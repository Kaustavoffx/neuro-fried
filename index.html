<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEURO-FRIED: TITAN ASCENSION</title>
    <style>
        /* =========================================
           1. CORE CONFIGURATION
           ========================================= */
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@700&family=VT323&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&display=swap');

        :root {
            /* CYBERPUNK PALETTE */
            --bg-void: #020202;
            --neon-purple: #b026ff; --neon-cyan: #00f3ff; --neon-green: #39ff14;
            --neon-red: #ff003c; --neon-yellow: #fff200;

            /* GLASS UI VARS */
            --glass-surface: rgba(12, 12, 16, 0.9);
            --glass-border: 1px solid rgba(255, 255, 255, 0.15);
            --glass-blur: blur(20px);

            /* FONTS */
            --f-display: 'Orbitron', sans-serif; --f-hud: 'Rajdhani', sans-serif; --f-code: 'VT323', monospace;
        }

        /* ERA THEMES */
        body.t-1990 { --primary: #ff00ff; --secondary: #00ffff; }
        body.t-2000 { --primary: #00ff00; --secondary: #003300; }
        body.t-2010 { --primary: #ffffff; --secondary: #888888; }
        body.t-2020 { --primary: #ff0055; --secondary: #00ccff; }

        * { box-sizing: border-box; user-select: none; -webkit-user-drag: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0; background-color: var(--bg-void); color: white;
            font-family: var(--f-hud); height: 100vh; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            transition: filter 0.5s ease, background 1s ease;
        }

        /* =========================================
           2. VISUAL LAYERS
           ========================================= */
        #render-layer { position: fixed; inset: 0; z-index: 0; }
        .vignette { position: fixed; inset: 0; pointer-events: none; z-index: 1; background: radial-gradient(circle, transparent 30%, #000 100%); }
        .scanlines { position: fixed; inset: 0; pointer-events: none; z-index: 2; opacity: 0.5; background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.15) 50%); background-size: 100% 4px; }
        .noise { position: fixed; inset: 0; pointer-events: none; z-index: 3; opacity: 0.04; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E"); }

        /* =========================================
           3. UI FRAMEWORK
           ========================================= */
        header { position: fixed; top: 0; left: 0; width: 100%; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; z-index: 100; background: rgba(0,0,0,0.8); border-bottom: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
        .brand { font-family: var(--f-display); font-size: 1.6rem; letter-spacing: 2px; text-shadow: 0 0 15px var(--neon-purple); }
        .creator { font-family: var(--f-code); color: #888; font-size: 1rem; letter-spacing: 1px; }

        /* HUD */
        .hud-panel { position: absolute; z-index: 50; padding: 15px 30px; background: var(--glass-surface); backdrop-filter: var(--glass-blur); border: var(--glass-border); border-radius: 4px; box-shadow: 0 10px 40px rgba(0,0,0,0.6); transition: 0.3s; }
        .hud-left { top: 90px; left: 40px; border-left: 4px solid var(--neon-green); }
        .hud-right { top: 90px; right: 40px; border-right: 4px solid var(--neon-cyan); text-align: right; }
        .stat-label { font-size: 0.8rem; color: #888; margin-bottom: 5px; letter-spacing: 1px; }
        .stat-value { font-family: var(--f-display); font-size: 2.2rem; line-height: 1; }
        .entropy-track { width: 120px; height: 4px; background: #333; margin-top: 8px; float: right; }
        .entropy-fill { height: 100%; width: 100%; background: var(--neon-cyan); transition: width 0.5s, background 0.5s; }
        .status-badge { font-family: var(--f-code); font-size: 1rem; margin-top: 10px; display: block; color: var(--neon-cyan); text-shadow: 0 0 5px var(--neon-cyan); }
        .status-badge.offline { color: #555; text-shadow: none; text-decoration: line-through; }

        /* =========================================
           4. SCREENS
           ========================================= */
        .screen { position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; opacity: 0; pointer-events: none; transition: opacity 0.5s ease-in-out; padding-top: 60px; }
        .screen.active { opacity: 1; pointer-events: all; }
        .hidden { display: none !important; opacity: 0 !important; }

        /* LANDING */
        h1.glitch-title { font-family: var(--f-display); font-size: 8vw; color: white; margin: 0; line-height: 0.9; text-transform: uppercase; text-align: center; text-shadow: 4px 4px 0px var(--neon-purple); animation: float 4s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .subtitle { font-family: var(--f-code); color: var(--neon-cyan); letter-spacing: 4px; margin: 10px 0 50px 0; background: rgba(0, 243, 255, 0.1); padding: 5px 20px; border: 1px solid var(--neon-cyan); }
        .mission-log { font-family: var(--f-code); color: #ccc; background: var(--glass-surface); border: var(--glass-border); padding: 30px 50px; border-radius: 8px; margin-bottom: 50px; text-align: left; line-height: 1.8; font-size: 1.1rem; max-width: 650px; box-shadow: 0 20px 60px rgba(0,0,0,0.7); border-left: 4px solid var(--neon-yellow); position: relative; }
        .mission-log strong { color: white; } .highlight { color: var(--neon-green); }

        /* FIXED BUTTON */
        .tech-btn { position: relative; z-index: 999999; background: rgba(255, 255, 255, 0.05); color: white; border: none; padding: 25px 60px; font-family: var(--f-display); font-size: 1.5rem; cursor: pointer; text-transform: uppercase; transition: all 0.2s; clip-path: polygon(20px 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%, 0 20px); box-shadow: inset 0 0 0 2px rgba(255,255,255,0.15); letter-spacing: 2px; pointer-events: auto; touch-action: manipulation; }
        .tech-btn:hover { background: var(--neon-purple); color: black; box-shadow: 0 0 50px var(--neon-purple); transform: scale(1.05); }

        /* GAME */
        .game-grid { width: 90%; max-width: 1000px; display: flex; flex-direction: column; gap: 30px; }
        .timer-rail { width: 100%; height: 12px; background: #1a1a1a; border: 1px solid #444; transform: skewX(-20deg); overflow: hidden; }
        .timer-fill { width: 100%; height: 100%; background: var(--neon-green); box-shadow: 0 0 20px var(--neon-green); transition: width 0.1s linear, background 0.3s; }
        .q-card { background: var(--glass-surface); backdrop-filter: blur(20px); padding: 50px; text-align: center; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); position: relative; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .q-card::after { content:''; position:absolute; bottom:0; right:0; width:30px; height:30px; border-bottom:2px solid var(--neon-cyan); border-right:2px solid var(--neon-cyan); }
        .era-display { font-family: var(--f-display); color: var(--neon-cyan); font-size: 1.5rem; margin-bottom: 20px; display: block; opacity: 0.8; letter-spacing: 4px; }
        .q-text { font-size: 2.2rem; line-height: 1.3; text-shadow: 0 4px 10px black; }
        .opt-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .opt-btn { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); padding: 30px; font-family: var(--f-hud); font-size: 1.4rem; color: #ddd; cursor: pointer; transition: 0.15s; display: flex; align-items: center; justify-content: center; min-height: 100px; position: relative; overflow: hidden; }
        .opt-btn:hover { background: rgba(0, 243, 255, 0.1); border-color: var(--neon-cyan); color: var(--neon-cyan); transform: translateY(-5px); }

        /* TRANSITION */
        #era-transition h1 { font-family: var(--f-display); font-size: 10rem; margin: 20px 0; color: transparent; -webkit-text-stroke: 3px var(--neon-cyan); text-shadow: 0 0 50px var(--neon-cyan); }

        /* SHARE */
        #s-over { justify-content: flex-start; padding-top: 100px; overflow-y: auto; }
        .go-title { font-family: var(--f-display); font-size: 5rem; color: var(--neon-red); margin-bottom: 40px; text-shadow: 0 0 40px var(--neon-red); }
        .share-layout { display: flex; gap: 50px; justify-content: center; flex-wrap: wrap; width: 100%; padding-bottom: 50px; }
        .card-preview { width: 320px; height: 480px; background: #000; border: 2px solid var(--neon-purple); position: relative; box-shadow: 0 0 60px rgba(176, 38, 255, 0.2); flex-shrink: 0; }
        .card-img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%) contrast(1.2); }
        .card-overlay { position: absolute; inset: 0; background: linear-gradient(to top, black 20%, transparent 80%); }
        .card-header { position: absolute; top: 20px; width: 100%; text-align: center; font-family: var(--f-display); color: var(--neon-cyan); font-size: 0.9rem; z-index: 5; letter-spacing: 2px; }
        .card-data { position: absolute; bottom: 25px; width: 100%; text-align: center; z-index: 5; }
        .score-big { font-family: var(--f-display); font-size: 4.5rem; line-height: 1; color: var(--neon-green); text-shadow: 0 0 20px var(--neon-green); }
        .name-big { font-family: var(--f-code); font-size: 1.8rem; text-transform: uppercase; margin-top: 10px; letter-spacing: 2px; }
        .controls { display: flex; flex-direction: column; gap: 20px; width: 320px; }
        .input-row { display: flex; align-items: center; border-bottom: 1px solid #444; padding: 10px 0; }
        .clean-in { background: transparent; border: none; color: white; font-family: var(--f-display); font-size: 1.5rem; width: 100%; outline: none; padding-left: 15px; text-transform: uppercase; }
        .action-btn { padding: 18px; background: rgba(255,255,255,0.05); border: 1px solid #444; color: white; font-family: var(--f-hud); font-size: 1.1rem; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .action-btn:hover { background: #333; border-color: white; }
        
        .screenshot-msg { color: var(--neon-cyan); font-family: var(--f-display); font-size: 1.1rem; text-align: center; line-height: 1.5; margin: 20px 0; text-shadow: 0 0 10px var(--neon-cyan); border: 1px solid rgba(0, 243, 255, 0.4); padding: 20px; background: rgba(0, 243, 255, 0.05); border-radius: 8px; letter-spacing: 1px; animation: pulseGlow 3s infinite; }
        @keyframes pulseGlow { 0% { box-shadow: 0 0 5px rgba(0,243,255,0.2); } 50% { box-shadow: 0 0 20px rgba(0,243,255,0.5); } 100% { box-shadow: 0 0 5px rgba(0,243,255,0.2); } }

        /* FX */
        .rewind-active { animation: smoothRewind 1s cubic-bezier(0.4, 0, 0.2, 1); will-change: transform, filter; }
        @keyframes smoothRewind { 0% { filter: invert(0); transform: scale(1); } 50% { filter: invert(1); transform: scale(1.02); } 100% { filter: invert(0); transform: scale(1); } }
        .shake { animation: shake 0.4s; } @keyframes shake { 0%, 100% { transform: translate(0); } 25% { transform: translate(-5px, 5px); } 75% { transform: translate(5px, -5px); } }
        .correct-flash { animation: flashG 0.3s; } @keyframes flashG { 0% { background: rgba(57, 255, 20, 0.3); } 100% { background: transparent; } }
        .singularity-mode { filter: invert(1) hue-rotate(180deg); }

        @media (max-width: 800px) { .opt-grid { grid-template-columns: 1fr; } h1.glitch-title { font-size: 15vw; } .share-layout { flex-direction: column; align-items: center; } .mission-log { padding: 20px; font-size: 1rem; } }
    </style>
</head>
<body>

    <div id="render-layer"><canvas id="c"></canvas></div>
    <div class="vignette"></div>
    <div class="scanlines"></div>
    <div class="noise"></div>

    <header>
        <div class="brand">NEURO-FRIED</div>
        <div class="creator">DEV: KAUSTAV CHOWDHURY</div>
    </header>

    <div id="hud" style="display:none; opacity: 0; transition: opacity 1s;">
        <div class="hud-panel hud-left">
            <div class="stat-label">AURA SCORE</div>
            <div class="stat-value" id="hud-score">0</div>
        </div>
        <div class="hud-panel hud-right">
            <div class="stat-label">TIMELINE STABILITY</div>
            <div class="entropy-track"><div class="entropy-fill" id="stability-bar"></div></div>
            <div class="status-badge" id="badge-rewind" style="margin-top:25px;">REWIND: ONLINE</div>
            <div class="status-badge" id="badge-freeze">FREEZE [SPACE]: ONLINE</div>
        </div>
    </div>

    <div id="s-title" class="screen active">
        <h1 class="glitch-title">NEURO<br>FRIED</h1>
        <div class="subtitle">/// TITAN_ASCENSION_V8 ///</div>
        
        <div class="mission-log">
            <strong>MISSION PROTOCOL:</strong><br>
            [1] ANSWER TRIVIA TO STABILIZE TIMELINE<br>
            [2] TIME ACCELERATES CONTINUOUSLY<br>
            [3] <span class="highlight">REWIND</span> & <span class="highlight">FREEZE</span> AVAILABLE<br>
            [4] <span style="color:var(--neon-red)">WARNING:</span> POWERS CAUSE ENTROPY DECAY
        </div>

        <button class="tech-btn" id="init-btn" onclick="Game.startSequence()">INITIALIZE SYSTEM</button>
    </div>

    <div id="s-trans" class="screen hidden">
        <div style="font-family:var(--f-code); letter-spacing:4px; color:#888;">WARPING TO...</div>
        <h1 id="year-counter">1990</h1>
    </div>

    <div id="s-game" class="screen hidden">
        <div class="game-grid">
            <div class="timer-rail"><div class="timer-fill" id="timer-bar"></div></div>
            <div class="q-card">
                <span class="era-display" id="era-tag">YEAR: 1990</span>
                <div class="q-text" id="q-text">LOADING...</div>
            </div>
            <div class="opt-grid" id="opt-area"></div>
        </div>
    </div>

    <div id="s-over" class="screen hidden">
        <h1 class="go-title">SIGNAL LOST</h1>
        <div class="share-layout">
            <div id="share-card" class="card-preview">
                <img id="card-img" class="card-img" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%25' height='100%25'%3E%3Crect fill='%23111' width='100%25' height='100%25'/%3E%3Ctext x='50%25' y='50%25' fill='%23333' font-family='monospace' text-anchor='middle' dominant-baseline='middle'%3ENO IMAGE%3C/text%3E%3C/svg%3E">
                <div class="card-overlay"></div>
                <div style="position:absolute; inset:10px; border:1px solid rgba(255,255,255,0.2);"></div>
                <div class="card-header">NEURO-FRIED // AGENT</div>
                <div class="card-data">
                    <div style="font-family:var(--f-code); color:#aaa;">FINAL AURA</div>
                    <div class="score-big" id="final-score">0</div>
                    <div class="name-big" id="card-name">UNKNOWN</div>
                </div>
            </div>
            <div class="controls">
                <div class="input-row"><span style="font-size:1.5rem; color:var(--neon-yellow);">âœŽ</span><input type="text" class="clean-in" placeholder="NAME" maxlength="10" oninput="updateName(this.value)"></div>
                <label class="action-btn">ðŸ“· UPLOAD PHOTO <input type="file" hidden accept="image/*" onchange="uploadImg(this)"></label>
                
                <div style="height:1px; background:#333; margin:10px 0;"></div>
                
                <div class="screenshot-msg">
                    TAKE A SCREENSHOT AND REVIVE YOUR HAPPINESS<br>
                    <span style="font-size:0.8em; color:#fff; opacity:0.7;">SHARE AMONG ALL</span>
                </div>

                <button class="action-btn" onclick="location.reload()">ðŸ”„ REBOOT SYSTEM</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. DATA (MUST BE FIRST) ---
        const DB = [
            {y:1990, q:"Before Google, we searched with...", a:"AltaVista", w:["Bing","DuckDuckGo"]},
            {y:1992, q:"First SMS text ever sent.", a:"Merry Christmas", w:["Hello World","Watson come here"]},
            {y:1995, q:"Brendan Eich created JavaScript in...", a:"10 Days", w:["10 Years","2 Weeks"]},
            {y:1997, q:"Deep Blue defeated Chess GM...", a:"Kasparov", w:["Carlsen","Fischer"]},
            {y:1999, q:"Napster revolutionized...", a:"P2P Music", w:["Video Streaming","Blockchain"]},
            {y:2001, q:"First iPod storage capacity.", a:"5 GB", w:["1 GB","500 MB"]},
            {y:2004, q:"Gmail launch date.", a:"April 1st", w:["Jan 1st","Christmas"]},
            {y:2007, q:"Missing feature on iPhone 1.", a:"App Store", w:["Camera","Safari"]},
            {y:2009, q:"Satoshi Nakamoto created...", a:"Bitcoin", w:["Ethereum","NFTs"]},
            {y:2012, q:"Oculus Rift Kickstarter raised...", a:"$2.4 Million", w:["$50k","$100 Million"]},
            {y:2016, q:"Niantic forced us outside with...", a:"Pokemon GO", w:["Ingress","Harry Potter"]},
            {y:2020, q:"Top app of the lockdown?", a:"Zoom", w:["Skype","Slack"]},
            {y:2024, q:"Google's multimodal AI model.", a:"Gemini", w:["Bard","Gemma"]},
            {y:2035, q:"SYSTEM FAILURE. YOU HAVE BEEN HERE BEFORE.", a:"IGNORE", w:["PANIC","RESET"]}
        ];

        // --- 2. GAME LOGIC (MUST BE SECOND) ---
        const Game = {
            active: false, score: 0, round: 0, maxTime: 8000, curr: 0, timer: null,
            rewinding: false, freeze: false, entropy: 0, singularity: false,
            abilities: { rewind: true, freeze: true },

            startSequence() {
                // UI Switch
                const t = document.getElementById('s-title'); 
                const h = document.getElementById('hud'); 
                t.classList.remove('active'); t.classList.add('hidden');
                h.style.display='block'; setTimeout(()=>h.style.opacity=1, 50);

                // Audio Safe Init
                try { AudioEngine.init(); AudioEngine.resume(); AudioEngine.startMusic(); } catch(e){}

                this.score=0; this.round=0; this.abilities={rewind:true, freeze:true};
                this.maxTime=8000; this.entropy=0; this.singularity=false;
                this.updateStability();
                window.onkeydown = (e) => { if(e.code==='Space') this.triggerFreeze(); };
                
                // Canvas Check
                if(!Canvas.running) Canvas.init();

                setTimeout(() => this.nextRound(), 500);
            },

            updateStability() {
                const fill = document.getElementById('stability-bar');
                const pct = Math.max(0, 100 - (this.entropy * 100));
                fill.style.width = pct + "%";
                fill.style.backgroundColor = pct > 50 ? "var(--neon-cyan)" : "var(--neon-red)";
                document.body.style.filter = `grayscale(${this.entropy}) contrast(${1+this.entropy})`;
            },

            nextRound() {
                if(this.round >= DB.length) { this.round=0; this.maxTime*=0.85; }
                const d = DB[this.round];
                
                if(this.round === 7) { this.singularityEvent(); return; }

                const g = document.getElementById('s-game'); const t = document.getElementById('s-trans');
                g.classList.remove('active'); g.classList.add('hidden');
                t.classList.remove('hidden'); t.classList.add('active');
                document.getElementById('year-counter').innerText = d.y;
                document.body.className = `t-${Math.floor(d.y/10)*10}`;

                setTimeout(() => {
                    t.classList.remove('active'); t.classList.add('hidden');
                    g.classList.remove('hidden'); g.classList.add('active');
                    
                    document.getElementById('era-tag').innerText = `TIMELINE: ${d.y}`;
                    document.getElementById('q-text').innerText = d.q;
                    document.getElementById('q-text').style.color = "white"; 
                    
                    const gr = document.getElementById('opt-area'); gr.innerHTML = "";
                    [d.a, ...d.w].sort(()=>Math.random()-0.5).forEach(txt => {
                        const b = document.createElement('div');
                        b.className = "opt-btn"; b.innerText = txt;
                        b.onmouseenter = () => AudioEngine.sfx('win'); 
                        b.onclick = () => this.check(txt, d.a);
                        gr.appendChild(b);
                    });
                    this.active = true; this.startTimer();
                }, 1200);
            },

            singularityEvent() {
                this.singularity = true; this.active = false;
                document.body.classList.add('singularity-mode');
                const g=document.getElementById('s-game'); g.classList.remove('hidden'); g.classList.add('active');
                document.getElementById('era-tag').innerText = "FATAL EXCEPTION";
                document.getElementById('q-text').innerText = "SYSTEM FAILURE. YOU HAVE BEEN HERE BEFORE.";
                document.getElementById('opt-area').innerHTML = "";
                setTimeout(() => {
                    document.body.classList.remove('singularity-mode');
                    this.singularity = false; this.round++; this.nextRound();
                }, 3000);
            },

            startTimer() {
                clearInterval(this.timer); this.curr = this.maxTime;
                this.timer = setInterval(() => {
                    if(this.freeze || !this.active) return;
                    this.curr -= 20;
                    const pct = (this.curr / this.maxTime) * 100;
                    document.getElementById('timer-bar').style.width = pct + "%";
                    if(pct < 30) document.getElementById('timer-bar').style.background = "var(--neon-red)";
                    else document.getElementById('timer-bar').style.background = "var(--neon-green)";
                    if(this.curr <= 0) { clearInterval(this.timer); this.fail(); }
                }, 20);
            },

            check(ans, cor) {
                if(!this.active) return;
                clearInterval(this.timer);
                if(ans === cor) {
                    AudioEngine.sfx('win');
                    const mult = 1.0 - (this.entropy * 0.5);
                    this.score += Math.floor((100 + Math.ceil(this.curr/10)) * mult);
                    document.getElementById('hud-score').innerText = this.score;
                    document.body.classList.add('correct-flash');
                    setTimeout(()=>document.body.classList.remove('correct-flash'), 300);
                    this.round++; this.nextRound();
                } else { this.fail(); }
            },

            fail() {
                clearInterval(this.timer);
                if(this.abilities.rewind) { this.triggerRewind(); } else { this.gameOver(); }
            },

            triggerRewind() {
                this.abilities.rewind = false; this.entropy += 0.3; this.updateStability();
                document.getElementById('badge-rewind').classList.add('offline');
                document.getElementById('badge-rewind').innerText = "REWIND: DESTROYED";
                AudioEngine.sfx('rewind');
                this.rewinding = true; document.body.classList.add('rewind-active');
                document.getElementById('q-text').innerHTML = "<span style='color:var(--neon-yellow)'>âš  TIMELINE DAMAGED.<br>REWINDING...</span>";
                setTimeout(() => {
                    this.rewinding = false; document.body.classList.remove('rewind-active');
                    this.maxTime += 1000; this.nextRound(); 
                }, 1000);
            },

            triggerFreeze() {
                if(!this.active || !this.abilities.freeze) return;
                this.abilities.freeze = false; this.entropy += 0.15; this.updateStability();
                document.getElementById('badge-freeze').classList.add('offline');
                document.getElementById('badge-freeze').innerText = "FREEZE: EMPTY";
                document.getElementById('timer-bar').style.background = "var(--neon-cyan)";
                this.freeze = true; setTimeout(() => { this.freeze = false; }, 3000);
            },

            gameOver() {
                this.active = false; AudioEngine.sfx('lose');
                document.getElementById('s-game').classList.remove('active'); document.getElementById('s-game').classList.add('hidden');
                document.getElementById('hud').style.display='none';
                document.getElementById('s-over').classList.remove('hidden'); document.getElementById('s-over').classList.add('active');
                document.getElementById('final-score').innerText = this.score;
            }
        };

        // --- 3. AUDIO ENGINE ---
        const AudioEngine = {
            ctx: null, isPlaying: false, baseRate: 1.0, notes: [110, 130.8, 146.8, 196.0, 220.0], tick: 0,
            init() { try { if(!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e){} },
            resume() { if(this.ctx && this.ctx.state === 'suspended') this.ctx.resume(); },
            playTone(freq, type, dur, vol) {
                if(!this.ctx) return;
                const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
                o.type = type; 
                let detune = (Game.entropy > 0.5) ? (Math.random()-0.5)*100 : 0;
                o.frequency.setValueAtTime(freq + detune, this.ctx.currentTime);
                g.gain.setValueAtTime(0, this.ctx.currentTime);
                g.gain.linearRampToValueAtTime(vol, this.ctx.currentTime + 0.02);
                g.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + dur);
                o.connect(g); g.connect(this.ctx.destination); o.start(); o.stop(this.ctx.currentTime + dur);
            },
            startMusic() {
                if(this.isPlaying || !this.ctx) return; this.isPlaying = true;
                setInterval(() => {
                    if(!Game.active || Game.singularity) return;
                    if(this.tick % 4 === 0) this.playTone(55, 'sawtooth', 0.4, 0.3);
                    if(this.tick % 2 === 0) this.playTone(this.notes[this.tick%this.notes.length]*2, 'triangle', 0.1, 0.1);
                    this.tick++;
                }, 200);
            },
            sfx(type) {
                if(!this.ctx) return;
                if(type==='win') { this.playTone(440,'sine',0.1,0.2); setTimeout(()=>this.playTone(880,'sine',0.2,0.2),100); }
                if(type==='lose') { this.playTone(100,'sawtooth',0.6,0.4); }
                if(type==='rewind') { 
                    const o=this.ctx.createOscillator(); o.frequency.setValueAtTime(200,this.ctx.currentTime);
                    o.frequency.linearRampToValueAtTime(1000,this.ctx.currentTime+0.8);
                    o.connect(this.ctx.destination); o.start(); o.stop(this.ctx.currentTime+0.8);
                }
            }
        };

        // --- 4. VISUALS (CANVAS) ---
        const Canvas = {
            el: document.getElementById('c'), ctx: document.getElementById('c').getContext('2d'), w:0, h:0, stars:[], running: false,
            init() { 
                this.resize(); window.addEventListener('resize', ()=>this.resize()); 
                for(let i=0; i<300; i++) this.stars.push({x:(Math.random()-0.5)*this.w*2, y:(Math.random()-0.5)*this.h*2, z:Math.random()*2}); 
                this.running = true;
                this.loop(); 
            },
            resize() { this.w = this.el.width = window.innerWidth; this.h = this.el.height = window.innerHeight; },
            loop() {
                this.ctx.fillStyle = "#020202"; this.ctx.fillRect(0,0,this.w,this.h);
                let speed = (typeof Game !== 'undefined' && Game.active) ? 2 + (Game.round * 0.5) : 0.5;
                if(typeof Game !== 'undefined') {
                    if(Game.rewinding) speed = -5;
                    if(Game.singularity) speed = 0;
                }
                this.stars.forEach(s => {
                    if(typeof Game !== 'undefined' && Game.entropy > 0.6) { s.x+=(Math.random()-0.5)*2; s.y+=(Math.random()-0.5)*2; }
                    s.z -= speed * 0.01; if(s.z <= 0) { s.z = 2; s.x = (Math.random()-0.5)*this.w*2; s.y = (Math.random()-0.5)*this.h*2; }
                    const sx = (s.x / s.z) + this.w/2; const sy = (s.y / s.z) + this.h/2; const size = (1 - s.z/2) * 3;
                    if(sx>0 && sx<this.w && sy>0 && sy<this.h) {
                        const a = 1 - (s.z/2); this.ctx.fillStyle = `rgba(255,255,255,${a})`; this.ctx.fillRect(sx, sy, size, size);
                    }
                });
                if(this.running) requestAnimationFrame(()=>this.loop());
            }
        };

        // BINDING (Last)
        Canvas.init();
        
        // SHARE LOGIC
        function updateName(v) { document.getElementById('card-name').innerText = v.toUpperCase() || "UNKNOWN"; }
        function uploadImg(input) { if(input.files[0]) { const r=new FileReader(); r.onload=(e)=>document.getElementById('card-img').src=e.target.result; r.readAsDataURL(input.files[0]); } }
    </script>
</body>
</html>