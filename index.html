<!-- 
    NEURO-FRIED
    Author: Kaustav Chowdhury
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEURO-FRIED: FINAL SURVIVAL</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* ========== CUSTOM FONTS ========== */
        @font-face {
            font-family: 'LigerRegular';
            src: url('LigerRegular-OGYE4.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'Neurobyte';
            src: url('Neurobyte-drBgX.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'FastlaneThree';
            src: url('FastlaneThree-gw7D6.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'BruceforeverRegular';
            src: url('BruceforeverRegular-5y5zB.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'QuantroSport';
            src: url('QuantroSport-0vY5o.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'Kroegbainder';
            src: url('Kroegbainder-gw07p.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        :root {
            /* EXTREME BLOODY HORROR THEME */
            --bg-color: #050000;
            --bg-dark: #020000;
            --primary: #8b00ff;
            --primary-light: #a020f0;
            --secondary: #6a0dad;
            --dark-blue: #1a0000;
            --accent: #ffffff;
            --danger: #ff0000;
            --blood: #8b0000;
            --blood-dark: #4a0000;
            --blood-bright: #cc0000;
            --green: #00ff00;
            --text-main: #ffffff;
            --text-dim: #cccccc;
            --particle-col: #ff0000;
            --horror-glow: rgba(255, 0, 0, 0.25);
            --blood-glow: rgba(139, 0, 0, 0.4);

            /* BLOOD-STAINED GLASS - Less opaque for readability */
            --glass-bg: rgba(15, 0, 0, 0.9);
            --glass-border: 1px solid rgba(139, 0, 0, 0.5);
            --glass-blur: blur(30px);
            --glass-shadow: 0 30px 80px rgba(139, 0, 0, 0.4);

            /* CUSTOM FONTS */
            --f-title: 'LigerRegular', sans-serif;
            /* Big Titles like NEURO FRIED */
            --f-button: 'Neurobyte', sans-serif;
            /* All Buttons */
            --f-ui: 'FastlaneThree', sans-serif;
            /* Game Over, UI elements */
            --f-mono: 'BruceforeverRegular', monospace;
            /* Info, Rules, Typewriting */
            --f-tutorial: 'QuantroSport', sans-serif;
            /* Landing/Tutorial Page */
        }

        /* ========== GLOBAL FONT APPLICATION ========== */

        /* ALL BUTTONS - Neurobyte */
        button,
        .btn,
        .tech-btn,
        .mega-btn,
        .cyber-btn,
        .opt-btn,
        [class*="button"],
        input[type="submit"],
        input[type="button"] {
            font-family: var(--f-button) !important;
        }

        /* LANDING & TUTORIAL PAGE - QuantroSport */
        #landing-page,
        #landing-page * {
            font-family: var(--f-tutorial) !important;
        }

        /* Override for landing page titles to use Valorax */
        #landing-page .hero-title,
        #landing-page h1,
        .hero-title {
            font-family: var(--f-title) !important;
        }

        /* GAME OVER SCREEN - FastlaneThree */
        #s-over,
        #s-over * {
            font-family: var(--f-ui) !important;
        }

        /* Game Over Headline uses title font */
        #game-over-headline {
            font-family: var(--f-title) !important;
        }

        /* INFO / RULES / TYPEWRITING - BruceforeverRegular */
        .info-text,
        .rule-text,
        .typewriter,
        .tutorial-content,
        .env-info,
        .story-text,
        [class*="description"],
        .q-text,
        .era-tag {
            font-family: var(--f-mono) !important;
        }

        /* TIME LOOP MODE - Kroegbainder */
        body.mode-B *,
        #s-luck *,
        .luck-box-container *,
        .dream-mode-container * {
            font-family: 'Kroegbainder', sans-serif !important;
        }

        /* ROYAL TEXT SHADERS */
        .text-royal {
            background: linear-gradient(to bottom, #ffd700, #ffaa00, #ffd700);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: textShine 3s linear infinite;
            background-size: 200% auto;
        }

        .text-chrome {
            background: linear-gradient(to bottom, #ffffff, #a0a0a0, #ffffff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
            animation: textShine 4s linear infinite reverse;
            background-size: 200% auto;
        }

        @keyframes textShine {
            to {
                background-position: 200% center;
            }
        }

        /* BUTTON GLINT */
        .btn-glint {
            position: relative;
            overflow: hidden;
        }

        .btn-glint::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg,
                    transparent,
                    rgba(255, 255, 255, 0.6),
                    transparent);
            transform: skewX(-20deg);
            animation: glintAnim 3s infinite;
        }

        @keyframes glintAnim {
            0% {
                left: -100%;
            }

            20% {
                left: 200%;
            }

            100% {
                left: 200%;
            }
        }

        /* CATEGORY THEMES */
        body.t-finance {
            --primary: #ffd700;
            --secondary: #50c878;
            --bg-color: #020502;
            --text-main: #fff;
            --particle-col: #fff;
        }

        body.t-code {
            --primary: #00ff00;
            --secondary: #008f11;
            --bg-color: #020502;
            --text-main: #fff;
            --particle-col: #0f0;
        }

        body.t-space {
            --primary: #9d00ff;
            --secondary: #e0b0ff;
            --bg-color: #05000a;
            --text-main: #fff;
            --particle-col: #fff;
        }

        body.t-social {
            --primary: #ff0055;
            --secondary: #ffcc00;
            --bg-color: #0f0202;
            --text-main: #fff;
            --particle-col: #fff;
        }

        body.t-gaming {
            --primary: #ff4400;
            --secondary: #ffee00;
            --bg-color: #0d0500;
            --text-main: #fff;
            --particle-col: #fff;
        }

        /* DUEL MODE THEMES (Day/Night) */
        body.time-day {
            --bg-color: #ffffff;
            --bg-dark: #f0f0f0;
            --primary: #000000;
            --primary-light: #333333;
            --secondary: #666666;
            --current-bg: #ffffff;
            --text-main: #000000;
            --text-dim: #555555;
            --particle-col: #000000;
            --glass-bg: rgba(255, 255, 255, 0.9);
            --glass-border: 1px solid rgba(0, 0, 0, 0.2);
            --glass-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        body.time-night {
            /* REVERT TO STANDARD HORROR */
            --bg-color: #050000;
            --primary: #ff1a1a;
            --text-main: #ffffff;
            --glass-bg: rgba(15, 0, 0, 0.9);
            transition: background-color 3s ease, color 3s ease;
        }

        /* Time Loop Mode - Unique Theme */
        body.mode-timeloop {
            --bg-color: #000508;
            --primary: #00ffff;
            --primary-light: #40ffff;
            --secondary: #00cccc;
            --danger: #ff00ff;
            --text-main: #ffffff;
            --text-dim: #80ffff;
            --particle-col: #00ffff;
            --glass-bg: rgba(0, 20, 30, 0.9);
            --glass-border: 1px solid rgba(0, 255, 255, 0.3);
            --horror-glow: rgba(0, 255, 255, 0.2);
            --loop-intensity: 0;
        }

        body.mode-timeloop .vignette {
            background: radial-gradient(circle, transparent 30%, rgba(0, 50, 50, 0.8) 100%);
        }

        body.mode-timeloop .blood-veins {
            background:
                linear-gradient(90deg, transparent 49%, rgba(0, 255, 255, 0.1) 50%, transparent 51%),
                linear-gradient(0deg, transparent 49%, rgba(0, 255, 255, 0.1) 50%, transparent 51%);
        }

        body.mode-timeloop .blood-drip {
            display: none;
        }

        /* Progressive glitch based on loop count */
        body.mode-timeloop[data-loop="1"] {
            --loop-intensity: 1;
        }

        body.mode-timeloop[data-loop="2"] {
            --loop-intensity: 2;
        }

        body.mode-timeloop[data-loop="3"] {
            --loop-intensity: 3;
        }

        body.mode-timeloop[data-loop="4"] {
            --loop-intensity: 4;
        }

        body.mode-timeloop[data-loop="5"] {
            --loop-intensity: 5;
        }

        body.mode-timeloop::before {
            content: '';
            position: fixed;
            inset: 0;
            background: repeating-linear-gradient(0deg,
                    rgba(0, 255, 255, calc(0.02 * var(--loop-intensity, 0))) 0px,
                    transparent 2px,
                    transparent 4px);
            pointer-events: none;
            z-index: 9998;
            animation: crtFlicker 0.1s infinite;
        }

        @keyframes crtFlicker {

            0%,
            100% {
                opacity: 0.8;
            }

            50% {
                opacity: 1;
            }
        }

        /* Loop glitch animation - intensifies with each loop */
        @keyframes loopGlitch {

            0%,
            100% {
                transform: translate(0);
                filter: hue-rotate(0deg);
            }

            20% {
                transform: translate(calc(-2px * var(--loop-intensity, 1)), 0);
                filter: hue-rotate(10deg);
            }

            40% {
                transform: translate(calc(2px * var(--loop-intensity, 1)), calc(1px * var(--loop-intensity, 1)));
            }

            60% {
                transform: translate(calc(-1px * var(--loop-intensity, 1)), calc(-1px * var(--loop-intensity, 1)));
                filter: hue-rotate(-10deg);
            }

            80% {
                transform: translate(calc(1px * var(--loop-intensity, 1)), 0);
            }
        }

        body.mode-timeloop.loop-glitching {
            animation: loopGlitch 0.3s ease-in-out;
        }

        /* Loop Counter HUD */
        #loop-counter {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-family: var(--f-title);
            font-size: 1.5rem;
            color: #00ffff;
            text-shadow: 0 0 15px #00ffff, 0 0 30px #00ffff;
            z-index: 9999;
            padding: 10px 30px;
            background: rgba(0, 50, 50, 0.8);
            border: 2px solid #00ffff;
            border-radius: 30px;
            letter-spacing: 3px;
        }

        #loop-counter.hidden {
            display: none;
        }

        /* Loop restart overlay */
        .loop-restart-overlay {
            position: fixed;
            inset: 0;
            background: #00ffff;
            z-index: 100000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .loop-restart-overlay.flash {
            animation: loopFlash 0.8s ease-out;
        }

        @keyframes loopFlash {
            0% {
                opacity: 0.8;
            }

            100% {
                opacity: 0;
            }
        }

        /* Time Loop Mode - Game UI */

        /* Question Card - Hexagonal Border Effect */
        body.mode-timeloop .question-card {
            background: linear-gradient(135deg, rgba(0, 30, 30, 0.95) 0%, rgba(0, 50, 50, 0.9) 100%);
            border: 2px solid #00ffff;
            border-radius: 4px;
            clip-path: polygon(3% 0, 97% 0, 100% 3%, 100% 97%, 97% 100%, 3% 100%, 0 97%, 0 3%);
            box-shadow:
                0 0 30px rgba(0, 255, 255, 0.4),
                inset 0 0 50px rgba(0, 255, 255, 0.1);
            animation: timeloopCardPulse 3s ease-in-out infinite;
        }

        @keyframes timeloopCardPulse {

            0%,
            100% {
                box-shadow: 0 0 30px rgba(0, 255, 255, 0.4), inset 0 0 50px rgba(0, 255, 255, 0.1);
            }

            50% {
                box-shadow: 0 0 50px rgba(0, 255, 255, 0.6), inset 0 0 70px rgba(0, 255, 255, 0.2);
            }
        }

        /* Era Display */
        body.mode-timeloop .era-display {
            color: #00ffff !important;
            text-shadow: 0 0 20px #00ffff;
            letter-spacing: 4px;
        }

        /* Question Text */
        body.mode-timeloop .q-txt {
            color: #ffffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        /* Option Buttons - Pill/Capsule Shape with Glow */
        body.mode-timeloop .opt-btn {
            background: linear-gradient(135deg, rgba(0, 40, 40, 0.9) 0%, rgba(0, 60, 60, 0.8) 100%);
            border: 2px solid rgba(0, 255, 255, 0.5);
            border-radius: 50px;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        body.mode-timeloop .opt-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.3), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s;
        }

        body.mode-timeloop .opt-btn:hover {
            background: linear-gradient(135deg, rgba(0, 80, 80, 0.9) 0%, rgba(0, 100, 100, 0.8) 100%);
            border-color: #00ffff;
            box-shadow:
                0 0 30px rgba(0, 255, 255, 0.5),
                0 0 60px rgba(0, 255, 255, 0.3);
            transform: scale(1.05);
            color: #ffffff;
        }

        body.mode-timeloop .opt-btn:hover::before {
            transform: translateX(100%);
        }

        /* Timer Panel */
        body.mode-timeloop #timer-panel {
            background: rgba(0, 30, 30, 0.9);
            border: 2px solid #00ffff;
            border-radius: 4px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.4);
        }

        body.mode-timeloop .timer-display {
            color: #00ffff !important;
            text-shadow: 0 0 20px #00ffff;
        }

        body.mode-timeloop .timer-label {
            color: rgba(0, 255, 255, 0.7);
        }

        /* Progress Bar */
        body.mode-timeloop .timer-bar-fill {
            background: linear-gradient(90deg, #00ffff, #00ff88);
            box-shadow: 0 0 15px #00ffff;
        }

        /* HUD Elements */
        body.mode-timeloop #hud {
            background: linear-gradient(180deg, rgba(0, 30, 30, 0.95) 0%, transparent 100%);
        }

        body.mode-timeloop #hud-score {
            color: #00ffff;
            text-shadow: 0 0 15px #00ffff;
        }

        body.mode-timeloop #hud-streak {
            color: #00ff88;
            text-shadow: 0 0 15px #00ff88;
        }

        /* Power Buttons */
        body.mode-timeloop .power-btn {
            border-color: rgba(0, 255, 255, 0.5);
            background: rgba(0, 30, 30, 0.8);
        }

        body.mode-timeloop .power-btn:hover {
            border-color: #00ffff;
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.5);
        }

        /* Reality Anchors (Rewind charges) */
        body.mode-timeloop .reality-anchor {
            background: #00ffff;
            box-shadow: 0 0 10px #00ffff;
        }

        /* Timeline bar */
        body.mode-timeloop .timeline-bar {
            background: linear-gradient(90deg, #00ffff 0%, #00ff88 50%, #00ffff 100%);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        /* Score sparkle effect */
        body.mode-timeloop .score-sparkle {
            color: #00ffff !important;
            text-shadow: 0 0 20px #00ffff;
        }

        /* Correct answer feedback */
        body.mode-timeloop .opt-btn.correct {
            background: linear-gradient(135deg, rgba(0, 100, 100, 0.9), rgba(0, 150, 150, 0.9)) !important;
            border-color: #00ff88 !important;
            box-shadow: 0 0 40px rgba(0, 255, 136, 0.6) !important;
        }

        /* Wrong answer feedback */
        body.mode-timeloop .opt-btn.wrong {
            background: linear-gradient(135deg, rgba(100, 0, 50, 0.9), rgba(150, 0, 75, 0.9)) !important;
            border-color: #ff0066 !important;
        }

        /* Glass panels */
        body.mode-timeloop .glass-panel {
            background: rgba(0, 30, 30, 0.85);
            border-color: rgba(0, 255, 255, 0.4);
        }

        /* Condition overlays */
        body.mode-timeloop .streak-overlay {
            color: #00ffff;
            text-shadow: 0 0 30px #00ffff;
        }

        /* Game over modifications for Time Loop */
        body.mode-timeloop #game-over-headline {
            color: #00ffff !important;
            text-shadow: 0 0 40px #00ffff !important;
        }

        /* SKIP TEXT BUTTON - Long Horizontal White Glitched */
        #skip-text-btn {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 80px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #fff;
            border-radius: 4px;
            color: #000;
            font-family: var(--f-title);
            font-size: 1.2rem;
            letter-spacing: 4px;
            cursor: pointer;
            z-index: 99999;
            transition: all 0.2s ease;
            animation: skipGlitch 0.3s infinite;
            text-transform: uppercase;
            font-weight: bold;
        }

        #skip-text-btn:hover {
            background: #fff;
            color: #000;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.8), 0 0 60px rgba(255, 255, 255, 0.4);
            transform: translateX(-50%) scale(1.05);
        }

        #skip-text-btn.hidden {
            display: none;
        }

        @keyframes skipGlitch {

            0%,
            100% {
                text-shadow: 2px 0 #ff0000, -2px 0 #00ffff;
                box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            }

            25% {
                text-shadow: -2px 0 #ff0000, 2px 0 #00ffff;
                box-shadow: 0 0 15px rgba(255, 255, 255, 0.7), inset 0 0 5px rgba(255, 0, 0, 0.2);
            }

            50% {
                text-shadow: 1px 1px #ff0000, -1px -1px #00ffff;
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.6);
            }

            75% {
                text-shadow: -1px -1px #ff0000, 1px 1px #00ffff;
                box-shadow: 0 0 15px rgba(255, 255, 255, 0.7), inset 0 0 5px rgba(0, 255, 255, 0.2);
            }
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--f-ui);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.8s ease, color 0.5s ease;
            animation: bgPulse 10s infinite alternate;
        }

        @keyframes bgPulse {
            0% {
                box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.8);
            }

            100% {
                box-shadow: inset 0 0 200px rgba(0, 0, 0, 1);
            }
        }

        /* Horror Effects */

        /* BLOOD RED AMBIENT - Intense glow from all edges */
        /* BODY BACKGROUND - now static black, visual moved to #tilt-ambient */
        body::before {
            content: none;
        }

        /* TILT AMBIENT - Moves with the layer */
        #tilt-ambient {
            position: absolute;
            inset: -100px;
            /* Overscan to avoid edges */
            background:
                radial-gradient(ellipse at 50% 0%, rgba(139, 0, 0, 0.6) 0%, transparent 40%),
                radial-gradient(ellipse at 0% 50%, rgba(255, 0, 0, 0.3) 0%, transparent 30%),
                radial-gradient(ellipse at 100% 50%, rgba(255, 0, 0, 0.3) 0%, transparent 30%),
                radial-gradient(ellipse at 50% 100%, rgba(139, 0, 0, 0.5) 0%, transparent 40%),
                radial-gradient(circle at 30% 20%, rgba(200, 0, 0, 0.2) 0%, transparent 20%),
                radial-gradient(circle at 70% 80%, rgba(200, 0, 0, 0.2) 0%, transparent 20%);
            pointer-events: none;
            z-index: -1;
            /* Behind render layer */
            animation: bloodPulse 4s ease-in-out infinite alternate;
        }

        @keyframes bloodPulse {
            0% {
                opacity: 0.5;
                filter: brightness(0.9);
            }

            50% {
                opacity: 0.8;
                filter: brightness(1.1);
            }

            100% {
                opacity: 0.6;
                filter: brightness(1);
            }
        }

        /* BLOOD VEINS OVERLAY - Creepy pulsing veins */
        .blood-veins {
            position: fixed;
            inset: 0;
            background:
                linear-gradient(90deg, transparent 49%, rgba(139, 0, 0, 0.1) 50%, transparent 51%),
                linear-gradient(0deg, transparent 49%, rgba(139, 0, 0, 0.1) 50%, transparent 51%);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 9996;
            animation: veinPulse 2s ease-in-out infinite;
            opacity: 0.3;
        }

        @keyframes veinPulse {

            0%,
            100% {
                opacity: 0.2;
            }

            50% {
                opacity: 0.4;
            }
        }

        /* BLOOD DRIP EFFECT - Subtle for readability */
        .blood-drip {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 100vh;
            background:
                linear-gradient(180deg, rgba(139, 0, 0, 0.5) 0%, rgba(139, 0, 0, 0.2) 5%, transparent 12%),
                linear-gradient(180deg, rgba(200, 0, 0, 0.4) 0%, transparent 6%) 20% 0,
                linear-gradient(180deg, rgba(139, 0, 0, 0.3) 0%, transparent 8%) 40% 0,
                linear-gradient(180deg, rgba(180, 0, 0, 0.4) 0%, transparent 7%) 60% 0,
                linear-gradient(180deg, rgba(139, 0, 0, 0.3) 0%, transparent 5%) 80% 0;
            background-size: 100% 100%, 3px 100%, 2px 100%, 4px 100%, 2px 100%;
            background-repeat: no-repeat;
            pointer-events: none;
            z-index: 9995;
            animation: bloodDripAnim 8s ease-in-out infinite;
            opacity: 0.35;
        }

        @keyframes bloodDripAnim {

            0%,
            100% {
                opacity: 0.3;
                transform: translateY(0);
            }

            30% {
                opacity: 0.6;
            }

            50% {
                opacity: 0.5;
                transform: translateY(5px);
            }

            70% {
                opacity: 0.4;
            }
        }

        /* Scanlines for horror CRT feel */
        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background: repeating-linear-gradient(0deg,
                    rgba(0, 0, 0, 0.1) 0px,
                    rgba(0, 0, 0, 0.1) 1px,
                    transparent 1px,
                    transparent 3px);
            pointer-events: none;
            z-index: 9997;
            opacity: 0.3;
        }

        /* Screen Shake Effect */
        @keyframes horrorShake {

            0%,
            100% {
                transform: translate(0);
            }

            10% {
                transform: translate(-2px, -1px);
            }

            20% {
                transform: translate(2px, 1px);
            }

            30% {
                transform: translate(-1px, 2px);
            }

            40% {
                transform: translate(1px, -1px);
            }

            50% {
                transform: translate(-2px, 1px);
            }

            60% {
                transform: translate(2px, -2px);
            }

            70% {
                transform: translate(-1px, -1px);
            }

            80% {
                transform: translate(1px, 2px);
            }

            90% {
                transform: translate(-2px, -2px);
            }
        }

        body.horror-shake {
            animation: horrorShake 0.4s ease-in-out;
        }

        /* Anxiety Pulse Effect */
        @keyframes anxietyPulse {

            0%,
            100% {
                box-shadow: inset 0 0 0 0 var(--horror-glow);
            }

            50% {
                box-shadow: inset 0 0 100px 30px var(--horror-glow);
            }
        }

        body.anxiety-mode {
            animation: anxietyPulse 2s ease-in-out infinite;
        }

        /* TYPEWRITER EFFECT STYLES */
        .typewriter-text {
            font-family: var(--f-mono);
            white-space: pre-wrap;
            /* overflow: hidden; - Removed to prevent truncation */
            /* border-right: 2px solid var(--primary); - Removed */
            position: relative;
            word-break: break-word;
            /* Ensure long words don't overflow */
        }

        .typewriter-text::after {
            content: '█';
            color: var(--primary);
            animation: blinkCursor 0.7s step-end infinite;
            margin-left: 2px;
            display: inline-block;
        }

        .typewriter-text.done::after {
            display: none;
        }

        .typewriter-text.done {
            /* border-right: none; - No longer needed */
            animation: none;
        }

        @keyframes blinkCursor {

            0%,
            100% {
                border-color: var(--primary);
            }

            50% {
                border-color: transparent;
            }
        }

        .story-container {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 0, 0, 0.4);
            border-radius: 12px;
            padding: 25px 30px;
            margin: 20px auto;
            max-width: 650px;
            min-height: 100px;
            font-size: 1.1rem;
            line-height: 1.8;
        }

        .story-line {
            color: #ffffff;
            font-family: var(--f-mono);
            font-size: 1.1rem;
            margin-bottom: 12px;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s, transform 0.3s;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
        }

        .story-line.visible {
            /* overflow: hidden; Removed */
            /* Royal Button Glint */
            opacity: 1;
            transform: translateY(0);
            position: relative;
            background: rgba(0, 0, 0, 0.5);
        }

        .init-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg,
                    transparent,
                    rgba(255, 255, 255, 0.4),
                    transparent);
            transform: skewX(-20deg);
            animation: glintAnim 3s infinite;
        }

        /* FADE FROM DARKNESS OVERLAY - Starts hidden */
        .darkness-overlay {
            position: fixed;
            inset: 0;
            background: #000000;
            z-index: 99999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease;
        }

        .darkness-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .darkness-overlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        /* CLICK TO START SCREEN */
        .click-to-start {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 100000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .click-to-start .start-text {
            font-family: var(--f-title);
            font-size: 2rem;
            color: var(--primary);
            animation: pulsate 2s ease-in-out infinite;
            text-shadow: 0 0 30px var(--primary);
        }

        .click-to-start .start-subtext {
            font-family: var(--f-mono);
            font-size: 1rem;
            color: var(--text-dim);
            margin-top: 15px;
            animation: blink 1s ease-in-out infinite;
        }

        .click-to-start .headphones-warning {
            font-family: var(--f-ui);
            font-size: 1.5rem;
            /* Big focused font */
            color: var(--secondary);
            margin-top: 30px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            animation: pulsate 3s ease-in-out infinite;
            text-shadow: 0 0 10px var(--secondary);
            border: 1px solid var(--secondary);
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.5);
        }

        @keyframes pulsate {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.05);
                opacity: 0.8;
            }
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        /* Eerie Float Animation */
        @keyframes eerieFloat {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            25% {
                transform: translateY(-3px) rotate(0.3deg);
            }

            50% {
                transform: translateY(-6px) rotate(-0.3deg);
            }

            75% {
                transform: translateY(-3px) rotate(0.2deg);
            }
        }

        /* Glitch Screen Effect */
        @keyframes glitchScreen {
            0% {
                transform: skewX(0) translate(0);
                filter: hue-rotate(0deg);
            }

            20% {
                transform: skewX(-2deg) translate(-2px, 0);
                filter: hue-rotate(30deg);
            }

            40% {
                transform: skewX(2deg) translate(2px, 1px);
            }

            60% {
                transform: skewX(-1deg) translate(-1px, -1px);
                filter: hue-rotate(-20deg);
            }

            80% {
                transform: skewX(1deg) translate(1px, 0);
            }

            100% {
                transform: skewX(0) translate(0);
                filter: hue-rotate(0deg);
            }
        }

        body.glitch-active {
            animation: glitchScreen 0.3s ease-in-out;
        }

        /* Blood Drip from Top */
        @keyframes bloodDrip {
            0% {
                transform: scaleY(0);
                opacity: 0;
            }

            10% {
                opacity: 0.6;
            }

            100% {
                transform: scaleY(1);
                opacity: 0;
            }
        }

        /* LAYERS & VFX */
        #render-layer {
            position: fixed;
            inset: 0;
            z-index: 0;
        }

        .vignette {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 1;
            /* STRONGER VIGNETTE */
            background: radial-gradient(circle, transparent 30%, rgba(0, 0, 0, 0.9) 100%);
        }

        .scanlines {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 2;
            opacity: 0.15;
            background: linear-gradient(to bottom, rgba(128, 128, 128, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px;
        }

        .fx-overlay {
            position: fixed;
            inset: 0;
            z-index: 900;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .fx-rewind {
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255, 255, 255, 0.2) 3px);
            mix-blend-mode: overlay;
        }

        .fx-freeze {
            background: rgba(0, 243, 255, 0.1);
            box-shadow: inset 0 0 100px var(--secondary);
            backdrop-filter: grayscale(100%) blur(4px);
        }

        /* Timer Panel Freeze Effect */
        #timer-panel.frozen {
            position: relative;
            animation: timerFreezeGlow 1s infinite alternate;
        }

        #timer-panel.frozen::before {
            content: '❄️ FROZEN';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: var(--f-title);
            font-size: 0.9rem;
            color: #00f3ff;
            text-shadow: 0 0 15px #00f3ff, 0 0 30px #00f3ff;
            letter-spacing: 3px;
            z-index: 10;
            animation: freezeTextPulse 0.5s infinite alternate;
        }

        #timer-panel.frozen::after {
            content: '';
            position: absolute;
            inset: 0;
            background: #050505;
            border: 25px solid #1a0a2e;
            /* Thick bezel with violet tint */
            border-radius: 12px;
            box-shadow:
                0 0 0 2px #8b00ff,
                /* Violet inner line */
                0 0 50px rgba(139, 0, 255, 0.5),
                /* Violet glow */
                0 0 100px rgba(106, 13, 173, 0.3),
                inset 0 0 20px rgba(0, 0, 0, 1);
            /* Inner shadow for depth */
            z-index: 5;
        }

        #timer-panel.frozen .stat-val,
        #timer-panel.frozen .stat-label,
        #timer-panel.frozen .time-bar-container {
            opacity: 0.3;
        }

        @keyframes timerFreezeGlow {
            0% {
                box-shadow: 0 0 20px rgba(0, 243, 255, 0.5), inset 0 0 15px rgba(0, 200, 255, 0.2);
            }

            100% {
                box-shadow: 0 0 40px rgba(0, 243, 255, 0.8), inset 0 0 25px rgba(0, 200, 255, 0.4);
            }
        }

        @keyframes freezeTextPulse {
            0% {
                opacity: 0.8;
                transform: translate(-50%, -50%) scale(1);
            }

            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.05);
            }
        }

        /* Rewind Effect Logic */
        body.is-rewinding .fx-rewind {
            opacity: 1 !important;
            animation: glitchEffect 0.2s infinite;
        }

        /* UI FRAMEWORK */
        header {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 9999;
            /* Above everything to ensure clicks work */
            backdrop-filter: blur(10px);
        }

        .brand {
            font-family: var(--f-title);
            font-size: 1.4rem;
            letter-spacing: 2px;
            color: var(--primary);
            text-shadow: 0 0 10px var(--primary);
        }

        #theme-toggle {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
        }

        /* =============================================
           TOGGLE BUTTONS - SOUND & THEME
           Time-themed rewind/loop design
           ============================================= */
        .toggle-controls {
            display: flex;
            gap: 12px;
            align-items: center;
            pointer-events: auto;
            /* Enable clicks */
            z-index: 10000;
        }

        /* Analog Stick - Nintendo Switch 2 Style */
        .stick {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: radial-gradient(circle at 35% 35%, #3a3a4a, #1a1a2a, #0a0a0a);
            border: 2px solid #000;
            margin: 10px 0;
            position: relative;
            box-shadow:
                0 3px 6px rgba(0, 0, 0, 0.9),
                inset 1px 1px 3px rgba(255, 255, 255, 0.15),
                inset -1px -1px 3px rgba(0, 0, 0, 0.5);
        }

        .stick::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: radial-gradient(circle, #2a2a3a, #000);
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.8);
        }


        /* Face Buttons - Nintendo Switch 2 Style */
        .btn-group {
            display: grid;
            grid-template-columns: repeat(3, 20px);
            grid-template-rows: repeat(3, 20px);
            gap: 4px;
            margin: 15px 0;
        }

        .btn-face {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: radial-gradient(circle at 35% 35%, #2a2a3a, #0a0a0a);
            border: 1px solid #000;
            box-shadow:
                0 2px 4px rgba(0, 0, 0, 0.8),
                inset 1px 1px 2px rgba(255, 255, 255, 0.2);
            transition: transform 0.1s;
        }

        .btn-face:nth-child(1) {
            grid-column: 2;
            grid-row: 1;
        }

        /* Top */
        .btn-face:nth-child(2) {
            grid-column: 1;
            grid-row: 2;
        }

        /* Left */
        .btn-face:nth-child(3) {
            grid-column: 3;
            grid-row: 2;
        }

        /* Right */
        .btn-face:nth-child(4) {
            grid-column: 2;
            grid-row: 3;
        }

        /* Bottom */

        .btn-face:active {
            transform: translateY(1px);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.9);
        }

        .btn-label {
            font-family: var(--f-mono);
            font-size: 0.7rem;
            color: #888;
            text-align: center;
            margin-top: auto;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-label span {
            display: block;
            font-size: 0.6rem;
            color: #666;
            margin-top: 2px;
        }

        .toggle-btn {
            position: relative;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(0, 0, 5, 0.9);
            border: 2px solid var(--primary);
            color: var(--primary);
            cursor: pointer;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(79, 70, 229, 0.3);
            overflow: hidden;
            z-index: 1000;
            /* Ensure buttons are on top */
        }

        .toggle-btn::before {
            content: '';
            position: absolute;
            inset: 3px;
            border-radius: 50%;
            border: 1px dashed rgba(79, 70, 229, 0.4);
            animation: rotateRing 10s linear infinite;
            pointer-events: none;
            /* Don't block clicks */
        }

        @keyframes rotateRing {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .toggle-btn:hover {
            background: rgba(79, 70, 229, 0.2);
            box-shadow: 0 0 30px rgba(79, 70, 229, 0.5);
            transform: scale(1.1);
        }

        .toggle-btn:active {
            transform: scale(0.95);
        }

        /* Sound OFF state */
        .toggle-btn.sound-off {
            border-color: var(--danger);
            color: var(--danger);
            box-shadow: 0 0 15px rgba(255, 0, 60, 0.3);
        }

        .toggle-btn.sound-off::before {
            border-color: rgba(255, 0, 60, 0.4);
            animation-direction: reverse;
        }

        /* Theme button - rotating icon */
        .toggle-btn.theme-btn .icon {
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .toggle-btn.theme-btn:hover .icon {
            transform: rotate(180deg);
        }

        /* =============================================
           DARK MONOCHROME THEME - Black/Ash/White only
           ============================================= */
        body.theme-dark {
            --primary: #a0a0a0 !important;
            --primary-light: #c0c0c0 !important;
            --secondary: #808080 !important;
            --dark-blue: #1a1a1a !important;
            --danger: #606060 !important;
            --green: #d0d0d0 !important;
        }

        /* Dark theme - toggle buttons */
        body.theme-dark .toggle-btn:not(.sound-off) {
            border-color: #a0a0a0 !important;
            color: #a0a0a0 !important;
            box-shadow: 0 0 15px rgba(160, 160, 160, 0.2) !important;
        }

        body.theme-dark .switch-left {
            background: linear-gradient(145deg, #1a1a2e 0%, #0f0f1e 50%, #1a1a2e 100%) !important;
            border-top-left-radius: 35px !important;
            border-bottom-left-radius: 35px !important;
            border-top-right-radius: 8px !important;
            border-bottom-right-radius: 8px !important;
            left: -110px;
            border-left: 3px solid #0a0a15 !important;
            border-top: 2px solid rgba(255, 255, 255, 0.1) !important;
            border-bottom: 2px solid rgba(0, 0, 0, 0.5) !important;
            box-shadow:
                -8px 0 20px rgba(0, 0, 0, 0.7),
                inset 2px 2px 8px rgba(255, 255, 255, 0.1),
                inset -2px -2px 8px rgba(0, 0, 0, 0.4) !important;
        }

        body.theme-dark .toggle-btn::before {
            border-color: rgba(160, 160, 160, 0.3) !important;
        }

        body.theme-dark .brand {
            color: #c0c0c0 !important;
            text-shadow: 0 0 10px rgba(200, 200, 200, 0.5) !important;
        }

        /* Dark theme - tech buttons */
        body.theme-dark .tech-btn {
            color: #a0a0a0 !important;
            border-color: #a0a0a0 !important;
            box-shadow: 0 0 20px rgba(160, 160, 160, 0.2), inset 0 0 20px rgba(160, 160, 160, 0.05) !important;
        }

        body.theme-dark .tech-btn:hover {
            background: #a0a0a0 !important;
            color: #000000 !important;
        }

        /* Dark theme - title glow */
        body.theme-dark .glitch-title {
            text-shadow: 0 0 30px rgba(200, 200, 200, 0.5) !important;
            color: #ffffff !important;
        }

        /* Dark theme - HUD panels */
        body.theme-dark .hud-panel {
            border-color: rgba(100, 100, 100, 0.3) !important;
            background: rgba(15, 15, 15, 0.95) !important;
        }

        /* Dark theme - glass elements */
        body.theme-dark .roulette-box,
        body.theme-dark .timeline-box,
        body.theme-dark .mission-log {
            border-color: rgba(100, 100, 100, 0.3) !important;
            background: rgba(15, 15, 15, 0.95) !important;
        }

        /* Dark theme - option buttons */
        body.theme-dark .opt-btn {
            border-color: #606060 !important;
            color: #c0c0c0 !important;
        }

        body.theme-dark .opt-btn:hover {
            border-color: #a0a0a0 !important;
            background: rgba(160, 160, 160, 0.1) !important;
        }

        /* Dark theme - game over screen */
        body.theme-dark #s-over {
            background: linear-gradient(180deg, #000000 0%, #0a0a0a 50%, #000000 100%) !important;
        }

        /* Dark theme - win modal */
        body.theme-dark .win-modal {
            background: linear-gradient(180deg, #000000 0%, #0a0a0a 50%, #000000 100%) !important;
        }

        /* Dark theme - share card wrapper */
        body.theme-dark .share-card-wrapper {
            background: linear-gradient(135deg, #404040, #606060, #404040) !important;
        }

        /* Dark theme - time bar */
        body.theme-dark .time-bar {
            background: linear-gradient(90deg, #505050, #a0a0a0) !important;
        }

        /* Dark theme - scanline effect toned down */
        body.theme-dark .vignette {
            background: radial-gradient(circle, transparent 30%, rgba(0, 0, 0, 0.95) 100%) !important;
        }

        /* HUD - REDESIGNED */
        .hud-panel {
            position: absolute;
            z-index: 50;
            padding: 15px 25px;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border: var(--glass-border);
            border-radius: 8px;
            box-shadow: var(--glass-shadow);
            transition: 0.3s;
        }

        .hud-top-right {
            top: 90px;
            right: 40px;
            border-right: 4px solid var(--primary);
            text-align: right;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-main);
            margin-bottom: 5px;
            letter-spacing: 2px;
            font-weight: bold;
            opacity: 0.7;
        }

        .stat-val {
            font-family: var(--f-title);
            font-size: 2.2rem;
            color: var(--primary);
        }

        /* LIVES INDICATOR */
        .lives-container {
            display: flex;
            gap: 5px;
            justify-content: flex-end;
            margin-top: 5px;
        }

        .life-pip {
            width: 15px;
            height: 15px;
            background: var(--secondary);
            transform: skewX(-20deg);
            box-shadow: 0 0 10px var(--secondary);
        }

        .life-pip.lost {
            background: #333;
            box-shadow: none;
            border: 1px solid #555;
        }

        /* BIG FREEZE BUTTON (Left) */
        .freeze-container {
            position: absolute;
            bottom: 40px;
            left: 40px;
            z-index: 60;
        }

        .big-freeze-btn {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(0, 243, 255, 0.1);
            border: 2px solid var(--secondary);
            color: var(--secondary);
            font-family: var(--f-title);
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.2);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: pulseFreeze 3s infinite;
        }

        .big-freeze-btn span {
            font-size: 0.8rem;
            font-family: var(--f-mono);
            margin-top: 5px;
            opacity: 0.7;
        }

        .big-freeze-btn:hover {
            transform: scale(1.1);
            background: var(--secondary);
            color: black;
            box-shadow: 0 0 60px var(--secondary);
        }

        .big-freeze-btn.used {
            filter: grayscale(1);
            opacity: 0.5;
            cursor: not-allowed;
            animation: none;
        }

        @keyframes pulseFreeze {
            0% {
                box-shadow: 0 0 0 rgba(0, 243, 255, 0);
            }

            50% {
                box-shadow: 0 0 40px rgba(0, 243, 255, 0.4);
            }

            100% {
                box-shadow: 0 0 0 rgba(0, 243, 255, 0);
            }
        }

        .btn-hud-rewind {
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.2);
            animation: pulseRewind 3s infinite;
            margin-top: 20px;
        }

        .btn-hud-rewind:hover {
            background: var(--primary);
            color: black;
            box-shadow: 0 0 60px var(--primary);
            transform: scale(1.1);
        }

        @keyframes pulseRewind {
            0% {
                box-shadow: 0 0 0 rgba(0, 243, 255, 0);
            }

            50% {
                box-shadow: 0 0 40px rgba(0, 243, 255, 0.4);
            }

            100% {
                box-shadow: 0 0 0 rgba(0, 243, 255, 0);
            }
        }

        /* FAIL MODAL (The Main Event) */
        .fail-modal {
            position: fixed;
            inset: 0;
            z-index: 2000;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: 0.3s;
        }

        .fail-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .fail-title {
            font-family: var(--f-title);
            font-size: 4rem;
            color: var(--danger);
            text-shadow: 0 0 40px var(--danger);
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 4px;
        }

        .fail-sub {
            font-family: var(--f-mono);
            font-size: 1.2rem;
            color: white;
            margin-bottom: 50px;
            text-align: center;
            letter-spacing: 2px;
        }

        .fail-btn-row {
            display: flex;
            gap: 40px;
        }

        .fail-btn {
            padding: 30px 60px;
            font-family: var(--f-title);
            font-size: 1.5rem;
            border: 2px solid;
            cursor: pointer;
            transition: 0.2s;
            text-transform: uppercase;
            background: transparent;
            letter-spacing: 2px;
            border-radius: 8px;
        }

        .btn-rewind {
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: 0 0 30px var(--primary);
        }

        .btn-rewind:hover {
            background: var(--primary);
            color: black;
            transform: scale(1.05);
        }

        .btn-exit {
            border-color: var(--danger);
            color: var(--danger);
            box-shadow: 0 0 10px var(--danger);
        }

        .switch-btn {
            width: 110px !important;
            height: 90% !important;
            border: none !important;
            border-radius: 0 !important;
            position: absolute;
            pointer-events: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
            padding: 30px 15px !important;
            box-shadow:
                inset 3px 3px 10px rgba(255, 255, 255, 0.15),
                inset -3px -3px 10px rgba(0, 0, 0, 0.5),
                8px 8px 25px rgba(0, 0, 0, 0.6) !important;
            transition: transform 0.15s ease;
            cursor: pointer;
            z-index: 10001;
            background: none;
            animation: none !important;
            top: 0;
            bottom: 0;
            margin: auto;
        }

        .btn-exit:hover {
            background: var(--danger);
            color: white;
            transform: scale(1.05);
        }

        /* SCREENS */
        .screen {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.6s cubic-bezier(0.22, 1, 0.36, 1);
            padding-top: 60px;
        }

        .screen.active {
            opacity: 1;
            pointer-events: all;
        }

        .hidden {
            display: none !important;
            opacity: 0 !important;
        }

        /* LANDING */
        .glitch-title {
            font-family: var(--f-title);
            font-size: 8vw;
            color: var(--text-main);
            margin: 0;
            text-transform: uppercase;
            text-shadow: 0 0 30px var(--primary);
            animation: float 4s ease-in-out infinite, titleGlitch 8s infinite;
            position: relative;
        }

        /* Chromatic aberration layers */
        .glitch-title::before,
        .glitch-title::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.5;
        }

        .glitch-title::before {
            color: #ff4d6d;
            animation: glitchLeft 3s infinite;
            clip-path: polygon(0 0, 100% 0, 100% 35%, 0 35%);
            transform: translateX(-2px);
            text-shadow: 0 0 8px rgba(255, 77, 109, 0.4);
        }

        .glitch-title::after {
            color: #60a5fa;
            animation: glitchRight 2.5s infinite;
            clip-path: polygon(0 65%, 100% 65%, 100% 100%, 0 100%);
            transform: translateX(2px);
            text-shadow: 0 0 8px rgba(96, 165, 250, 0.4);
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes titleGlitch {

            0%,
            90%,
            100% {
                opacity: 1;
                filter: none;
            }

            91% {
                opacity: 0.8;
                filter: blur(1px);
                transform: translateY(-10px) skewX(2deg);
            }

            92% {
                opacity: 1;
                filter: none;
                transform: translateY(-10px) skewX(0);
            }

            93% {
                opacity: 0.9;
                transform: translateY(-10px) skewX(-1deg);
            }

            94% {
                opacity: 1;
                transform: translateY(-10px);
            }
        }

        @keyframes glitchLeft {

            0%,
            94%,
            100% {
                transform: translateX(-2px);
                opacity: 0;
            }

            95% {
                transform: translateX(-5px);
                opacity: 0.7;
            }

            96% {
                transform: translateX(-2px);
                opacity: 0.4;
            }

            97% {
                transform: translateX(-8px);
                opacity: 0.6;
            }

            98% {
                transform: translateX(-2px);
                opacity: 0;
            }
        }

        @keyframes glitchRight {

            0%,
            92%,
            100% {
                transform: translateX(2px);
                opacity: 0;
            }

            93% {
                transform: translateX(6px);
                opacity: 0.6;
            }

            94% {
                transform: translateX(2px);
                opacity: 0.3;
            }

            95% {
                transform: translateX(10px);
                opacity: 0.5;
            }

            96% {
                transform: translateX(2px);
                opacity: 0;
            }
        }

        .mission-log {
            font-family: var(--f-mono);
            color: var(--text-main);
            opacity: 0.8;
            background: var(--glass-bg);
            border: var(--glass-border);
            padding: 25px 40px;
            border-radius: 12px;
            margin-bottom: 40px;
            text-align: left;
            max-width: 600px;
            border-left: 3px solid var(--primary);
            box-shadow: var(--glass-shadow);
            backdrop-filter: var(--glass-blur);
        }

        .tech-btn {
            position: relative;
            z-index: 10000;
            background: rgba(0, 0, 0, 0.85);
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 22px 55px;
            font-family: var(--f-title);
            font-size: 1.3rem;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.3s ease;
            letter-spacing: 3px;
            pointer-events: auto;
            overflow: visible;
            box-shadow: 0 0 25px rgba(139, 0, 255, 0.3), inset 0 0 15px rgba(0, 0, 0, 0.9);

            /* COOL ASYMMETRICAL SHAPE */
            clip-path: polygon(4% 0%, 94% 0%, 98% 10%, 100% 30%,
                    98% 55%, 100% 80%, 92% 95%, 80% 100%,
                    12% 98%, 0% 85%, 2% 55%, 0% 25%, 5% 8%);

            animation: techGlow 2.8s ease-in-out infinite;
        }

        @keyframes techGlow {

            0%,
            100% {
                box-shadow: 0 0 25px rgba(139, 0, 255, 0.3), inset 0 0 15px rgba(0, 0, 0, 0.9);
            }

            50% {
                box-shadow: 0 0 35px rgba(0, 243, 255, 0.4), inset 0 0 20px rgba(139, 0, 255, 0.1);
            }
        }

        /* BLACK SCANNING LINE effect */
        .tech-btn::before {
            content: '';
            position: absolute;
            top: -100%;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.6), transparent);
            animation: btnScan 2s linear infinite;
        }

        /* 3D EFFECT FOR TECH BTN */
        .tech-btn {
            box-shadow: 0 4px 0 var(--primary-light), 0 5px 20px rgba(0, 0, 0, 0.5);
            transform: translateY(0);
        }

        .tech-btn:active {
            box-shadow: 0 0 0 var(--primary-light), 0 0 10px rgba(139, 0, 0, 0.4);
            transform: translateY(4px);
        }

        .tech-btn::after {
            content: '';
            position: absolute;
            inset: 2px;
            background: repeating-linear-gradient(0deg,
                    transparent 0px,
                    transparent 3px,
                    rgba(0, 0, 0, 0.1) 3px,
                    rgba(0, 0, 0, 0.1) 5px);
            border: 1px solid rgba(139, 0, 0, 0.3);
            border-radius: 2px;
            pointer-events: none;
        }

        @keyframes btnPulse {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(139, 0, 0, 0.4), inset 0 0 20px rgba(139, 0, 0, 0.2);
            }

            50% {
                box-shadow: 0 0 40px rgba(200, 0, 0, 0.6), inset 0 0 30px rgba(139, 0, 0, 0.3);
            }
        }

        @keyframes btnScan {
            0% {
                top: -100%;
            }

            100% {
                top: 100%;
            }
        }

        .tech-btn:hover {
            background: var(--primary);
            color: var(--bg-color);
            box-shadow: 0 0 60px var(--primary), 0 0 100px rgba(79, 70, 229, 0.5);
            transform: scale(1.05);
            text-shadow: 0 0 10px var(--bg-color);
        }

        .tech-btn:hover::before {
            animation: none;
            opacity: 0;
        }

        /* Danger variant buttons (REROLL, etc) - red effects */
        .tech-btn[style*="danger"] {
            box-shadow: 0 0 20px rgba(255, 0, 60, 0.3), inset 0 0 20px rgba(255, 0, 60, 0.1);
            animation: btnPulseDanger 2s infinite;
        }

        .tech-btn[style*="danger"]::before {
            background: linear-gradient(transparent, rgba(255, 0, 60, 0.4), transparent);
        }

        .tech-btn[style*="danger"]::after {
            border: 1px solid rgba(255, 0, 60, 0.3);
        }

        @keyframes btnPulseDanger {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(255, 0, 60, 0.3), inset 0 0 20px rgba(255, 0, 60, 0.1);
            }

            50% {
                box-shadow: 0 0 40px rgba(255, 0, 60, 0.6), inset 0 0 30px rgba(255, 0, 60, 0.2);
            }
        }

        .tech-btn[style*="danger"]:hover {
            background: var(--danger);
            box-shadow: 0 0 60px var(--danger), 0 0 100px rgba(255, 0, 60, 0.5);
        }

        /* MADE WITH LOVE ANIMATION */
        .made-with-love {
            position: absolute;
            bottom: 30px;
            font-family: var(--f-mono);
            font-size: 2.9rem;
            color: #666;
            width: 100%;
            text-align: center;
            pointer-events: none;
            animation: heartbeat 2s infinite ease-in-out;
            letter-spacing: 1px;
        }

        @keyframes heartbeat {

            0%,
            100% {
                opacity: 0.6;
                transform: scale(1);
            }

            50% {
                opacity: 1;
                transform: scale(1.1);
                color: var(--danger);
                text-shadow: 0 0 10px var(--danger);
            }
        }

        /* GAMEPLAY */
        /* CRT POWER OFF */
        .power-off-anim {
            animation: powerOff 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }

        @keyframes powerOff {
            0% {
                transform: scale(1);
                filter: brightness(1) blur(0);
            }

            40% {
                transform: scale(1, 0.002);
                filter: brightness(30) blur(5px);
            }

            100% {
                transform: scale(0, 0);
                filter: brightness(0);
                opacity: 0;
            }
        }

        .game-grid {
            width: 90%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .opt-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            width: 100%;
        }

        .opt-btn {
            flex: 0 1 45%;
            min-width: 300px;
            padding: 25px 40px;
            background: rgba(0, 0, 0, 0.85);
            border: 3px solid var(--primary);
            color: white;
            font-family: var(--f-title);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(139, 0, 255, 0.3);
            position: relative;
            overflow: visible;
        }

        /* UNIQUE ASYMMETRICAL SHAPE FOR EACH OPTION */
        .opt-btn:nth-child(1) {
            clip-path: polygon(6% 0%, 94% 2%, 100% 18%, 96% 45%,
                    98% 72%, 90% 95%, 75% 100%, 10% 98%,
                    0% 85%, 4% 58%, 2% 30%, 5% 12%);
            animation: optToggle1 2.3s ease-in-out infinite;
        }

        .opt-btn:nth-child(2) {
            clip-path: polygon(8% 2%, 92% 0%, 98% 22%, 100% 48%,
                    95% 75%, 88% 98%, 12% 100%, 2% 92%,
                    0% 68%, 5% 42%, 3% 18%, 7% 8%);
            animation: optToggle2 2.6s ease-in-out infinite;
        }

        .opt-btn:nth-child(3) {
            clip-path: polygon(10% 0%, 90% 3%, 96% 15%, 100% 40%,
                    97% 70%, 92% 90%, 80% 98%, 15% 100%,
                    3% 88%, 0% 62%, 4% 35%, 6% 15%);
            animation: optToggle3 2.9s ease-in-out infinite;
            /* CENTER THE THIRD OPTION */
            margin: 15px auto 0 auto;
        }

        @keyframes optToggle1 {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(139, 0, 255, 0.3);
            }

            50% {
                box-shadow: 0 0 30px rgba(255, 0, 100, 0.4);
            }
        }

        @keyframes optToggle2 {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(255, 0, 100, 0.3);
            }

            50% {
                box-shadow: 0 0 30px rgba(139, 0, 255, 0.4);
            }
        }

        @keyframes optToggle3 {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(0, 255, 200, 0.3);
            }

            50% {
                box-shadow: 0 0 30px rgba(139, 0, 255, 0.4);
            }
        }

        .opt-btn:hover {
            background: rgba(139, 0, 255, 0.2);
            border-color: white;
            transform: scale(1.03);
            box-shadow: 0 0 40px var(--primary);
        }

        /* PROTOCOL INTERACTION */
        .protocol-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 40px;
            perspective: 1000px;
            cursor: pointer;
        }

        .protocol-trigger {
            font-family: var(--f-mono);
            color: var(--secondary);
            letter-spacing: 3px;
            padding: 10px 20px;
            border: 1px solid transparent;
            transition: 0.3s;
            position: relative;
            z-index: 20;
            text-shadow: 0 0 10px var(--secondary);
            animation: pulse-trigger 2s infinite;
        }

        @keyframes pulse-trigger {
            0% {
                opacity: 0.7;
            }

            50% {
                opacity: 1;
                text-shadow: 0 0 20px var(--secondary);
            }

            100% {
                opacity: 0.7;
            }
        }

        .protocol-container:hover .protocol-trigger {
            color: var(--primary);
            border: 1px solid var(--primary);
            background: rgba(0, 243, 255, 0.1);
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.2);
            animation: none;
        }

        .mission-log {
            font-family: var(--f-mono);
            color: var(--text-main);
            background: var(--glass-bg);
            border: var(--glass-border);
            padding: 0 40px;
            /* Collapsed padding */
            border-radius: 12px;
            text-align: left;
            max-width: 600px;
            border-left: 3px solid var(--primary);
            box-shadow: var(--glass-shadow);
            backdrop-filter: var(--glass-blur);

            /* Hidden State */
            max-height: 0;
            opacity: 0;
            transform: rotateX(-20deg) translateY(-20px);
            transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            overflow: hidden;
            pointer-events: none;
        }

        .protocol-container:hover .mission-log {
            /* Expanded State */
            max-height: 500px;
            opacity: 1;
            transform: rotateX(0deg) translateY(20px);
            padding: 25px 40px;
            pointer-events: all;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        /* Typing effect for lines? Maybe too complex for CSS only, keep it clean first */
        .protocol-line {
            opacity: 0;
            transform: translateX(-20px);
            transition: 0.3s;
        }

        .protocol-container:hover .protocol-line {
            opacity: 1;
            transform: translateX(0);
        }

        .protocol-container:hover .protocol-line:nth-child(1) {
            transition-delay: 0.1s;
        }

        .protocol-container:hover .protocol-line:nth-child(2) {
            transition-delay: 0.2s;
        }

        .protocol-container:hover .protocol-line:nth-child(3) {
            transition-delay: 0.3s;
        }

        .protocol-container:hover .protocol-line:nth-child(4) {
            transition-delay: 0.4s;
        }

        .protocol-container:hover .protocol-line:nth-child(5) {
            transition-delay: 0.5s;
        }

        /* OUTRO SEQUENCE */
        .outro-text {
            font-family: var(--f-title);
            font-size: 8vw;
            color: white;
            opacity: 0;
            transform: scale(0.8);
            position: absolute;
            width: 100%;
            text-align: center;
        }

        .anim-in {
            animation: outroIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .anim-out {
            animation: outroOut 0.5s cubic-bezier(0.6, -0.28, 0.735, 0.045) forwards;
        }

        @keyframes outroIn {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes outroOut {
            0% {
                opacity: 1;
                transform: scale(1);
            }

            100% {
                opacity: 0;
                transform: scale(1.5);
            }
        }

        /* HYPE INTRO */
        .hype-num {
            font-size: 15vw;
            font-family: var(--f-title);
            color: var(--primary);
            text-shadow: 0 0 50px var(--primary);
            animation: zoomFade 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards;
            opacity: 0;
            transform: scale(3);
        }

        .glitch-text {
            color: var(--accent);
            letter-spacing: 5px;
            text-align: center;
            margin-top: 20px;
            animation: glitchText 0.3s infinite;
        }

        @keyframes glitchText {
            0% {
                transform: translate(2px, 0);
            }

            50% {
                transform: translate(-2px, 0);
            }

            100% {
                transform: translate(2px, 0);
            }
        }

        /* ROULETTE (HORIZONTAL) */
        .roulette-window {
            height: 120px;
            /* Shorter height for horizontal strip */
            width: 100%;
            overflow: hidden;
            position: relative;
            /* Side fades instead of top/bottom */
            mask-image: linear-gradient(90deg, transparent, black 20%, black 80%, transparent);
            -webkit-mask-image: linear-gradient(90deg, transparent, black 20%, black 80%, transparent);
            margin-bottom: 30px;
            display: flex;
            /* Center track vertically */
            align-items: center;
        }

        .roulette-track {
            display: flex;
            flex-direction: row;
            align-items: center;
            /* Center alignment is handled by the initial scroll calculations */
            padding-left: 50%;
            will-change: transform;
        }

        .roulette-item {
            flex: 0 0 180px;
            /* Slightly narrower to allow gaps */
            margin: 0 10px;
            /* Spacing between cards */
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--f-title);
            font-size: 1.2rem;
            /* Adjusted for card size */
            color: var(--text-main);

            /* Card Look */
            background: rgba(0, 243, 255, 0.05);
            /* Subtle glass */
            border: 1px solid rgba(0, 243, 255, 0.2);
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);

            /* Default state (will be overridden by JS) */
            opacity: 0.3;
            transform: scale(0.7);
            filter: blur(2px);
            transition: border-color 0.2s, background-color 0.2s;
            /* Color transitions only, transform is manual */
            white-space: normal;
            /* Allow text wrap if needed */
            text-align: center;
            line-height: 1.1;
            padding: 10px;
        }

        .roulette-item.locked {
            border-color: var(--primary);
            background: rgba(0, 243, 255, 0.2);
            color: var(--primary);
            box-shadow: 0 0 30px var(--primary);
            z-index: 100 !important;
        }

        /* ANOMALIES & STREAKS */
        .anomaly-mirror .q-card,
        .anomaly-mirror .opt-btn {
            transform: scaleX(-1);
        }

        .anomaly-alert {
            position: fixed;
            top: 30%;
            width: 100%;
            text-align: center;
            font-family: var(--f-title);
            font-size: 2rem;
            color: var(--danger);
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            z-index: 9999;
            animation: flashWarn 0.5s 2 forwards;
            pointer-events: none;
            border-top: 2px solid var(--danger);
            border-bottom: 2px solid var(--danger);
        }

        @keyframes flashWarn {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        .pulse-text {
            animation: pulseTxt 0.5s infinite alternate;
            color: var(--green) !important;
            text-shadow: 0 0 10px var(--green);
        }

        @keyframes pulseTxt {
            from {
                transform: scale(1);
            }

            to {
                transform: scale(1.1);
            }
        }

        @media (max-width: 900px) {
            .opt-grid {
                grid-template-columns: 1fr;
            }

            h1.glitch-title {
                font-size: 12vw;
            }

            .roulette-box {
                min-width: 90%;
                padding: 30px;
            }

            .fail-btn-row {
                flex-direction: column;
            }

            .freeze-container {
                bottom: 20px;
                left: 20px;
            }
        }

        /* RETRO COIN */
        .coin-cont {
            width: 40px;
            height: 40px;
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
            perspective: 1000px;
        }

        .retro-coin {
            width: 100%;
            height: 100%;
            background: #ffd700;
            border-radius: 50%;
            border: 4px solid #b8860b;
            box-shadow: inset 0 0 10px #fff7cc, 0 0 10px rgba(255, 215, 0, 0.7);
            position: relative;
            animation: spinCoin 3s linear infinite;
            transform-style: preserve-3d;
        }

        .retro-coin::after {
            content: '$';
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--f-mono);
            font-weight: bold;
            color: #b8860b;
            font-size: 1.2rem;
            transform: translateZ(1px);
        }

        @keyframes spinCoin {
            0% {
                transform: rotateY(0deg);
            }

            100% {
                transform: rotateY(360deg);
            }
        }

        .score-sparkle {
            position: absolute;
            pointer-events: none;
            animation: sparkleFloat 1s forwards;
            color: #ffd700;
            font-family: var(--f-mono);
            font-weight: bold;
            font-size: 1.5rem;
            text-shadow: 0 0 5px #fff;
        }

        @keyframes sparkleFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }

            100% {
                opacity: 0;
                transform: translateY(-50px) scale(0);
            }
        }

        .timer-rail {
            width: 100%;
            height: 6px;
            background: rgba(128, 128, 128, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .timer-fill {
            width: 100%;
            height: 100%;
            background: var(--primary);
            box-shadow: 0 0 15px var(--primary);
            transition: width 0.1s linear, background 0.3s;
        }

        .q-card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            padding: 50px;
            text-align: center;
            border-radius: 16px;
            border: var(--glass-border);
            position: relative;
            box-shadow: var(--glass-shadow);
            /* BORDER AND MORE VISIBILITY */
            border: 2px solid var(--primary);
            background: rgba(0, 0, 0, 0.85);
            /* Darker, more solid background */
            box-shadow: 0 0 40px rgba(139, 0, 0, 0.3);
        }

        .era-tag {
            font-family: var(--f-title);
            color: var(--secondary);
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: block;
            letter-spacing: 4px;
            opacity: 0.8;
        }

        .q-text {
            font-size: 2rem;
            line-height: 1.4;
            color: var(--text-main);
            font-weight: bold;
        }

        .opt-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .opt-btn {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid var(--primary);
            /* Visible border */
            padding: 30px;
            font-family: var(--f-ui);
            font-size: 1.4rem;
            /* Slightly larger */
            color: var(--text-main);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            /* Bouncy transition */
            text-align: center;
            border-radius: 8px;

            /* 3D POP OUT LOOK */
            box-shadow:
                0 0 0 var(--primary-dark),
                0 10px 20px rgba(0, 0, 0, 0.5),
                inset 0 0 20px rgba(255, 0, 0, 0.1);
            transform: perspective(500px) translate3d(0, 0, 0);
        }

        .opt-btn:hover {
            background: rgba(20, 0, 0, 0.9);
            border-color: var(--primary-light);
            color: white;
            /* POP OUT EFFECT: Scale up + Lift up + Shadow grows */
            transform: perspective(500px) translate3d(0, -10px, 30px);
            box-shadow:
                0 15px 30px rgba(255, 0, 0, 0.3),
                0 0 15px var(--primary);
            z-index: 10;
        }

        .opt-btn:active {
            /* PRESS EFFECT */
            transform: perspective(500px) translate3d(0, 2px, 0);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            transition: 0.1s;
        }

        /* ROULETTE & TIMELINE */
        .roulette-box {
            background: var(--glass-bg);
            padding: 60px;
            border: var(--glass-border);
            text-align: center;
            border-radius: 16px;
            min-width: 500px;
            box-shadow: var(--glass-shadow);
            backdrop-filter: var(--glass-blur);
        }

        #roulette-display {
            font-family: var(--f-title);
            font-size: 3.5rem;
            color: var(--primary);
            margin: 40px 0;
            text-shadow: 0 0 20px var(--primary);
            min-height: 80px;
        }

        .locked-topic {
            animation: flashLock 0.5s;
            color: var(--accent) !important;
            text-shadow: 0 0 40px var(--accent) !important;
            scale: 1.2;
            transition: 0.3s;
        }

        @keyframes flashLock {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
                filter: brightness(2);
            }

            100% {
                transform: scale(1);
            }
        }

        .timeline-box {
            background: var(--glass-bg);
            padding: 50px;
            border: var(--glass-border);
            text-align: center;
            max-width: 700px;
            border-radius: 16px;
            box-shadow: var(--glass-shadow);
            border-top: 3px solid var(--primary);
        }

        .btn-row {
            display: flex;
            gap: 30px;
            justify-content: center;
            margin-top: 30px;
        }

        /* OVER (MATCHING IMAGE 2/4) */
        .share-card {
            margin-bottom: 30px;
            border: 4px solid var(--primary);
            width: 320px;
            height: 480px;
            position: relative;
            background: #000;
            box-shadow: 0 0 60px rgba(0, 0, 0, 0.5);
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 300px;
        }

        /* FX */
        body.is-rewinding {
            animation: vhs-glitch 0.2s infinite;
            filter: invert(1) hue-rotate(180deg);
        }

        body.is-rewinding .fx-rewind {
            opacity: 1;
        }

        @keyframes vhs-glitch {
            0% {
                transform: translate(2px, 0);
            }

            20% {
                transform: translate(-2px, 0);
            }

            40% {
                transform: translate(1px, 1px);
            }

            60% {
                transform: translate(-1px, -1px);
            }
        }

        body.is-frozen .fx-freeze {
            opacity: 1;
        }

        body.paradox-hit {
            animation: chromaticPulse 0.3s ease-out;
        }

        @keyframes chromaticPulse {
            0% {
                transform: scale(1);
                text-shadow: none;
                filter: brightness(1);
            }

            50% {
                transform: scale(1.02);
                text-shadow: 3px 0 var(--danger), -3px 0 var(--primary);
                filter: brightness(1.2);
            }

            100% {
                transform: scale(1);
                text-shadow: none;
                filter: brightness(1);
            }
        }

        @media (max-width: 900px) {
            .opt-grid {
                grid-template-columns: 1fr;
            }

            h1.glitch-title {
                font-size: 15vw;
                /* Larger on mobile for impact */
            }

            .roulette-box {
                min-width: 90%;
                padding: 30px;
            }

            .fail-btn-row {
                flex-direction: column;
                gap: 20px;
            }

            .freeze-container {
                bottom: 20px;
                left: 20px;
            }

            /* Responsive HUD */
            .hud-top-right {
                top: auto;
                bottom: 20px;
                /* Move score to bottom on mobile */
                right: 20px;
                background: rgba(0, 0, 0, 0.8);
            }

            .big-freeze-btn {
                width: 80px;
                height: 80px;
                font-size: 0.9rem;
            }

            /* Touch Targets */
            .tech-btn,
            .opt-btn {
                min-height: 60px;
                /* Thumbs are fat */
            }

            .outro-text {
                font-size: 12vw;
            }
        }

        @media (max-width: 450px) {
            .mission-log {
                font-size: 0.8rem;
                padding: 15px;
            }

            .hud-panel {
                transform: scale(0.9);
                transform-origin: bottom right;
            }
        }

        /* =========================================
           MOBILE BLOCKER
           ========================================= */
        .mobile-blocker {
            position: fixed;
            inset: 0;
            z-index: 99999;
            background: linear-gradient(180deg, #000005 0%, #0a0a1a 50%, #000005 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 40px;
        }

        .mobile-blocker.active {
            display: flex;
        }

        .mobile-blocker h1 {
            font-family: var(--f-title);
            font-size: 1.8rem;
            color: var(--danger);
            margin-bottom: 20px;
            text-shadow: 0 0 20px var(--danger);
        }

        .mobile-blocker p {
            font-family: var(--f-mono);
            color: var(--text-dim);
            max-width: 350px;
            line-height: 1.6;
        }

        .mobile-blocker .desktop-icon {
            font-size: 5rem;
            margin-top: 30px;
            animation: float 3s ease-in-out infinite;
        }

        /* =========================================
           LUCK RANDOMIZER SCREEN
           ========================================= */
        .luck-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        .luck-slots {
            display: flex;
            gap: 20px;
        }

        .luck-slot {
            width: 100px;
            height: 130px;
            background: var(--glass-bg);
            border: 2px solid var(--primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--f-title);
            font-size: 2.5rem;
            color: var(--primary);
            box-shadow: 0 0 20px rgba(79, 70, 229, 0.3), inset 0 0 30px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }

        .luck-slot.spinning {
            animation: slotGlow 0.15s infinite alternate;
        }

        .luck-slot.selected {
            border-color: var(--green);
            color: var(--green);
            box-shadow: 0 0 40px rgba(57, 255, 20, 0.5), inset 0 0 20px rgba(57, 255, 20, 0.1);
            transform: scale(1.1);
        }

        @keyframes slotGlow {
            0% {
                box-shadow: 0 0 20px rgba(79, 70, 229, 0.3);
            }

            100% {
                box-shadow: 0 0 40px rgba(79, 70, 229, 0.6);
            }
        }

        .luck-result {
            font-family: var(--f-title);
            font-size: 1.8rem;
            color: var(--primary);
            text-align: center;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .luck-result .mode-desc {
            font-family: var(--f-mono);
            font-size: 1rem;
            color: var(--text-dim);
        }

        .luck-box {
            background: var(--glass-bg);
            padding: 50px;
            border: var(--glass-border);
            text-align: center;
            border-radius: 16px;
            box-shadow: var(--glass-shadow);
            backdrop-filter: var(--glass-blur);
        }

        /* =========================================
           MODE B: TIME LOOP / DREAM MODE
           ========================================= */
        body.mode-dream {
            animation: dreamPulse 3s infinite alternate;
        }

        body.mode-dream .game-grid {
            filter: hue-rotate(15deg) saturate(1.1);
        }

        body.mode-dream .q-card {
            animation: dreamGlitchSubtle 5s infinite;
        }

        @keyframes dreamPulse {
            0% {
                filter: brightness(1) saturate(1);
            }

            100% {
                filter: brightness(1.05) saturate(1.15);
            }
        }

        @keyframes dreamGlitchSubtle {

            0%,
            95%,
            100% {
                transform: translate(0);
            }

            96% {
                transform: translate(-2px, 1px);
            }

            97% {
                transform: translate(2px, -1px);
            }

            98% {
                transform: translate(-1px, -1px);
            }

            99% {
                transform: translate(1px, 1px);
            }
        }

        .dream-overlay {
            position: fixed;
            inset: 0;
            z-index: 5000;
            background: rgba(0, 0, 0, 0.97);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .dream-overlay.active {
            display: flex;
        }

        .dream-text {
            font-family: var(--f-title);
            font-size: 3.5rem;
            color: var(--primary);
            animation: dreamTextGlow 1.5s infinite alternate;
            text-align: center;
        }

        .dream-subtext {
            font-family: var(--f-mono);
            color: var(--text-dim);
            margin-top: 20px;
            font-size: 1.2rem;
        }

        @keyframes dreamTextGlow {
            0% {
                text-shadow: 0 0 20px var(--primary);
                opacity: 0.7;
            }

            100% {
                text-shadow: 0 0 60px var(--primary), 0 0 100px var(--primary);
                opacity: 1;
            }
        }


        /* =============================================
           WIN SCREEN - TIME SAVED / TIMELINE RESTORED
           Theme: Expanding time rings, clock hands, forward motion
           ============================================= */
        .win-modal {
            position: fixed;
            inset: 0;
            z-index: 2000;
            background:
                /* INTENSE BLACK VIGNETTE BORDER */
                radial-gradient(ellipse at 50% 50%, transparent 30%, rgba(0, 0, 0, 0.7) 60%, rgba(0, 0, 0, 0.95) 80%, #000000 100%),
                /* Clock-like concentric time rings */
                repeating-radial-gradient(circle at 50% 50%,
                    transparent 0px,
                    transparent 60px,
                    rgba(57, 255, 20, 0.04) 62px,
                    transparent 64px,
                    transparent 120px,
                    rgba(0, 243, 255, 0.03) 122px,
                    transparent 124px),
                /* Clock hand radial lines - 12 directions */
                repeating-conic-gradient(from 0deg at 50% 50%,
                    transparent 0deg,
                    rgba(57, 255, 20, 0.02) 1deg,
                    transparent 2deg,
                    transparent 30deg),
                /* Central time glow - TIME RESTORED */
                radial-gradient(ellipse at 50% 50%, rgba(57, 255, 20, 0.15) 0%, transparent 40%),
                /* Deep time-space base */
                linear-gradient(180deg, #000502 0%, #000805 30%, #000503 70%, #000000 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: 0.5s;
        }

        /* ROTATING TIME RINGS - Expanding outward (time gained!) */
        .win-modal::before {
            content: '';
            position: fixed;
            top: 50%;
            left: 50%;
            width: 200vmax;
            height: 200vmax;
            transform: translate(-50%, -50%);
            background:
                /* Multiple clock rings at different sizes */
                repeating-radial-gradient(circle at center,
                    transparent 0px,
                    transparent 100px,
                    rgba(57, 255, 20, 0.06) 102px,
                    transparent 106px,
                    transparent 200px,
                    rgba(0, 255, 136, 0.05) 202px,
                    transparent 206px,
                    transparent 300px,
                    rgba(0, 243, 255, 0.04) 302px,
                    transparent 306px);
            animation: timeExpandWin 8s linear infinite;
            pointer-events: none;
            z-index: 1;
        }

        /* CLOCK HANDS - Rotating radial lines */
        .win-modal::after {
            content: '';
            position: fixed;
            top: 50%;
            left: 50%;
            width: 200vmax;
            height: 200vmax;
            transform: translate(-50%, -50%);
            background:
                /* Hour hand */
                conic-gradient(from 0deg at 50% 50%,
                    transparent 0deg,
                    rgba(57, 255, 20, 0.15) 2deg,
                    transparent 4deg,
                    transparent 360deg),
                /* Minute hand */
                conic-gradient(from 90deg at 50% 50%,
                    transparent 0deg,
                    rgba(0, 243, 255, 0.1) 1deg,
                    transparent 3deg,
                    transparent 360deg);
            animation: clockHandsWin 20s linear infinite;
            pointer-events: none;
            z-index: 2;
        }

        /* Time rings expand outward - TIME GAINED */
        @keyframes timeExpandWin {
            0% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
            }

            100% {
                transform: translate(-50%, -50%) scale(1.2) rotate(30deg);
            }
        }

        /* Clock hands rotate forward - TIME FLOWS */
        @keyframes clockHandsWin {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }

            100% {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        .win-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .win-title {
            font-family: var(--f-title);
            font-size: 5rem;
            color: var(--green);
            text-shadow:
                0 0 20px var(--green),
                0 0 40px var(--green),
                0 0 80px rgba(57, 255, 20, 0.5),
                0 2px 0 rgba(0, 255, 136, 0.8),
                0 -2px 0 rgba(0, 243, 255, 0.8);
            animation: winPulse 2s infinite, holoFlicker 0.1s infinite;
            text-align: center;
            position: relative;
            z-index: 10;
        }

        @keyframes holoFlicker {

            0%,
            100% {
                opacity: 1;
            }

            92% {
                opacity: 1;
            }

            93% {
                opacity: 0.8;
            }

            94% {
                opacity: 1;
            }
        }

        .win-subtitle {
            font-family: var(--f-mono);
            font-size: 1.5rem;
            color: white;
            margin-bottom: 50px;
            opacity: 0.8;
            text-align: center;
            position: relative;
            z-index: 10;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            margin-bottom: 50px;
            position: relative;
            z-index: 10;
        }

        .stat-box {
            background: var(--glass-bg);
            border: var(--glass-border);
            padding: 25px 40px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-box .stat-label {
            margin-bottom: 10px;
        }

        .stat-box .stat-value {
            font-family: var(--f-title);
            font-size: 2.5rem;
            color: var(--primary);
        }

        @keyframes winPulse {

            0%,
            100% {
                text-shadow: 0 0 30px var(--green), 0 0 60px rgba(57, 255, 20, 0.3);
            }

            50% {
                text-shadow: 0 0 60px var(--green), 0 0 100px var(--green), 0 0 150px rgba(57, 255, 20, 0.5);
            }
        }

        /* =============================================
           GAME OVER SCREEN - TIME LOST / TIMELINE BROKEN
           Theme: Collapsing time rings, reverse clock, rewind motion
           Colors: INDIGO and BLACK only
           ============================================= */
        #s-over {
            background:
                /* INTENSE BLACK VIGNETTE BORDER */
                radial-gradient(ellipse at 50% 50%, transparent 30%, rgba(0, 0, 0, 0.7) 60%, rgba(0, 0, 0, 0.95) 80%, #000000 100%),
                /* Clock-like concentric time rings - COLLAPSING */
                repeating-radial-gradient(circle at 50% 50%,
                    transparent 0px,
                    transparent 60px,
                    rgba(79, 70, 229, 0.05) 62px,
                    transparent 64px,
                    transparent 120px,
                    rgba(30, 27, 75, 0.08) 122px,
                    transparent 124px),
                /* Clock hand radial lines - 12 directions (broken clock) */
                repeating-conic-gradient(from 0deg at 50% 50%,
                    transparent 0deg,
                    rgba(79, 70, 229, 0.03) 1deg,
                    transparent 2deg,
                    transparent 30deg),
                /* Central void - TIME CONSUMED */
                radial-gradient(ellipse at 50% 50%, rgba(79, 70, 229, 0.1) 0%, transparent 35%),
                /* Deep void base - PURE BLACK with subtle indigo */
                linear-gradient(180deg, #000002 0%, #03031a 30%, #05051a 50%, #03031a 70%, #000000 100%) !important;
            position: absolute;
            inset: 0;
        }

        /* COLLAPSING TIME RINGS - Shrinking inward (time lost!) */
        #s-over::before {
            content: '';
            position: fixed;
            top: 50%;
            left: 50%;
            width: 200vmax;
            height: 200vmax;
            transform: translate(-50%, -50%);
            background:
                /* Multiple clock rings collapsing - INDIGO */
                repeating-radial-gradient(circle at center,
                    transparent 0px,
                    transparent 100px,
                    rgba(79, 70, 229, 0.06) 102px,
                    transparent 106px,
                    transparent 200px,
                    rgba(129, 140, 248, 0.04) 202px,
                    transparent 206px,
                    transparent 300px,
                    rgba(30, 27, 75, 0.05) 302px,
                    transparent 306px);
            animation: timeCollapseLose 10s linear infinite;
            pointer-events: none;
            z-index: 1;
        }

        /* REWINDING CLOCK HANDS - Rotating backwards - INDIGO */
        #s-over::after {
            content: '';
            position: fixed;
            top: 50%;
            left: 50%;
            width: 200vmax;
            height: 200vmax;
            transform: translate(-50%, -50%);
            background:
                /* Hour hand - REWINDING - INDIGO */
                conic-gradient(from 0deg at 50% 50%,
                    transparent 0deg,
                    rgba(79, 70, 229, 0.15) 2deg,
                    transparent 4deg,
                    transparent 360deg),
                /* Minute hand - REWINDING FASTER - LIGHT INDIGO */
                conic-gradient(from 180deg at 50% 50%,
                    transparent 0deg,
                    rgba(129, 140, 248, 0.1) 1deg,
                    transparent 3deg,
                    transparent 360deg);
            animation: clockHandsLose 15s linear infinite reverse;
            pointer-events: none;
            z-index: 2;
        }

        /* Time rings collapse inward - TIME LOST */
        @keyframes timeCollapseLose {
            0% {
                transform: translate(-50%, -50%) scale(1.2) rotate(30deg);
            }

            100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
            }
        }

        /* Clock hands rotate BACKWARDS - TIME REWINDS */
        @keyframes clockHandsLose {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }

            100% {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        /* Content stays on top */
        #s-over .game-over-container {
            position: relative;
            z-index: 10;
        }

        /* DANGER STATE */
        .time-bar.danger {
            background: var(--danger) !important;
            animation: timerPulse 0.3s infinite;
        }

        /* Screen Shake / Distortion for Low Time */
        body.time-critical {
            animation: screenShake 0.1s infinite;
        }

        body.time-critical .vignette {
            background: radial-gradient(circle, transparent 20%, rgba(255, 0, 60, 0.4) 100%);
        }

        @keyframes screenShake {
            0% {
                transform: translate(1px, 1px);
            }

            25% {
                transform: translate(-1px, 0px);
            }

            50% {
                transform: translate(0px, -1px);
            }

            75% {
                transform: translate(-1px, 1px);
            }

            100% {
                transform: translate(1px, -1px);
            }
        }

        @keyframes timerPulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        @keyframes powerPopup {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }

            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }

            80% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) translateY(-50px);
            }
        }

        /* Heartbeat edge pulse - syncs with audio */
        .heartbeat-vignette {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 1050;
            border: 0 solid rgba(255, 0, 60, 0);
            box-shadow: inset 0 0 0 rgba(255, 0, 60, 0);
        }

        .heartbeat-vignette.pulse {
            animation: heartbeatVignettePulse var(--heartbeat-speed, 0.43s) ease-out forwards;
        }

        @keyframes heartbeatVignettePulse {
            0% {
                border-width: 0;
                box-shadow: inset 0 0 0 rgba(255, 0, 60, 0);
            }

            15% {
                border-width: 10px;
                border-color: rgba(255, 0, 60, 0.9);
                box-shadow: inset 0 0 120px rgba(255, 0, 60, 0.5);
            }

            30% {
                border-width: 5px;
                border-color: rgba(255, 0, 60, 0.6);
                box-shadow: inset 0 0 70px rgba(255, 0, 60, 0.3);
            }

            45% {
                border-width: 8px;
                border-color: rgba(255, 0, 60, 0.7);
                box-shadow: inset 0 0 90px rgba(255, 0, 60, 0.4);
            }

            100% {
                border-width: 0;
                box-shadow: inset 0 0 0 rgba(255, 0, 60, 0);
            }
        }

        /* Last Breath effect - that clutch moment */
        body.deaths-door {
            filter: grayscale(1) contrast(1.4) brightness(0.7);
            transition: filter 0.1s ease-out;
        }

        body.deaths-door * {
            animation-play-state: paused !important;
        }

        body.deaths-door .opt-btn {
            animation-play-state: running !important;
            transition: all 0.1s !important;
        }

        body.deaths-door .vignette {
            background: radial-gradient(circle, transparent 0%, rgba(0, 0, 0, 0.98) 70%) !important;
        }

        body.deaths-door::before {
            content: '⏳ LAST BREATH ⏳';
            position: fixed;
            top: 12%;
            left: 50%;
            transform: translateX(-50%);
            font-family: var(--f-title);
            font-size: 3.5rem;
            color: rgba(255, 0, 60, 1);
            text-shadow: 0 0 40px rgba(255, 0, 60, 0.9), 0 0 80px rgba(255, 0, 60, 0.6);
            z-index: 2500;
            animation: lastBreathText 0.5s ease-out forwards;
            letter-spacing: 8px;
            pointer-events: none;
        }

        @keyframes lastBreathText {
            0% {
                opacity: 0;
                transform: translateX(-50%) scale(2.5);
            }

            40% {
                opacity: 1;
                transform: translateX(-50%) scale(1);
            }

            100% {
                opacity: 1;
                transform: translateX(-50%) scale(1);
            }
        }

        /* CLUTCH SAVE Celebration */
        .clutch-save-overlay {
            position: fixed;
            inset: 0;
            z-index: 2600;
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
        }

        .clutch-save-overlay.active {
            animation: clutchFlash 1.5s ease-out forwards;
        }

        .clutch-save-text {
            font-family: var(--f-title);
            font-size: 5rem;
            color: var(--green);
            text-shadow: 0 0 50px var(--green), 0 0 100px var(--green), 0 0 150px var(--green);
            letter-spacing: 8px;
            animation: clutchTextPop 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes clutchFlash {
            0% {
                opacity: 0;
                background: rgba(57, 255, 20, 0);
            }

            15% {
                opacity: 1;
                background: rgba(57, 255, 20, 0.4);
            }

            40% {
                background: rgba(57, 255, 20, 0.15);
            }

            100% {
                opacity: 0;
                background: rgba(57, 255, 20, 0);
            }
        }

        @keyframes clutchTextPop {
            0% {
                opacity: 0;
                transform: scale(0.2) rotate(-10deg);
            }

            50% {
                opacity: 1;
                transform: scale(1.3) rotate(3deg);
            }

            75% {
                transform: scale(0.9) rotate(-2deg);
            }

            100% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }

        /* Screen crack when you lose an anchor */
        .screen-crack-overlay {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 1100;
            opacity: 0;
            background:
                radial-gradient(ellipse at 30% 40%, transparent 0%, transparent 20%, rgba(255, 0, 60, 0.1) 21%, transparent 22%),
                radial-gradient(ellipse at 70% 60%, transparent 0%, transparent 15%, rgba(255, 0, 60, 0.1) 16%, transparent 17%),
                linear-gradient(45deg, transparent 48%, rgba(255, 255, 255, 0.1) 49%, rgba(255, 255, 255, 0.1) 51%, transparent 52%),
                linear-gradient(-45deg, transparent 48%, rgba(255, 255, 255, 0.08) 49%, rgba(255, 255, 255, 0.08) 51%, transparent 52%),
                linear-gradient(30deg, transparent 45%, rgba(255, 255, 255, 0.05) 46%, transparent 54%);
            background-size: 100% 100%, 100% 100%, 200% 200%, 200% 200%, 300% 300%;
            transition: opacity 0.3s;
        }

        .screen-crack-overlay.cracked {
            opacity: 1;
            animation: crackAppear 0.5s ease-out forwards;
        }

        @keyframes crackAppear {
            0% {
                opacity: 0;
                transform: scale(0.95);
            }

            50% {
                opacity: 1;
                transform: scale(1.02);
            }

            100% {
                opacity: 0.7;
                transform: scale(1);
            }
        }

        /* Floating archive cards - looks sick on hover */
        .roulette-item {
            animation: floatDrift 4s ease-in-out infinite;
            animation-delay: calc(var(--float-delay, 0) * 0.3s);
        }

        .roulette-item:nth-child(odd) {
            animation-duration: 4.5s;
            animation-direction: alternate-reverse;
        }

        .roulette-item:hover {
            animation: none !important;
            transform: scale(1.5) !important;
            opacity: 1 !important;
            filter: blur(0) brightness(1.3) !important;
            border-color: var(--primary) !important;
            background: rgba(0, 243, 255, 0.3) !important;
            box-shadow: 0 0 50px var(--primary), 0 0 100px rgba(0, 243, 255, 0.5) !important;
            z-index: 200 !important;
            transition: all 0.15s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
        }

        @keyframes floatDrift {

            0%,
            100% {
                transform: translateY(0) scale(var(--item-scale, 0.7));
            }

            50% {
                transform: translateY(-8px) scale(var(--item-scale, 0.7));
            }
        }

        /* The dramatic stamp that slams on at the end */
        .kia-stamp {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(3) rotate(-15deg);
            font-family: var(--f-title);
            font-size: 3rem;
            color: rgba(255, 0, 60, 0.9);
            text-shadow: 0 0 10px rgba(255, 0, 60, 0.5);
            border: 4px solid rgba(255, 0, 60, 0.9);
            padding: 10px 25px;
            letter-spacing: 10px;
            opacity: 0;
            pointer-events: none;
            z-index: 100;
        }

        .kia-stamp.stamped {
            animation: stampSlam 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes stampSlam {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(4) rotate(-25deg);
            }

            60% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(0.9) rotate(-12deg);
            }

            80% {
                transform: translate(-50%, -50%) scale(1.05) rotate(-14deg);
            }

            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1) rotate(-15deg);
            }
        }

        /* =========================================
           GAME OVER SCREEN STYLES
           ========================================= */

        .game-over-container {
            display: flex;
            gap: 40px;
            align-items: flex-start;
            justify-content: center;
            flex-wrap: wrap;
            padding: 20px;
            max-width: 900px;
        }

        .share-card-wrapper {
            padding: 4px;
            background: linear-gradient(135deg, #ff0066, #9933ff, #00ff66);
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(153, 51, 255, 0.4);
        }

        .share-card {
            position: relative;
            width: 280px;
            height: 380px;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
        }

        .controls-panel {
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-width: 280px;
            max-width: 320px;
        }

        .control-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .name-row input {
            flex: 1;
            padding: 12px 15px;
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: white;
            font-family: var(--f-title);
            font-size: 1.1rem;
            letter-spacing: 2px;
            outline: none;
            text-transform: uppercase;
        }

        .name-row input::placeholder {
            color: #666;
            text-transform: uppercase;
        }

        .name-row input:focus {
            border-bottom-color: var(--green);
        }

        .control-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #444;
            color: white;
            font-family: var(--f-mono);
            font-size: 0.95rem;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 4px;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
        }

        .upload-btn {
            text-align: center;
        }

        .reboot-btn {
            background: rgba(0, 243, 255, 0.1);
            border-color: var(--primary);
            color: var(--primary);
            font-family: var(--f-title);
            margin-top: 5px;
        }

        .reboot-btn:hover {
            background: var(--primary);
            color: black;
            box-shadow: 0 0 20px var(--primary);
        }

        .share-message-box {
            background: rgba(0, 255, 102, 0.05);
            border: 1px solid rgba(0, 255, 102, 0.2);
            padding: 15px;
            border-radius: 4px;
            text-align: center;
        }

        /* Star Rating */
        .rating-section {
            padding: 12px 0;
            text-align: center;
        }

        .star-rating {
            display: flex;
            justify-content: center;
            gap: 5px;
        }

        .star {
            font-size: 1.8rem;
            color: #333;
            cursor: pointer;
            transition: all 0.15s;
            text-shadow: none;
        }

        .star:hover,
        .star.hovered {
            color: #ffd700;
            transform: scale(1.2);
            text-shadow: 0 0 10px #ffd700;
        }

        .star.active {
            color: #ffd700;
            text-shadow: 0 0 15px #ffd700;
        }

        /* Feedback Section */
        .feedback-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .feedback-section textarea {
            width: 100%;
            height: 70px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #333;
            border-radius: 4px;
            color: white;
            font-family: var(--f-mono);
            font-size: 0.85rem;
            resize: none;
            outline: none;
            transition: border-color 0.2s;
        }

        .feedback-section textarea::placeholder {
            color: #555;
        }

        .feedback-section textarea:focus {
            border-color: var(--primary);
        }

        .send-feedback-btn {
            position: relative;
            padding: 16px 28px;
            background: linear-gradient(135deg, rgba(153, 51, 255, 0.2), rgba(57, 255, 20, 0.2));
            border: 2px solid transparent;
            border-image: linear-gradient(135deg, #9933ff, #39ff14) 1;
            color: white;
            font-family: var(--f-title);
            font-size: 1rem;
            letter-spacing: 2px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            overflow: hidden;
            animation: feedbackPulse 2s infinite;
        }

        .send-feedback-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%) rotate(45deg);
            }

            100% {
                transform: translateX(100%) rotate(45deg);
            }
        }

        @keyframes feedbackPulse {

            0%,
            100% {
                box-shadow: 0 0 15px rgba(153, 51, 255, 0.4), 0 0 30px rgba(57, 255, 20, 0.2);
            }

            50% {
                box-shadow: 0 0 25px rgba(153, 51, 255, 0.6), 0 0 50px rgba(57, 255, 20, 0.4);
            }
        }

        .send-feedback-btn:hover {
            transform: scale(1.05) translateY(-2px);
            background: linear-gradient(135deg, rgba(153, 51, 255, 0.4), rgba(57, 255, 20, 0.4));
            box-shadow: 0 0 40px rgba(153, 51, 255, 0.6), 0 0 60px rgba(57, 255, 20, 0.4), 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .send-feedback-btn:active {
            transform: scale(0.98);
        }

        .send-feedback-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            animation: none;
        }

        .send-feedback-btn.sent {
            background: linear-gradient(135deg, #39ff14, #00ff88);
            color: black;
            font-weight: bold;
            animation: none;
            box-shadow: 0 0 30px rgba(57, 255, 20, 0.6);
        }

        /* ACHIEVEMENT TIERS */
        .ach-card.tier-common {
            border: 1px solid #cd7f32;
            box-shadow: 0 0 5px rgba(205, 127, 50, 0.3);
        }

        .ach-card.tier-common .ach-card-icon {
            text-shadow: 0 0 5px #cd7f32;
        }

        .ach-card.tier-rare {
            border: 1px solid silver;
            background: linear-gradient(135deg, rgba(192, 192, 192, 0.1), transparent);
            box-shadow: 0 0 10px rgba(192, 192, 192, 0.4);
        }

        .ach-card.tier-rare .ach-card-icon {
            text-shadow: 0 0 10px silver;
        }

        .ach-card.tier-epic {
            border: 2px solid #ff003c;
            background: linear-gradient(135deg, rgba(255, 0, 60, 0.15), transparent);
            box-shadow: 0 0 15px rgba(255, 0, 60, 0.5);
            animation: epicPulse 2s infinite alternate;
        }

        .ach-card.tier-epic .ach-card-name {
            color: #ff003c;
            text-shadow: 0 0 5px #ff003c;
        }

        .ach-card.tier-legendary {
            border: 2px solid #ffd700;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), transparent, rgba(255, 215, 0, 0.1));
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8), inset 0 0 20px rgba(255, 215, 0, 0.2);
            animation: legendaryShine 3s infinite linear;
            position: relative;
            overflow: hidden;
        }

        .ach-card.tier-legendary::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }

        .ach-card.tier-legendary .ach-card-name {
            color: #ffd700;
            text-shadow: 0 0 10px #ffd700, 0 0 20px #ffd700;
        }

        @keyframes epicPulse {
            0% {
                box-shadow: 0 0 15px rgba(255, 0, 60, 0.5);
            }

            100% {
                box-shadow: 0 0 25px rgba(255, 0, 60, 0.8), inset 0 0 10px rgba(255, 0, 60, 0.2);
            }
        }

        @keyframes legendaryShine {
            0% {
                border-color: #ffd700;
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            }

            50% {
                border-color: #fff;
                box-shadow: 0 0 50px rgba(255, 215, 0, 1);
            }

            100% {
                border-color: #ffd700;
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            }
        }

        /* ATTRACTIVE ASYMMETRICAL BUTTON */
        #init-btn {
            margin-top: 0;
            position: relative;
            z-index: 5000;
            padding: 20px 50px;
            font-size: 1.5rem;
            min-width: 280px;
            text-align: center;

            /* COOL ASYMMETRICAL SHAPE - Dynamic polygon */
            clip-path: polygon(5% 0%, 90% 0%, 96% 8%, 100% 25%,
                    98% 50%, 100% 75%, 95% 92%, 85% 100%,
                    15% 98%, 0% 88%, 2% 60%, 0% 30%, 4% 8%);

            /* ATTRACTIVE NEON STYLING */
            background: linear-gradient(135deg,
                    rgba(139, 0, 255, 0.15) 0%,
                    rgba(0, 0, 0, 0.9) 40%,
                    rgba(0, 243, 255, 0.15) 100%);
            border: 2px solid #00f3ff;
            color: #00f3ff;
            box-shadow:
                0 0 20px rgba(0, 243, 255, 0.4),
                inset 0 0 15px rgba(0, 0, 0, 0.8),
                0 0 40px rgba(139, 0, 255, 0.2);

            transform: translateY(-60px);

            /* SMOOTH PULSE EFFECT */
            animation: coolPulse 2.5s ease-in-out infinite;

            transition: all 0.3s ease;
            filter: hue-rotate(0deg) brightness(1);
        }

        #init-btn:hover {
            background: linear-gradient(135deg,
                    rgba(139, 0, 255, 0.3) 0%,
                    rgba(0, 0, 0, 0.8) 50%,
                    rgba(0, 243, 255, 0.3) 100%);
            color: white;
            border-color: #8b00ff;
            box-shadow:
                0 0 40px rgba(139, 0, 255, 0.6),
                inset 0 0 20px rgba(0, 243, 255, 0.2),
                0 0 60px rgba(0, 243, 255, 0.4);
            transform: translateY(-60px) scale(1.05);
            filter: brightness(1.3);
        }

        /* Attractive pulse animation */
        @keyframes coolPulse {

            0%,
            100% {
                box-shadow:
                    0 0 20px rgba(0, 243, 255, 0.4),
                    inset 0 0 15px rgba(0, 0, 0, 0.8);
            }

            50% {
                box-shadow:
                    0 0 30px rgba(139, 0, 255, 0.6),
                    inset 0 0 20px rgba(0, 243, 255, 0.1);
            }
        }

        #open-ach-btn {
            transform: scale(1.3);
            border-bottom: 2px solid var(--primary);
            position: fixed;
            bottom: 20px;
            right: 20px;

        }

        /* PARADOX MODE STYLES */
        #s-game-paradox {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
            z-index: 200;
        }

        .paradox-terminal {
            width: 800px;
            max-width: 95vw;
            background: rgba(10, 0, 0, 0.95);
            border: 2px solid var(--danger);
            box-shadow: 0 0 50px var(--danger), inset 0 0 50px rgba(50, 0, 0, 0.5);
            padding: 40px;
            position: relative;
            overflow: hidden;
            font-family: var(--f-mono);
            text-align: center;
        }

        .paradox-feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: bold;
            pointer-events: none;
            z-index: 10;
            animation: feedbackPop 1s forwards;
            text-shadow: 0 0 20px currentColor;
            white-space: nowrap;
        }

        .paradox-feedback.success {
            color: #00ff00;
        }

        .paradox-feedback.failure {
            color: var(--danger);
        }

        @keyframes feedbackPop {
            0% {
                opacity: 0;
                transform: translate(-50%, -40%) scale(0.5);
            }

            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -60%) scale(1);
            }
        }


        .paradox-header {
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid var(--danger);
            padding-bottom: 15px;
            margin-bottom: 30px;
            font-size: 1.5rem;
            color: var(--danger);
            text-shadow: 0 0 10px var(--danger);
        }

        /* OUTRO SEQUENCE */
        .outro-clean-text {
            font-family: var(--f-title);
            font-size: 6rem;
            font-weight: 900;
            color: #ffffff;
            text-shadow: none;
            text-transform: uppercase;
            opacity: 0;
            transition: opacity 0.1s ease-in-out;
            letter-spacing: 5px;
            text-align: center;
        }

        .strikethrough-red {
            text-decoration: line-through;
            text-decoration-color: var(--danger);
            text-decoration-thickness: 8px;
        }

        .paradox-content {
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }

        .question-display {
            font-size: 2rem;
            color: #fff;
            text-align: center;
            margin-bottom: 50px;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }

        .chaos-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .paradox-btn {
            background: rgba(50, 0, 0, 0.3);
            border: 2px solid var(--danger);
            color: var(--danger);
            padding: 25px;
            font-size: 1.3rem;
            font-family: var(--f-mono);
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
        }

        .paradox-btn:hover {
            background: var(--danger);
            color: #000;
            box-shadow: 0 0 30px var(--danger);
            transform: scale(1.05);
        }

        .sanity-meter {
            margin-top: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            color: var(--danger);
            font-size: 1.2rem;
        }

        .sanity-bar {
            flex-grow: 1;
            height: 15px;
            background: #330000;
            border: 1px solid var(--danger);
            box-shadow: 0 0 10px var(--danger);
            position: relative;
        }

        #sanity-fill {
            height: 100%;
            background: var(--danger);
            transition: width 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 15px var(--danger);
        }

        .instruction-text {
            margin-top: 15px;
            text-align: center;
            font-size: 1.1rem;
            border: 1px dashed var(--danger);
            padding: 10px;
            color: rgba(255, 0, 0, 0.8);
        }

        .paradox-glitch-layer {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: -1;
            opacity: 0.1;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, var(--danger) 2px, var(--danger) 4px);
        }

        /* HUD Styles */
        #neural-wrapper {
            position: fixed;
            inset: 0;
            overflow: hidden;
            background: #000;
            perspective: 1200px;
            /* Essential for 3D tilt */
            z-index: 9999;
            pointer-events: none;
            /* Let clicks pass closely, but wrapper handles perspective */
        }

        #game-tilt-layer {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transform-style: preserve-3d;
            /* Smooth transition handled by JS Lerp */
            pointer-events: auto;
            /* Enable interaction with game */
            background: radial-gradient(circle at center, #110000 0%, #000 90%);
        }

        #neural-hud-overlay {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 10000;
        }

        /* 1. Vignette Heavy - Focusing the view */
        .vignette-heavy {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, transparent 50%, rgba(0, 0, 0, 0.9) 95%);
            mix-blend-mode: multiply;
        }

        /* 2. Border Glitch / Neon Frame */
        .border-glitch {
            position: absolute;
            inset: 20px;
            border: 1px solid rgba(255, 50, 50, 0.3);
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.1), inset 0 0 20px rgba(255, 0, 0, 0.05);
            background: linear-gradient(to bottom, transparent 95%, rgba(255, 0, 0, 0.05));
            pointer-events: none;
        }

        .border-glitch::before,
        .border-glitch::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid var(--primary);
            transition: all 0.2s ease;
        }

        .border-glitch::before {
            top: -1px;
            left: -1px;
            border-right: none;
            border-bottom: none;
            border-top-left-radius: 20px;
        }

        .border-glitch::after {
            bottom: -1px;
            right: -1px;
            border-left: none;
            border-top: none;
            border-bottom-right-radius: 20px;
        }

        /* 3. Retinal Scanline - Subconscious scanning effect */
        .retinal-scanline {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: rgba(255, 50, 50, 0.2);
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
            animation: retinalScan 8s linear infinite;
            opacity: 0.5;
        }

        @keyframes retinalScan {
            0% {
                transform: translateY(-10%);
                opacity: 0;
            }

            10% {
                opacity: 0.5;
            }

            90% {
                opacity: 0.5;
            }

            100% {
                transform: translateY(110%);
                opacity: 0;
            }
        }

        /* 4. Bio-Metrics Overlay */
        .bio-metrics {
            position: absolute;
            bottom: 40px;
            left: 50px;
            font-family: var(--f-mono);
            font-size: 0.7rem;
            color: rgba(255, 50, 50, 0.6);
            line-height: 1.4;
            text-shadow: 0 0 5px rgba(255, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .bio-metrics span {
            display: flex;
            justify-content: space-between;
            width: 180px;
        }

        .bio-marker {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            display: inline-block;
            box-shadow: 0 0 8px var(--primary);
            animation: pulseBio 2s infinite;
            margin-right: 8px;
        }

        @keyframes pulseBio {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.6;
                transform: scale(0.8);
            }
        }

        .sys-status {
            position: absolute;
            top: 40px;
            right: 50px;
            text-align: right;
            font-family: var(--f-code);
            font-size: 0.7rem;
            color: rgba(255, 50, 50, 0.5);
        }

        /* Custom Cursor for Neural Interface */
        body {
            cursor: crosshair !important;
            /* Force a technical feel */
        }

        /* RULES OVERLAY STYLES */
        .rules-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 20000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .rules-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .rules-card {
            background: var(--glass-bg);
            border: 2px solid var(--primary);
            box-shadow: 0 0 50px rgba(255, 0, 0, 0.2);
            padding: 40px;
            max-width: 600px;
            width: 90%;
            min-height: 400px;
            /* Ensure boxy shape */
            border-radius: 16px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .rules-overlay.active .rules-card {
            transform: scale(1);
        }

        .rules-title {
            font-family: var(--f-title);
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 30px;
            text-shadow: 0 0 20px var(--primary);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 15px;
        }

        .rules-list {
            list-style: none;
            padding: 0;
            margin: 0 0 30px 0;
            text-align: left;
            font-family: var(--f-mono);
            font-size: 1.2rem;
            color: var(--text-main);
            line-height: 1.6;
        }

        .rules-list li {
            margin-bottom: 15px;
            padding-left: 20px;
            position: relative;
        }

        .rules-list li::before {
            content: '>';
            position: absolute;
            left: 0;
            color: var(--secondary);
        }

        .rules-hint {
            font-family: var(--f-ui);
            color: var(--text-dim);
            font-size: 0.9rem;
            animation: pulse 2s infinite;
            letter-spacing: 2px;
        }

        /* Game End Styles */
        .outro-text {
            font-family: var(--f-title);
            font-size: 4rem;
            color: white;
            text-align: center;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .anim-in {
            opacity: 1 !important;
            transform: scale(1) !important;
        }

        .anim-out {
            opacity: 0 !important;
            transform: scale(1.2) !important;
            filter: blur(10px);
        }

        #s-over {
            z-index: 7000;
            /* Ensure on top of outro */
            background: black;
            /* Prevent see-through */
        }

        /* Power Off Animation for Game Over - Fixes Glitchy End */
        .power-off-anim {
            animation: powerOff 0.6s forwards cubic-bezier(0.23, 1, 0.32, 1);
            pointer-events: none;
        }

        @keyframes powerOff {
            0% {
                filter: brightness(1) sepia(0);
                transform: scale(1);
            }

            50% {
                filter: brightness(0.5) sepia(1) hue-rotate(-50deg);
            }

            100% {
                filter: brightness(0) grayscale(1);
                transform: scale(0.95);
                opacity: 0;
            }
        }

        @keyframes glitchText {
            0% {
                transform: translate(0);
            }

            20% {
                transform: translate(-2px, 2px);
            }

            40% {
                transform: translate(-2px, -2px);
            }

            60% {
                transform: translate(2px, 2px);
            }

            80% {
                transform: translate(2px, -2px);
            }

            100% {
                transform: translate(0);
            }
        }

        /* Cinematic Boot Sequence */
        .boot-sequence {
            position: fixed;
            inset: 0;
            z-index: 200000;
            background: #000;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
        }

        .boot-tunnel {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            transform-style: preserve-3d;
            animation: tunnelRotate 10s linear infinite;
        }

        @keyframes tunnelRotate {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .tr {
            position: absolute;
            border: 4px solid rgba(139, 0, 255, 0.6);
            /* Brighter, thicker */
            border-radius: 50%;
            box-shadow:
                0 0 30px rgba(139, 0, 255, 0.4),
                inset 0 0 30px rgba(139, 0, 255, 0.4);
            opacity: 0;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Generated via loop logic conceptually, hardcoded for performance */
        .tr-1 {
            width: 100vw;
            height: 100vw;
            animation: tunnelZoom 1.5s cubic-bezier(0.7, 0, 0.3, 1) infinite;
            animation-delay: 0.0s;
        }

        .tr-2 {
            width: 80vw;
            height: 80vw;
            animation: tunnelZoom 1.5s cubic-bezier(0.7, 0, 0.3, 1) infinite;
            animation-delay: 0.2s;
        }

        .tr-3 {
            width: 60vw;
            height: 60vw;
            animation: tunnelZoom 1.5s cubic-bezier(0.7, 0, 0.3, 1) infinite;
            animation-delay: 0.4s;
        }

        .tr-4 {
            width: 40vw;
            height: 40vw;
            animation: tunnelZoom 1.5s cubic-bezier(0.7, 0, 0.3, 1) infinite;
            animation-delay: 0.6s;
        }

        .tr-5 {
            width: 20vw;
            height: 20vw;
            animation: tunnelZoom 1.5s cubic-bezier(0.7, 0, 0.3, 1) infinite;
            animation-delay: 0.8s;
        }

        .tr-6 {
            width: 10vw;
            height: 10vw;
            animation: tunnelZoom 1.5s cubic-bezier(0.7, 0, 0.3, 1) infinite;
            animation-delay: 1.0s;
        }

        @keyframes tunnelZoom {
            0% {
                transform: translate(-50%, -50%) translateZ(-1000px) scale(0.1);
                opacity: 0;
            }

            10% {
                opacity: 1;
            }

            100% {
                transform: translate(-50%, -50%) translateZ(500px) scale(2);
                opacity: 0;
            }
        }

        /* ROYAL UPGRADES */
        .bl-text {
            /* ROYAL UPGRADE */
            background: linear-gradient(180deg, #fff, #8b00ff, #0ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            filter: drop-shadow(0 0 30px rgba(139, 0, 255, 0.8));
            position: relative;
            z-index: 2;
        }

        .init-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg,
                    transparent,
                    rgba(255, 255, 255, 0.4),
                    transparent);
            transform: skewX(-20deg);
            animation: glintAnim 3s infinite;
        }

        .boot-content {
            z-index: 10;
            text-align: center;
            position: relative;
        }

        .boot-terminal {
            font-family: var(--f-mono);
            color: var(--primary);
            font-size: 1.2rem;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--primary);
            margin-bottom: 20px;
            min-height: 2rem;
        }

        .boot-logo {
            position: relative;
            transform: scale(0.8);
            opacity: 0;
            transition: all 0.1s;
        }

        .boot-logo.slam {
            animation: logoSlam 1.5s cubic-bezier(0.19, 1, 0.22, 1) forwards;
        }

        .bl-text {
            font-family: var(--f-title);
            font-size: 8vw;
            font-weight: 900;
            line-height: 1;
            /* ROYAL UPGRADE */
            background: linear-gradient(180deg, #fff, #8b00ff, #0ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            filter: drop-shadow(0 0 30px rgba(139, 0, 255, 0.8));
            position: relative;
            z-index: 2;
        }



        .bl-text::before,
        .bl-text::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.5;
            mix-blend-mode: hard-light;
        }

        .bl-text::before {
            color: #0ff;
            animation: glitchLeft 0.5s infinite;
            clip-path: polygon(0 0, 100% 0, 100% 45%, 0 45%);
        }

        .bl-text::after {
            color: #f0f;
            animation: glitchRight 0.5s infinite;
            clip-path: polygon(0 55%, 100% 55%, 100% 100%, 0 100%);
        }

        @keyframes logoSlam {
            0% {
                transform: scale(20);
                /* MASSIVE START */
                opacity: 0;
                filter: blur(50px);
                letter-spacing: 50px;
            }

            40% {
                opacity: 1;
            }

            80% {
                transform: scale(0.9);
                /* Bounce back */
                filter: blur(0);
                letter-spacing: 5px;
            }

            100% {
                transform: scale(1);
                opacity: 1;
                filter: blur(0);
                letter-spacing: normal;
            }
        }

        /* Flash removed for smoothness */

        @keyframes shakeHeavy {
            0% {
                transform: translate(0, 0) rotate(0deg);
            }

            25% {
                transform: translate(10px, 10px) rotate(5deg);
            }

            50% {
                transform: translate(-10px, -10px) rotate(-5deg);
            }

            75% {
                transform: translate(10px, -10px) rotate(5deg);
            }

            100% {
                transform: translate(0, 0) rotate(0deg);
            }
        }

        .shake-heavy {
            animation: shakeHeavy 0.2s cubic-bezier(.36, .07, .19, .97) both;
        }

        .text-slam {
            animation: textSlam 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .text-slam-final {
            animation: textSlam 2s cubic-bezier(0.19, 1, 0.22, 1) forwards;
            font-size: 6rem !important;
            color: var(--primary);
            text-shadow: 0 0 50px var(--primary);
        }

        @keyframes textSlam {
            0% {
                opacity: 0;
                transform: scale(15);
                /* MASSIVE */
                filter: blur(20px);
                letter-spacing: 20px;
            }

            60% {
                opacity: 1;
                transform: scale(0.9);
                letter-spacing: normal;
            }

            100% {
                opacity: 1;
                transform: scale(1);
                filter: blur(0);
            }
        }

        .outro-text {
            font-family: var(--f-title);
            font-size: 5rem;
            color: #fff;
            position: absolute;
            transition: all 0.5s;
        }

        /* =========================================
           GOD-LEVEL LANDING PAGE STYLES
           ========================================= */
        #landing-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 999999;
            background: #050005;
            overflow-y: auto;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        .landing-section {
            min-height: 80vh;
            padding: 60px 8%;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-bottom: 1px solid rgba(139, 0, 255, 0.15);
        }

        .landing-section.hero {
            min-height: 100vh;
            background: radial-gradient(circle at center, #1a0033 0%, #050000 100%);
            text-align: center;
            position: relative;
        }

        .briefing-title {
            font-family: var(--f-title);
            font-size: 8vw;
            background: linear-gradient(to bottom, #fff, var(--primary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 20px rgba(139, 0, 255, 0.5));
        }

        .hero-subtitle {
            font-family: var(--f-mono);
            color: var(--primary);
            letter-spacing: 5px;
            text-transform: uppercase;
            margin-top: 20px;
            animation: blink 2s infinite;
        }

        .dev-credit {
            font-family: var(--f-mono);
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            letter-spacing: 3px;
            margin-top: 10px;
            text-transform: uppercase;
        }

        .hero-links {
            display: flex;
            gap: 20px;
            margin-top: 50px;
        }

        .link-btn {
            text-decoration: none;
            color: #fff;
            font-family: var(--f-ui);
            padding: 15px 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: 0.3s;
        }

        .link-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(139, 0, 255, 0.3);
        }

        .scroll-indicator {
            position: absolute;
            bottom: 30px;
            font-family: var(--f-mono);
            font-size: 0.7rem;
            color: #444;
        }

        .mouse {
            width: 20px;
            height: 35px;
            border: 2px solid #333;
            border-radius: 20px;
            margin: 10px auto;
            position: relative;
        }

        .mouse::after {
            content: '';
            width: 4px;
            height: 8px;
            background: var(--primary);
            position: absolute;
            left: 50%;
            top: 5px;
            transform: translateX(-50%);
            border-radius: 2px;
            animation: scrollMove 2s infinite;
        }

        @keyframes scrollMove {
            0% {
                transform: translate(-50%, 0);
                opacity: 1;
            }

            100% {
                transform: translate(-50%, 15px);
                opacity: 0;
            }
        }

        .section-title {
            font-family: var(--f-title);
            font-size: 2.5rem;
            color: #fff;
            letter-spacing: 5px;
            margin-bottom: 40px;
        }

        /* PROTOCOL EXECUTION STEPS */
        .execution-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            width: 100%;
        }

        .exec-step {
            background: #0a0015;
            border: 1px solid #222;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
        }

        .exec-step:hover {
            border-color: var(--primary);
            box-shadow: 0 0 50px rgba(139, 0, 255, 0.6), 0 15px 40px rgba(0, 0, 0, 0.4);
            transform: scale(1.08);
            z-index: 100;
        }

        /* Image Preview Container - HIDDEN BY DEFAULT */
        .step-preview {
            position: relative;
            width: 100%;
            height: 0;
            background: linear-gradient(135deg, #1a0030 0%, #0a0015 100%);
            overflow: hidden;
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            opacity: 0;
        }

        /* On hover, REVEAL and expand to show full image */
        .exec-step:hover .step-preview {
            height: 350px;
            padding: 15px;
            opacity: 1;
        }

        .step-preview img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: grayscale(0) brightness(1);
            transition: all 0.4s ease;
        }

        .exec-step:hover .step-preview img {
            filter: grayscale(0) brightness(1);
            object-fit: contain;
        }

        .step-info {
            padding: 15px;
            position: relative;
            transition: all 0.4s ease;
        }

        .exec-step:hover .step-info {
            padding: 20px;
            background: rgba(20, 0, 40, 0.8);
        }

        .step-num {
            position: absolute;
            top: 5px;
            right: 15px;
            font-family: var(--f-title);
            font-size: 2.5rem;
            color: #ffffff;
            opacity: 0.9;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease;
            z-index: 5;
        }

        .exec-step:hover .step-num {
            font-size: 3rem;
            text-shadow: 0 0 30px var(--primary);
            color: var(--primary);
        }

        .step-info h3 {
            font-family: var(--f-title);
            color: #fff;
            margin: 0 0 8px 0;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .exec-step:hover .step-info h3 {
            font-size: 1.2rem;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .step-info p {
            font-family: var(--f-mono);
            color: #888;
            margin: 0;
            font-size: 0.8rem;
            line-height: 1.4;
            transition: all 0.3s ease;
        }

        .exec-step:hover .step-info p {
            color: #ccc;
            font-size: 0.95rem;
        }

        /* SYSTEM VARIATIONS - Horizontal Card Layout (like Environment Checks) */
        .modes-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            width: 100%;
            max-width: 1400px;
            margin: 40px auto 0;
        }

        .mode-box {
            background: rgba(20, 0, 40, 0.6);
            border: 1px solid rgba(139, 0, 255, 0.3);
            border-radius: 12px;
            /* overflow: hidden; REMOVED to allow pop-out */
            display: flex;
            flex-direction: row;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            min-height: 160px;
        }

        .mode-box:hover {
            border-color: var(--primary);
            background: rgba(40, 0, 80, 0.95);
            box-shadow: 0 0 50px rgba(139, 0, 255, 0.6), 0 15px 40px rgba(0, 0, 0, 0.4);
            transform: scale(1.03);
            z-index: 100;
            min-height: 300px;
        }

        .mode-thumb {
            width: 180px;
            min-height: 160px;
            flex-shrink: 0;
            overflow: hidden;
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            background: linear-gradient(135deg, #1a0030 0%, #0a0015 100%);
        }

        .mode-box:hover .mode-thumb {
            /* width: 220px; REMOVED expansion to prevent text shifting */
            padding: 15px;
        }

        .mode-thumb img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: grayscale(0.3) brightness(0.8);
            position: relative;
            z-index: 5;
        }

        .mode-box:hover .mode-thumb img {
            filter: grayscale(0) brightness(1);
            /* Pop-out Effect */
            position: absolute;
            width: 360px;
            /* Larger */
            height: auto;
            max-width: none;
            top: 25%;
            /* Moved up to make room for text below */
            left: 50%;
            transform: translate(-50%, -25%);
            /* Center X, align top area */
            z-index: 105;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.9);
            border: 2px solid var(--primary);
            border-radius: 8px;
            background: #000;
        }

        .mode-box .mode-content {
            padding: 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: all 0.4s ease;
        }

        .mode-box:hover .mode-content {
            padding: 20px;
            /* Position text BELOW the popped out image */
            position: absolute;
            top: 60%;
            /* Below the image approx */
            left: 50%;
            transform: translateX(-50%);
            width: 360px;
            /* Match image width */
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid var(--primary);
            border-top: none;
            /* Connect visually or keep separate? Let's border all */
            border-radius: 8px;
            z-index: 105;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .mode-box:hover .mode-content h3 {
            font-size: 2.2rem !important;
            text-shadow: 0 0 20px var(--primary);
            margin-bottom: 5px;
        }

        .mode-box:hover .mode-desc {
            font-size: 1.3rem !important;
            color: #fff;
            margin-bottom: 10px;
        }

        .mode-box:hover .mode-rules {
            font-size: 1rem;
            color: #ccc;
            text-align: left;
            width: 100%;
            padding-left: 20px;
        }

        .mode-box .mode-content h3 {
            font-family: var(--f-title);
            color: #fff;
            margin: 0 0 10px 0;
            font-size: 1.3rem;
            letter-spacing: 3px;
            transition: all 0.3s ease;
        }

        .mode-box:hover .mode-content h3 {
            font-size: 1.6rem;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .mode-desc {
            font-family: var(--f-mono);
            color: var(--primary);
            font-size: 1rem;
            margin: 0;
            transition: all 0.3s ease;
        }

        .mode-box:hover .mode-desc {
            font-size: 1.1rem;
            text-shadow: 0 0 10px var(--primary);
        }

        .mode-box .mode-rules {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.4s ease;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .mode-box:hover .mode-rules {
            max-height: 150px;
            opacity: 1;
            margin-top: 15px;
        }

        .mode-box .mode-rules li {
            color: #ccc;
            font-family: var(--f-mono);
            font-size: 0.95rem;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .mode-box:hover .mode-rules li {
            color: #fff;
        }

        /* FAQ / COMMAND INTERFACE */
        .tutorial-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            width: 100%;
            max-width: 1000px;
        }

        .faq-item {
            background: rgba(255, 255, 255, 0.03);
            border-left: 4px solid var(--primary);
            padding: 20px;
            cursor: pointer;
            transition: 0.3s;
        }

        .faq-trigger {
            font-family: var(--f-mono);
            color: var(--primary);
            font-weight: bold;
            letter-spacing: 2px;
        }

        .faq-content {
            display: none;
            padding-top: 15px;
        }

        .faq-content p {
            color: #aaa;
            font-family: var(--f-mono);
            font-size: 0.9rem;
            margin: 0;
        }

        .faq-item:hover {
            background: rgba(139, 0, 255, 0.1);
        }

        .faq-item:hover .faq-content {
            display: block;
        }

        .faq-img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            margin-top: 10px;
            border-radius: 4px;
            border: 1px solid rgba(139, 0, 255, 0.2);
        }

        /* COMMAND INTERFACE - CIRCULAR BUTTONS */
        .command-buttons {
            display: flex;
            justify-content: center;
            gap: 350px;
            padding: 40px 0;
            position: relative;
        }

        .cmd-circle {
            width: 280px;
            height: 280px;
            border-radius: 50%;
            background: radial-gradient(circle at center, rgba(30, 0, 60, 0.9) 0%, rgba(10, 0, 20, 0.95) 70%);
            border: 3px solid var(--primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            /* overflow: hidden; REMOVED to allow pop-out */
        }

        .cmd-circle::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: radial-gradient(circle, transparent 50%, rgba(139, 0, 255, 0.2) 100%);
            opacity: 0;
            transition: opacity 0.4s;
        }

        .cmd-circle:hover {
            transform: scale(1.1);
            border-color: #fff;
            box-shadow: 0 0 50px rgba(139, 0, 255, 0.6),
                0 0 100px rgba(139, 0, 255, 0.3),
                inset 0 0 30px rgba(139, 0, 255, 0.2);
        }

        .cmd-circle:hover::before {
            opacity: 1;
        }

        .cmd-icon {
            font-size: 3.5rem;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 10px var(--primary));
        }

        /* POP-OUT DISPLAY FOR VIDEOS */
        .cmd-preview {
            position: absolute;
            width: 400px;
            /* Made larger */
            height: 240px;
            /* Made larger */
            background: #000;
            border: 2px solid var(--primary);
            box-shadow: 0 0 20px rgba(139, 0, 255, 0.5);
            border-radius: 8px;
            overflow: hidden;
            opacity: 0;
            pointer-events: none;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 10;
            top: 50%;
            transform: translateY(-50%) scale(0.8);
        }

        .cmd-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(1);
            /* Full brightness */
        }

        .cmd-circle:hover .cmd-preview {
            opacity: 1;
            transform: translateY(-50%) scale(1);
        }

        /* FREEZE (First Child) -> Show on LEFT side */
        .cmd-circle:first-child .cmd-preview {
            right: 120%;
            /* Push to left */
        }

        /* REWIND (Last Child) -> Show on RIGHT side */
        .cmd-circle:last-child .cmd-preview {
            left: 120%;
            /* Push to right */
        }

        /* New wrapper for text content to ensure z-index layering */
        .cmd-content {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Ensure icon is also above video */
        .cmd-icon {
            z-index: 1;
            font-size: 3.5rem;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 10px var(--primary));
        }

        .cmd-circle:hover .cmd-preview {
            opacity: 1;
        }

        .cmd-circle:hover .cmd-icon,
        .cmd-circle:hover h3,
        .cmd-circle:hover p,
        .cmd-circle:hover .cmd-desc {
            position: relative;
            z-index: 2;
        }

        .cmd-circle h3 {
            font-family: var(--f-title);
            color: #fff;
            margin: 5px 0;
            font-size: 1.3rem;
            letter-spacing: 3px;
        }

        .cmd-circle p {
            font-family: var(--f-mono);
            color: var(--primary);
            margin: 0;
            font-size: 1.2rem;
        }

        .cmd-desc {
            font-family: var(--f-mono);
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.75rem;
            margin-top: 10px;
            max-width: 180px;
            line-height: 1.4;
        }

        /* ENVIRONMENT CHECKS GRID */
        .env-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .env-item {
            background: rgba(20, 0, 40, 0.6);
            border: 1px solid rgba(139, 0, 255, 0.3);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 140px;
            cursor: pointer;
        }

        .env-item:hover {
            border-color: var(--primary);
            background: rgba(40, 0, 80, 0.95);
            box-shadow: 0 0 50px rgba(139, 0, 255, 0.6), 0 15px 40px rgba(0, 0, 0, 0.4);
            transform: scale(1.02);
            z-index: 100;
            min-height: 280px;
        }

        .env-preview {
            width: 0;
            min-height: 0;
            background: linear-gradient(135deg, #1a0030 0%, #0a0015 100%);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s ease;
            overflow: hidden;
            padding: 0;
            opacity: 0;
        }

        .env-item:hover .env-preview {
            width: 400px;
            min-height: 280px;
            padding: 15px;
            opacity: 1;
        }

        .env-preview img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: grayscale(0) brightness(1);
            transition: all 0.4s ease;
        }

        .env-item:hover .env-preview img {
            filter: grayscale(0) brightness(1);
            object-fit: contain;
        }

        .env-info {
            padding: 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: all 0.4s ease;
        }

        .env-item:hover .env-info {
            padding: 30px;
        }

        .env-info h3 {
            font-family: var(--f-title);
            color: var(--primary);
            margin: 0 0 10px 0;
            font-size: 1.3rem;
            letter-spacing: 3px;
            transition: all 0.3s ease;
        }

        .env-item:hover .env-info h3 {
            font-size: 1.5rem;
            text-shadow: 0 0 15px var(--primary);
        }

        .env-info p {
            font-family: var(--f-mono);
            color: #999;
            font-size: 1rem;
            margin: 0;
            line-height: 1.6;
            transition: all 0.3s ease;
            max-height: 50px;
            overflow: hidden;
        }

        .env-item:hover .env-info p {
            color: #fff;
            font-size: 1.1rem;
            max-height: 200px;
        }

        /* ARCHIVE TAGS */
        .archive-tags {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            max-width: 900px;
        }

        .archive-tag {
            padding: 10px 20px;
            border: 1px solid rgba(139, 0, 255, 0.4);
            font-family: var(--f-mono);
            color: var(--primary);
            font-size: 0.8rem;
            background: rgba(139, 0, 255, 0.05);
            border-radius: 4px;
            transition: 0.3s;
        }

        .archive-tag:hover {
            background: var(--primary);
            color: #000;
        }

        /* FOOTER */
        .landing-footer {
            padding: 50px 10%;
            background: #020000;
            width: 100%;
            border-top: 1px solid var(--primary);
            text-align: center;
        }

        .footer-grid {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin-bottom: 30px;
        }

        .tech-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .tech-item .label {
            font-size: 0.7rem;
            color: #666;
            font-family: var(--f-mono);
        }

        .tech-item .val {
            font-size: 1rem;
            color: var(--primary);
            font-family: var(--f-ui);
            font-weight: bold;
        }

        .dev-note {
            font-family: var(--f-mono);
            color: #444;
            font-size: 0.8rem;
        }

        /* FLOATING START BUTTON */
        .floating-start {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            padding: 20px 50px;
            background: #000;
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: 4px;
            z-index: 1000000;
            cursor: pointer;
            font-family: var(--f-title);
            font-size: 1.2rem;
            transition: 0.4s;
            box-shadow: 0 0 10px rgba(139, 0, 255, 0.3);
            overflow: hidden;
            letter-spacing: 2px;
        }

        .floating-start:hover {
            transform: translateX(-50%) scale(1.05);
            box-shadow: 0 0 25px var(--primary);
            background: rgba(139, 0, 255, 0.2);
            color: #fff;
        }

        .btn-aura {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, var(--primary) 0%, transparent 70%);
            opacity: 0.2;
            animation: pulsate 2s infinite;
        }

        @media (max-width: 1200px) {
            .execution-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 900px) {
            .execution-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .modes-row {
                flex-direction: column;
                align-items: center;
            }

            .mode-box {
                max-width: 100%;
                width: 100%;
            }

            .mode-box:hover {
                flex: 1;
            }

            .tutorial-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 600px) {
            .execution-grid {
                grid-template-columns: 1fr;
            }

            .command-buttons {
                flex-direction: column;
                align-items: center;
                gap: 40px;
            }

            .cmd-circle {
                width: 220px;
                height: 220px;
            }

            .env-grid {
                grid-template-columns: 1fr;
            }

            .env-item {
                flex-direction: column;
            }

            .env-preview {
                width: 100%;
                height: 120px;
            }
        }

        /* =========================================
           TUTORIAL SIDE-PANEL MODE (1:3 Split)
           ========================================= */
        #landing-page.landing-side-panel {
            position: fixed;
            top: 20px;
            /* Gap from top */
            right: 20px;
            /* Gap from right */
            bottom: 20px;
            /* Gap from bottom */
            left: auto;
            /* Reset left */
            width: calc(50vw - 40px);
            /* Adjust for margins */
            /* 50% Screen */
            z-index: 20000;
            overflow-y: auto;
            transform: translateX(0);
            /* On Screen */
            opacity: 1 !important;
            /* Force visible */
            display: block !important;

            /* DEVICE LOOK */
            border: 8px solid #ffffff;
            /* Device Bezel */
            border-radius: 20px;
            /* Rounded Device Corners */
            box-shadow:
                0 0 0 2px #444,
                /* Outer Bezel outline */
                -20px 0 50px rgba(0, 0, 0, 0.8),
                /* Depth shadow */
                inset 0 0 20px rgba(0, 0, 0, 0.8);
            /* Screen inner shadow */
            background: #000000;
            font-family: 'Orbitron', sans-serif !important;
            scrollbar-width: none;
            -ms-overflow-style: none;
            /* Slight opacity for game feel */
            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        /* TUTORIAL HEADER */
        .tutorial-header {
            display: none;
            /* Hidden by default */
        }

        #landing-page.landing-side-panel .tutorial-header {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000000;
            color: #ffffff;
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 2rem;
            letter-spacing: 4px;
            padding: 20px 0;
            border-bottom: 2px solid #ffffff;
            margin-bottom: 30px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 1);
        }

        #landing-page.landing-side-panel::-webkit-scrollbar {
            display: none;
        }

        /* GAME SPLIT MODE */
        #neural-wrapper {
            transition: width 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            width: 100vw;
            left: 0;
            position: fixed;
            /* Ensure fixed positioning */
        }

        #neural-wrapper.game-split-mode {
            width: 50vw;
        }

        /* Hide when toggled off in game */
        #landing-page.landing-side-panel.hidden-panel {
            transform: translateX(110%);
        }

        /* Adjust content for narrower view */
        #landing-page.landing-side-panel .hero-content {
            padding-top: 50px;
            zoom: 0.7;
        }

        #landing-page.landing-side-panel .cmd-preview {
            width: 100%;
            height: auto;
            right: 0 !important;
            left: 0 !important;
            top: 100%;
            transform: translateY(10px);
        }

        /* TUTORIAL TOGGLE BUTTON - REDESIGN */
        #tutorial-toggle-btn {
            position: fixed;
            top: 20px;
            right: 200px;
            /* Left of leaderboards */
            z-index: 20001;
            /* Above panel */
            width: auto;
            /* Allow expansion for text */
            height: 50px;
            /* Bigger */
            padding: 0 20px;
            border-radius: 12px;
            /* Rounded Edges (Square-ish) */
            border: 2px solid #fff;
            background: rgba(255, 0, 0, 0.1);
            /* Red tint */
            color: #fff;
            font-family: var(--f-title);
            font-size: 1rem;
            letter-spacing: 2px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
            text-shadow: 2px 0 red, -2px 0 blue;
            /* Glitch text */
            animation: glitch-border 2s infinite;
        }

        #tutorial-toggle-btn:hover {
            background: #fff;
            color: #ff0000;
            box-shadow: 0 0 25px #ff0000;
            text-shadow: none;
            border-color: #ff0000;
        }

        @keyframes glitch-border {
            0% {
                border-color: #fff;
                box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
            }

            50% {
                border-color: #ff0000;
                box-shadow: 0 0 20px rgba(255, 0, 0, 0.8), inset 0 0 10px rgba(255, 0, 0, 0.2);
            }

            100% {
                border-color: #fff;
                box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
            }
        }
    </style>
</head>


<body>

    <!-- =========================================
         GOD-LEVEL LANDING PAGE
         ========================================= -->
    <!-- LANDING PAGE -->
    <div id="landing-page">
        <!-- New Tutorial Header (Only visible in side-panel mode) -->
        <div class="tutorial-header">TUTORIALS</div>



        <section class="landing-section hero">
            <div class="hero-content">
                <div class="glitch-wrapper">
                    <h1 class="briefing-title" data-text="NEURO-FRIED">NEURO-FRIED</h1>
                </div>
                <p class="dev-credit">DEV: Kaustav Chowdhury</p>
                <p class="hero-subtitle">Class-X4 Temporal Survival Interface</p>
                <div class="hero-links" style="display: flex; justify-content: center; gap: 20px;">
                    <a href="https://github.com/Kaustavoffx/neuro-fried" target="_blank" class="link-btn github">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor"
                                d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                        </svg>
                        GITHUB REPO
                    </a>
                    <a href="http://www.youtube.com/watch?v=2fnb_pqz9tg" target="_blank" class="link-btn youtube">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor"
                                d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z" />
                        </svg>
                        WATCH SUMMARY
                    </a>
                    <a href="https://docs.google.com/forms/d/e/1FAIpQLSfUFVf7SwcggiPZFhkk1smvoNpNEiAFbAcHBrwx5x29uRqtvA/viewform?usp=sharing&ouid=112655134902488809956"
                        target="_blank" class="link-btn feedback">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor"
                                d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" />
                        </svg>
                        SHARE FEEDBACK
                    </a>
                </div>
            </div>
            <div class="scroll-indicator">
                <span>DATA SCROLL</span>
                <div class="mouse"></div>
            </div>
        </section>

        <section class="landing-section docs">
            <h2 class="section-title">PROTOCOL EXECUTION</h2>
            <div class="execution-grid">
                <div class="exec-step">
                    <div class="step-preview"><img src="assets/1.png" alt="Neural Link"></div>
                    <div class="step-info">
                        <span class="step-num">01</span>
                        <h3>NEURAL LINK</h3>
                        <p>Initialize the connection. The system scans your interface.</p>
                    </div>
                </div>
                <div class="exec-step">
                    <div class="step-preview"><img src="assets/2.png" alt="Identity Register"></div>
                    <div class="step-info">
                        <span class="step-num">02</span>
                        <h3>IDENTITY REGISTER</h3>
                        <p>Anchor your presence in the PCM data stream.</p>
                    </div>
                </div>
                <div class="exec-step">
                    <div class="step-preview"><img src="assets/3.png" alt="Fate Selection"></div>
                    <div class="step-info">
                        <span class="step-num">03</span>
                        <h3>FATE SELECTION</h3>
                        <p>Spin the wheel of fortune. Let destiny guide your path.</p>
                    </div>
                </div>
                <div class="exec-step">
                    <div class="step-preview"><img src="assets/4.png" alt="Archive Selection"></div>
                    <div class="step-info">
                        <span class="step-num">04</span>
                        <h3>ARCHIVE SELECTION</h3>
                        <p>Choose your corrupted archive. Each contains unique challenges.</p>
                    </div>
                </div>
                <div class="exec-step">
                    <div class="step-preview"><img src="assets/5.png" alt="Path Direction"></div>
                    <div class="step-info">
                        <span class="step-num">05</span>
                        <h3>PATH DIRECTION</h3>
                        <p>Select your temporal flow. Forward or reverse through time.</p>
                    </div>
                </div>
                <div class="exec-step">
                    <div class="step-preview"><img src="assets/6.png" alt="Gameplay Rules"></div>
                    <div class="step-info">
                        <span class="step-num">06</span>
                        <h3>GAMEPLAY RULES</h3>
                        <p>Learn the mechanics. Freeze, rewind, and survive.</p>
                    </div>
                </div>
                <div class="exec-step">
                    <div class="step-preview"><img src="assets/7.png" alt="Game Start"></div>
                    <div class="step-info">
                        <span class="step-num">07</span>
                        <h3>GAME START</h3>
                        <p>Enter the neural interface. The countdown begins.</p>
                    </div>
                </div>
                <div class="exec-step">
                    <div class="step-preview"><img src="assets/8.png" alt="Game Over"></div>
                    <div class="step-info">
                        <span class="step-num">08</span>
                        <h3>GAME OVER</h3>
                        <p>Signal lost. Review your score and share your legacy.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="landing-section modes">
            <h2 class="section-title">SYSTEM VARIATIONS</h2>
            <div class="modes-row">
                <div class="mode-box">
                    <div class="mode-thumb"><img src="assets/ownluck mode.png" alt="Own Luck"></div>
                    <div class="mode-content">
                        <h3>OWN LUCK</h3>
                        <p class="mode-desc">Standard survival test.</p>
                        <ul class="mode-rules">
                            <li>+5s for correct answers</li>
                            <li>Linear difficulty spike</li>
                            <li>Classic High-Score mode</li>
                        </ul>
                    </div>
                </div>
                <div class="mode-box">
                    <div class="mode-thumb"><img src="assets/timeloop.png" alt="Time Loop"></div>
                    <div class="mode-content">
                        <h3>TIME LOOP</h3>
                        <p class="mode-desc">Death is just a reset.</p>
                        <ul class="mode-rules">
                            <li>-50% score on death</li>
                            <li>Stats carry over</li>
                            <li>Infinite cycle gameplay</li>
                        </ul>
                    </div>
                </div>
                <div class="mode-box">
                    <div class="mode-thumb"><img src="assets/paradox mode.png" alt="Paradox"></div>
                    <div class="mode-content">
                        <h3>PARADOX</h3>
                        <p class="mode-desc">Inverted Reality.</p>
                        <ul class="mode-rules">
                            <li>Logic is reversed</li>
                            <li>Pick the WRONG answer</li>
                            <li>Entropy increases faster</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section class="landing-section tutorials">
            <h2 class="section-title">COMMAND INTERFACE</h2>
            <div class="command-buttons">
                <div class="cmd-circle">
                    <div class="cmd-icon">❄️</div>
                    <div class="cmd-preview">
                        <video loop muted playsinline autoplay>
                            <source src="assets/freeze.mp4" type="video/mp4">
                        </video>
                    </div>
                    <!-- Ensure text remains visible on top or fades out? User said "expanded as like others" -->
                    <!-- Usually hover effects might cover text or sit behind. -->
                    <!-- Given "expand as like others" and looking at HUD buttons, they expanded. -->
                    <!-- Here, the circle is quite large. Let's make the video background. -->
                    <div class="cmd-content">
                        <h3>FREEZE</h3>
                        <p>[SPACE]</p>
                        <span class="cmd-desc">Halts temporal decay for 5 seconds</span>
                    </div>
                </div>
                <div class="cmd-circle">
                    <div class="cmd-icon">⏪</div>
                    <div class="cmd-preview">
                        <video loop muted playsinline autoplay>
                            <source src="assets/rewind.mp4" type="video/mp4">
                        </video>
                    </div>
                    <div class="cmd-content">
                        <h3>REWIND</h3>
                        <p>[R]</p>
                        <span class="cmd-desc">Rolls back the last 3 seconds</span>
                    </div>
                </div>
            </div>
        </section>

        <section class="landing-section environment" id="env-section">
            <h2 class="section-title">ENVIRONMENT CHECKS</h2>

            <div class="env-master-container"
                style="display: flex; gap: 40px; align-items: flex-start; flex-wrap: wrap;"
                onmouseleave="resetEnvPreview()">

                <!-- LEFT: 2x5 GRID (Selector) -->
                <div class="env-grid-selector"
                    style="flex: 1; min-width: 300px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <!-- Items have onmouseover to update the viewer -->

                    <!-- 1 -->
                    <div class="env-box"
                        onmouseover="updateEnvPreview('assets/inv.png', 'INVERSION REALITY', 'When screen glitches, logic is flipped. Pick the WRONG answer to survive.')">
                        <div class="env-box-icon"><img src="assets/inv.png" alt="Icon"></div>
                        <span>INVERSION REALITY</span>
                    </div>

                    <!-- 2 -->
                    <div class="env-box"
                        onmouseover="updateEnvPreview('assets/acc.png', 'CHRONO ACCELERATION', 'Timer accelerates as you progress. Each level increases decay rate by 0.25x.')">
                        <div class="env-box-icon"><img src="assets/acc.png" alt="Icon"></div>
                        <span>CHRONO ACCELERATION</span>
                    </div>

                    <!-- 3 -->
                    <div class="env-box"
                        onmouseover="updateEnvPreview('assets/timeline.png', 'INTEGRITY METER', 'Sanity gauge tracks your mental stability. Wrong answers damage integrity.')">
                        <div class="env-box-icon"><img src="assets/timeline.png" alt="Icon"></div>
                        <span>INTEGRITY METER</span>
                    </div>

                    <!-- 4 -->
                    <div class="env-box"
                        onmouseover="updateEnvPreview('assets/card.png', 'YOUR GAME CARD', 'Identity card shows stats, score multipliers, and neural sync status.')">
                        <div class="env-box-icon"><img src="assets/card.png" alt="Icon"></div>
                        <span>YOUR GAME CARD</span>
                    </div>

                    <!-- 5 -->
                    <div class="env-box"
                        onmouseover="updateEnvPreview('assets/streak.png', 'STREAK', 'Consecutive correct answers build a streak multiplier. Higher streaks = higher scores.')">
                        <div class="env-box-icon"><img src="assets/streak.png" alt="Icon"></div>
                        <span>STREAK</span>
                    </div>

                    <!-- 6 -->
                    <div class="env-box"
                        onmouseover="updateEnvPreview('assets/frozen.png', 'FREEZE MOMENT', 'Press [SPACE] to freeze time for 5 seconds. Use wisely - charges are limited.')">
                        <div class="env-box-icon"><img src="assets/frozen.png" alt="Icon"></div>
                        <span>FREEZE MOMENT</span>
                    </div>

                    <!-- 7 -->
                    <div class="env-box"
                        onmouseover="updateEnvPreview('assets/deja vu.png', 'DEJA VU MOMENT', 'Seen this question before? Youre stuck in a loop. Bonus time but reality corrupts.')">
                        <div class="env-box-icon"><img src="assets/deja vu.png" alt="Icon"></div>
                        <span>DEJA VU MOMENT</span>
                    </div>

                    <!-- 8 -->
                    <div class="env-box"
                        onmouseover="updateEnvPreview('assets/skip.png', 'SKIP SEQUENCE', 'Bypass a difficult logic gate. Limited uses available per timeline run.')">
                        <div class="env-box-icon"><img src="assets/skip.png" alt="Icon"></div>
                        <span>SKIP SEQUENCE</span>
                    </div>

                    <!-- 9 -->
                    <div class="env-box"
                        onmouseover="updateEnvPreview('assets/data.png', 'DATA BREACH', 'Warning: External intrusion detected. Data corruption imminent. Restore integrity immediately.')">
                        <div class="env-box-icon"><img src="assets/data.png" alt="Icon"></div>
                        <span>DATA BREACH</span>
                    </div>

                    <!-- 10 -->
                    <div class="env-box"
                        onmouseover="updateEnvPreview('assets/loop.png', 'TIME LOOP', 'Trapped in a temporal cycle. Previous answers determine your future path. Break the cycle to survive.')">
                        <div class="env-box-icon"><img src="assets/loop.png" alt="Icon"></div>
                        <span>TIME LOOP</span>
                    </div>
                </div>

                <!-- RIGHT: PREVIEW VIEWER (Sticky) -->
                <div class="env-viewer"
                    style="flex: 1; min-width: 300px; position: sticky; top: 100px; background: rgba(0,0,0,0.6); border: 1px solid var(--primary); border-radius: 12px; padding: 20px; box-shadow: 0 0 30px rgba(0,0,0,0.5); backdrop-filter: blur(10px);">
                    <div class="viewer-screen"
                        style="width: 100%; aspect-ratio: 16/9; background: #000; border: 1px solid var(--primary); margin-bottom: 20px; overflow: hidden; position: relative; border-radius: 8px;">
                        <img id="preview-img" src="" alt="Preview"
                            style="width: 100%; height: 100%; object-fit: contain; opacity: 0; transition: opacity 0.3s ease;">
                        <div class="scanline"
                            style="position: absolute; top:0; left:0; width:100%; height:100%; background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.5) 51%); background-size: 100% 4px; pointer-events: none;">
                        </div>
                    </div>
                    <h3 id="preview-title"
                        style="font-family: var(--f-title); color: var(--primary); font-size: 2rem; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 2px;">
                        HOVER TO SEE</h3>
                    <div class="tab-indicator"
                        style="width: 50px; height: 4px; background: var(--danger); margin-bottom: 15px;"></div>
                    <p id="preview-desc"
                        style="font-family: var(--f-mono); color: var(--text-dim); font-size: 1.1rem; line-height: 1.6;">
                        the data will show here</p>
                </div>

            </div>

            <style>
                .env-box {
                    background: rgba(10, 10, 15, 0.4);
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    padding: 15px;
                    border-radius: 8px;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 15px;
                    transition: all 0.3s ease;
                }

                .env-box:hover {
                    background: rgba(var(--primary-rgb), 0.1);
                    /* fallback if no rgb var, using primary opacity */
                    background: rgba(139, 0, 255, 0.2);
                    border-color: var(--primary);
                    transform: translateX(5px);
                    box-shadow: 0 0 15px rgba(139, 0, 255, 0.2);
                }

                .env-box-icon {
                    width: 40px;
                    height: 40px;
                    flex-shrink: 0;
                    border-radius: 4px;
                    overflow: hidden;
                    background: #000;
                }

                .env-box-icon img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                }

                .env-box span {
                    font-family: var(--f-title);
                    color: var(--text-main);
                    font-size: 0.9rem;
                    letter-spacing: 1px;
                }
            </style>

            <script>
                function updateEnvPreview(img, title, desc) {
                    const i = document.getElementById('preview-img');
                    const t = document.getElementById('preview-title');
                    const d = document.getElementById('preview-desc');

                    if (i) {
                        i.src = img;
                        i.style.opacity = '1';
                        i.style.filter = 'none';
                    }
                    if (t) t.innerText = title;
                    if (d) d.innerText = desc;
                }

                function resetEnvPreview() {
                    const i = document.getElementById('preview-img');
                    const t = document.getElementById('preview-title');
                    const d = document.getElementById('preview-desc');

                    if (i) {
                        i.style.opacity = '0'; // Fade out to black
                        setTimeout(() => i.src = "", 300); // Clear source after fade
                    }
                    if (t) t.innerText = "HOVER TO SEE";
                    if (d) d.innerText = "the data will show here";
                }
            </script>
        </section>


        <section class="landing-section archives">
            <h2 class="section-title">CORRUPTED ARCHIVES</h2>
            <div class="archive-tags" id="archive-list"></div>
        </section>

        <footer class="landing-footer">
            <div class="footer-grid">
                <div class="tech-item"><span class="label">ENGINE</span><span class="val">VANILLA JS</span></div>
                <div class="tech-item"><span class="label">VISUALS</span><span class="val">CSS GLASS</span></div>
                <div class="tech-item"><span class="label">AUDIO</span><span class="val">WEB AUDIO API</span></div>
            </div>
            <p class="dev-note">PROJECT: NEURO-FRIED // VERSION: 2.0.5</p>
        </footer>

        <button id="master-start-btn" class="floating-start">
            <span class="btn-glitch">INITIALIZE LINK</span>
            <div class="btn-aura"></div>
        </button>
    </div>

    <!-- CRT OVERLAY (PREMIUM SCANLINES) -->
    <div class="crt-overlay"></div>
    <style>
        .crt-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background:
                linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: 999999;
            opacity: 0.6;
            animation: flicker 0.15s infinite;
        }

        @keyframes flicker {
            0% {
                opacity: 0.55;
            }

            50% {
                opacity: 0.6;
            }

            100% {
                opacity: 0.55;
            }
        }
    </style>

    <!-- DARKNESS OVERLAY for cinematic transitions -->
    <div class="darkness-overlay" id="darkness-overlay"></div>

    <!-- NEURAL INTERFACE WRAPPER -->
    <div id="neural-wrapper" style="display:none;">
        <div id="game-tilt-layer">

            <!-- CLICK TO START SCREEN -->
            <div class="click-to-start" id="click-to-start">
                <div class="start-text">⚡ NEURO-FRIED ⚡</div>
                <div class="headphones-warning">🎧 USE HEADPHONES FOR BETTER OPTIMIZATION 🎧</div>
                <div class="start-subtext">[ CLICK TO INITIALIZE LINK ]</div>
            </div>

            <!-- CINEMATIC BOOT SEQUENCE -->
            <div id="boot-sequence" class="boot-sequence hidden">
                <div class="boot-tunnel">
                    <div class="tr tr-1"></div>
                    <div class="tr tr-2"></div>
                    <div class="tr tr-3"></div>
                    <div class="tr tr-4"></div>
                    <div class="tr tr-5"></div>
                    <div class="tr tr-6"></div>
                </div>
                <div class="boot-content">
                    <div class="boot-terminal" id="boot-terminal">
                        <div class="bt-line">INITIALIZING NEURAL INTERFACE...</div>
                    </div>
                    <div class="boot-logo hidden" id="boot-logo">
                        <div class="bl-text" data-text="NEURO-FRIED">NEURO-FRIED</div>
                    </div>
                </div>
                <div class="boot-flash"></div>
            </div>

            <!-- TILT BACKGROUND (Moves with the layer) -->
            <div id="tilt-ambient"></div>

            <div id="render-layer"><canvas id="c"></canvas></div>
            <div class="vignette"></div>
            <div class="scanlines"></div>

            <!-- BLOOD HORROR OVERLAYS -->
            <div class="blood-veins"></div>
            <div class="blood-drip" id="blood-drip"></div>

            <div class="fx-overlay fx-rewind"></div>
            <div class="fx-overlay fx-freeze"></div>

            <div class="heartbeat-vignette" id="heartbeat-vignette"></div>

            <div class="clutch-save-overlay" id="clutch-save-overlay">
                <div class="clutch-save-text">⚡ CLUTCH SAVE ⚡</div>
            </div>

            <div class="screen-crack-overlay" id="screen-crack-overlay"></div>

            <!-- MOBILE BLOCKER -->
            <div class="mobile-blocker" id="mobile-blocker">
                <h1>🖥️ DESKTOP ONLY</h1>
                <p>NEURO-FRIED requires a desktop browser for the full neural experience. The timeline cannot be
                    accessed from
                    mobile devices.</p>
                <div class="desktop-icon">💻</div>
                <p style="margin-top: 20px; font-size: 0.9rem; opacity: 0.6;">Switch to a computer to play.</p>
            </div>

            <!-- LUCK RANDOMIZER SCREEN -->
            <div id="s-luck" class="screen hidden">
                <h2
                    style="font-family:var(--f-title); color:var(--text-main); margin-bottom:10px; font-size:2rem; margin-top: 15vh;">
                    FATE SELECTION
                </h2>
                <div class="story-container" id="fate-story-container">
                    <!-- Typewriter text generated here -->
                </div>
                <div class="luck-box" id="luck-box-container" style="opacity:0; pointer-events:none;">
                    <div class="luck-container">
                        <div class="luck-slots">
                            <div class="luck-slot" id="luck-slot-1">?</div>
                            <div class="luck-slot" id="luck-slot-2">?</div>
                            <div class="luck-slot" id="luck-slot-3">?</div>
                        </div>
                        <div class="luck-result" id="luck-result"></div>
                    </div>
                    <button class="tech-btn" id="spin-luck-btn" style="margin-top:30px;">SPIN FATE</button>
                </div>
            </div>

            <!-- DREAM OVERLAY (Mode B) -->
            <div class="dream-overlay" id="dream-overlay">
                <div class="dream-text" id="dream-text">IT WAS A DREAM...</div>
                <div class="dream-subtext" id="dream-subtext">Timeline resetting...</div>
            </div>

            <!-- TIME LOOP MODE HUD -->
            <div id="loop-counter" class="hidden">LOOP: <span id="loop-num">0</span></div>
            <div class="loop-restart-overlay" id="loop-restart-overlay"></div>


            <!-- PARADOX GAME SCREEN (Mode C) -->
            <div id="s-game-paradox" class="screen hidden" style="background: black;">
                <div class="paradox-terminal">
                    <div class="paradox-header">
                        <span class="blink">WARNING: REALITY UNSTABLE</span>
                        <span id="paradox-timer" style="color:var(--danger)">60.00</span>
                    </div>

                    <div class="paradox-content">
                        <div class="paradox-glitch-layer"></div>
                        <div class="question-display" id="paradox-question">
                            [ SYSTEM FAILURE ]
                        </div>

                        <div class="chaos-grid" id="paradox-options">
                            <!-- Buttons generated by JS -->
                        </div>
                    </div>

                    <div class="paradox-footer">
                        <div class="sanity-meter">
                            <span>SANITY:</span>
                            <div class="sanity-bar">
                                <div id="sanity-fill" style="width:100%"></div>
                            </div>
                        </div>
                        <div id="paradox-instruction" class="instruction-text">
                            // INSTRUCTION: SYSTEM NORMAL //
                        </div>
                    </div>
                </div>
            </div>

            <!-- PUZZLE MODAL (Mode C End) -->
            <div class="puzzle-modal" id="puzzle-modal" style="display: none;">
                <div class="puzzle-box">
                    <div class="puzzle-title">⏳ FINAL CHALLENGE ⏳</div>
                    <div style="font-family:var(--f-mono); color:var(--text-dim); margin-bottom:20px;">
                        Solve to escape the timeline...
                    </div>
                    <div class="puzzle-question" id="puzzle-question">2 + 2 = ?</div>
                    <input type="text" class="puzzle-input" id="puzzle-input" placeholder="?" autocomplete="off">
                    <button class="tech-btn puzzle-submit" id="puzzle-submit">SUBMIT</button>
                    <div id="puzzle-feedback" style="margin-top:15px; font-family:var(--f-mono); min-height:30px;">
                    </div>
                </div>
            </div>

            <!-- CREEPY RESTART OVERLAY -->


            <div id="fail-modal" class="fail-modal">
                <div class="fail-title">TIMELINE FRACTURED</div>
                <div class="fail-sub">ANOMALY DETECTED. CHOOSE ACTION.</div>
                <div style="font-family:var(--f-mono); opacity:0.6;">
                    EVERY REWIND ACCELERATES COLLAPSE.
                </div>

                <div class="fail-btn-row">
                    <button class="fail-btn btn-rewind" onclick="Game.triggerRewind()">REWIND<br><span
                            style="font-size:0.8rem">COST: 1 CHARGE</span></button>
                    <button class="fail-btn btn-exit" onclick="Game.gameOver()">EXIT<br><span
                            style="font-size:0.8rem">ACCEPT
                            FATE</span></button>
                </div>
            </div>

            <div id="victory-screen" class="win-modal" style="display:none;">
                <h1 class="glitch-title"
                    style="color: var(--green); text-shadow: 0 0 30px var(--green), 0 0 80px rgba(57, 255, 20, 0.5); transform: scale(0.8); position: relative; z-index: 10;">
                    NEURAL SYNC COMPLETE
                </h1>
                <div class="victory-stats" style="
            background: rgba(0, 20, 10, 0.85);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(57, 255, 20, 0.4);
            border-radius: 16px;
            padding: 30px 50px;
            margin: 30px 0;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 0 40px rgba(57, 255, 20, 0.2), inset 0 0 30px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 10;
        ">
                    <div class="stat-row"
                        style="display: flex; justify-content: space-between; margin: 15px 0; border-bottom: 1px solid rgba(57, 255, 20, 0.2); padding-bottom: 10px;">
                        <span class="stat-label" style="font-family: var(--f-ui); color: rgba(255,255,255,0.7);">FINAL
                            SCORE</span>
                        <span class="stat-val" id="final-score"
                            style="font-family: var(--f-mono); font-size: 1.5rem; color: var(--green); text-shadow: 0 0 10px var(--green);">0</span>
                    </div>
                    <div class="stat-row"
                        style="display: flex; justify-content: space-between; margin: 15px 0; border-bottom: 1px solid rgba(57, 255, 20, 0.2); padding-bottom: 10px;">
                        <span class="stat-label" style="font-family: var(--f-ui); color: rgba(255,255,255,0.7);">TIME
                            SURVIVED</span>
                        <span class="stat-val" id="time-survived"
                            style="font-family: var(--f-mono); font-size: 1.5rem; color: var(--secondary); text-shadow: 0 0 10px var(--secondary);">0s</span>
                    </div>
                    <div class="stat-row"
                        style="display: flex; justify-content: space-between; margin: 15px 0; border-bottom: 1px solid rgba(57, 255, 20, 0.2); padding-bottom: 10px;">
                        <span class="stat-label"
                            style="font-family: var(--f-ui); color: rgba(255,255,255,0.7);">QUESTIONS
                            CLEARED</span>
                        <span class="stat-val" id="questions-cleared"
                            style="font-family: var(--f-mono); font-size: 1.5rem; color: var(--text-main);">0</span>
                    </div>
                    <div class="stat-row" style="display: flex; justify-content: space-between; margin: 15px 0;">
                        <span class="stat-label" style="font-family: var(--f-ui); color: rgba(255,255,255,0.7);">MAX
                            SPEED</span>
                        <span class="stat-val" id="max-speed"
                            style="font-family: var(--f-mono); font-size: 1.5rem; color: var(--danger); text-shadow: 0 0 10px var(--danger);">1x</span>
                    </div>
                </div>
                <button class="tech-btn" style="position: relative; z-index: 10;"
                    onclick="location.reload()">REBOOT</button>
            </div>

            <!-- RULES OVERLAY (New Feature) -->
            <div id="rules-overlay" class="rules-overlay hidden">
                <div class="rules-card">
                    <h2 class="rules-title" id="rules-title">MODE RULES</h2>
                    <ul class="rules-list" id="rules-list">
                        <!-- Populated by JS -->
                    </ul>
                    <div class="rules-hint">[ TAP ANYWHERE TO START ]</div>
                </div>
            </div>



            <div id="s-title" class="screen active">
                <h1 class="glitch-title" data-text="NEURO FRIED">NEURO<br>FRIED</h1>

                <div class="protocol-container">
                    <div class="protocol-trigger">[ TRANSMISSION INTERCEPTED ]</div>
                    <div class="story-container" id="title-story-container">
                        <!-- Typewriter text will be generated here -->
                    </div>
                </div>

                <button class="tech-btn" id="init-btn" style="opacity:0; pointer-events:none;">INITIALIZE
                    SYSTEM</button>
            </div>

            <div id="s-roulette" class="screen hidden">
                <h2 style="font-family:var(--f-title); color:var(--text-main); margin-bottom:20px; opacity:0.8;">
                    SEARCHING
                    ARCHIVES...</h2>
                <div class="story-container" id="roulette-story-container">
                    <!-- Typewriter text generated here -->
                </div>
                <div class="roulette-box">
                    <div class="roulette-window">
                        <div class="roulette-track" id="roulette-track"></div>
                        <div
                            style="position:absolute; inset:0; background:linear-gradient(to bottom, var(--glass-bg), transparent 40%, transparent 60%, var(--glass-bg)); pointer-events:none; z-index:20;">
                        </div>
                    </div>
                    <div id="roulette-actions" class="hidden" style="margin-top:10px;">
                        <button class="tech-btn" onclick="Game.confirmTopic()"
                            style="border-color:var(--primary); color:var(--primary);">ACCEPT</button>
                        <button class="tech-btn" onclick="Game.reroll()"
                            style="border-color:var(--danger); color:var(--danger);">REROLL</button>
                    </div>
                </div>
            </div>

            <div id="s-timeline" class="screen hidden">
                <div class="timeline-box">
                    <h2 style="font-family:var(--f-title); color:var(--text-main);">CHOOSE YOUR PATH</h2>
                    <div class="story-container" id="timeline-story-container">
                        <!-- Typewriter text generated here -->
                    </div>
                    <div id="timeline-controls" style="opacity:0; pointer-events:none;">
                        <div style="margin:20px 0; font-family:var(--f-mono); font-size:2rem; color:var(--secondary);">
                            1935 <span style="opacity:0.5">&lt;---&gt;</span> 2035
                        </div>
                        <div class="btn-row">
                            <button class="tech-btn" style="border-color:var(--primary); color:var(--primary);"
                                onclick="Game.startGame('asc')">CHRONOLOGICAL</button>
                            <button class="tech-btn" style="border-color:var(--danger); color:var(--danger);"
                                onclick="Game.startGame('desc')">REWIND FLOW</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="s-register" class="screen hidden" style="background: black; z-index: 5500;">
                <div class="register-box">
                    <h2 style="font-family:var(--f-title); color:var(--primary); margin-bottom:10px;">IDENTITY
                        REGISTRATION</h2>
                    <p style="font-family:var(--f-mono); color:#888; margin-bottom:30px;">REQUIRED FOR NEURAL SYNC</p>

                    <label for="reg-photo" class="avatar-upload">
                        <span id="reg-upload-text" style="color:var(--secondary); font-family:var(--f-mono);">+
                            PHOTO</span>
                        <img id="reg-preview" class="avatar-preview">
                        <input type="file" id="reg-photo" hidden accept="image/*" onchange="previewAvatar(this)">
                    </label>

                    <input type="text" id="reg-name" class="cyber-input" placeholder="ENTER CODENAME" maxlength="12"
                        autocomplete="off">

                    <button class="mega-btn" onclick="registerAndStart()">INITIATE SYNC</button>
                </div>
            </div>

            <div id="s-hype" class="screen hidden" style="background: rgba(0,0,0,0.9); z-index: 5000;">
                <div id="hype-count" class="hype-num">3</div>
                <div id="hype-msg-cont" class="hype-msg-cont hidden"></div>
            </div>

            <div id="s-outro" class="screen hidden"
                style="background:black; z-index: 10000; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                <div id="outro-content" style="position:relative; padding: 20px;">
                    <h1 id="outro-t1" class="outro-text">SYSTEM</h1>
                    <h1 id="outro-t2" class="outro-text">FAILURE</h1>
                    <h1 id="outro-t3" class="outro-text">EXTREME</h1>
                    <h1 id="outro-final" class="outro-text hidden" style="color:var(--primary)">DISCONNECTED</h1>
                </div>
            </div>

            <div id="s-game" class="screen hidden">

                <div class="game-grid">
                    <div class="timer-rail">
                        <div class="timer-fill" id="timer-bar"></div>
                    </div>
                    <div class="q-card">
                        <span class="era-tag" id="era-display">YEAR: 1990</span>
                        <div class="q-text" id="q-text">LOADING...</div>
                    </div>
                    <div class="opt-grid" id="opt-area"></div>
                </div>
            </div>

            <div id="s-over" class="screen hidden"
                style="background: #000000; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                <h1 id="game-over-headline"
                    style="font-family:var(--f-title); font-size:4rem; color:var(--danger); margin-bottom:10px;">SIGNAL
                    LOST
                </h1>

                <div class="game-over-container">
                    <!-- LEFT: Share Card -->
                    <div class="share-card-wrapper">
                        <div class="share-card">
                            <img id="card-img"
                                style="width:100%; height:100%; object-fit:cover; filter:grayscale(100%); opacity:0.6;"
                                src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%25' height='100%25'%3E%3Crect fill='%23111' width='100%25' height='100%25'/%3E%3Ctext x='50%25' y='50%25' fill='%23333' font-family='monospace' text-anchor='middle' dominant-baseline='middle'%3ENO IMAGE%3C/text%3E%3C/svg%3E">
                            <div
                                style="position:absolute; inset:0; background:linear-gradient(to top, black 20%, transparent 80%);">
                            </div>
                            <div style="position:absolute; inset:10px; border:1px solid rgba(255,255,255,0.2);"></div>
                            <div
                                style="position:absolute; top:20px; width:100%; text-align:center; font-family:var(--f-title); color:var(--danger); font-size:0.9rem; letter-spacing:2px;">
                                NEURO-FRIED // AGENT</div>

                            <div style="position:absolute; bottom:30px; width:100%; text-align:center;">
                                <div style="color:#aaa; font-family:var(--f-mono); margin-bottom:5px;">FINAL AURA</div>
                                <div style="color:var(--green); font-family:var(--f-title); font-size:4rem; text-shadow:0 0 20px var(--green);"
                                    id="final-aura-score">0</div>
                                <div style="color:white; font-family:var(--f-title); font-size:1.5rem; letter-spacing:3px;"
                                    id="final-name">AGENT</div>
                            </div>
                        </div>
                    </div>

                    <!-- RIGHT: Controls Panel -->
                    <div class="controls-panel">
                        <!-- User Info Readout -->
                        <div class="control-row name-row" style="justify-content: center; margin-bottom: 20px;">
                            <span style="color:var(--primary); font-family:var(--f-mono); font-size:1.2rem;">IDENTITY
                                VERIFIED</span>
                        </div>

                        <!-- TIMELINE INTEGRITY STATS (Game Jam Feature) -->
                        <div id="timeline-stats" style="
                            margin-bottom: 20px; 
                            padding: 15px; 
                            background: rgba(139, 0, 255, 0.1); 
                            border: 2px solid var(--primary); 
                            border-radius: 8px;
                            font-family: var(--f-mono);">
                            <div
                                style="color: #00f3ff; font-size: 0.9rem; margin-bottom: 10px; text-align: center; letter-spacing: 2px;">
                                ⚠️ TIMELINE REPORT ⚠️
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 8px; font-size: 0.85rem;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: #aaa;">Timeline Corruption:</span>
                                    <span id="final-corruption" style="color: #ff00ff; font-weight: bold;">0%</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: #aaa;">Loops Detected:</span>
                                    <span id="final-loops" style="color: #00f3ff; font-weight: bold;">0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: #aaa;">Powers Used:</span>
                                    <span id="final-powers" style="color: #8b00ff; font-weight: bold;">0</span>
                                </div>
                                <div id="final-ending-badge" style="
                                    margin-top: 10px; 
                                    padding: 8px; 
                                    text-align: center; 
                                    background: rgba(0, 0, 0, 0.5); 
                                    border-radius: 4px;
                                    color: #00ff00;
                                    font-weight: bold;
                                    font-size: 0.9rem;
                                    letter-spacing: 1px;">
                                    ENDING: UNKNOWN
                                </div>
                            </div>
                        </div>

                        <!-- Feedback Button - Opens Google Form -->
                        <button class="send-feedback-btn" onclick="sendFeedback()">📝 SHARE FEEDBACK</button>

                        <!-- Reboot Button -->
                        <button class="control-btn reboot-btn" onclick="location.reload()">🔄 REBOOT SYSTEM</button>

                        <!-- Capture Button -->
                        <button class="control-btn" onclick="initiateCapture()"
                            style="margin-top:10px; border-color:var(--green); color:var(--green);">📸 CAPTURE
                            RECALL</button>


                        <!-- Leaderboard Button -->
                        <button class="control-btn" onclick="showLeaderboard()" style="margin-top:10px;">🏆
                            LEADERBOARD</button>

                        <div style="margin-top: 20px; font-family: var(--f-mono); color: #888; font-size: 0.8rem;">
                            MADE WITH CARE FOR <span style="color: var(--primary);">YOU</span>
                        </div>
                    </div>

                    <!-- Share Message -->
                    <div class="share-message-box">
                        <div style="color:var(--green); font-family:var(--f-title); font-size:1rem; line-height:1.4;">
                            TAKE A SCREENSHOT<br>AND REVIVE YOUR<br>HAPPINESS
                        </div>
                        <div
                            style="color:#888; font-family:var(--f-mono); font-size:0.8rem; margin-top:8px; letter-spacing:1px;">
                            SHARE AMONG ALL
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div> <!-- END game-tilt-layer -->

    <!-- NEURAL HUD OVERLAYS -->
    <div id="neural-hud-overlay">
        <div class="vignette-heavy"></div>
        <div class="border-glitch"></div>
        <div class="retinal-scanline"></div>

        <div class="sys-status">
            <div>NEURAL_LINK: ACTIVE</div>
            <div>LATENCY: 12ms</div>
            <div>SECURE_CONN: TRUE</div>
        </div>

        <div class="bio-metrics">
            <span>BPM: <div class="bio-marker"></div> 110</span>
            <span>CORTEX_SYNC: <div class="bio-marker" style="animation-delay:0.5s"></div> 98.4%</span>
            <span>ADRENALINE: <div class="bio-marker" style="animation-delay:1s"></div> CRITICAL</span>
        </div>
        <div id="hud" class="hidden"
            style="pointer-events: none; width: 100%; height: 100%; position: absolute; inset: 0;">
            <!-- New Left HUD Timer -->
            <div class="hud-panel hud-top-left" id="timer-panel" style="
                left: 40px;
                top: 40px;
                min-width: 180px;
                border: 2px solid var(--primary);
                border-right: none;
                text-align: left;
                pointer-events: auto;
                z-index: 10000;
                position: fixed;
            ">
                <div class="stat-label">TIME REMAINING</div>
                <div class="stat-val" id="time-display" style="font-size: 2.5rem; color: var(--primary);">60.0</div>
                <div class="time-bar-container" style="
                    width: 150px;
                    height: 8px;
                    background: rgba(255,255,255,0.1);
                    border-radius: 4px;
                    margin-top: 10px;
                    overflow: hidden;
                ">
                    <div class="time-bar" id="time-bar" style="
                        height: 100%;
                        width: 100%;
                        background: linear-gradient(90deg, var(--danger), var(--primary));
                        transition: width 0.1s linear;
                        box-shadow: 0 0 10px var(--primary);
                    "></div>
                </div>
            </div>

            <!-- Points / Stats (Top Right) -->
            <div class="hud-panel hud-top-right"
                style="right: 40px; top: 40px; pointer-events: auto; z-index: 10000; position: fixed;">
                <div class="stat-label">TIMELINES SAVED</div>
                <div style="display:flex; align-items:center; justify-content:flex-end;">
                    <div class="coin-cont">
                        <div class="retro-coin"></div>
                    </div>
                    <div class="stat-val" id="hud-score">0</div>
                </div>
                <div class="stat-label" style="margin-top:10px;">REALITY ANCHORS</div>
                <div id="hud-streak"
                    style="font-family:var(--f-mono); color:var(--green); font-size:1.2rem; min-height:1.5rem;">
                </div>
                <div class="lives-container" id="lives-container">
                    <div class="life-pip"></div>
                    <div class="life-pip"></div>
                    <div class="life-pip"></div>
                </div>
            </div>

            <!-- TIMELINE CORRUPTION METER -->
            <div class="hud-panel"
                style="left: 50%; top: 60px; transform: translateX(-50%); 
                       min-width: 300px; max-width: 400px; text-align: center; pointer-events: none; z-index: 10000; position: fixed;">
                <div class="stat-label" style="margin-bottom: 8px; font-size: 0.8rem;">
                    ⚠️ TIMELINE INTEGRITY ⚠️
                </div>
                <div style="width: 100%; height: 20px; background: rgba(0,0,0,0.8); border: 2px solid var(--primary); 
                            border-radius: 10px; overflow: hidden; position: relative;">
                    <div id="corruption-fill" style="width: 0%; height: 100%; 
                                background: linear-gradient(90deg, #8b00ff, #ff00ff, #ff0000);
                                transition: width 0.3s ease, box-shadow 0.3s ease;
                                box-shadow: 0 0 10px rgba(139, 0, 255, 0.8);">
                    </div>
                    <div id="corruption-text" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
                                font-family: var(--f-mono); font-size: 0.7rem; color: white;
                                text-shadow: 0 0 5px black; font-weight: bold; z-index: 1;">
                        0% CORRUPTED
                    </div>
                </div>
                <div id="corruption-warning" style="margin-top: 5px; font-family: var(--f-mono); font-size: 0.7rem; 
                            color: var(--danger); opacity: 0; transition: opacity 0.3s;">
                    ⚠️ REALITY FRACTURING ⚠️
                </div>
            </div>

            <!-- FREEZE BUTTON (Right Center) -->
            <button class="big-freeze-btn" id="btn-freeze" onclick="TimePowers.useFreeze()"
                style="pointer-events: auto; position: fixed; right: 40px; top: 50%; transform: translateY(-50%); z-index: 10000; flex-direction: column; gap: 10px;">
                FREEZE
                <span>[SPACE]</span>
            </button>

            <!-- REWIND BUTTON (Left Center) -->
            <button class="big-freeze-btn btn-hud-rewind" id="btn-rewind-hud" onclick="TimePowers.useRewind()"
                style="pointer-events: auto; position: fixed; left: 40px; top: 50%; transform: translateY(-50%); z-index: 10000; flex-direction: column; gap: 10px;">
                REWIND
                <span>[R]</span>
            </button>
        </div>
    </div>
    </div> <!-- END neural-wrapper -->

    <script>
        // --- 1. DATA: 20 CATEGORIES (400 Qs Skeleton - Full sample set) ---
        const TOPICS = [
            {
                id: 'finance', name: 'FINANCE & MARKETS', icon: '📈', theme: 't-finance', qs: [
                    { y: 1929, q: "The Great Depression began with...", a: "Black Tuesday", w: ["Red Friday", "Gray Monday"] },
                    { y: 1971, q: "Nixon ended the direct convertibility of the dollar to...", a: "Gold", w: ["Silver", "Oil"] },
                    { y: 1987, q: "Black Monday saw the Dow drop...", a: "22%", w: ["50%", "10%"] },
                    { y: 2001, q: "Enron collapsed due to...", a: "Accounting Fraud", w: ["Market Crash", "Hacks"] },
                    { y: 2008, q: "Bank collapse that sparked the crisis.", a: "Lehman Brothers", w: ["Goldman Sachs", "JP Morgan"] },
                    { y: 2009, q: "Created as a decentralized digital currency.", a: "Bitcoin", w: ["Litecoin", "Ethereum"] },
                    { y: 2021, q: "GameStop stock squeezed by...", a: "Reddit", w: ["Twitter", "Facebook"] },
                    { y: 1944, q: "Bretton Woods established the...", a: "IMF", w: ["WTO", "NATO"] },
                    { y: 1999, q: "Repeal of Glass-Steagall allowed...", a: "Mega Banks", w: ["Crypto", "Offshore"] },
                    { y: 2010, q: "The Flash Crash lasted...", a: "36 Minutes", w: ["1 Hour", "1 Day"] },
                    { y: 2022, q: "FTX Exchange collapsed due to...", a: "Fraud", w: ["Hacks", "Regulation"] },
                    { y: 1933, q: "FDR confiscated private...", a: "Gold", w: ["Guns", "Land"] },
                    { y: 2000, q: "The Dot Com bubble burst caused...", a: "Recession", w: ["Inflation", "War"] },
                    { y: 2023, q: "Silicon Valley Bank failed due to...", a: "Bond Rates", w: ["Crypto", "Hacks"] },
                    { y: 1950, q: "First credit card introduced.", a: "Diners Club", w: ["Visa", "Amex"] },
                    { y: 1998, q: "Long-Term Capital Management...", a: "Collapsed", w: ["Soared", "Merged"] },
                    { y: 2007, q: "The start of the...", a: "Subprime Crisis", w: ["Oil Crisis", "Tech Boom"] },
                    { y: 2017, q: "Bitcoin hit this milestone.", a: "$20,000", w: ["$1,000", "$100,000"] },
                    { y: 1923, q: "Hyperinflation destroyed the...", a: "German Mark", w: ["US Dollar", "Pound"] },
                    { y: 2030, q: "Projected year for...", a: "CBDCs", w: ["Cash End", "Gold Return"] }
                ]
            },
            {
                id: 'coding', name: 'CODE & ALGOS', icon: '💻', theme: 't-code', qs: [
                    { y: 1936, q: "Father of theoretical computer science.", a: "Alan Turing", w: ["Ada Lovelace", "Charles Babbage"] },
                    { y: 1945, q: "First actual computer bug.", a: "Moth", w: ["Ant", "Fly"] },
                    { y: 1957, q: "First high-level language.", a: "FORTRAN", w: ["COBOL", "BASIC"] },
                    { y: 1972, q: "Language created by Dennis Ritchie.", a: "C", w: ["B", "D"] },
                    { y: 1991, q: "Linux kernel was released by...", a: "Linus Torvalds", w: ["Steve Jobs", "Bill Gates"] },
                    { y: 1995, q: "Programming language created in 10 days.", a: "JavaScript", w: ["Java", "Python"] },
                    { y: 2004, q: "Google's email service launched on April 1st.", a: "Gmail", w: ["Hotmail", "Yahoo"] },
                    { y: 2008, q: "GitHub was founded to host...", a: "Git Repos", w: ["SVN", "Mercurial"] },
                    { y: 2009, q: "Language created by Google.", a: "Go", w: ["Rust", "Swift"] },
                    { y: 2014, q: "HTML5 became a...", a: "Standard", w: ["Suggestion", "Law"] },
                    { y: 1983, q: "C++ was released by...", a: "Stroustrup", w: ["Gosling", "Rossum"] },
                    { y: 1991, q: "Python was released by...", a: "Guido van Rossum", w: ["Eich", "Wall"] },
                    { y: 2010, q: "Rust was released by...", a: "Mozilla", w: ["Google", "Apple"] },
                    { y: 2023, q: "AI model that changed coding.", a: "GPT-4", w: ["DeepBlue", "Watson"] },
                    { y: 1969, q: "UNIX was developed at...", a: "Bell Labs", w: ["Xerox PARC", "MIT"] },
                    { y: 1995, q: "Java slogan: Write Once...", a: "Run Anywhere", w: ["Run Fast", "Debug Everywhere"] },
                    { y: 2001, q: "Agile Manifesto was...", a: "Signed", w: ["Rejected", "Lost"] },
                    { y: 2015, q: "VS Code was released by...", a: "Microsoft", w: ["Apple", "Adobe"] },
                    { y: 1989, q: "Python is named after...", a: "Monty Python", w: ["Snake", "Constrictor"] },
                    { y: 2024, q: "Devin AI claimed to be...", a: "First AI Engineer", w: ["Fastest Coder", "Best Debugger"] }
                ]
            },
            {
                id: 'tech', name: 'FUTURE TECH', icon: '🤖', theme: 't-tech', qs: [
                    { y: 1969, q: "Network that became the basis for the Internet.", a: "ARPANET", w: ["SKYNET", "INTRANET"] },
                    { y: 1984, q: "Apple launched Macintosh with...", a: "1984 Ad", w: ["Think Different", "Hello"] },
                    { y: 2007, q: "Device that combined phone, ipod, and communicator.", a: "iPhone", w: ["Blackberry", "Palm Pilot"] },
                    { y: 2016, q: "AI that defeated the Go world champion.", a: "AlphaGo", w: ["DeepBlue", "Watson"] },
                    { y: 2023, q: "Large Language Model released by OpenAI.", a: "GPT-4", w: ["Bard", "Llama"] },
                    { y: 2024, q: "Apple's Spatial Computer.", a: "Vision Pro", w: ["Oculus", "Hololens"] },
                    { y: 1977, q: "First complete personal computer.", a: "Apple II", w: ["Altair", "Commodore"] },
                    { y: 1998, q: "Google was founded in a...", a: "Garage", w: ["Dorm", "Office"] },
                    { y: 2001, q: "Wikipedia was launched by...", a: "Jimmy Wales", w: ["Assange", "Snowden"] },
                    { y: 2011, q: "Siri was integrated into...", a: "iPhone 4S", w: ["iPhone 3G", "iPhone 5"] },
                    { y: 1989, q: "World Wide Web invented by...", a: "Tim Berners-Lee", w: ["Al Gore", "Vint Cerf"] },
                    { y: 2004, q: "Firefox 1.0 challenged...", a: "Internet Explorer", w: ["Netscape", "Opera"] },
                    { y: 2012, q: "Google Glass was a...", a: "Flop", w: ["Hit", "Standard"] },
                    { y: 2020, q: "Zoom became the standard for...", a: "Meetings", w: ["Gaming", "Dating"] },
                    { y: 1990, q: "Photoshop 1.0 released for...", a: "Macintosh", w: ["Windows", "Linux"] },
                    { y: 2006, q: "Tesla Roadster revealed.", a: "Electric Car", w: ["Hybrid", "Hydrogen"] },
                    { y: 2015, q: "OpenAI was founded.", a: "Non-Profit", w: ["For-Profit", "Gov Org"] },
                    { y: 1979, q: "Sony Walkman changed...", a: "Music", w: ["Video", "Gaming"] },
                    { y: 2022, q: "DALL-E 2 generated...", a: "Images", w: ["Video", "Music"] },
                    { y: 2025, q: "The Singularity is...", a: "Near", w: ["Far", "Impossible"] }
                ]
            },
            {
                id: 'social', name: 'SOCIAL MEDIA', icon: '📱', theme: 't-social', qs: [
                    { y: 2004, q: "The Facebook started at...", a: "Harvard", w: ["Yale", "Stanford"] },
                    { y: 2006, q: "Twitter's original character limit.", a: "140", w: ["280", "100"] },
                    { y: 2010, q: "Instagram launched for...", a: "iOS Only", w: ["Android", "Web"] },
                    { y: 2011, q: "Snapchat's key feature.", a: "Disappearing", w: ["Filters", "Stories"] },
                    { y: 2016, q: "TikTok original name.", a: "Douyin", w: ["Musical.ly", "Vine"] },
                    { y: 2003, q: "First major social network.", a: "MySpace", w: ["Friendster", "Hi5"] },
                    { y: 2005, q: "YouTube's first video.", a: "Me at the zoo", w: ["Cat video", "Dance"] },
                    { y: 2012, q: "Facebook bought Instagram for...", a: "$1 Billion", w: ["$500 Million", "$10 Billion"] },
                    { y: 2013, q: "Vine introduced...", a: "6 sec videos", w: ["Stories", "Live"] },
                    { y: 2018, q: "Cambridge Analytica scandal hit...", a: "Facebook", w: ["Twitter", "Google"] },
                    { y: 2022, q: "Elon Musk bought Twitter for...", a: "$44 Billion", w: ["$20 Billion", "$100 Billion"] },
                    { y: 2007, q: "Hashtags were invented on...", a: "Twitter", w: ["Instagram", "Facebook"] },
                    { y: 2020, q: "BeReal encouraged...", a: "Authenticity", w: ["Filters", "Ads"] },
                    { y: 2011, q: "Google+ was a...", a: "Failure", w: ["Success", "Standard"] },
                    { y: 2014, q: "Amazon bought Twitch.", a: "Streaming", w: ["Shopping", "Gaming"] },
                    { y: 2004, q: "Digg was a news...", a: "Aggregator", w: ["Creator", "Paper"] },
                    { y: 2010, q: "Pinterest launched for...", a: "Moodboards", w: ["Dating", "Jobs"] },
                    { y: 2016, q: "Pokemon GO was...", a: "Social AR", w: ["VR", "Console"] },
                    { y: 2023, q: "Threads challenged...", a: "Twitter", w: ["Reddit", "TikTok"] },
                    { y: 2008, q: "Spotify launched in...", a: "Europe", w: ["USA", "Asia"] }
                ]
            },
            {
                id: 'space', name: 'COSMIC FRONTIER', icon: '🚀', theme: 't-space', qs: [
                    { y: 1957, q: "First satellite in orbit.", a: "Sputnik 1", w: ["Explorer", "Vostok"] },
                    { y: 1969, q: "Apollo 11 landed on...", a: "The Moon", w: ["Mars", "Venus"] },
                    { y: 1990, q: "Telescope launched into orbit.", a: "Hubble", w: ["Webb", "Kepler"] },
                    { y: 2015, q: "SpaceX landed a...", a: "Rocket Booster", w: ["Shuttle", "Capsule"] },
                    { y: 2022, q: "Successor to Hubble.", a: "James Webb", w: ["Galileo", "Copernicus"] },
                    { y: 1961, q: "First human in space.", a: "Yuri Gagarin", w: ["Shepard", "Glenn"] },
                    { y: 1986, q: "Challenger disaster involved...", a: "O-Rings", w: ["Engine", "Fuel"] },
                    { y: 2012, q: "Curiosity Rover landed on...", a: "Mars", w: ["Moon", "Titan"] },
                    { y: 1977, q: "Voyager probes carry...", a: "Golden Record", w: ["CD", "Map"] },
                    { y: 1998, q: "ISS construction...", a: "Began", w: ["Ended", "Failed"] },
                    { y: 2003, q: "Columbia disaster on...", a: "Re-entry", w: ["Launch", "Orbit"] },
                    { y: 2020, q: "SpaceX launched humans to...", a: "ISS", w: ["Moon", "Mars"] },
                    { y: 1969, q: "Armstrong's first word.", a: "Houston", w: ["Eagle", "Step"] },
                    { y: 2019, q: "First image of a...", a: "Black Hole", w: ["Quasar", "Pulsar"] },
                    { y: 1958, q: "NASA was...", a: "Founded", w: ["Ended", "Merged"] },
                    { y: 2021, q: "Perseverance landed with...", a: "Helicopter", w: ["Bike", "Boat"] },
                    { y: 1972, q: "Last moon landing.", a: "Apollo 17", w: ["Apollo 11", "Apollo 13"] },
                    { y: 2006, q: "Pluto was...", a: "Demoted", w: ["Discovered", "Exploded"] },
                    { y: 2024, q: "Artemis mission targets...", a: "Moon", w: ["Mars", "Asteroid"] },
                    { y: 2030, q: "Goal for Mars...", a: "Landing", w: ["Colony", "Flyby"] }
                ]
            },
            {
                id: 'gaming', name: 'GAMING HISTORY', icon: '🎮', theme: 't-gaming', qs: [
                    { y: 1985, q: "Nintendo saved the industry with...", a: "NES", w: ["Atari", "Sega"] },
                    { y: 1993, q: "FPS that caused controversy.", a: "DOOM", w: ["Quake", "Halo"] },
                    { y: 1996, q: "Mario went...", a: "3D", w: ["VR", "Online"] },
                    { y: 2004, q: "WoW defined...", a: "MMORPGs", w: ["FPS", "RTS"] },
                    { y: 2011, q: "Minecraft officially...", a: "Released", w: ["Beta", "Alpha"] },
                    { y: 1980, q: "Pac-Man was created by...", a: "Namco", w: ["Nintendo", "Sega"] },
                    { y: 1989, q: "Game Boy launched with...", a: "Tetris", w: ["Mario", "Zelda"] },
                    { y: 1991, q: "Sonic challenged...", a: "Mario", w: ["Zelda", "Link"] },
                    { y: 1997, q: "Final Fantasy VII on...", a: "PlayStation", w: ["N64", "Saturn"] },
                    { y: 2000, q: "PS2 became the...", a: "Best Seller", w: ["Worst", "Average"] },
                    { y: 2001, q: "Halo launched with...", a: "Xbox", w: ["PS2", "GameCube"] },
                    { y: 2006, q: "Wii introduced...", a: "Motion", w: ["VR", "4K"] },
                    { y: 2013, q: "GTA V broke...", a: "Sales Records", w: ["Consoles", "Laws"] },
                    { y: 2017, q: "Switch combined...", a: "Home & Handheld", w: ["VR & AR", "PC & Console"] },
                    { y: 2020, q: "Cyberpunk 2077 had a...", a: "Rough Launch", w: ["Perfect Launch", "Delay"] },
                    { y: 1972, q: "Pong was the...", a: "First Hit", w: ["Last Hit", "Flop"] },
                    { y: 1998, q: "Ocarina of Time set...", a: "Standards", w: ["Records", "Traps"] },
                    { y: 2007, q: "Portal introduced...", a: "Portals", w: ["Guns", "Zombies"] },
                    { y: 2018, q: "Fortnite popularized...", a: "Battle Royale", w: ["FPS", "RPG"] },
                    { y: 2022, q: "Elden Ring won...", a: "GOTY", w: ["Nothing", "Indie"] }
                ]
            },
            {
                id: 'cyber', name: 'CYBER SECURITY', icon: '🔒', theme: 't-cyber', qs: [
                    { y: 1988, q: "The Morris Worm was the...", a: "First Worm", w: ["Virus", "Trojan"] },
                    { y: 2010, q: "Stuxnet targeted...", a: "Iran Nuclear", w: ["US Banks", "Russia"] },
                    { y: 2013, q: "Snowden revealed...", a: "NSA Spying", w: ["CIA Plots", "FBI"] },
                    { y: 2017, q: "WannaCry was...", a: "Ransomware", w: ["Spyware", "Adware"] },
                    { y: 2020, q: "SolarWinds hack affected...", a: "US Gov", w: ["Facebook", "Google"] },
                    { y: 1995, q: "Kevin Mitnick was...", a: "Arrested", w: ["Hired", "Found"] },
                    { y: 2000, q: "ILOVEYOU virus spread via...", a: "Email", w: ["USB", "Web"] },
                    { y: 2014, q: "Mt. Gox lost...", a: "Bitcoin", w: ["Dollars", "Gold"] },
                    { y: 2011, q: "PSN was...", a: "Hacked", w: ["Upgraded", "Sold"] },
                    { y: 2016, q: "Mirai Botnet used...", a: "IoT Devices", w: ["PCs", "Phones"] },
                    { y: 2019, q: "Capital One breach via...", a: "Firewall", w: ["Phishing", "Physical"] },
                    { y: 2021, q: "Colonial Pipeline paid...", a: "Ransom", w: ["Taxes", "Nothing"] },
                    { y: 2022, q: "Lapsus$ hacked...", a: "Nvidia", w: ["AMD", "Intel"] },
                    { y: 2008, q: "Conficker worm infected...", a: "Millions", w: ["Thousands", "Hundreds"] },
                    { y: 2015, q: "Ashley Madison data...", a: "Leaked", w: ["Saved", "Lost"] },
                    { y: 2018, q: "GDPR enacted for...", a: "Privacy", w: ["Speed", "Security"] },
                    { y: 2023, q: "MGM Resorts...", a: "Hacked", w: ["Closed", "Sold"] },
                    { y: 1999, q: "Melissa Virus was a...", a: "Macro", w: ["Micro", "Nano"] },
                    { y: 2012, q: "LinkedIn passwords...", a: "Stolen", w: ["Reset", "Sold"] },
                    { y: 2024, q: "AI Phishing is...", a: "Rising", w: ["Falling", "Stable"] }
                ]
            },
            {
                id: 'mobile', name: 'MOBILE PHONES', icon: '📵', theme: 't-mobile', qs: [
                    { y: 1973, q: "First mobile call by...", a: "Motorola", w: ["Nokia", "Bell"] },
                    { y: 1983, q: "Motorola DynaTAC price.", a: "$4000", w: ["$1000", "$500"] },
                    { y: 2000, q: "The indestructible phone.", a: "Nokia 3310", w: ["Razr", "Ericsson"] },
                    { y: 2007, q: "iPhone introduced...", a: "Multi-touch", w: ["Stylus", "Keyboard"] },
                    { y: 2008, q: "Android launched on...", a: "HTC Dream", w: ["Samsung", "Pixel"] },
                    { y: 1992, q: "First Smartphone concept.", a: "IBM Simon", w: ["Apple Newton", "Palm"] },
                    { y: 2004, q: "Moto Razr was a...", a: "Fashion Icon", w: ["Smart Phone", "Brick"] },
                    { y: 2010, q: "iPhone 4 scandal.", a: "Antennagate", w: ["Bendgate", "Battery"] },
                    { y: 2016, q: "Samsung Note 7...", a: "Exploded", w: ["Cracked", "Lost"] },
                    { y: 1999, q: "Blackberry introduced...", a: "Email", w: ["Games", "Music"] },
                    { y: 2002, q: "Nokia 7650 had a...", a: "Camera", w: ["GPS", "Wifi"] },
                    { y: 2017, q: "iPhone X removed...", a: "Home Button", w: ["Screen", "Cam"] },
                    { y: 2009, q: "App Store slogan.", a: "There's an app", w: ["Download it", "Get it"] },
                    { y: 2011, q: "Galaxy Note popularized...", a: "Phablets", w: ["Tablets", "Watches"] },
                    { y: 2019, q: "Foldable phones...", a: "Returned", w: ["Died", "Exploded"] },
                    { y: 2020, q: "5G rollout...", a: "Began", w: ["Ended", "Failed"] },
                    { y: 1996, q: "StarTAC was the first...", a: "Clamshell", w: ["Slider", "Touch"] },
                    { y: 2013, q: "Fingerprint sensor on...", a: "iPhone 5S", w: ["iPhone 5", "iPhone 6"] },
                    { y: 2023, q: "USB-C on iPhone...", a: "15", w: ["14", "13"] },
                    { y: 2005, q: "Google bought...", a: "Android", w: ["Nokia", "HTC"] }
                ]
            },
            {
                id: 'internet', name: 'INTERNET CULTURE', icon: '🌐', theme: 't-net', qs: [
                    { y: 1993, q: "Eternal September began on...", a: "Usenet", w: ["Reddit", "Digg"] },
                    { y: 1996, q: "Dancing Baby was a...", a: "Meme", w: ["Virus", "Game"] },
                    { y: 2005, q: "First YouTube video.", a: "Me at zoo", w: ["Cats", "Shoes"] },
                    { y: 2007, q: "Rickrolling uses...", a: "Never Gonna", w: ["Sandstorm", "Halo"] },
                    { y: 2012, q: "Gangnam Style hit...", a: "1 Billion", w: ["1 Million", "1 Trillion"] },
                    { y: 1998, q: "Hamster Dance was...", a: "Viral", w: ["Viral", "Dead"] },
                    { y: 2004, q: "Numa Numa guy...", a: "Lip Synced", w: ["Danced", "Sang"] },
                    { y: 2006, q: "Lonelygirl15 was...", a: "Fake", w: ["Real", "Alien"] },
                    { y: 2011, q: "Nyan Cat is a...", a: "Pop Tart", w: ["Toast", "Bread"] },
                    { y: 2013, q: "The Fox says...", a: "Ring Ding", w: ["Meow", "Woof"] },
                    { y: 2015, q: "The Dress was...", a: "Blue/Black", w: ["Gold/White", "Red/Green"] },
                    { y: 2016, q: "Harambe became a...", a: "Symbol", w: ["Pet", "Logo"] },
                    { y: 2019, q: "Storm Area 51...", a: "Failed", w: ["Succeeded", "Happened"] },
                    { y: 2009, q: "David After...", a: "Dentist", w: ["School", "Doctor"] },
                    { y: 2010, q: "Bed Intruder...", a: "Song", w: ["Movie", "Book"] },
                    { y: 2014, q: "Ice Bucket Challenge for...", a: "ALS", w: ["Cancer", "Flu"] },
                    { y: 2018, q: "Tide Pods are not...", a: "Food", w: ["Soap", "Toys"] },
                    { y: 2007, q: "Charlie bit my...", a: "Finger", w: ["Toe", "Ear"] },
                    { y: 2020, q: "Coffin Dance...", a: "Meme", w: ["Song", "Dance"] },
                    { y: 2012, q: "Overly Attached...", a: "Girlfriend", w: ["Boyfriend", "Mom"] }
                ]
            },
            {
                id: 'chips', name: 'HARDWARE', icon: '💾', theme: 't-hard', qs: [
                    { y: 1965, q: "Moore's Law involves...", a: "Transistors", w: ["Heat", "Cost"] },
                    { y: 1971, q: "First Microprocessor.", a: "Intel 4004", w: ["8086", "Pentium"] },
                    { y: 1993, q: "Pentium processor by...", a: "Intel", w: ["AMD", "IBM"] },
                    { y: 2006, q: "Core 2 Duo introduced...", a: "Multi-core", w: ["Speed", "Heat"] },
                    { y: 2020, q: "Apple M1 chip used...", a: "ARM", w: ["x86", "RISC"] },
                    { y: 1981, q: "IBM PC used...", a: "Intel 8088", w: ["Motorola", "Zilog"] },
                    { y: 1999, q: "Nvidia invented the...", a: "GPU", w: ["CPU", "APU"] },
                    { y: 2017, q: "Ryzen challenged...", a: "Intel", w: ["Nvidia", "Apple"] },
                    { y: 1958, q: "Integrated Circuit...", a: "Invented", w: ["Lost", "Sold"] },
                    { y: 1985, q: "Amiga used...", a: "Custom Chips", w: ["Standard", "None"] },
                    { y: 2011, q: "Raspberry Pi is a...", a: "Tiny PC", w: ["Cake", "Toy"] },
                    { y: 2000, q: "USB drives replaced...", a: "Floppies", w: ["CDs", "DVDs"] },
                    { y: 2012, q: "SSD prices...", a: "Dropped", w: ["Rose", "Stalled"] },
                    { y: 1995, q: "3dfx Voodoo was for...", a: "Graphics", w: ["Sound", "Net"] },
                    { y: 2022, q: "RTX 4090 requires...", a: "Power", w: ["Water", "Air"] },
                    { y: 2005, q: "Xbox 360 used...", a: "PowerPC", w: ["x86", "ARM"] },
                    { y: 1991, q: "Sound Blaster...", a: "Audio", w: ["Video", "Net"] },
                    { y: 2015, q: "USB-C introduced...", a: "Reversibility", w: ["Speed", "Power"] },
                    { y: 1976, q: "Cray-1 was a...", a: "Supercomputer", w: ["Laptop", "Phone"] },
                    { y: 2024, q: "Chips Act boosts...", a: "US Fab", w: ["China", "EU"] }
                ]
            },
            {
                id: 'os', name: 'OPERATING SYS', icon: '💿', theme: 't-os', qs: [
                    { y: 1981, q: "MS-DOS launched with...", a: "IBM PC", w: ["Apple", "Compaq"] },
                    { y: 1984, q: "MacOS introduced...", a: "GUI", w: ["CLI", "Touch"] },
                    { y: 1995, q: "Windows 95 brought...", a: "Start Menu", w: ["Tiles", "Dock"] },
                    { y: 2001, q: "Windows XP was...", a: "Beloved", w: ["Hated", "Ignored"] },
                    { y: 2015, q: "Windows 10 was the...", a: "Last Version", w: ["First", "Best"] },
                    { y: 1991, q: "Linux Kernel...", a: "Released", w: ["Sold", "Closed"] },
                    { y: 1985, q: "Windows 1.0 was a...", a: "Shell", w: ["OS", "App"] },
                    { y: 2007, q: "iOS was based on...", a: "OS X", w: ["Linux", "Windows"] },
                    { y: 2009, q: "Windows 7 fixed...", a: "Vista", w: ["XP", "98"] },
                    { y: 2001, q: "Mac OS X used...", a: "Unix", w: ["DOS", "Linux"] },
                    { y: 2012, q: "Windows 8 removed...", a: "Start Btn", w: ["Desktop", "Mouse"] },
                    { y: 1969, q: "Unix created at...", a: "Bell Labs", w: ["MIT", "Stanford"] },
                    { y: 1990, q: "Windows 3.0 was a...", a: "Hit", w: ["Flop", "Bug"] },
                    { y: 2004, q: "Ubuntu made Linux...", a: "Easy", w: ["Hard", "Fast"] },
                    { y: 2008, q: "Android is based on...", a: "Linux", w: ["Java", "Windows"] },
                    { y: 2021, q: "Windows 11 centered...", a: "Taskbar", w: ["Windows", "Icons"] },
                    { y: 1993, q: "Windows NT was...", a: "32-bit", w: ["16-bit", "64-bit"] },
                    { y: 1987, q: "OS/2 was by...", a: "IBM/MS", w: ["Apple", "Dell"] },
                    { y: 2011, q: "ChromeOS runs...", a: "Web Apps", w: ["Exe", "Dmg"] },
                    { y: 2000, q: "Windows ME was...", a: "Unstable", w: ["Great", "Fast"] }
                ]
            },
            {
                id: 'crypto', name: 'CRYPTO & WEB3', icon: '⛓️', theme: 't-crypto', qs: [
                    { y: 2009, q: "Bitcoin Genesis Block.", a: "Jan 3", w: ["Dec 25", "Jan 1"] },
                    { y: 2015, q: "Ethereum launched...", a: "Smart Contracts", w: ["NFTs", "Mining"] },
                    { y: 2013, q: "Dogecoin started as...", a: "Joke", w: ["Scam", "Bank"] },
                    { y: 2017, q: "ICO Boom raised...", a: "Billions", w: ["Millions", "Trillions"] },
                    { y: 2022, q: "The Merge moved ETH to...", a: "Proof of Stake", w: ["Work", "History"] },
                    { y: 2010, q: "Bitcoin Pizza cost...", a: "10k BTC", w: ["100 BTC", "1k BTC"] },
                    { y: 2014, q: "Mt Gox hack lost...", a: "850k BTC", w: ["100k", "1M"] },
                    { y: 2021, q: "Beeple NFT sold for...", a: "$69M", w: ["$1M", "$100k"] },
                    { y: 2011, q: "Silk Road used...", a: "Bitcoin", w: ["Cash", "Card"] },
                    { y: 2016, q: "The DAO was...", a: "Hacked", w: ["Success", "Sold"] },
                    { y: 2022, q: "Terra Luna...", a: "Crashed", w: ["Mooned", "Stayed"] },
                    { y: 2008, q: "Whitepaper by...", a: "Satoshi", w: ["Vitalik", "CZ"] },
                    { y: 2020, q: "DeFi Summer...", a: "Exploded", w: ["Failed", "Stopped"] },
                    { y: 2017, q: "CryptoKitties clogged...", a: "Ethereum", w: ["Bitcoin", "Solana"] },
                    { y: 2021, q: "El Salvador adopted...", a: "Bitcoin", w: ["ETH", "Doge"] },
                    { y: 2018, q: "Crypto Winter...", a: "Froze", w: ["Heated", "Melted"] },
                    { y: 2024, q: "Bitcoin ETF...", a: "Approved", w: ["Denied", "Pending"] },
                    { y: 2019, q: "Facebook Libra...", a: "Failed", w: ["Launched", "Succeeded"] },
                    { y: 2021, q: "Bored Apes...", a: "Minted", w: ["Sold", "Lost"] },
                    { y: 2013, q: "Vitalik proposed...", a: "Ethereum", w: ["Bitcoin 2", "Solana"] }
                ]
            },
            {
                id: 'vr', name: 'VR & AR', icon: '🥽', theme: 't-vr', qs: [
                    { y: 2012, q: "Oculus Kickstarter.", a: "Palmer Luckey", w: ["Zuckerberg", "Carmack"] },
                    { y: 2016, q: "HTC Vive used...", a: "Lighthouses", w: ["Cameras", "Lasers"] },
                    { y: 2014, q: "Facebook bought Oculus.", a: "$2B", w: ["$1B", "$500M"] },
                    { y: 2019, q: "Oculus Quest was...", a: "Standalone", w: ["PC Only", "Phone"] },
                    { y: 2024, q: "Apple Vision Pro.", a: "Spatial", w: ["Virtual", "Augmented"] },
                    { y: 1995, q: "Virtual Boy was...", a: "Red", w: ["Blue", "Green"] },
                    { y: 2016, q: "PSVR launched for...", a: "PS4", w: ["PS3", "PS5"] },
                    { y: 2020, q: "Half-Life: Alyx...", a: "VR Only", w: ["PC", "Console"] },
                    { y: 2011, q: "Ready Player One...", a: "Book", w: ["Movie", "Game"] },
                    { y: 2015, q: "Google Cardboard...", a: "Cheap", w: ["Expensive", "Complex"] },
                    { y: 2021, q: "Metaverse hype...", a: "Peaked", w: ["Died", "Started"] },
                    { y: 1968, q: "Sword of Damocles...", a: "First HMD", w: ["Game", "Movie"] },
                    { y: 2018, q: "Beat Saber...", a: "Hit", w: ["Miss", "Flop"] },
                    { y: 2016, q: "Pokemon GO is...", a: "AR", w: ["VR", "MR"] },
                    { y: 2013, q: "Google Glass...", a: "Failed", w: ["Won", "Stayed"] },
                    { y: 2022, q: "Meta Quest Pro...", a: "Expensive", w: ["Cheap", "Free"] },
                    { y: 1992, q: "Lawnmower Man...", a: "Movie", w: ["Game", "Book"] },
                    { y: 2019, q: "Valve Index...", a: "Finger Tracking", w: ["Eye", "Body"] },
                    { y: 2023, q: "Quest 3...", a: "Mixed Reality", w: ["VR", "AR"] },
                    { y: 1990, q: "Virtuality Arcade...", a: "Machines", w: ["Consoles", "PCs"] }
                ]
            },
            {
                id: 'ai', name: 'AI REVOLUTION', icon: '🧠', theme: 't-ai', qs: [
                    { y: 2022, q: "ChatGPT launch.", a: "Nov 30", w: ["Jan 1", "Dec 25"] },
                    { y: 2016, q: "AlphaGo beat...", a: "Lee Sedol", w: ["Kasparov", "Carlsen"] },
                    { y: 1950, q: "Turing Test...", a: "Proposed", w: ["Solved", "Failed"] },
                    { y: 1997, q: "Deep Blue beat...", a: "Kasparov", w: ["Sedol", "Fischer"] },
                    { y: 2023, q: "GPT-4 release.", a: "Multimodal", w: ["Text", "Image"] },
                    { y: 2011, q: "Watson won...", a: "Jeopardy", w: ["Chess", "Go"] },
                    { y: 2012, q: "AlexNet breakthrough.", a: "Vision", w: ["Text", "Audio"] },
                    { y: 2017, q: "Transformer paper.", a: "Attention", w: ["Memory", "Speed"] },
                    { y: 2021, q: "DALL-E generated...", a: "Images", w: ["Video", "Text"] },
                    { y: 2014, q: "GANs invented by...", a: "Goodfellow", w: ["Hinton", "LeCun"] },
                    { y: 2020, q: "GPT-3 released.", a: "175B Params", w: ["100B", "1T"] },
                    { y: 1956, q: "Dartmouth Workshop.", a: "AI Born", w: ["AI Died", "AI Peak"] },
                    { y: 1966, q: "ELIZA chatbot.", a: "Therapist", w: ["Friend", "Enemy"] },
                    { y: 2015, q: "OpenAI founded.", a: "Non-profit", w: ["For-profit", "Gov"] },
                    { y: 2024, q: "Sora generates...", a: "Video", w: ["Audio", "Code"] },
                    { y: 2018, q: "BERT model by...", a: "Google", w: ["Meta", "OpenAI"] },
                    { y: 2006, q: "Deep Learning...", a: "Rebranded", w: ["Invented", "Lost"] },
                    { y: 2023, q: "Bard became...", a: "Gemini", w: ["Bing", "Chat"] },
                    { y: 1980, q: "Expert Systems...", a: "Peak", w: ["Start", "End"] },
                    { y: 2025, q: "AGI is...", a: "Prediction", w: ["Here", "Gone"] }
                ]
            },
            {
                id: 'founder', name: 'TECH FOUNDERS', icon: '👔', theme: 't-founder', qs: [
                    { y: 1976, q: "Jobs & Wozniak founded...", a: "Apple", w: ["Microsoft", "IBM"] },
                    { y: 1975, q: "Gates & Allen founded...", a: "Microsoft", w: ["Apple", "Intel"] },
                    { y: 1994, q: "Bezos founded...", a: "Amazon", w: ["eBay", "PayPal"] },
                    { y: 1998, q: "Page & Brin founded...", a: "Google", w: ["Yahoo", "Bing"] },
                    { y: 2004, q: "Zuckerberg founded...", a: "Facebook", w: ["Twitter", "Snap"] },
                    { y: 2002, q: "Musk founded...", a: "SpaceX", w: ["Tesla", "PayPal"] },
                    { y: 1968, q: "Moore & Noyce...", a: "Intel", w: ["AMD", "Nvidia"] },
                    { y: 1993, q: "Jensen Huang...", a: "Nvidia", w: ["ATI", "Intel"] },
                    { y: 1984, q: "Michael Dell...", a: "Dell", w: ["HP", "Compaq"] },
                    { y: 2006, q: "Jack Dorsey...", a: "Twitter", w: ["Square", "Vine"] },
                    { y: 2008, q: "Brian Chesky...", a: "Airbnb", w: ["Uber", "Lyft"] },
                    { y: 2009, q: "Travis Kalanick...", a: "Uber", w: ["Lyft", "Grab"] },
                    { y: 2011, q: "Evan Spiegel...", a: "Snapchat", w: ["Insta", "FB"] },
                    { y: 1977, q: "Larry Ellison...", a: "Oracle", w: ["SAP", "Salesforce"] },
                    { y: 2012, q: "Vitalik Buterin...", a: "Ethereum", w: ["Bitcoin", "Solana"] },
                    { y: 1995, q: "Pierre Omidyar...", a: "eBay", w: ["Amazon", "Craigslist"] },
                    { y: 2007, q: "Reed Hastings...", a: "Netflix", w: ["Hulu", "Disney"] },
                    { y: 2010, q: "Kevin Systrom...", a: "Instagram", w: ["Vine", "TikTok"] },
                    { y: 1939, q: "Hewlett & Packard...", a: "HP", w: ["IBM", "Dell"] },
                    { y: 2005, q: "Sam Altman...", a: "Y Combinator", w: ["OpenAI", "Reddit"] }
                ]
            },
            {
                id: 'phys', name: 'PHYSICS', icon: '⚛️', theme: 't-phys', qs: [
                    { y: 1905, q: "Einstein's...", a: "Annus Mirabilis", w: ["Year", "Day"] },
                    { y: 1915, q: "General Relativity...", a: "Published", w: ["Written", "Lost"] },
                    { y: 1945, q: "Trinity Test...", a: "Atomic Bomb", w: ["H-Bomb", "TNT"] },
                    { y: 1964, q: "Higgs mechanism...", a: "Proposed", w: ["Found", "Lost"] },
                    { y: 2012, q: "Higgs Boson...", a: "Discovered", w: ["Lost", "Hidden"] },
                    { y: 1927, q: "Solvay Conference...", a: "Quantum", w: ["Relativity", "Light"] },
                    { y: 1986, q: "Chernobyl...", a: "Meltdown", w: ["Test", "Fire"] },
                    { y: 2015, q: "Gravitational Waves...", a: "Detected", w: ["Seen", "Heard"] },
                    { y: 1990, q: "Webb construction...", a: "Began", w: ["Ended", "Launched"] },
                    { y: 1965, q: "Cosmic Background...", a: "Found", w: ["Lost", "Hidden"] },
                    { y: 1935, q: "Schrodinger's...", a: "Cat", w: ["Dog", "Rat"] },
                    { y: 1954, q: "CERN established.", a: "Geneva", w: ["Paris", "London"] },
                    { y: 2019, q: "Black Hole...", a: "Imaged", w: ["Found", "Lost"] },
                    { y: 1974, q: "Hawking Radiation...", a: "Proposed", w: ["Found", "Seen"] },
                    { y: 1911, q: "Superconductivity...", a: "Discovered", w: ["Invented", "Lost"] },
                    { y: 2022, q: "Fusion Ignition...", a: "Achieved", w: ["Failed", "Tried"] },
                    { y: 1900, q: "Planck's...", a: "Constant", w: ["Variable", "Number"] },
                    { y: 1924, q: "Hubble found...", a: "Galaxies", w: ["Stars", "Planets"] },
                    { y: 1995, q: "Top Quark...", a: "Found", w: ["Lost", "Hidden"] },
                    { y: 2011, q: "Neutrinos...", a: "Faster?", w: ["Slower", "Same"] }
                ]
            },
            {
                id: 'startup', name: 'TECH HUSTLE', icon: '💼', theme: 't-startup', qs: [
                    { y: 2000, q: "Dot Com...", a: "Bubble", w: ["Boom", "Bang"] },
                    { y: 2008, q: "Airbnb founded during...", a: "Recession", w: ["Boom", "War"] },
                    { y: 2010, q: "WeWork founded.", a: "Coworking", w: ["Living", "Eating"] },
                    { y: 2019, q: "WeWork IPO...", a: "Failed", w: ["Soared", "Okay"] },
                    { y: 2022, q: "Theranos founder...", a: "Convicted", w: ["Freed", "Hired"] },
                    { y: 2009, q: "Uber founded as...", a: "UberCab", w: ["Taxi", "Lyft"] },
                    { y: 2011, q: "Zoom founded.", a: "Video", w: ["Chat", "Phone"] },
                    { y: 2013, q: "Slack launched.", a: "Messaging", w: ["Email", "Video"] },
                    { y: 2005, q: "Y Combinator...", a: "Started", w: ["Ended", "Sold"] },
                    { y: 2012, q: "Coinbase founded.", a: "Crypto", w: ["Bank", "Stock"] },
                    { y: 2014, q: "Magic Leap...", a: "Hype", w: ["Real", "Fake"] },
                    { y: 2020, q: "Snowflake IPO.", a: "Cloud", w: ["Data", "Web"] },
                    { y: 2021, q: "Rivian IPO.", a: "EV", w: ["Gas", "Hybrid"] },
                    { y: 2006, q: "Spotify founded.", a: "Music", w: ["Video", "Pod"] },
                    { y: 2015, q: "Juicero...", a: "Failed", w: ["Won", "Sold"] },
                    { y: 2003, q: "Tesla founded.", a: "EVs", w: ["Gas", "Solar"] },
                    { y: 2016, q: "Quibi...", a: "Short", w: ["Long", "Med"] },
                    { y: 2020, q: "Quibi...", a: "Died", w: ["Lived", "Sold"] },
                    { y: 1999, q: "Pets.com...", a: "Icon", w: ["Store", "Site"] },
                    { y: 2018, q: "Robinhood...", a: "Trading", w: ["Bank", "Loan"] }
                ]
            },
            {
                id: 'bio', name: 'BIOTECH & FUTURE', icon: '🧬', theme: 't-bio', qs: [
                    { y: 1953, q: "Watson and Crick famously discovered the double helix structure of what?", a: "DNA", w: ["RNA", "Proteins"] },
                    { y: 1996, q: "Dolly became the first mammal cloned from an adult cell. What animal was she?", a: "Sheep", w: ["Cow", "Goat"] },
                    { y: 2003, q: "The Human Genome Project completed the sequencing of what?", a: "Human DNA", w: ["Monkey DNA", "Virus DNA"] },
                    { y: 2012, q: "CRISPR-Cas9 technology was developed to perform what function?", a: "Gene Editing", w: ["Cloning", "Sequencing"] },
                    { y: 2020, q: "Pfizer and Moderna released vaccines for COVID-19 using which technology?", a: "mRNA", w: ["Viral Vector", "Inactivated Virus"] },
                    { y: 1978, q: "Louise Brown was the first human born via which method?", a: "IVF", w: ["Surrogacy", "Cloning"] },
                    { y: 1990, q: "The Human Genome Project began. How much did it initially cost?", a: "$3 Billion", w: ["$3 Million", "$300 Billion"] },
                    { y: 2006, q: "23andMe was founded to provide what service to consumers?", a: "Genetic Testing", w: ["Ancestry Books", "Medical Advice"] },
                    { y: 2018, q: "Scientist He Jiankui was condemned for creating the first...", a: "Gene-Edited Babies", w: ["Cloned Humans", "Super Soldiers"] },
                    { y: 1928, q: "Alexander Fleming discovered Penicillin, which is what type of drug?", a: "Antibiotic", w: ["Painkiller", "Antiviral"] },
                    { y: 1983, q: "PCR technology allowed scientists to amplify what?", a: "DNA Segments", w: ["Blood Cells", "Neurons"] },
                    { y: 2024, q: "Neuralink successfully implanted its device in a human. What does it do?", a: "Brain-Computer Interface", w: ["Memory Erasure", "Vision Restoration"] },
                    { y: 2013, q: "The first lab-grown burger was eaten in London. What was its price tag?", a: "$330,000", w: ["$3,300", "$33"] },
                    { y: 2001, q: "One week after 9/11, letters containing which deadly spores were mailed?", a: "Anthrax", w: ["Smallpox", "Ricin"] },
                    { y: 1951, q: "The immortal 'HeLa' cells were taken without consent from whom?", a: "Henrietta Lacks", w: ["Rosa Parks", "Marie Curie"] },
                    { y: 2022, q: "Surgeons successfully transplanted a heart from which animal into a human?", a: "Pig", w: ["Chimpanzee", "Cow"] },
                    { y: 1997, q: "The film 'Gattaca' explored a future society based on what?", a: "Eugenics", w: ["Robotics", "Virtual Reality"] },
                    { y: 2015, q: "Elizabeth Holmes was exposed for fraud regarding her company, Theranos. What did it promise?", a: "Blood Testing", w: ["Anti-Aging", "Brain Uploading"] },
                    { y: 1980, q: "The Supreme Court ruled that man-made organisms could be...", a: "Patented", w: ["Released", "Taxed"] },
                    { y: 2025, q: "Biohacking involves altering one's own biology. What is a common method?", a: "Implanting Chips", w: ["Drinking Bleach", "Laser Eyes"] }
                ]
            },
            {
                id: 'energy', name: 'ENERGY & AUTO', icon: '⚡', theme: 't-energy', qs: [
                    { y: 2008, q: "Tesla Motors released its first production vehicle. What was it called?", a: "Roadster", w: ["Model S", "Cybertruck"] },
                    { y: 2011, q: "A tsunami caused a nuclear meltdown at which power plant in Japan?", a: "Fukushima Daiichi", w: ["Chernobyl", "Three Mile Island"] },
                    { y: 1886, q: "Karl Benz patented what is typically regarded as the first...", a: "Automobile", w: ["Bicycle", "Steam Engine"] },
                    { y: 1908, q: "Henry Ford revolutionized the industry with the mass production of which car?", a: "Model T", w: ["Mustang", "F-150"] },
                    { y: 2020, q: "Tesla became the most valuable car company, surpassing which giant?", a: "Toyota", w: ["Ford", "Volkswagen"] },
                    { y: 2015, q: "Volkswagen was caught cheating on emissions tests in a scandal known as...", a: "Dieselgate", w: ["Fuelgate", "Smogcheck"] },
                    { y: 1973, q: "Which organization effectively caused an oil crisis by proclaiming an embargo?", a: "OPEC", w: ["NATO", "UN"] },
                    { y: 1986, q: "Where did the worst nuclear disaster in history occur?", a: "Chernobyl", w: ["Fukushima", "Kiev"] },
                    { y: 2010, q: "The Deepwater Horizon rig explosion caused an oil spill in which body of water?", a: "Gulf of Mexico", w: ["Persian Gulf", "North Sea"] },
                    { y: 1997, q: "Toyota launched the Prius, making it the first mass-produced...", a: "Hybrid Car", w: ["Electric Car", "Hydrogen Car"] },
                    { y: 2012, q: "Tesla launched the Model S, proving electric cars could be...", a: "Desirable Luxury", w: ["Cheap", "Slow"] },
                    { y: 2019, q: "Elon Musk unveiled the Cybertruck, during which what famously broke?", a: "The Window", w: ["The Wheel", "The Battery"] },
                    { y: 1954, q: "Bell Labs demonstrated the first practical version of what energy technology?", a: "Solar Cell", w: ["Wind Turbine", "Nuclear Reactor"] },
                    { y: 2006, q: "Al Gore starring in 'An Inconvenient Truth' raised awareness about what?", a: "Climate Change", w: ["Deforestation", "Ocean Plastic"] },
                    { y: 2016, q: "The Paris Agreement was a global accord to limit...", a: "Temperature Rise", w: ["Plastic Waste", "Deforestation"] },
                    { y: 2022, q: "Scientists at NIF achieved 'ignition' in which type of energy research?", a: "Nuclear Fusion", w: ["Fission", "Solar"] },
                    { y: 1979, q: "The Three Mile Island accident halted nuclear growth in which country?", a: "USA", w: ["Russia", "France"] },
                    { y: 2003, q: "Martin Eberhard and Marc Tarpenning founded which company?", a: "Tesla", w: ["Rivian", "Lucid"] },
                    { y: 2025, q: "Many countries have set bans on the sale of new...", a: "Gasoline Cars", w: ["Electric Cars", "Hybrids"] },
                    { y: 1900, q: "At the turn of the 20th century, 38% of American cars were powered by what?", a: "Electricity", w: ["Gasoline", "Steam"] }
                ]
            },
            {
                id: 'general', name: 'GENERAL FACTS', icon: '📚', theme: 't-gen', qs: [
                    { y: 1939, q: "World War II officially began when Germany invaded which country?", a: "Poland", w: ["France", "Austria"] },
                    { y: 1945, q: "World War II ended in the Pacific after the bombing of Hiroshima and...", a: "Nagasaki", w: ["Tokyo", "Kyoto"] },
                    { y: 1963, q: "President John F. Kennedy was assassinated in which city?", a: "Dallas", w: ["Houston", "Austin"] },
                    { y: 1989, q: "The fall of which barrier symbolized the end of the Cold War?", a: "Berlin Wall", w: ["Iron Curtain", "Great Wall"] },
                    { y: 2001, q: "Which terrorist group was responsible for the September 11 attacks?", a: "Al-Qaeda", w: ["ISIS", "Taliban"] },
                    { y: 1912, q: "The RMS Titanic sank after hitting an iceberg on its maiden voyage to...", a: "New York", w: ["Boston", "London"] },
                    { y: 1969, q: "The Woodstock music festival took place in which US state?", a: "New York", w: ["California", "Texas"] },
                    { y: 1991, q: "The Soviet Union officially dissolved on December 26 of this year.", a: "1991", w: ["1989", "1993"] },
                    { y: 2020, q: "The WHO declared COVID-19 a global pandemic in which month?", a: "March", w: ["January", "June"] },
                    { y: 2016, q: "The UK voted to leave the European Union. What was this termed?", a: "Brexit", w: ["ExitEU", "UK-Out"] },
                    { y: 1953, q: "Edmund Hillary and Tenzing Norgay were the first to summit which peak?", a: "Mount Everest", w: ["K2", "Matterhorn"] },
                    { y: 1977, q: "George Lucas released the first movie of which franchise?", a: "Star Wars", w: ["Star Trek", "Alien"] },
                    { y: 1994, q: "Disney's The Lion King became the highest-grossing animated film of its time.", a: "True", w: ["False", "Maybe"] },
                    { y: 2009, q: "James Cameron's Avatar popularized which film technology?", a: "3D", w: ["IMAX", "CGI"] },
                    { y: 2019, q: "Avengers: Endgame briefly became the highest-grossing film ever.", a: "True", w: ["False", "Maybe"] },
                    { y: 1980, q: "Which Beatle was tragically shot outside his apartment in New York?", a: "John Lennon", w: ["Paul McCartney", "George Harrison"] },
                    { y: 1997, q: "Princess Diana died in a car crash in which city?", a: "Paris", w: ["London", "Rome"] },
                    { y: 2011, q: "A series of anti-government protests across the Middle East was known as...", a: "Arab Spring", w: ["Desert Storm", "Cedar Revolution"] },
                    { y: 2022, q: "Queen Elizabeth II passed away after reigning for how many years?", a: "70 Years", w: ["60 Years", "80 Years"] },
                    { y: 1937, q: "Aviator Amelia Earhart disappeared while attempting to...", a: "Fly Around the World", w: ["Cross the Atlantic", "Fly to Antarctic"] }
                ]
            }
        ];


        // --- MULTI-TRACK MUSIC SYSTEM ---
        // aka "The DJ of the Apocalypse"
        // Swaps tracks based on how screwed the player is.
        const MusicSystem = {
            tracks: {
                landing: new Audio('landing bgm.mp3'),   // [NEW] Landing Page Ambience
                start: new Audio('gamestart bgm.mp3'),   // The calm before the storm
                gameplay: new Audio('gameplay bgm.mp3'), // The storm
                gameover: new Audio('gameover bgm.mp3')  // The... aftermath
            },
            currentTrack: null,
            fadeInterval: null,
            baseVolume: 0.25,
            landingVolume: 0.08, // Very mild
            duckVolume: 0.1,

            init() {
                // Configure all tracks
                Object.values(this.tracks).forEach(track => {
                    track.loop = true;
                    track.volume = 0; // Start silent for fade-in
                });
            },

            play(trackName) {
                if (!soundEnabled) return;

                const newTrack = this.tracks[trackName];
                if (!newTrack) return;

                // If already playing this track, ensure it's playing but don't reset
                if (this.currentTrack === newTrack && !newTrack.paused) return;

                // Stop current track with rapid fade out
                if (this.currentTrack) {
                    const oldTrack = this.currentTrack;
                    this.fadeOut(oldTrack);
                }

                // Start new track
                this.currentTrack = newTrack;
                newTrack.currentTime = 0;
                newTrack.volume = 0;

                const playPromise = newTrack.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.log("Auto-play prevented (will resume on click):", error);
                        // Add one-time click handler to resume if blocked
                        document.addEventListener('click', () => {
                            if (this.currentTrack === newTrack && newTrack.paused) {
                                newTrack.play();
                                this.fadeIn(newTrack, trackName);
                            }
                        }, { once: true });
                    });
                }

                this.fadeIn(newTrack, trackName);
            },

            stop() {
                if (this.currentTrack) {
                    this.fadeOut(this.currentTrack);
                    this.currentTrack = null;
                }
            },

            // Duck volume (for typewriter)
            duck() {
                if (this.currentTrack) {
                    this.fadeGeneric(this.currentTrack, this.duckVolume, 500);
                }
            },

            // Unduck/Restore volume
            unduck() {
                if (this.currentTrack) {
                    this.fadeGeneric(this.currentTrack, this.baseVolume, 800);
                }
            },

            fadeIn(track, name) {
                // Special handling for landing page BGM
                if (track === this.tracks.landing || name === 'landing') {
                    // Slow fade (4s) to mild volume (0.08)
                    this.fadeGeneric(track, this.landingVolume, 4000);
                } else {
                    // Standard Game BGM
                    this.fadeGeneric(track, this.baseVolume, 800);
                }
            },

            fadeOut(track) {
                // Rapid fade out then pause
                if (track) {
                    // Manual interval for fade out to ensure we pause at end
                    let vol = track.volume;
                    const interval = setInterval(() => {
                        vol = Math.max(0, vol - 0.05);
                        track.volume = vol;
                        if (vol <= 0) {
                            clearInterval(interval);
                            track.pause();
                            track.currentTime = 0;
                        }
                    }, 50);
                }
            },

            // Generic fader
            fadeGeneric(track, targetVol, duration) {
                if (!soundEnabled) return;

                const startVol = track.volume;
                const startTime = Date.now();

                // Unique interval key per track to prevent conflicts? 
                // Simple approach: global interval is risky if switching tracks fast.
                // We'll trust the single-threaded nature + short durations.

                const step = () => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);

                    if (track !== this.currentTrack && targetVol > 0) return; // Stop fading in if track switched away

                    const newVol = startVol + (targetVol - startVol) * progress;
                    track.volume = Math.max(0, Math.min(1, newVol));

                    if (progress < 1) {
                        requestAnimationFrame(step);
                    }
                };
                requestAnimationFrame(step);
            }
        };

        // Let's get this party started
        MusicSystem.init();

        // =============================================
        // GLOBAL TOGGLE SYSTEMS
        // =============================================
        console.log('✅ UI Systems online. Don\'t break anything.');

        // --- SOUND TOGGLE ---
        let soundEnabled = true;
        let savedBgmVolume = 0.12; // REDUCED from 0.25 - less intrusive audio

        function toggleSound() {
            const btn = document.getElementById('sound-toggle');
            if (!btn) return;
            const icon = btn.querySelector('.icon');

            soundEnabled = !soundEnabled;

            if (soundEnabled) {
                // Enable sound
                if (typeof MusicSystem !== 'undefined' && MusicSystem.currentTrack) {
                    MusicSystem.currentTrack.volume = savedBgmVolume;
                }
                if (typeof AudioSystem !== 'undefined' && AudioSystem.ctx && AudioSystem.ctx.state === 'suspended') {
                    AudioSystem.resume();
                }
                if (icon) icon.textContent = '🔊';
                btn.classList.remove('sound-off');
                btn.title = 'Sound ON - Click to mute';
            } else {
                // Disable sound
                if (typeof MusicSystem !== 'undefined' && MusicSystem.currentTrack) {
                    savedBgmVolume = MusicSystem.currentTrack.volume;
                    MusicSystem.currentTrack.volume = 0;
                }
                if (typeof AudioSystem !== 'undefined' && AudioSystem.ctx) {
                    AudioSystem.ctx.suspend();
                }
                if (icon) icon.textContent = '🔇';
                btn.classList.add('sound-off');
                btn.title = 'Sound OFF - Click to unmute';
            }
        }

        // --- THEME TOGGLE - 3 THEMES: COLORFUL, BLOODY, NOIR ---
        let currentTheme = 'bloody'; // Start with current bloody theme

        function toggleTheme() {
            try {
                // Achievement Hook
                if (typeof achievementStats !== 'undefined' && typeof unlockAchievement !== 'undefined') {
                    achievementStats.themeToggleCount = (achievementStats.themeToggleCount || 0) + 1;
                    if (achievementStats.themeToggleCount >= 5) unlockAchievement('void_gazer');
                }

                const btn = document.getElementById('theme-toggle-btn');
                if (!btn) return;

                const icon = btn.querySelector('.icon');
                const root = document.documentElement;

                // Rotate icon
                if (icon) {
                    icon.style.transform = 'rotate(360deg)';
                    setTimeout(() => icon.style.transform = 'rotate(0deg)', 500);
                }

                // Cycle: bloody -> colorful -> noir -> bloody
                if (currentTheme === 'bloody') {
                    // COLORFUL (Indigo/Blue) - Original theme
                    root.style.setProperty('--primary', '#6366f1');
                    root.style.setProperty('--primary-light', '#818cf8');
                    root.style.setProperty('--secondary', '#a5b4fc');
                    root.style.setProperty('--danger', '#ef4444');
                    root.style.setProperty('--blood', '#dc2626');
                    root.style.setProperty('--bg-color', '#000005');
                    root.style.setProperty('--text-main', '#ffffff');
                    root.style.setProperty('--horror-glow', 'rgba(99, 102, 241, 0.2)');
                    root.style.setProperty('--glass-bg', 'rgba(10, 10, 30, 0.9)');
                    document.body.classList.remove('theme-bloody', 'theme-noir');
                    document.body.classList.add('theme-colorful');
                    currentTheme = 'colorful';
                    if (icon) icon.textContent = '🌈';
                    btn.title = 'Theme: COLORFUL - Click for NOIR';
                } else if (currentTheme === 'colorful') {
                    // NOIR (Black & White)
                    root.style.setProperty('--primary', '#ffffff');
                    root.style.setProperty('--primary-light', '#e0e0e0');
                    root.style.setProperty('--secondary', '#aaaaaa');
                    root.style.setProperty('--danger', '#888888');
                    root.style.setProperty('--blood', '#666666');
                    root.style.setProperty('--bg-color', '#000000');
                    root.style.setProperty('--text-main', '#ffffff');
                    root.style.setProperty('--horror-glow', 'rgba(255, 255, 255, 0.1)');
                    root.style.setProperty('--glass-bg', 'rgba(20, 20, 20, 0.9)');
                    document.body.classList.remove('theme-colorful', 'theme-bloody');
                    document.body.classList.add('theme-noir');
                    currentTheme = 'noir';
                    if (icon) icon.textContent = '⬛';
                    btn.title = 'Theme: NOIR - Click for BLOODY';
                } else {
                    // BLOODY (Red Horror) - Current default
                    root.style.setProperty('--primary', '#ff1a1a');
                    root.style.setProperty('--primary-light', '#ff6666');
                    root.style.setProperty('--secondary', '#ff4444');
                    root.style.setProperty('--danger', '#ff0000');
                    root.style.setProperty('--blood', '#8b0000');
                    root.style.setProperty('--bg-color', '#050000');
                    root.style.setProperty('--text-main', '#ffffff');
                    root.style.setProperty('--horror-glow', 'rgba(255, 0, 0, 0.25)');
                    root.style.setProperty('--glass-bg', 'rgba(15, 0, 0, 0.9)');
                    document.body.classList.remove('theme-colorful', 'theme-noir');
                    document.body.classList.add('theme-bloody');
                    currentTheme = 'bloody';
                    if (icon) icon.textContent = '🩸';
                    btn.title = 'Theme: BLOODY - Click for COLORFUL';
                }
            } catch (error) {
                console.error('Error in toggleTheme:', error);
            }
        }

        // =============================================
        // TYPEWRITER SYSTEM - Story Narrative Effect
        // =============================================
        // TYPEWRITER SYSTEM - The "Ghost in the Machine"
        // (Simulates frantic/human typing with variance)
        // =============================================
        const TypeWriter = {
            baseSpeed: 30, // Base ms per char (tweak if too slow)
            lineDelay: 600, // Breathing room between lines
            skipped: false, // Skip flag
            currentLines: [], // Store lines for skip functionality
            currentContainer: null,
            onCompleteCallback: null,

            showSkipButton() {
                const btn = document.getElementById('skip-text-btn');
                if (btn) {
                    btn.classList.remove('hidden');
                    btn.onclick = () => this.skip();
                }
            },

            hideSkipButton() {
                const btn = document.getElementById('skip-text-btn');
                if (btn) {
                    btn.classList.add('hidden');
                    btn.onclick = null;
                }
            },

            skip() {
                this.skipped = true;

                // Instantly complete all text in the current container
                if (this.currentContainer && this.currentLines.length > 0) {
                    this.currentContainer.innerHTML = '';
                    this.currentLines.forEach(line => {
                        const p = document.createElement('p');
                        p.className = 'story-line typewriter-text visible done';
                        if (line.style) p.style.cssText = line.style;
                        p.textContent = line.text;
                        this.currentContainer.appendChild(p);
                    });
                }

                this.hideSkipButton();

                // Restore volume
                if (typeof MusicSystem !== 'undefined') MusicSystem.unduck();

                // Trigger completion callback if set - INSTANTLY
                // Ensure any external delays are also bypassed if possible,
                // but we can't control external StorySystem delays from here easily
                // unless we expose 'skipped' state globally or StorySystem checks it.
                // For now, this fixes the typing part.
                if (this.onCompleteCallback) {
                    this.onCompleteCallback();
                    this.onCompleteCallback = null;
                }
            },

            async type(elementId, text) {
                const el = document.getElementById(elementId);
                // Fail silently if element is gone (don't crash the party)
                if (!el) return;

                this.skipped = false;
                this.showSkipButton();

                // duck volume for dramatic effect
                if (typeof MusicSystem !== 'undefined') MusicSystem.duck();

                el.textContent = '';
                el.classList.add('typewriter-text');
                el.classList.remove('done');

                for (let i = 0; i < text.length; i++) {
                    if (this.skipped) {
                        el.textContent = text;
                        break;
                    }

                    const char = text[i];
                    el.textContent += char;

                    // Sound logic: Don't spam it. 
                    // Every 2-3 chars feels more natural than machine-gun fire.
                    if (char !== ' ' && i % 3 === 0) {
                        this.playTypingSound();
                    }

                    // --- HUMANIZATION MAGIC ---
                    // No one types at perfect constant speed.
                    // Add some jitter (+/- 10ms)
                    let delay = this.baseSpeed + (Math.random() * 20 - 10);

                    // Pause at punctuation (caught in thought?)
                    if (char === '.' || char === '!' || char === '?') {
                        delay += 350; // Dramatic pause
                    } else if (char === ',' || char === ';') {
                        delay += 150; // Brief pause
                    }

                    // Sanity check: don't let it be negative
                    await this.wait(Math.max(5, delay));
                }

                el.classList.add('done');
                this.hideSkipButton();

                // Restore volume
                if (typeof MusicSystem !== 'undefined') MusicSystem.unduck();
            },

            async typeLines(containerId, lines, onComplete = null) {
                const container = document.getElementById(containerId);
                if (!container) return;

                this.skipped = false;
                this.currentLines = lines;
                this.currentContainer = container;
                this.onCompleteCallback = onComplete;
                this.showSkipButton();

                // duck volume
                if (typeof MusicSystem !== 'undefined') MusicSystem.duck();

                container.innerHTML = '';

                for (const line of lines) {
                    if (this.skipped) break;

                    const p = document.createElement('p');
                    p.className = 'story-line typewriter-text';
                    // Inject custom styles if needed (e.g. red warning text)
                    if (line.style) p.style.cssText = line.style;
                    container.appendChild(p);

                    // Brief pause before starting a new line
                    await this.wait(150);
                    if (this.skipped) break;

                    p.classList.add('visible');

                    for (let i = 0; i < line.text.length; i++) {
                        if (this.skipped) {
                            p.textContent = line.text;
                            break;
                        }

                        const char = line.text[i];
                        p.textContent += char;

                        // Sound: randomness makes it organic
                        if (char !== ' ' && Math.random() > 0.6) {
                            this.playTypingSound();
                        }

                        // Jittery typing speed
                        let delay = this.baseSpeed + (Math.random() * 25 - 10);

                        // Dramatic pauses for effect
                        if (['.', '!', '?'].includes(char)) delay += 400;
                        if ([':', ',', '-'].includes(char)) delay += 200;

                        await this.wait(Math.max(5, delay));
                    }

                    p.classList.add('done');
                    // Wait before next line (let the user read!)
                    // INSTANT SKIP FIX: Check skipped BEFORE waiting
                    if (!this.skipped) await this.wait(this.lineDelay);
                }

                this.hideSkipButton();
                this.currentLines = [];
                this.currentContainer = null;

                // Restore volume
                if (typeof MusicSystem !== 'undefined') MusicSystem.unduck();

                // Trigger completion callback if not already triggered by skip
                if (!this.skipped && onComplete) {
                    onComplete();
                }
            },

            // The subtle "click" of a mechanical keyboard provided by Web Audio API
            playTypingSound() {
                try {
                    // Always try to wake up the audio context if it's sleeping
                    if (typeof AudioSystem !== 'undefined') {
                        if (!AudioSystem.ctx) AudioSystem.init();
                        AudioSystem.resume();

                        if (AudioSystem.ctx) {
                            const osc = AudioSystem.ctx.createOscillator();
                            const gain = AudioSystem.ctx.createGain();
                            osc.connect(gain);
                            gain.connect(AudioSystem.ctx.destination);

                            // Randomize pitch slightly for realism
                            // (No two keypresses sound exactly identical)
                            osc.frequency.value = 800 + Math.random() * 250;
                            osc.type = 'square'; // Square wave gives that 8-bit clicky feel

                            gain.gain.value = 0.025; // Keep it subtle, don't blow ears out

                            osc.start();
                            osc.stop(AudioSystem.ctx.currentTime + 0.025);
                        }
                    }
                } catch (e) {
                    // If audio fails, game plays on. No biggie.
                }
            },

            wait(ms) {
                if (this.skipped) return Promise.resolve();
                return new Promise(r => setTimeout(r, ms));
            }
        };

        // =============================================
        // GAME MODE SYSTEMS
        // =============================================

        // Mode Constants
        const GAME_MODES = {
            A: {
                name: 'OWN LUCK',
                icon: '🎯',
                desc: 'Standard gameplay with Freeze & Rewind powers',
                theme: 'normal'
            },
            B: {
                name: 'TIME LOOP',
                icon: '🌀',
                desc: 'Glitch effects • Dream sequences • Loop on death',
                theme: 'dream'
            },
            C: {
                name: 'PARADOX',
                icon: '⚔️',
                desc: 'Chaos • Corrupt System • Restore Sanity',
                theme: 'Power Up'
            }
        };

        let currentGameMode = null;
        let gameInProgress = false;

        // --- MOBILE DETECTION ---
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
                || window.innerWidth < 1024;
        }

        function checkMobileBlock() {
            const blocker = document.getElementById('mobile-blocker');
            if (blocker) {
                // Mobile restriction removed as per user request
                blocker.classList.remove('active');
            }
        }

        // --- EXIT WARNING ---
        window.addEventListener('beforeunload', (e) => {
            if (gameInProgress) {
                e.preventDefault();
                e.returnValue = 'You have an active game. Are you sure you want to leave?';
                return e.returnValue;
            }
        });

        // --- LUCK RANDOMIZER SYSTEM ---
        const LuckSystem = {
            spinning: false,

            spin() {
                if (this.spinning) return;
                this.spinning = true;

                const slots = document.querySelectorAll('.luck-slot');
                const modes = ['A', 'B', 'C'];
                const icons = { 'A': '🎯', 'B': '🌀', 'C': '⚔️' };

                // Disable button immediately
                const spinBtn = document.getElementById('spin-luck-btn');
                spinBtn.textContent = 'SPINNING...';
                spinBtn.disabled = true;

                // Play initial sound
                if (typeof AudioSystem !== 'undefined') AudioSystem.playRouletteClick();

                // Add spinning class for glow effect
                slots.forEach(slot => slot.classList.add('spinning'));

                // Decide final result upfront
                currentGameMode = modes[Math.floor(Math.random() * 3)];

                // Spin each slot independently with staggered stop times
                const slotStopTimes = [2000, 2500, 3000]; // Each slot stops at different time

                slots.forEach((slot, index) => {
                    this.spinSlot(slot, icons, modes, slotStopTimes[index], index === slots.length - 1);
                });
            },

            spinSlot(slot, icons, modes, duration, isLast) {
                const startTime = Date.now();
                const startInterval = 50;  // Start fast (50ms)
                const endInterval = 400;   // End slow (400ms)

                let lastUpdate = 0;
                let currentInterval = startInterval;

                const animate = () => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);

                    // Ease-out curve: starts fast, slows down dramatically at end
                    const easeOut = 1 - Math.pow(1 - progress, 3);
                    currentInterval = startInterval + (endInterval - startInterval) * easeOut;

                    // Only update if enough time has passed
                    if (elapsed - lastUpdate >= currentInterval) {
                        const randomMode = modes[Math.floor(Math.random() * 3)];
                        slot.textContent = icons[randomMode];
                        lastUpdate = elapsed;

                        // Play tick sound on slower spins
                        if (currentInterval > 150 && typeof AudioSystem !== 'undefined') {
                            AudioSystem.playRouletteClick();
                        }
                    }

                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        // Final stop - show selected mode with bounce effect
                        this.stopSlot(slot, icons, isLast);
                    }
                };

                requestAnimationFrame(animate);
            },

            stopSlot(slot, icons, isLast) {
                slot.classList.remove('spinning');
                slot.textContent = icons[currentGameMode];

                // Bounce animation
                slot.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    slot.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        slot.style.transform = 'scale(1.1)';
                        slot.classList.add('selected');
                        setTimeout(() => {
                            slot.style.transform = 'scale(1)';
                        }, 100);
                    }, 100);
                }, 100);

                // Play stop sound
                if (typeof AudioSystem !== 'undefined') AudioSystem.playCorrect();

                // If this is the last slot, show result
                if (isLast) {
                    setTimeout(() => this.showResult(), 500);
                }
            },

            showResult() {
                const result = document.getElementById('luck-result');
                const mode = GAME_MODES[currentGameMode];

                result.innerHTML = `
                    <span style="font-size:2.5rem;">${mode.icon}</span>
                    <span>${mode.name}</span>
                    <span class="mode-desc">${mode.desc}</span>
                `;

                // Update button
                const spinBtn = document.getElementById('spin-luck-btn');
                spinBtn.textContent = 'ENTERING TIMELINE...';

                this.spinning = false;

                // Proceed after delay
                setTimeout(() => {
                    if (typeof Game !== 'undefined') {
                        Game.proceedWithMode();
                    }
                }, 2000);
            },

            reset() {
                const slots = document.querySelectorAll('.luck-slot');
                slots.forEach(slot => {
                    slot.textContent = '?';
                    slot.classList.remove('spinning', 'selected');
                });
                document.getElementById('luck-result').innerHTML = '';
                const spinBtn = document.getElementById('spin-luck-btn');
                spinBtn.textContent = 'SPIN FATE';
                spinBtn.disabled = false;
                currentGameMode = null;
            }
        };

        // Time Loop Mode (Inverted Logic)
        const DreamMode = {
            loopCount: 0,
            active: false,
            totalScore: 0,

            init() {
                this.loopCount = 0;
                this.totalScore = 0;
                this.active = true;

                // Apply unique Time Loop theme
                document.body.classList.add('mode-timeloop');
                document.body.setAttribute('data-loop', '0');

                // Show loop counter
                const loopCounter = document.getElementById('loop-counter');
                if (loopCounter) {
                    loopCounter.classList.remove('hidden');
                    document.getElementById('loop-num').textContent = '0';
                }
            },

            // Called when player answers correctly - TRIGGERS LOOP
            onCorrectAnswer() {
                if (!this.active) return false;

                // Each correct answer = trigger a loop restart
                this.loopCount++;
                this.updateLoopUI();
                this.triggerLoopRestart();
                return true; // Signal that we handled this
            },

            // Called when timer expires - ESCAPE THE LOOP (End Game)
            onTimerExpire() {
                if (!this.active) return false;

                // Timer expire = player escapes the loop
                this.cleanup();

                // Show escape message
                const overlay = document.getElementById('dream-overlay');
                const dreamText = document.getElementById('dream-text');
                const dreamSubtext = document.getElementById('dream-subtext');

                dreamText.textContent = 'LOOP BROKEN';
                dreamText.style.color = '#00ffff';
                dreamSubtext.textContent = `You survived ${this.loopCount} loops!`;

                overlay.classList.add('active');

                setTimeout(() => {
                    overlay.classList.remove('active');
                    if (typeof Game !== 'undefined') {
                        // Update final score
                        Game.score = this.totalScore;
                        Game.gameOver();
                    }
                }, 3000);

                return true;
            },

            updateLoopUI() {
                // Update loop counter
                const loopNum = document.getElementById('loop-num');
                if (loopNum) loopNum.textContent = this.loopCount;

                // Update glitch intensity (max 5)
                const intensity = Math.min(this.loopCount, 5);
                document.body.setAttribute('data-loop', intensity.toString());
            },

            triggerLoopRestart() {
                // Flash the screen
                const flash = document.getElementById('loop-restart-overlay');
                if (flash) {
                    flash.classList.add('flash');
                    setTimeout(() => flash.classList.remove('flash'), 800);
                }

                // Glitch animation
                document.body.classList.add('loop-glitching');
                setTimeout(() => document.body.classList.remove('loop-glitching'), 300);

                // Play sound
                if (typeof AudioSystem !== 'undefined') AudioSystem.playRewind();

                // Accumulate score before reset
                if (typeof Game !== 'undefined') {
                    this.totalScore += Game.score;
                }

                // Show loop message briefly
                const overlay = document.getElementById('dream-overlay');
                const dreamText = document.getElementById('dream-text');
                const dreamSubtext = document.getElementById('dream-subtext');

                dreamText.textContent = `LOOP ${this.loopCount}`;
                dreamText.style.color = '#00ffff';
                dreamSubtext.textContent = 'Timeline fracturing...';

                overlay.classList.add('active');

                setTimeout(() => {
                    overlay.classList.remove('active');

                    // Restart the game round with MORE glitch
                    if (typeof Game !== 'undefined') {
                        Game.round = 0;
                        Game.score = 0; // Score accumulates in totalScore
                        Game.streak = 0; // Reset streak
                        Game.active = true; // RE-ENABLE INPUT - This was the bug!
                        document.getElementById('hud-score').innerText = this.totalScore;
                        document.getElementById('hud-streak').innerText = '';
                        if (typeof TimerSystem !== 'undefined') {
                            // Timer gets shorter each loop (min 30 seconds)
                            const newTime = Math.max(30, 60 - (this.loopCount * 5));
                            TimerSystem.start(newTime);
                        }
                        Game.nextRound();
                    }
                }, 1500);
            },

            // Legacy method for compatibility - now does nothing
            onQuestionAnswered() {
                return false;
            },

            // Legacy method for compatibility
            triggerDreamSequence(isWin) {
                // Not used in new logic
            },

            cleanup() {
                this.active = false;
                document.body.classList.remove('mode-timeloop');
                document.body.removeAttribute('data-loop');

                // Hide loop counter
                const loopCounter = document.getElementById('loop-counter');
                if (loopCounter) loopCounter.classList.add('hidden');
            }
        };

        // --- DUEL MODE (Mode C) ---
        const DuelMode = {
            playerScore: 0,
            aiScore: 0,
            dayStartTime: null,
            nightTriggered: false,
            nightTimeout: null,
            active: false,
            currentQuestion: null,

            init() {
                this.playerScore = 0;
                this.aiScore = 0;
                this.dayStartTime = Date.now();
                this.nightTriggered = false;
                this.active = true;
                document.body.classList.add('time-day');

                // HIDE TIMER & HUD ELEMENTS FOR DUEL
                const timerPanel = document.getElementById('timer-panel');
                if (timerPanel) timerPanel.classList.add('hidden');

                this.startDayNightCycle();

                document.getElementById('player-duel-score').textContent = '0';
                document.getElementById('ai-duel-score').textContent = '0';
            },

            reset() {
                if (typeof resetAchievementStats !== 'undefined') resetAchievementStats(); // ACHIEVEMENT HOOK
                this.playerScore = 0;
                this.aiScore = 0;
                this.dayStartTime = Date.now();
                this.nightTriggered = false;
                this.active = true;
                document.body.classList.add('time-day');

                // HIDE TIMER & HUD ELEMENTS FOR DUEL
                const timerPanel = document.getElementById('timer-panel');
                if (timerPanel) timerPanel.classList.add('hidden');

                this.startDayNightCycle();

                document.getElementById('player-duel-score').textContent = '0';
                document.getElementById('ai-duel-score').textContent = '0';
            },

            startDayNightCycle() {
                // Random time between 45-90 seconds for night to trigger
                const nightDelay = (Math.random() * 45 + 45) * 1000;
                this.nightDuration = nightDelay; // Save for rewind logic
                this.startTime = Date.now();

                this.nightTimeout = setTimeout(() => {
                    this.triggerNight();
                }, nightDelay);
            },

            rewindTime(ms) {
                // Extend the day phase
                if (this.nightTriggered) return; // Can't rewind once night starts (it's too late)

                clearTimeout(this.nightTimeout);

                // Calculate how much time was left
                const elapsed = Date.now() - this.startTime;
                let remaining = this.nightDuration - elapsed;

                // Add bonus time (rewind)
                remaining += ms;
                if (remaining < 1000) remaining = 1000; // Safety min

                // Restart timeout with new remaining time
                this.startTime = Date.now(); // Reset start base
                this.nightDuration = remaining;

                this.nightTimeout = setTimeout(() => {
                    this.triggerNight();
                }, remaining);

                // Visual feedback of extended day
                const dayEl = document.createElement('div');
                dayEl.innerHTML = "☀️ DAYLIGHT EXTENDED";
                dayEl.className = 'anomaly-alert';
                dayEl.style.color = '#000';
                dayEl.style.background = '#fff';
                document.body.appendChild(dayEl);
                setTimeout(() => dayEl.remove(), 2000);
            },

            triggerNight() {
                if (!this.active) return;

                if (typeof TimerSystem !== 'undefined' && TimerSystem.frozen) {
                    setTimeout(() => this.triggerNight(), 500);
                    return;
                }

                this.nightTriggered = true;
                document.body.classList.remove('time-day');
                document.body.classList.add('time-night');

                if (typeof AudioSystem !== 'undefined') AudioSystem.playFreeze();

                // End game after short night period
                setTimeout(() => {
                    if (this.active) {
                        this.endDuelWithPuzzle();
                    }
                }, 8000);
            },

            loadDuelQuestion(questionData) {
                this.currentQuestion = questionData;

                // Player side
                document.getElementById('era-display-player').innerText = `YEAR: ${questionData.y}`;
                document.getElementById('q-text-player').innerText = questionData.q;

                // AI side (same question)
                document.getElementById('era-display-ai').innerText = `YEAR: ${questionData.y}`;
                document.getElementById('q-text-ai').innerText = questionData.q;

                // Generate options for player
                const playerArea = document.getElementById('opt-area-player');
                playerArea.innerHTML = '';
                const options = [questionData.a, ...questionData.w].sort(() => Math.random() - 0.5);

                options.forEach(txt => {
                    const b = document.createElement('div');
                    b.className = 'opt-btn';
                    b.innerText = txt;
                    b.onclick = () => this.playerAnswer(txt, questionData.a);
                    playerArea.appendChild(b);
                });

                // Generate options for AI (same order)
                const aiArea = document.getElementById('opt-area-ai');
                aiArea.innerHTML = '';
                options.forEach(txt => {
                    const b = document.createElement('div');
                    b.className = 'opt-btn';
                    b.innerText = txt;
                    b.dataset.answer = txt;
                    aiArea.appendChild(b);
                });

                // Simulate AI answering
                this.simulateAIAnswer(questionData, options);
            },

            simulateAIAnswer(questionData, options) {
                // AI has 65% accuracy, answers in 1-4 seconds
                const delay = Math.random() * 3000 + 1000;

                setTimeout(() => {
                    if (!this.active) return;

                    if (typeof TimerSystem !== 'undefined' && TimerSystem.frozen) {
                        setTimeout(() => this.simulateAIAnswer(questionData, options), 500);
                        return;
                    }

                    const correct = Math.random() < 0.65;
                    const aiOpts = document.querySelectorAll('#opt-area-ai .opt-btn');

                    aiOpts.forEach(opt => {
                        // Creepy/Hidden AI Selection Logic
                        if (correct && opt.dataset.answer === questionData.a) {
                            // "Faded portion" & "Hide type"
                            opt.style.transition = 'all 2s ease';
                            opt.style.background = 'rgba(0, 0, 0, 0.8)'; // Dark void
                            opt.style.borderColor = 'rgba(57, 255, 20, 0.1)'; // Very faint green hint
                            opt.style.color = 'transparent'; // HIDE TEXT
                            opt.style.textShadow = 'none';
                            opt.style.filter = 'blur(3px) grayscale(100%)';
                            opt.style.transform = 'scale(0.95)';
                            opt.innerHTML = ''; // Ensure text is gone

                            this.aiScore += 100;
                        } else if (!correct && opt.dataset.answer !== questionData.a && Math.random() > 0.5) {
                            // Decoy / Wrong
                            opt.style.transition = 'all 2s ease';
                            opt.style.background = 'rgba(0, 0, 0, 0.5)';
                            opt.style.color = 'transparent';
                            opt.style.borderColor = 'transparent';
                            opt.style.filter = 'blur(5px)';
                        }
                    });

                    document.getElementById('ai-duel-score').textContent = this.aiScore;
                }, delay);
            },

            playerAnswer(ans, correct) {
                if (!this.active) return;

                const playerOpts = document.querySelectorAll('#opt-area-player .opt-btn');
                playerOpts.forEach(opt => opt.style.pointerEvents = 'none');

                if (ans === correct) {
                    try { if (typeof onCorrectAnswer !== 'undefined') onCorrectAnswer(); } catch (e) { console.error(e); } // ACHIEVEMENT HOOK SAFE
                    this.playerScore += 100;
                    if (typeof AudioSystem !== 'undefined') AudioSystem.playCorrect();
                    playerOpts.forEach(opt => {
                        if (opt.innerText === ans) {
                            opt.style.background = 'rgba(57, 255, 20, 0.3)';
                            opt.style.borderColor = 'var(--green)';
                        }
                    });

                    // Sync with main Game score and HUD
                    if (typeof Game !== 'undefined') {
                        Game.score = this.playerScore;
                        document.getElementById('hud-score').innerText = this.playerScore;
                    }
                } else {
                    try { if (typeof onWrongAnswer !== 'undefined') onWrongAnswer(); } catch (e) { console.error(e); } // ACHIEVEMENT HOOK SAFE
                    if (typeof AudioSystem !== 'undefined') AudioSystem.playWrong();
                    playerOpts.forEach(opt => {
                        if (opt.innerText === ans) {
                            opt.style.background = 'rgba(255, 0, 60, 0.3)';
                            opt.style.borderColor = 'var(--danger)';
                        }
                    });
                }

                document.getElementById('player-duel-score').textContent = this.playerScore;

                // Next question after delay
                setTimeout(() => {
                    if (typeof Game !== 'undefined' && this.active) {
                        Game.round++;
                        Game.nextRound();
                    }
                }, 1500);
            },

            endDuelWithPuzzle() {
                this.active = false;
                if (this.nightTimeout) clearTimeout(this.nightTimeout);

                // Transfer scores to main game
                if (typeof Game !== 'undefined') {
                    Game.score = this.playerScore;
                }

                PuzzleSystem.show();
            },

            cleanup() {
                this.active = false;
                if (this.nightTimeout) clearTimeout(this.nightTimeout);
                document.body.classList.remove('time-day', 'time-night');

                // RESTORE TIMER
                const timerPanel = document.getElementById('timer-panel');
                if (timerPanel) timerPanel.classList.remove('hidden');
            }
        };

        // Puzzle System
        const PuzzleSystem = {
            puzzles: [
                { q: 'Complete: 2, 4, 8, 16, ?', a: '32' },
                { q: 'Unscramble: MEIT', a: 'TIME' },
                { q: 'What is 7 × 8?', a: '56' },
                { q: 'Complete: 1, 1, 2, 3, 5, ?', a: '8' },
                { q: 'Unscramble: NIREW', a: 'REWIND' },
                { q: 'What is 144 ÷ 12?', a: '12' },
                { q: '⏰ + 🔄 = ?', a: 'REWIND' },
                { q: '60 seconds = ? minutes', a: '1' }
            ],
            currentPuzzle: null,
            attempts: 0,

            show() {
                this.currentPuzzle = this.puzzles[Math.floor(Math.random() * this.puzzles.length)];
                this.attempts = 0;

                document.getElementById('puzzle-question').textContent = this.currentPuzzle.q;
                document.getElementById('puzzle-input').value = '';
                document.getElementById('puzzle-feedback').textContent = '';
                document.getElementById('puzzle-modal').classList.add('active');

                // Focus the input
                setTimeout(() => {
                    document.getElementById('puzzle-input').focus();
                }, 100);
            },

            submit() {
                const input = document.getElementById('puzzle-input').value.trim().toUpperCase();
                const feedback = document.getElementById('puzzle-feedback');

                if (input === this.currentPuzzle.a.toUpperCase()) {
                    feedback.textContent = '✅ CORRECT!';
                    feedback.style.color = 'var(--green)';
                    if (typeof AudioSystem !== 'undefined') AudioSystem.playCorrect();

                    setTimeout(() => {
                        document.getElementById('puzzle-modal').classList.remove('active');
                        DuelMode.cleanup();
                        // Explicitly trigger Win State
                        if (typeof Game !== 'undefined') Game.gameWin();
                    }, 1500);
                } else {
                    this.attempts++;
                    feedback.textContent = `❌ WRONG (${3 - this.attempts} tries left)`;
                    feedback.style.color = 'var(--danger)';
                    if (typeof AudioSystem !== 'undefined') AudioSystem.playWrong();

                    document.getElementById('puzzle-input').value = '';

                    if (this.attempts >= 3) {
                        setTimeout(() => {
                            document.getElementById('puzzle-modal').classList.remove('active');
                            DuelMode.cleanup();
                            // Trigger creepy restart instead of normal game over
                            this.triggerCreepyRestart();
                        }, 1500);
                    }
                }
            },

            triggerCreepyRestart() {
                // Fallback to standard game over since overlay is removed
                if (typeof Game !== 'undefined') Game.gameOver();
            }
        };

        // Initialize on load
        window.addEventListener('resize', checkMobileBlock);
        document.addEventListener('DOMContentLoaded', () => {
            checkMobileBlock();

            // Luck spin button
            const spinBtn = document.getElementById('spin-luck-btn');
            if (spinBtn) {
                spinBtn.addEventListener('click', () => LuckSystem.spin());
            }

            // Puzzle submit
            const puzzleSubmit = document.getElementById('puzzle-submit');
            if (puzzleSubmit) {
                puzzleSubmit.addEventListener('click', () => PuzzleSystem.submit());
            }

            // Puzzle input enter key
            const puzzleInput = document.getElementById('puzzle-input');
            if (puzzleInput) {
                puzzleInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') PuzzleSystem.submit();
                });
            }


        });

        // Horror Effects Helper
        const HorrorEffects = {
            shake() {
                document.body.classList.add('horror-shake');
                setTimeout(() => document.body.classList.remove('horror-shake'), 400);
            },

            glitch() {
                document.body.classList.add('glitch-active');
                setTimeout(() => document.body.classList.remove('glitch-active'), 300);
            },

            anxiety(enable = true) {
                if (enable) {
                    document.body.classList.add('anxiety-mode');
                } else {
                    document.body.classList.remove('anxiety-mode');
                }
            },

            randomGlitch() {
                // Random chance to glitch during gameplay
                if (Math.random() < 0.1) {
                    this.glitch();
                }
            }
        };

        // Audio System
        const AudioSystem = {
            ctx: null,
            bgmPlaying: false,

            init() {
                if (this.ctx) return; // Prevent re-init
                try {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                    console.log("AudioSystem: Waking up the beast...");
                } catch (e) { console.error("AudioSystem: It's dead, Jim.", e); }
            },

            resume() {
                if (!soundEnabled) return; // User said "shut up", so we shut up.
                if (this.ctx && this.ctx.state === 'suspended') {
                    this.ctx.resume().then(() => console.log("AudioSystem: And... we're back!"));
                }
            },

            // Smooth volume transition helper
            fadeTo(targetVol, duration = 1000) {
                if (typeof bgMusic === 'undefined' || !bgMusic) return;

                // Don't fade if sound is globally disabled, just set internal state
                if (!soundEnabled) return;

                const startVol = bgMusic.volume;
                const startTime = Date.now();

                // Clear any existing fade interval
                if (this.fadeInterval) clearInterval(this.fadeInterval);

                this.fadeInterval = setInterval(() => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);

                    // Linear interpolation
                    const newVol = startVol + (targetVol - startVol) * progress;
                    bgMusic.volume = Math.max(0, Math.min(1, newVol));

                    if (progress >= 1) clearInterval(this.fadeInterval);
                }, 50);
            },

            // Correct Answer - Satisfying "ding"
            playCorrect() {
                if (!this.ctx) this.init(); this.resume();
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.frequency.setValueAtTime(880, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1760, this.ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.3, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.3);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.3);
            },

            // Wrong Answer - Harsh buzz
            playWrong() {
                if (!this.ctx) this.init(); this.resume();
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sawtooth';
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.frequency.setValueAtTime(150, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(50, this.ctx.currentTime + 0.4);
                gain.gain.setValueAtTime(0.3, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.4);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.4);
            },

            // Freeze Time - Whoosh effect
            playFreeze() {
                if (!this.ctx) this.init(); this.resume();
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                const filter = this.ctx.createBiquadFilter();
                filter.type = 'lowpass';
                osc.type = 'sine';
                osc.connect(filter);
                filter.connect(gain);
                gain.connect(this.ctx.destination);
                osc.frequency.setValueAtTime(2000, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(100, this.ctx.currentTime + 0.8);
                filter.frequency.setValueAtTime(3000, this.ctx.currentTime);
                filter.frequency.exponentialRampToValueAtTime(200, this.ctx.currentTime + 0.8);

                osc.start();
                osc.stop(this.ctx.currentTime + 0.8);
            },



            // Rewind - Reverse tape effect
            playRewind() {
                if (!this.ctx) this.init(); this.resume();
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'square';
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.frequency.setValueAtTime(100, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(800, this.ctx.currentTime + 0.5);
                gain.gain.setValueAtTime(0.15, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.5);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.5);
            },

            // Tick sound for timer (tension!)
            playTick() {
                if (!this.ctx) this.init(); this.resume();
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.frequency.setValueAtTime(1000, this.ctx.currentTime);
                gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.05);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.05);
            },

            // Roulette spinning
            playRouletteClick() {
                if (!this.ctx) this.init(); this.resume();
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.frequency.setValueAtTime(600 + Math.random() * 200, this.ctx.currentTime);
                gain.gain.setValueAtTime(0.08, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.03);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.03);
            },

            // UI Click - Soft interaction
            playClick() {
                if (!this.ctx) this.init(); this.resume();
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(100, this.ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.1);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.1);
            },

            // Alias for hover sound (requested by Achievement system)
            playBtnHover() {
                this.playClick();
            },

            // Horror Boom Effect
            playCreepyBoom() {
                if (!this.ctx) this.init(); this.resume();
                if (!this.ctx) return;

                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                // Low frequency noise/rumble
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(30, this.ctx.currentTime + 1.5);

                gain.gain.setValueAtTime(0.5, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 1.5);

                osc.connect(gain);
                gain.connect(this.ctx.destination);

                osc.start();
                osc.stop(this.ctx.currentTime + 1.5);
            }
        };

        // Global UI Click Sound
        document.addEventListener('click', (e) => {
            // Init audio on first interaction
            if (AudioSystem.ctx && AudioSystem.ctx.state === 'suspended') AudioSystem.resume();

            if (e.target.tagName === 'BUTTON' || e.target.closest('button') || e.target.classList.contains('opt-btn')) {
                AudioSystem.playClick();
            }
        });

        // --- TIMER SYSTEM ---
        const TimerSystem = {
            timeLeft: 15,
            maxTime: 15,
            interval: null,
            frozen: false,

            start(seconds = 15) {
                this.maxTime = seconds;
                this.timeLeft = seconds;
                this.frozen = false;
                this.update();

                if (this.interval) clearInterval(this.interval);

                // DUEL MODE EXCEPTION: No timer countdown
                if (typeof currentGameMode !== 'undefined' && currentGameMode === 'C') {
                    // Update once to clear/hide info but don't tick
                    this.update();
                    return;
                }

                this.interval = setInterval(() => {
                    if (this.frozen) return;

                    // Apply difficulty multiplier to time drain
                    let rate = 0.1 * DifficultySystem.getTickRate();

                    // Anomaly: Fast
                    if (document.body.classList.contains('anomaly-fast')) rate *= 2;

                    this.timeLeft -= rate;
                    this.update();

                    // Tick sound when low (below 10s)
                    if (this.timeLeft <= 10 && this.timeLeft > 0) {
                        if (Math.floor(this.timeLeft * 5) % 5 === 0) { // Faster ticking
                            AudioSystem.playTick();
                        }
                    }

                    if (this.timeLeft <= 0) {
                        this.stop();
                        // TIME LOOP Mode: Timer expire = ESCAPE the loop
                        if (typeof currentGameMode !== 'undefined' && currentGameMode === 'B' && DreamMode.active) {
                            DreamMode.onTimerExpire();
                        } else {
                            Game.gameOver(); // Time out = Game Over now
                        }
                    }
                }, 100);
            },

            update() {
                const display = document.getElementById('time-display');
                const bar = document.getElementById('time-bar');

                // Ring (Keep legacy support if exists, or ignore)
                const ring = document.getElementById('timeRing');
                const ringProg = document.getElementById('timeProgress');
                if (ringProg) {
                    const percent = Math.max(0, this.timeLeft / this.maxTime); // Relative to max?
                    // Or relative to 60s base? Let's keep it relative to current Max for Ring
                    const offset = 251 * (1 - percent);
                    ringProg.style.strokeDashoffset = offset;
                }

                if (!display || !bar) return;

                // SPECIAL DISPLAY FOR DUEL MODE
                if (typeof currentGameMode !== 'undefined' && currentGameMode === 'C') {
                    display.textContent = "NO TIME";
                    bar.style.width = "100%";
                    bar.style.backgroundColor = (document.body.classList.contains('time-day')) ? '#000' : '#444';
                    return;
                }

                display.textContent = this.timeLeft.toFixed(1);
                // Bar is relative to 60s (Initial Max) visually, or dynamic?
                // User snippet: (timeRemaining / 60 * 100) + '%'
                // So bar clamps at 60s full.
                let percent = (this.timeLeft / 60) * 100;
                if (percent > 100) percent = 100;
                bar.style.width = percent + '%';

                // Danger state when under 15 seconds (User requested < 15)
                if (this.timeLeft < 15) {
                    bar.classList.add('danger');
                    display.style.color = 'var(--danger)';
                    // Visual Distortion Request
                    document.body.classList.add('time-critical');
                } else {
                    bar.classList.remove('danger');
                    display.style.color = 'var(--primary)';
                    document.body.classList.remove('time-critical');
                }
            },

            freeze(duration = 5) {
                this.frozen = true;
                // Timer pauses for duration, visual effect handled by TimePowers.useFreeze
                setTimeout(() => {
                    this.frozen = false;
                }, duration * 1000);
            },

            addTime(seconds) {
                this.timeLeft = Math.min(this.timeLeft + seconds, this.maxTime);
                this.update();
            },

            stop() {
                if (this.interval) {
                    clearInterval(this.interval);
                    this.interval = null;
                }
            }
        };

        // --- TIME POWERS ---
        const TimePowers = {
            freezeCharges: 1,
            rewindCharges: 3,

            reset() {
                this.freezeCharges = 1;
                this.rewindCharges = 3;
                this.updatePowerUI();
            },

            useFreeze() {
                if (this.freezeActive || this.freezeCharges <= 0) return;

                if (typeof onFreezeUsed !== 'undefined') onFreezeUsed(); // ACHIEVEMENT HOOK
                this.freezeCharges--;
                // Assuming updateButtons() is a function that updates the UI for powers
                // If not, this line might cause an error. Keeping it as per instruction.
                if (typeof this.updateButtons === 'function') this.updateButtons();
            },

            // Freeze: Pause timer for 5 seconds (timer only, game continues)
            useFreeze() {
                if (this.freezeCharges <= 0 || TimerSystem.frozen || (!Game.active && (typeof ParadoxMode === 'undefined' || !ParadoxMode.active))) return false;
                this.freezeCharges--;

                // Freeze only the timer (not full screen)
                TimerSystem.freeze(5);
                AudioSystem.playFreeze();

                // Apply freeze visual effect only to timer panel
                const timerPanel = document.getElementById('timer-panel');
                if (timerPanel) {
                    timerPanel.classList.add('frozen');
                    setTimeout(() => {
                        timerPanel.classList.remove('frozen');
                    }, 5000);
                }

                const btn = document.getElementById('btn-freeze');
                if (btn) btn.classList.add('used');

                this.updatePowerUI();

                // GAME JAM: Timeline Corruption
                if (typeof TimelineIntegrity !== 'undefined') TimelineIntegrity.onFreeze();

                return true;
            },

            // Rewind: Adds Time but ACCELERATES COLLAPSE
            useRewind() {
                if (this.rewindCharges <= 0 || (!Game.active && (typeof ParadoxMode === 'undefined' || !ParadoxMode.active))) return false;

                // Special Duel Mode Handling
                if (typeof DuelMode !== 'undefined' && DuelMode.active) {
                    this.rewindCharges--;
                    DuelMode.rewindTime(15000); // Add 15s to day cycle
                    AudioSystem.playRewind();
                    this.updatePowerUI();
                    return true;
                }

                this.rewindCharges--;
                Game.triggerRewindEffect();

                // GAME JAM: Timeline Corruption
                if (typeof TimelineIntegrity !== 'undefined') TimelineIntegrity.onRewind();

                return true;
            },

            // Earn powers through streaks
            onStreak(streakCount) {
                if (streakCount % 3 === 0) {
                    this.freezeCharges++;
                    this.showPowerGain('FREEZE +1');
                }

                if (streakCount % 5 === 0) {
                    if (this.rewindCharges < 3) {
                        this.rewindCharges++;
                        this.showPowerGain('REWIND +1');
                    } else {
                        this.showPowerGain('MAX CHARGES');
                    }
                }
                this.updatePowerUI();
            },

            showPowerGain(text) {
                const popup = document.createElement('div');
                popup.className = 'power-popup'; // Ensure CSS exists
                popup.textContent = text;
                popup.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    font-family: var(--f-title);
                    font-size: 2rem;
                    color: var(--green);
                    text-shadow: 0 0 20px var(--green);
                    z-index: 9999;
                    animation: powerPopup 1.5s forwards;
                `;
                document.body.appendChild(popup);
                setTimeout(() => popup.remove(), 1500);
            },

            updatePowerUI() {
                // Update freeze button
                const freezeBtn = document.querySelector('.big-freeze-btn');
                if (freezeBtn) {
                    freezeBtn.querySelector('span').textContent = `×${this.freezeCharges} [SPACE]`;
                    if (this.freezeCharges > 0) freezeBtn.classList.remove('used');
                    else freezeBtn.classList.add('used');
                }

                // Update rewind button
                const rewindBtn = document.querySelector('.btn-hud-rewind');
                if (rewindBtn) {
                    rewindBtn.querySelector('span').textContent = `×${this.rewindCharges} [R]`;
                    if (this.rewindCharges > 0) rewindBtn.classList.remove('used');
                    else rewindBtn.classList.add('used');
                }

                // Update Life Pips (Health Bar)
                const pips = document.querySelectorAll('.life-pip');
                pips.forEach((pip, i) => {
                    // Show filled if index < charges
                    if (i < this.rewindCharges) {
                        pip.classList.add('filled');
                        pip.style.background = 'var(--primary)';
                        pip.style.boxShadow = '0 0 10px var(--primary)';
                    } else {
                        pip.classList.remove('filled');
                        pip.style.background = 'rgba(255,255,255,0.1)';
                        pip.style.boxShadow = 'none';
                    }
                });
            }
        };

        // --- DIFFICULTY SYSTEM ---
        // --- DIFFICULTY SYSTEM ---
        const DifficultySystem = {
            level: 1,
            questionsAnswered: 0,

            reset() {
                this.level = 1;
                this.questionsAnswered = 0;
            },

            getTickRate() {
                // User requested 0.25 increment per 5 questions (per level)
                // Level 1 = 1x
                // Level 2 = 1.25x
                return 1 + (this.level - 1) * 0.25;
            },

            getScoreMultiplier() {
                return 1 + (this.level - 1) * 0.25;
            },

            onCorrectAnswer() {
                this.questionsAnswered++;

                // Level up every 5 questions
                if (this.questionsAnswered % 5 === 0) {
                    this.level++;

                    // Show Warning as requested
                    const alert = document.createElement('div');
                    alert.className = 'anomaly-alert';
                    alert.innerHTML = '⚠️ TIME ACCELERATION ⚠️<br>Speed: ' + this.getTickRate().toFixed(2) + 'x';
                    document.body.appendChild(alert);
                    setTimeout(() => alert.remove(), 2000);

                    AudioSystem.playWrong(); // Warning sound
                }
            },
        };

        // --- KEYBOARD SHORTCUTS ---
        document.addEventListener('keydown', (e) => {
            // Prevent interference with input fields
            if (e.target.tagName === 'INPUT') return;

            switch (e.key.toLowerCase()) {
                case ' ': // Spacebar = Freeze
                    e.preventDefault();
                    TimePowers.useFreeze();
                    break;
                case 'r': // R = Rewind
                    TimePowers.useRewind();
                    break;
                case '1':
                case '2':
                case '3':
                case '4':
                    // Quick answer selection
                    const optBtns = document.querySelectorAll('.opt-btn');
                    const idx = parseInt(e.key) - 1;
                    if (optBtns[idx]) optBtns[idx].click();
                    break;
            }
        });

        // --- 3. VISUALS ---
        // MOVED AFTER GAME DEFINITION to fix reference error loop but keeping logic here for structure

        // --- 4. GAME LOGIC ---
        // --- 4. PARADOX MODE (Mode C - Replacement) ---
        const ParadoxMode = {
            active: false,
            sanity: 100,
            chaosLevel: 0,
            timerInterval: null,
            round: 0,
            isInverted: false, // If true, must pick WRONG answer
            currentQ: null,

            init() {
                console.log("ParadoxMode: Initializing Chaos...");
                this.active = true;
                this.sanity = 100;
                this.chaosLevel = 0;
                this.round = 0;
            },

            start() {
                console.log("ParadoxMode: START");
                document.getElementById('s-game-paradox').classList.remove('hidden');
                document.getElementById('s-game-paradox').classList.add('active');

                TimerSystem.start(60); // 60s survival
                this.nextRound();
                this.updateSanityUI();
            },

            nextRound() {
                this.round++;
                this.chaosLevel = Math.min(10, Math.floor(this.round / 3)); // Chaos increases over time

                // 1. Get Question
                const topic = Game.currentTopic || TOPICS[0];
                const q = topic.qs[Math.floor(Math.random() * topic.qs.length)];
                this.currentQ = q;

                // 2. Determine Logic (Inverted?)
                // Chaos Level increases chance of inversion
                this.isInverted = Math.random() < (0.1 + (this.chaosLevel * 0.05));

                // 3. Render
                this.renderUI(q);
            },

            renderUI(q) {
                const qDisplay = document.getElementById('paradox-question');
                const optGrid = document.getElementById('paradox-options');
                const instruction = document.getElementById('paradox-instruction');

                // Clear previous
                optGrid.innerHTML = '';

                // Text
                qDisplay.innerText = this.isInverted ? `[CORRUPT DATA] ${q.q}` : q.q;
                if (this.isInverted) {
                    qDisplay.classList.add('glitch-text');
                    instruction.innerHTML = `<span class="blink">⚠ WARNING: LOGIC INVERTED - SELECT FALSE ANSWER ⚠</span>`;
                    instruction.style.color = '#ff0000';
                    instruction.style.borderColor = '#ff0000';
                } else {
                    qDisplay.classList.remove('glitch-text');
                    instruction.innerHTML = `// INSTRUCTION: SYSTEM NORMAL //`;
                    instruction.style.color = 'rgba(255,0,0,0.8)';
                    instruction.style.borderColor = 'var(--danger)';
                }

                // Options (Correct + Wrong)
                // DATA FIX: q.w is an array, not q.w1, q.w2
                let answers = [q.a, ...q.w];

                // Shuffle
                answers = answers.sort(() => Math.random() - 0.5);

                answers.forEach(ans => {
                    const btn = document.createElement('button');
                    btn.className = 'paradox-btn';
                    btn.innerText = ans;

                    // Chaos Move
                    if (this.chaosLevel > 2) {
                        const rot = (Math.random() - 0.5) * this.chaosLevel;
                        btn.style.transform = `rotate(${rot}deg)`;
                    }

                    btn.onclick = () => this.handleAnswer(ans, q.a);
                    optGrid.appendChild(btn);
                });
            },

            handleAnswer(selected, correct) {
                this.checkAnswer(selected);
            },

            checkAnswer(ans) {
                const isCorrectContent = (ans === this.currentQ.a);
                let success = false;

                if (this.isInverted) {
                    // Success if they picked a WRONG answer
                    success = !isCorrectContent;
                } else {
                    // Success if they picked the RIGHT answer
                    success = isCorrectContent;
                }

                if (success) {
                    this.onSuccess();
                } else {
                    this.onFailure();
                }
            },

            onSuccess() {
                AudioSystem.playCorrect();
                Game.score += 100 * Game.multiplier;
                document.getElementById('hud-score').innerText = Game.score;

                // Sanity restore
                this.sanity = Math.min(100, this.sanity + 5);
                this.updateSanityUI();

                // Visual Feedback
                const f = document.createElement('div');
                f.className = 'paradox-feedback success';
                f.innerText = this.isInverted ? "ERROR ACCEPTED" : "DATA VERIFIED";
                document.getElementById('s-game-paradox').appendChild(f);
                setTimeout(() => f.remove(), 1000);

                this.nextRound();
            },

            onFailure() {
                AudioSystem.playWrong();

                // Sanity damage
                this.sanity -= 15;
                this.updateSanityUI();
                TimerSystem.addTime(-5); // Penalty

                // Visual Feedback
                const f = document.createElement('div');
                f.className = 'paradox-feedback fail';
                f.innerText = "FATAL EXCEPTION";
                document.getElementById('s-game-paradox').appendChild(f);
                setTimeout(() => f.remove(), 1000);

                if (this.sanity <= 0) {
                    this.triggerGameOver();
                } else {
                    this.nextRound();
                }
            },

            updateSanityUI() {
                const bar = document.getElementById('sanity-fill');
                if (bar) {
                    bar.style.width = this.sanity + '%';
                    if (this.sanity < 30) bar.style.backgroundColor = 'var(--danger)';
                    else bar.style.backgroundColor = 'var(--primary)';
                }
            },

            triggerGameOver() {
                this.active = false;
                TimerSystem.stop();
                Game.gameOver();
            },

            cleanup() {
                this.active = false;
                document.getElementById('s-game-paradox').classList.add('hidden');
                document.getElementById('s-game-paradox').classList.remove('active');
            }
        };

        const Game = {
            active: false, score: 0, round: 0, curr: 0,
            currentTopic: null, qData: [], rewinding: false,
            streak: 0, multiplier: 1, anomaly: null,
            rewindUsedInRound: false,

            startSequence() {
                // Check if already registered in this session? 
                // User asked to add options "when the start off the game".
                // So we always show register screen first.

                // NEW ACHIEVEMENT TRACKING
                if (typeof achievementStats !== 'undefined') {
                    achievementStats.gamesPlayed++;
                    if (currentGameMode) achievementStats.modesPlayed.add(currentGameMode);

                    if (achievementStats.gamesPlayed >= 5) unlockAchievement('veteran');
                    if (achievementStats.modesPlayed.size >= 3) unlockAchievement('mode_traveler');
                }

                // Initialize Audio
                try {
                    if (typeof AudioSystem !== 'undefined') { AudioSystem.init(); AudioSystem.resume(); }
                    if (typeof MusicSystem !== 'undefined') MusicSystem.play('start');
                } catch (e) { }

                gameInProgress = true;
                LuckSystem.reset();
                if (typeof StorySystem !== 'undefined') StorySystem.reset();

                // SHOW REGISTER SCREEN INSTEAD OF LUCK
                // Hide Title
                document.getElementById('s-title').classList.add('hidden');
                document.getElementById('s-title').classList.remove('active');

                // Show Register
                const regScreen = document.getElementById('s-register');
                regScreen.classList.remove('hidden');
                regScreen.classList.add('active');

                // Pre-fill if exists
                try {
                    const saved = JSON.parse(localStorage.getItem('neuro_fried_last_user'));
                    if (saved) {
                        if (saved.name) document.getElementById('reg-name').value = saved.name;
                        if (saved.photo) {
                            UserProfile.photo = saved.photo;
                            const preview = document.getElementById('reg-preview');
                            const text = document.getElementById('reg-upload-text');
                            preview.src = saved.photo;
                            preview.style.display = 'block';
                            text.style.display = 'none';
                        }
                    }
                } catch (e) { }
            },

            proceedWithMode() {
                // Called by LuckSystem after mode is selected
                switch (currentGameMode) {
                    case 'A':
                        // Normal mode
                        this.switchScreen('s-luck', 's-roulette');
                        this.startRoulette();
                        break;
                    case 'B':
                        // Dream/Time Loop mode
                        DreamMode.init();
                        this.switchScreen('s-luck', 's-roulette');
                        this.startRoulette();
                        break;
                    case 'C':
                        // Paradox Mode (replaces Duel)
                        ParadoxMode.init();
                        this.switchScreen('s-luck', 's-roulette');
                        this.startRoulette();
                        break;
                    default:
                        this.switchScreen('s-luck', 's-roulette');
                        this.startRoulette();
                }
            },

            startRoulette() {
                const track = document.getElementById('roulette-track');
                const acts = document.getElementById('roulette-actions');

                track.innerHTML = "";
                acts.classList.add('hidden');
                track.style.transform = "translateX(0px)";

                // 1. GENERATE ITEMS 
                const itemCount = 50;
                const targetIndex = 35;
                const itemWidth = 200;

                let targetTopic = null;
                const items = [];

                for (let i = 0; i < itemCount; i++) {
                    const t = TOPICS[Math.floor(Math.random() * TOPICS.length)];
                    const el = document.createElement('div');
                    el.className = 'roulette-item';
                    el.innerText = t.name;
                    track.appendChild(el);

                    if (i === targetIndex) targetTopic = t;
                    items.push({ el, cx: i * itemWidth + itemWidth / 2 });
                }

                this.currentTopic = targetTopic;

                // 2. MATHS
                const finalScroll = (targetIndex * itemWidth) + (itemWidth / 2);

                // Physics
                let scrollX = 0;
                let speed = 0;
                const maxSpeed = 50;
                const accelRate = 1.5;
                const decelDist = 2000;
                const minSpeed = 0.5;

                let state = 'accel';

                const loop = () => {
                    const distRemaining = finalScroll - scrollX;

                    if (distRemaining > decelDist) {
                        if (speed < maxSpeed) speed += accelRate;
                    } else if (distRemaining > 0.5) {
                        let targetSpeed = distRemaining * 0.03;
                        if (targetSpeed > maxSpeed) targetSpeed = maxSpeed;
                        if (targetSpeed < minSpeed) targetSpeed = minSpeed;
                        speed += (targetSpeed - speed) * 0.1;
                    } else {
                        scrollX = finalScroll;
                        speed = 0;
                        state = 'done';
                    }

                    scrollX += speed;
                    track.style.transform = `translateX(-${scrollX}px)`;

                    // DYNAMIC SCALE 
                    const viewCenter = scrollX;
                    const visRange = 1000;

                    items.forEach((it) => {
                        const dist = it.cx - viewCenter;
                        if (Math.abs(dist) > visRange) {
                            it.el.style.transform = 'scale(0.5)';
                            it.el.style.opacity = '0';
                            return;
                        }

                        const normDist = Math.abs(dist) / itemWidth;
                        let scale = Math.max(0.6, 1.4 - (normDist * 0.4));
                        let opacity = Math.max(0.1, 1 - (normDist * 0.6));
                        let blur = Math.min(10, normDist * 3);

                        it.el.style.transform = `scale(${scale})`;
                        it.el.style.opacity = opacity;
                        it.el.style.filter = `blur(${blur}px)`;
                        it.el.style.zIndex = Math.floor(100 - normDist);
                    });

                    // Audio Tick
                    if (speed > 1) {
                        const currIdx = Math.floor(scrollX / itemWidth);
                        const prevIdx = Math.floor((scrollX - speed) / itemWidth);
                        if (currIdx !== prevIdx) AudioSystem.playRouletteClick();
                    }

                    if (state !== 'done') {
                        requestAnimationFrame(loop);
                    } else {
                        // Finished
                        items[targetIndex].el.classList.add('locked');
                        items[targetIndex].el.style.transform = 'scale(1.5)';
                        items[targetIndex].el.style.opacity = '1';
                        AudioSystem.playCorrect(); // Win sound replacement
                        acts.classList.remove('hidden');
                    }
                };

                requestAnimationFrame(loop);
            },

            confirmTopic() {
                document.body.className = this.currentTopic.theme;
                this.switchScreen('s-roulette', 's-timeline');
            },

            reroll() { this.startRoulette(); },

            startGame(dir) {
                try {
                    this.qData = [...this.currentTopic.qs];
                    if (dir === 'asc') this.qData.sort((a, b) => a.y - b.y); else this.qData.sort((a, b) => b.y - b.y);

                    this.score = 0; this.round = 0;
                    this.streak = 0; this.multiplier = 1; this.anomaly = null;

                    DifficultySystem.reset();
                    TimePowers.reset();
                    // Ensure Timer is stopped before starting new
                    TimerSystem.stop();

                    if (typeof MusicSystem !== 'undefined') MusicSystem.play('gameplay');

                    document.getElementById('hud').classList.remove('hidden');
                    document.getElementById('hud-score').innerText = "0";
                    document.getElementById('hud-streak').innerText = "";

                    // Reset UI - No lives to reset

                    // INTERCEPT: SHOW RULES INSTEAD OF HYPING DIRECTLY
                    this.showRules();

                } catch (e) { alert("Start Error: " + e.message); console.error(e); }
            },

            showRules() {
                const overlay = document.getElementById('rules-overlay');
                const title = document.getElementById('rules-title');
                const list = document.getElementById('rules-list');

                if (!overlay || !list) { this.runHypeSequence(); return; }

                list.innerHTML = '';
                let rules = [];

                if (currentGameMode === 'A') {
                    title.innerText = "MODE A: OWN LUCK";
                    title.style.color = "var(--primary)";
                    rules = [
                        "Survive 60 seconds against the clock.",
                        "Correct Answer: +5 Seconds & Score Multiplier.",
                        "Wrong Answer: -5 Seconds penalty.",
                        "Use SPACE to FREEZE time (Cost: 3-Streak Charge).",
                        "Use R to REWIND death (Cost: Accel Difficulty)."
                    ];
                } else if (currentGameMode === 'B') {
                    title.innerText = "MODE B: TIME LOOP";
                    title.style.color = "#00ffff";
                    rules = [
                        "⚠️ INVERTED LOGIC: Correct = LOOP.",
                        "Each correct answer RESTARTS the timeline.",
                        "Glitch intensity INCREASES each loop.",
                        "Timer gets SHORTER each cycle.",
                        "Only escape when TIME RUNS OUT."
                    ];
                } else if (currentGameMode === 'C') {
                    title.innerText = "MODE C: PARADOX";
                    title.style.color = "var(--danger)";
                    rules = [
                        "Sanity Meter replaces Health.",
                        "Wrong answers damage your Sanity.",
                        "LOGIC INVERSION: If text glitches, pick the WRONG answer.",
                        "Chaos Level rises over time.",
                        "Survive against your own mind."
                    ];
                }

                rules.forEach(r => {
                    const li = document.createElement('li');
                    li.innerText = r;
                    list.appendChild(li);
                });

                overlay.classList.remove('hidden');
                // Force reflow
                void overlay.offsetWidth;
                overlay.classList.add('active');

                // One-time click listener to dismiss
                const dismiss = () => {
                    overlay.classList.remove('active');
                    setTimeout(() => {
                        overlay.classList.add('hidden');
                        this.switchScreen('s-timeline', 's-hype');
                        this.runHypeSequence();
                    }, 500); // Wait for transition
                    document.removeEventListener('click', dismiss);
                };

                // Slight delay so user doesn't click through instantly
                setTimeout(() => {
                    document.addEventListener('click', dismiss);
                }, 500);
            },

            runHypeSequence() {
                const c = document.getElementById('hype-count');
                const m = document.getElementById('hype-msg-cont');
                m.classList.add('hidden'); m.innerHTML = '';

                let num = 3;
                c.innerText = num;
                c.classList.remove('hidden');

                AudioSystem.playRouletteClick(); // Beep

                const step = () => {
                    c.style.animation = 'none';
                    c.offsetHeight;
                    c.style.animation = 'zoomFade 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards';

                    c.innerText = num;
                    AudioSystem.playRouletteClick();

                    if (num > 0) {
                        num--;
                        setTimeout(step, 800);
                    } else {
                        c.classList.add('hidden');
                        m.classList.remove('hidden');
                        AudioSystem.playCorrect();

                        const text = "READY TO REWIND TO WIN";
                        const words = text.split(' ');

                        words.forEach((word, wi) => {
                            const wSpan = document.createElement('div');
                            wSpan.style.display = "inline-block";
                            wSpan.style.margin = "0 15px";

                            word.split('').forEach((char, ci) => {
                                const s = document.createElement('span');
                                s.className = 'hype-char';
                                s.innerText = char;
                                s.style.animationDelay = `${(wi * 2 + ci) * 0.05}s`;
                                if (word === "WIN" || word === "REWIND") s.style.color = "var(--primary)";
                                wSpan.appendChild(s);
                            });
                            m.appendChild(wSpan);
                            if (word === "REWIND") {
                                const br = document.createElement('div');
                                br.style.flexBasis = "100%";
                                br.style.height = "20px";
                                m.appendChild(br);
                            }
                        });


                        setTimeout(() => {
                            const chars = document.querySelectorAll('.hype-char');
                            chars.forEach((char, i) => {
                                char.classList.add('out');
                                char.style.animationDelay = `${i * 0.02}s`;
                            });

                            setTimeout(() => {
                                // Choose correct game screen based on mode
                                if (currentGameMode === 'C') {
                                    this.switchScreen('s-hype', 's-game-paradox');
                                    ParadoxMode.start();
                                } else {
                                    this.switchScreen('s-hype', 's-game');
                                    this.nextRound();
                                }
                                c.classList.remove('hidden');
                            }, 800);
                        }, 2000);
                    }
                };
                step();
            },

            nextRound() {
                if (this.round >= this.qData.length) { this.gameWin(); return; }

                const d = this.qData[this.round];
                this.rewindUsedInRound = false;

                // Paradox Mode runs independently, so no special handling here needed if flow is correct.
                // But just in case:
                if (currentGameMode === 'C') return;

                // Normal and Dream mode use standard game screen
                document.getElementById('era-display').innerText = `YEAR: ${d.y}`;
                document.getElementById('q-text').innerText = d.q;

                // GAME JAM: Check for Deja Vu (Time Loop Detection)
                // GAME JAM: Check for Deja Vu (Time Loop Detection)
                try {
                    if (typeof TimelineIntegrity !== 'undefined') {
                        TimelineIntegrity.checkDejaVu(d.q);
                    }
                } catch (e) { console.warn("DejaVu Failed", e); }


                const gr = document.getElementById('opt-area'); gr.innerHTML = '';
                [d.a, ...d.w].sort(() => Math.random() - 0.5).forEach(txt => {
                    const b = document.createElement('div');
                    b.className = 'opt-btn'; b.innerText = txt;
                    b.onclick = (e) => this.check(txt, d.a, e);
                    gr.appendChild(b);
                });

                this.active = true;

                // ANOMALY SYSTEM 
                document.body.classList.remove('anomaly-mirror', 'anomaly-fast');
                this.anomaly = null;

                if (Math.random() < 0.3 && this.round > 2) {
                    const type = Math.random() > 0.5 ? 'mirror' : 'fast';
                    this.anomaly = type;

                    const notif = document.createElement('div');
                    notif.className = 'anomaly-alert';

                    if (type === 'mirror') {
                        document.body.classList.add('anomaly-mirror');
                        notif.innerText = "⚠ REALITY INVERSION DETECTED ⚠";
                    } else {
                        // Fast mode handling
                        // TimerSystem will need to know about this? 
                        // Or we just reduce the start time?
                        // The old code reduced time *rate* (drop = 40 instead of 20).
                        // I will set TimerSystem total time to be less? Or I need to tell TimerSystem to tick faster?
                        // Simpler: Just reduce the initial time by half for this round or set a flag.
                        // I'll set a flag in TimerSystem or just act like 'fast' = less time.
                        notif.innerText = "⚠ CHRONO-ACCELERATION DETECTED ⚠";
                    }
                    document.body.appendChild(notif);
                    setTimeout(() => notif.remove(), 2000);
                    AudioSystem.playWrong(); // Use harsh sound for warn
                }

                // Start Timer ONLY if it's the first round (or we handle it in startGame)
                // Actually, startGame calls nextRound. 
                // We want Global Timer to start once.

                if (this.round === 0) {
                    TimerSystem.start(60); // 60s Start
                }
                // Do NOT call TimerSystem.start() every round anymore.

            },

            // Timeout Handler
            handleTimeOut() {
                this.showFailState();
            },

            // Manual Rewind Effect (The "R" Key)
            triggerRewindEffect() {
                // 1. Visuals
                AudioSystem.playRewind();
                document.body.classList.add('is-rewinding');
                setTimeout(() => document.body.classList.remove('is-rewinding'), 500);

                // 2. Logic: Gain Time but Pay the Price
                TimerSystem.addTime(10); // +10 Seconds
                this.showTimeFeedback(10);

                // 3. THE PRICE: Acceleration
                DifficultySystem.level++;
                const speed = DifficultySystem.getTickRate().toFixed(2);

                // 4. Alert
                const alert = document.createElement('div');
                alert.className = 'anomaly-alert';
                alert.innerHTML = `⚠️ CHRONO-ACCELERATION ⚠️<br>SPEED: ${speed}x`;
                document.body.appendChild(alert);
                setTimeout(() => alert.remove(), 2500);
            },

            // Called from Fail Modal
            triggerRewind() {
                // Use a charge if available (Uncapped usage per round as requested)
                if (TimePowers.rewindCharges > 0) {
                    TimePowers.rewindCharges--;
                    TimePowers.updatePowerUI();

                    // Mark as used for this round (Legacy: removed restriction)
                    // this.rewindUsedInRound = true;

                    document.getElementById('fail-modal').classList.remove('active');
                    document.body.classList.remove('paradox-hit');

                    // Recover with bonus time
                    AudioSystem.playRewind();
                    this.rewinding = true;
                    document.body.classList.add('is-rewinding');

                    setTimeout(() => {
                        this.rewinding = false;
                        document.body.classList.remove('is-rewinding');

                        // Restart Round or Just Add Time?
                        // User expects to "continue".
                        // Add +15s (Reduced from 20s) and ACCELERATE
                        this.active = true;
                        TimerSystem.addTime(15);

                        // --- THE COLLAPSE ACCELERATES ---
                        DifficultySystem.level++;
                        const speed = DifficultySystem.getTickRate().toFixed(2);

                        // Visual Warning
                        const alert = document.createElement('div');
                        alert.className = 'anomaly-alert';
                        alert.innerHTML = `⚠️ TIMELINE UNSTABLE ⚠️<br>SPEED INCREASED TO ${speed}x`;
                        document.body.appendChild(alert);
                        setTimeout(() => alert.remove(), 3000);

                        TimerSystem.start(TimerSystem.timeLeft);

                    }, 1000);

                } else {
                    // Feedback: No charges!
                    const btn = document.querySelector('.btn-rewind');
                    btn.classList.add('shake');
                    setTimeout(() => btn.classList.remove('shake'), 400);
                }
            },

            check(ans, cor, e) {
                if (!this.active) return;
                this.active = false; // LOCK INPUT


                if (ans === cor) {
                    if (typeof onCorrectAnswer !== 'undefined') onCorrectAnswer(); // ACHIEVEMENT HOOK
                    AudioSystem.playCorrect();
                    if (e && typeof showScorePop === 'function') showScorePop(e.clientX, e.clientY);

                    // GAIN TIME +5s
                    TimerSystem.addTime(5);
                    this.showTimeFeedback(5);

                    // Reset single-rewind flag on correct answer (redundant but safe)
                    this.rewindUsedInRound = false;

                    // STREAK LOGIC
                    this.streak++;
                    DifficultySystem.onCorrectAnswer();
                    TimePowers.onStreak(this.streak); // Check for power gains

                    let multimsg = "";
                    this.multiplier = DifficultySystem.getScoreMultiplier(); // Base multiplier from difficulty

                    if (this.streak > 1) {
                        // Add streak bonus to multiplier
                        this.multiplier += Math.min(4, Math.ceil(this.streak / 2));
                        multimsg = ` x${this.multiplier.toFixed(1)}`;
                        document.getElementById('hud-streak').innerText = "STREAK " + this.streak + multimsg;
                        document.getElementById('hud-streak').classList.add('pulse-text');

                        // Show Streak Overlay
                        Game.showConditionOverlay('streak', `STREAK ${this.streak}x`);
                    }

                    // Sparkle
                    const hud = document.getElementById('hud-score');
                    const rect = hud.getBoundingClientRect();
                    const el = document.createElement('div');
                    el.className = 'score-sparkle';
                    let baseVal = 100 + Math.ceil(TimerSystem.timeLeft * 10);
                    let finalVal = Math.floor(baseVal * this.multiplier);
                    el.innerText = `+${finalVal}`;
                    el.style.left = (rect.left + Math.random() * 20) + 'px';
                    el.style.top = rect.top + 'px';
                    document.body.appendChild(el);
                    setTimeout(() => el.remove(), 1000);

                    this.score += finalVal;
                    document.getElementById('hud-score').innerText = this.score;

                    // TIME LOOP Mode (Mode B) - Correct answer TRIGGERS LOOP
                    if (currentGameMode === 'B' && DreamMode.active) {
                        if (DreamMode.onCorrectAnswer()) {
                            // Loop triggered - DreamMode handles the restart
                            return;
                        }
                    }

                    this.round++; this.nextRound();
                } else {
                    // WRONG ANSWER LOGIC
                    if (typeof onWrongAnswer !== 'undefined') onWrongAnswer(); // ACHIEVEMENT HOOK
                    AudioSystem.playWrong();

                    // Lose Time (-5s)
                    TimerSystem.addTime(-5);
                    this.showTimeFeedback(-5);

                    // Visual Feedback
                    const btn = document.querySelector('.btn-rewind'); // Reuse shake logic or add new?
                    document.body.classList.add('paradox-hit');
                    setTimeout(() => document.body.classList.remove('paradox-hit'), 200);

                    this.streak = 0;
                    this.multiplier = 1;
                    document.getElementById('hud-streak').innerText = "";

                    // FATAL CHECK
                    if (TimerSystem.timeLeft <= 0) {
                        this.showFailState();
                    } else {
                        // CONTINUE (Not too change logic: Keeps game flowing)
                        this.round++;
                        this.nextRound();
                    }
                }
            },

            showTimeFeedback(seconds) {
                const indicator = document.createElement('div');
                indicator.className = seconds > 0 ? 'time-indicator time-gain' : 'time-indicator time-loss';
                indicator.textContent = (seconds > 0 ? '+' : '') + seconds + 's';

                // Quick inline styling since CSS might be missing again
                indicator.style.position = 'fixed';
                indicator.style.top = '50%';
                indicator.style.left = '50%';
                indicator.style.transform = 'translate(-50%, -50%)';
                indicator.style.fontSize = '4rem';
                indicator.style.fontWeight = 'bold';
                indicator.style.color = seconds > 0 ? '#00ff00' : '#ff003c';
                indicator.style.zIndex = '10000';
                indicator.style.pointerEvents = 'none';
                indicator.style.textShadow = '0 0 20px currentColor';
                indicator.style.animation = 'floatUp 1s forwards'; // Need keyframes or JS anim

                // Add simple float animation if CSS keyframes missing
                indicator.animate([
                    { transform: 'translate(-50%, -50%) scale(1)', opacity: 1 },
                    { transform: 'translate(-50%, -150%) scale(1.5)', opacity: 0 }
                ], { duration: 1000, easing: 'ease-out' });

                document.body.appendChild(indicator);
                setTimeout(() => indicator.remove(), 1000);
            },



            showFailState() {
                this.active = false;
                TimerSystem.stop();
                AudioSystem.playWrong();

                // Dream Mode (Mode B) - trigger dream loop instead of fail
                if (currentGameMode === 'B' && DreamMode.active) {
                    DreamMode.triggerDreamSequence(false); // false = loss
                    return;
                }

                // Update Rewind Button Text
                const btn = document.querySelector('.btn-rewind');
                if (btn) {
                    const count = TimePowers.rewindCharges;

                    if (this.rewindUsedInRound) {
                        btn.innerHTML = `LOCKED<br><span style="font-size:0.8rem">ALREADY REWOUND</span>`;
                        btn.style.opacity = '0.5';
                        btn.style.cursor = 'not-allowed';
                        btn.disabled = true;
                    } else if (count <= 0) {
                        btn.innerHTML = `REWIND<br><span style="font-size:0.8rem">NO CHARGES</span>`;
                        btn.style.opacity = '0.5';
                        btn.style.cursor = 'not-allowed';
                        btn.disabled = true;
                    } else {
                        btn.innerHTML = `REWIND<br><span style="font-size:0.8rem">CHARGES: ${count}</span>`;
                        btn.style.opacity = '1';
                        btn.style.cursor = 'pointer';
                        btn.disabled = false;
                    }
                }

                document.getElementById('fail-modal').classList.add('active');
                document.body.classList.add('paradox-hit');
            },

            showConditionOverlay(type, text) {
                const el = document.createElement('div');
                el.className = 'anomaly-alert';
                el.style.top = '20%';
                el.style.color = type === 'streak' ? 'var(--green)' : 'var(--primary)';
                el.innerHTML = text;
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 1500);
            },



            gameWin() {
                this.active = false;
                TimerSystem.stop();

                try {
                    if (typeof saveScore === 'function') saveScore(this.score);
                } catch (e) { console.error("Score save failed", e); }

                try {
                    if (typeof MusicSystem !== 'undefined') MusicSystem.play('gameover');
                    AudioSystem.playCorrect();
                    if (typeof onGameWinAC !== 'undefined') onGameWinAC(TimerSystem.timeLeft);
                } catch (e) { console.error("Win effects failed", e); }

                // Cleanup any active modes
                if (currentGameMode === 'B') DreamMode.cleanup();
                if (currentGameMode === 'C') DuelMode.cleanup();

                // Set victory headline before showing game over screen
                this.isWin = true;
                const headline = document.getElementById('game-over-headline');
                if (headline) {
                    headline.textContent = 'NEURAL SYNC COMPLETE';
                    headline.style.color = 'var(--green)';
                    headline.style.textShadow = '0 0 30px var(--green)';
                }

                // Update final score for display
                document.getElementById('final-aura-score').textContent = this.score;

                // Hide HUD and game screens
                document.getElementById('hud').classList.add('hidden');
                document.getElementById('s-game').classList.add('hidden');
                document.getElementById('s-game').classList.add('hidden');
                document.getElementById('s-game-paradox').classList.add('hidden'); // Fix: Hide Paradox Mode

                // GAME JAM: Show custom ending based on Timeline Corruption
                if (typeof TimelineIntegrity !== 'undefined') {
                    TimelineIntegrity.showEnding('win');
                } else {
                    // Fallback to normal outro
                    this.runOutroSequence();
                }
            },

            gameOver() {
                this.active = false; AudioSystem.playWrong();
                // MusicSystem.play handles searching/stopping current track
                gameInProgress = false;
                document.getElementById('fail-modal').classList.remove('active');
                document.body.classList.add('power-off-anim');

                // Cleanup any active modes
                if (currentGameMode === 'B') DreamMode.cleanup();
                if (currentGameMode === 'C') DuelMode.cleanup();

                // Reset headline to SIGNAL LOST for game over
                this.isWin = false;
                const headline = document.getElementById('game-over-headline');
                if (headline) {
                    headline.textContent = 'SIGNAL LOST';
                    headline.style.color = 'var(--danger)';
                    headline.style.textShadow = '0 0 30px var(--danger)';
                }

                // Cue the sad violin... or menacing drone in our case
                if (typeof MusicSystem !== 'undefined') MusicSystem.play('gameover');

                setTimeout(() => {
                    document.body.classList.remove('power-off-anim');
                    document.getElementById('hud').classList.add('hidden');
                    document.getElementById('s-game').classList.add('hidden');
                    document.getElementById('s-game-paradox').classList.add('hidden'); // Fix: Hide Paradox Mode
                    this.runOutroSequence();
                }, 600);
            },

            runOutroSequence() {
                console.log('🎬 Starting ROBUST outro sequence...');
                const s = document.getElementById('s-outro');
                if (!s) { this.triggerGameOverScreen(); return; }

                // FORCE VISIBILITY - RESET EVERYTHING
                s.innerHTML = '';
                s.classList.remove('hidden');

                // Nuclear Option for CSS
                s.setAttribute('style', 'display:flex !important; flex-direction:column; justify-content:center; align-items:center; position:fixed; top:0; left:0; width:100vw; height:100vh; background:black !important; z-index:2147483647 !important; opacity:1 !important;');

                // Create Text
                const textField = document.createElement('div');
                textField.className = 'outro-clean-text';
                s.appendChild(textField);

                // Sequence
                const sequence = [
                    { text: "THANK YOU", delay: 800 },
                    { text: "FOR PLAYING", delay: 800 },
                    { text: "NEURO FRIED", delay: 1000 },
                    { text: "REWIND", delay: 600, style: "strike" },
                    { text: "RESTART", delay: 2000 }
                ];
                let step = 0;

                const nextStep = () => {
                    if (step >= sequence.length) {
                        s.style.opacity = '0';
                        setTimeout(() => {
                            s.classList.add('hidden');
                            s.style.zIndex = '10000';
                            this.triggerGameOverScreen();
                        }, 500);
                        return;
                    }

                    const data = sequence[step];
                    textField.style.opacity = '0';

                    setTimeout(() => {
                        textField.innerText = data.text;
                        textField.className = 'outro-clean-text';

                        try {
                            if (typeof AudioSystem !== 'undefined') {
                                if (data.style === 'strike') {
                                    textField.classList.add('strikethrough-red');
                                    if (AudioSystem.playRewind) AudioSystem.playRewind();
                                } else {
                                    if (AudioSystem.playRouletteClick) AudioSystem.playRouletteClick();
                                }
                            }
                        } catch (e) { console.warn(e); }

                        textField.style.opacity = '1';
                        setTimeout(() => { step++; nextStep(); }, data.delay);
                    }, 150);
                };
                nextStep();
            },

            runOutroSequence_IGNORED() {
                console.log('🎬 Starting outro sequence...');

                const s = document.getElementById('s-outro');
                if (!s) { this.triggerGameOverScreen(); return; }

                // Clear previous content
                s.innerHTML = '';
                s.classList.remove('hidden');

                // Create Central Text Element
                const textField = document.createElement('div');
                textField.className = 'outro-clean-text';
                s.appendChild(textField);

                // Sequence Data
                const sequence = [
                    { text: "THANK YOU", delay: 800 },
                    { text: "FOR PLAYING", delay: 800 },
                    { text: "NEURO FRIED", delay: 1000 },
                    { text: "REWIND", delay: 600, style: "strike" },
                    { text: "RESTART", delay: 2000 } // Keep restart visible longer
                ];

                let step = 0;

                const nextStep = () => {
                    if (step >= sequence.length) {
                        // End Sequence -> Show Game Over Screen
                        s.classList.add('hidden');
                        this.triggerGameOverScreen();
                        return;
                    }

                    const data = sequence[step];

                    // Reset styling
                    textField.style.opacity = '0'; // Blink out

                    setTimeout(() => {
                        // Change text
                        textField.innerText = data.text;
                        textField.className = 'outro-clean-text'; // Reset class

                        if (data.style === 'strike') {
                            textField.classList.add('strikethrough-red');
                            // Optional: play glitch sound
                            if (AudioSystem) AudioSystem.playRewind();
                        } else {
                            if (AudioSystem) AudioSystem.playRouletteClick();
                        }

                        textField.style.opacity = '1'; // Blink in

                        // Schedule next
                        setTimeout(() => {
                            step++;
                            nextStep();
                        }, data.delay);
                    }, 150); // Short blank gap for flicker effect
                };

                // Start
                nextStep();
            },

            triggerGameOverScreen() {
                // Populate Stats
                document.getElementById('final-aura-score').innerText = this.score;

                if (typeof achievementStats !== 'undefined') {
                    if (document.getElementById('questions-cleared'))
                        document.getElementById('questions-cleared').innerText = achievementStats.questionsAnsweredSession || 0;
                }

                if (document.getElementById('time-survived')) {
                    const time = (typeof TimerSystem !== 'undefined' && TimerSystem.timeSurvived)
                        ? TimerSystem.timeSurvived.toFixed(1) : '0.0';
                    document.getElementById('time-survived').innerText = time + 's';
                }

                if (document.getElementById('max-speed')) {
                    const speed = (typeof DifficultySystem !== 'undefined' && DifficultySystem.getTickRate)
                        ? DifficultySystem.getTickRate().toFixed(2) : '1.00';
                    document.getElementById('max-speed').innerText = speed + 'x';
                }

                // User Picture if available
                const saved = JSON.parse(localStorage.getItem('neuro_fried_last_user'));
                if (saved && saved.photo) {
                    const img = document.getElementById('card-img');
                    if (img) img.src = saved.photo;
                    if (document.getElementById('final-name')) document.getElementById('final-name').innerText = saved.name.toUpperCase();
                }

                // Show screen - FORCE VISIBILITY
                const overScreen = document.getElementById('s-over');
                overScreen.classList.remove('hidden');
                overScreen.style.display = 'flex';
                overScreen.style.zIndex = '2147483647'; // Max Z-Index
                overScreen.style.opacity = '1';
                overScreen.style.position = 'fixed';
                overScreen.style.top = '0';
                overScreen.style.left = '0';
                overScreen.style.width = '100vw';
                overScreen.style.height = '100vh';

                // Ensure text reset
                const headline = document.getElementById('game-over-headline');
                if (headline) {
                    headline.textContent = this.isWin ? 'TIMELINE SAVED' : 'SIGNAL LOST';
                    headline.style.color = this.isWin ? 'var(--green)' : 'var(--danger)';
                }
                setTimeout(() => document.getElementById('s-over').classList.add('active'), 50);
            },

            switchScreen(from, to) {
                document.getElementById(from).classList.remove('active');
                document.getElementById(from).classList.add('hidden');
                document.getElementById(to).classList.remove('hidden');
                setTimeout(() => document.getElementById(to).classList.add('active'), 10);

                // Trigger Story System
                setTimeout(async () => {
                    if (to === 's-luck') {
                        await StorySystem.playStory('fate', 'fate', 'luck-box-container');
                    } else if (to === 's-timeline') {
                        await StorySystem.playStory('timeline', 'timeline', 'timeline-controls');
                    } else if (to === 's-roulette') {
                        await StorySystem.playStory('roulette', 'roulette', 'roulette-actions');
                    }
                }, 300);
            }
        };

        // --- VISUALS (Placed After Game Logic to Prevent ReferenceError) ---
        const Canvas = {
            el: document.getElementById('c'),
            ctx: document.getElementById('c').getContext('2d'),
            w: 0,
            h: 0,
            particles: [],
            warpMode: false, // NEW: Warp Speed Toggle

            init() {
                this.resize();
                window.addEventListener('resize', () => this.resize());
                // Create initial starfield
                const colors = ['#ff00ff', '#00ffff', '#ffff00', '#ff0000', '#00ff00', '#ffffff', '#9400d3'];
                for (let i = 0; i < 400; i++) {
                    this.particles.push({
                        x: (Math.random() - 0.5) * window.innerWidth,
                        y: (Math.random() - 0.5) * window.innerHeight,
                        z: Math.random() * 2000,
                        color: colors[Math.floor(Math.random() * colors.length)]
                    });
                }
                this.loop();
            },

            resize() {
                this.w = this.el.width = window.innerWidth;
                this.h = this.el.height = window.innerHeight;
                this.cx = this.w / 2;
                this.cy = this.h / 2;
            },

            loop() {
                // WARP SPEED LOGIC
                let bg = getComputedStyle(document.body).getPropertyValue('--bg-color');

                // Clear with slight trail for motion blur
                this.ctx.fillStyle = this.warpMode ? 'rgba(0,0,0,0.3)' : bg;
                this.ctx.fillRect(0, 0, this.w, this.h);

                // --- 1. SMOKE / NEBULA LAYER (God-Tier) ---
                if (!this.warpMode) {
                    this.ctx.globalCompositeOperation = 'screen';
                    // Procedural Nebula (Simulated with large moving gradients)
                    const time = Date.now() * 0.0005;
                    const x1 = Math.sin(time) * this.w * 0.5 + this.cx;
                    const y1 = Math.cos(time * 0.8) * this.h * 0.5 + this.cy;

                    const grad = this.ctx.createRadialGradient(x1, y1, 0, x1, y1, this.w * 0.8);
                    grad.addColorStop(0, 'rgba(139, 0, 255, 0.05)'); // Purple core
                    grad.addColorStop(0.5, 'rgba(0, 255, 255, 0.02)'); // Cyan mid
                    grad.addColorStop(1, 'transparent');

                    this.ctx.fillStyle = grad;
                    this.ctx.fillRect(0, 0, this.w, this.h);

                    // Second layer
                    const x2 = Math.cos(time * 0.5) * this.w * 0.5 + this.cx;
                    const y2 = Math.sin(time * 0.3) * this.h * 0.5 + this.cy;
                    const grad2 = this.ctx.createRadialGradient(x2, y2, 0, x2, y2, this.w * 0.6);
                    grad2.addColorStop(0, 'rgba(255, 0, 0, 0.03)'); // Red core
                    grad2.addColorStop(1, 'transparent');

                    this.ctx.fillStyle = grad2;
                    this.ctx.fillRect(0, 0, this.w, this.h);

                    this.ctx.globalCompositeOperation = 'source-over'; // Reset
                }

                // --- 2. STARFIELD ---
                // Determine speed based on state
                let speed = 2;
                if (this.warpMode) {
                    speed = 40; // HYPERSPEED
                } else if (typeof Game !== 'undefined' && Game.rewinding) {
                    speed = -40; // REVERSE
                } else if (typeof Game !== 'undefined' && Game.active) {
                    speed = 10; // GAMEPLAY
                }

                for (let i = 0; i < this.particles.length; i++) {
                    let p = this.particles[i];
                    p.z -= speed;

                    // Standard loop
                    if (p.z <= 0) {
                        p.z = 2000;
                        p.x = (Math.random() - 0.5) * this.w;
                        p.y = (Math.random() - 0.5) * this.h;
                    }
                    // Rewind loop
                    if (p.z > 2000) {
                        p.z = 1;
                        p.x = (Math.random() - 0.5) * this.w;
                        p.y = (Math.random() - 0.5) * this.h;
                    }

                    const k = 128.0 / p.z;
                    const px = p.x * k + this.cx;
                    const py = p.y * k + this.cy;

                    if (px >= 0 && px <= this.w && py >= 0 && py <= this.h) {
                        const size = (1 - p.z / 2000) * (this.warpMode ? 6 : 3);
                        const shade = parseInt((1 - p.z / 2000) * 255);

                        // God-Tier: Stars sparkle more
                        const flicker = Math.random() > 0.9 ? 1.5 : 1;

                        // Multi-colored particles
                        const alpha = Math.min(1, (1 - p.z / 2000) * flicker);

                        // Parse hex/color to apply alpha? 
                        // Simpler: use the stored color and apply globalAlpha or assume color is opaque and simple opacity usually works via globalAlpha? 
                        // Canvas fillStyle with opacity on a distinct color is tricky without parsing.
                        // Let's use globalAlpha.
                        this.ctx.globalAlpha = alpha;
                        this.ctx.fillStyle = p.color;

                        if (this.warpMode) {
                            // Draw warp lines
                            const len = (1 - p.z / 2000) * 50;
                            this.ctx.fillRect(px, py, size, size + len);
                        } else {
                            this.ctx.fillRect(px, py, size, size);
                        }
                        this.ctx.globalAlpha = 1.0; // Reset
                    }
                }

                requestAnimationFrame(() => this.loop());
            }
        };

        // MATRIX DECODE HELPER
        async function matrixDecode(element, text) {
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*";
            let iterations = 0;

            return new Promise(resolve => {
                const interval = setInterval(() => {
                    element.innerText = text
                        .split("")
                        .map((letter, index) => {
                            if (index < iterations) return text[index];
                            return chars[Math.floor(Math.random() * chars.length)];
                        })
                        .join("");

                    if (iterations >= text.length) {
                        clearInterval(interval);
                        resolve();
                    }

                    iterations += 1 / 2; // Speed of decoding
                }, 30);
            });
        }



        // STARTUP
        Canvas.init();

        // EVENT LISTENER BINDING
        document.getElementById('init-btn').addEventListener('click', () => {
            Game.startSequence();
        });

        // =========================================
        // FEEDBACK SYSTEM
        // =========================================
        const GOOGLE_FORM_URL = 'https://forms.gle/QptiuezmtJs8iFJZ9';

        function sendFeedback() {
            const btn = document.querySelector('.send-feedback-btn');

            // Visual confirmation
            btn.textContent = '✓ OPENING FORM...';
            btn.classList.add('sent');

            // Play success sound
            if (AudioSystem && AudioSystem.playCorrect) {
                AudioSystem.playCorrect();
            }

            // Open Google Form in new tab
            setTimeout(() => {
                window.open(GOOGLE_FORM_URL, '_blank');
                btn.textContent = '✓ FORM OPENED!';
            }, 300);
        }

        // Add shake animation for feedback button
        const shakeStyle = document.createElement('style');
        shakeStyle.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(shakeStyle);

        // Extra visual polish stuff

        // Heartbeat visual sync
        const HeartbeatVignetteSystem = {
            vignetteEl: null,

            init() {
                this.vignetteEl = document.getElementById('heartbeat-vignette');
            },

            pulse(bpm) {
                if (!this.vignetteEl) this.init();
                if (!this.vignetteEl) return;

                // Calculate animation speed from BPM (faster BPM = faster pulse)
                const speed = 60000 / bpm / 1000; // Convert to seconds
                this.vignetteEl.style.setProperty('--heartbeat-speed', speed + 's');

                // Trigger pulse animation
                this.vignetteEl.classList.remove('pulse');
                void this.vignetteEl.offsetWidth; // Force reflow
                this.vignetteEl.classList.add('pulse');
            },

            stop() {
                if (this.vignetteEl) {
                    this.vignetteEl.classList.remove('pulse');
                }
            }
        };

        // Override HeartbeatSystem.playBeat to sync vignette
        if (typeof HeartbeatSystem !== 'undefined') {
            const originalPlayBeat = HeartbeatSystem.playBeat;
            HeartbeatSystem.playBeat = function () {
                originalPlayBeat.call(this);
                // Sync vignette pulse with audio heartbeat
                if (this.currentBPM > 0) {
                    HeartbeatVignetteSystem.pulse(this.currentBPM);
                }
            };

            const originalStop = HeartbeatSystem.stop;
            HeartbeatSystem.stop = function () {
                originalStop.call(this);
                HeartbeatVignetteSystem.stop();
            };
        }

        // Last breath clutch mechanic - gives you half a second to save yourself
        const DeathsDoorSystem = {
            active: false,
            timeout: null,

            enter() {
                if (this.active) return;
                this.active = true;

                // Stop all sounds except allow answer clicks
                if (typeof bgMusic !== 'undefined') bgMusic.pause();
                if (typeof HeartbeatSystem !== 'undefined') HeartbeatSystem.stop();

                // Apply death's door visual
                document.body.classList.add('deaths-door');

                // Allow 500ms window for clutch save
                this.timeout = setTimeout(() => {
                    this.exit(false); // No clutch save
                }, 500);
            },

            exit(clutchSave = false) {
                if (!this.active) return;
                this.active = false;

                if (this.timeout) {
                    clearTimeout(this.timeout);
                    this.timeout = null;
                }

                document.body.classList.remove('deaths-door');

                if (clutchSave) {
                    this.celebrateClutchSave();
                } else {
                    // Proceed to game over
                    if (typeof Game !== 'undefined') {
                        Game.gameOver();
                    }
                }
            },

            celebrateClutchSave() {
                // Show clutch save overlay
                const overlay = document.getElementById('clutch-save-overlay');
                if (overlay) {
                    overlay.classList.add('active');
                    setTimeout(() => overlay.classList.remove('active'), 1500);
                }

                // Award bonus points
                if (typeof Game !== 'undefined') {
                    Game.score += 500;
                    document.getElementById('hud-score').innerText = Game.score;

                    // Show bonus feedback
                    const bonus = document.createElement('div');
                    bonus.className = 'anomaly-alert';
                    bonus.style.color = 'var(--green)';
                    bonus.innerHTML = '⚡ +500 CLUTCH BONUS ⚡';
                    document.body.appendChild(bonus);
                    setTimeout(() => bonus.remove(), 2000);
                }

                // Resume timer with small bonus
                if (typeof TimerSystem !== 'undefined') {
                    TimerSystem.timeLeft = 5; // Give 5 seconds
                    TimerSystem.update();
                    TimerSystem.frozen = false;
                }

                // Play celebration sound
                if (typeof AudioSystem !== 'undefined') AudioSystem.playCorrect();

                // Resume music
                if (typeof bgMusic !== 'undefined') {
                    bgMusic.play().catch(() => { });
                }

                // Continue to next question
                if (typeof Game !== 'undefined') {
                    Game.active = true;
                    Game.round++;
                    Game.nextRound();
                }
            },

            // Check if an answer was clicked during death's door
            checkClutch(isCorrect) {
                if (this.active && isCorrect) {
                    this.exit(true); // Clutch save!
                    return true;
                }
                return false;
            }
        };

        // Override TimerSystem to trigger death's door instead of immediate game over
        if (typeof TimerSystem !== 'undefined') {
            const originalTimerInterval = TimerSystem.start;
            TimerSystem.start = function (seconds = 15) {
                this.maxTime = seconds;
                this.timeLeft = seconds;
                this.frozen = false;
                this.update();

                if (this.interval) clearInterval(this.interval);
                this.interval = setInterval(() => {
                    if (this.frozen) return;

                    let rate = 0.1 * (typeof DifficultySystem !== 'undefined' ? DifficultySystem.getTickRate() : 1);
                    if (document.body.classList.contains('anomaly-fast')) rate *= 2;

                    this.timeLeft -= rate;
                    this.update();

                    if (this.timeLeft <= 10 && this.timeLeft > 0) {
                        if (Math.floor(this.timeLeft * 5) % 5 === 0) {
                            if (typeof AudioSystem !== 'undefined') AudioSystem.playTick();
                        }
                    }

                    // LAST BREATH: Instead of immediate game over, trigger death's door
                    if (this.timeLeft <= 0) {
                        this.stop();
                        DeathsDoorSystem.enter();
                    }
                }, 100);
            };
        }

        // Override Game.check to support clutch saves
        if (typeof Game !== 'undefined') {
            const originalGameCheck = Game.check;
            Game.check = function (ans, cor) {
                // Check if in death's door and this is a correct answer
                if (DeathsDoorSystem.active) {
                    if (ans === cor) {
                        DeathsDoorSystem.checkClutch(true);
                    } else {
                        DeathsDoorSystem.exit(false); // Wrong answer during death's door = game over
                    }
                    return;
                }

                // Normal answer check
                originalGameCheck.call(this, ans, cor);
            };
        }

        // Screen crack effect on anchor loss
        const ScreenCrackSystem = {
            crackEl: null,
            crackCount: 0,

            init() {
                this.crackEl = document.getElementById('screen-crack-overlay');
            },

            showCrack() {
                if (!this.crackEl) this.init();
                if (!this.crackEl) return;

                this.crackCount++;
                this.crackEl.classList.add('cracked');

                // Fade out after delay
                setTimeout(() => {
                    if (this.crackEl) this.crackEl.classList.remove('cracked');
                }, 2000);
            },

            reset() {
                this.crackCount = 0;
                if (this.crackEl) this.crackEl.classList.remove('cracked');
            }
        };

        // Override TimePowers.useRewind to trigger screen crack
        if (typeof TimePowers !== 'undefined') {
            const originalUseRewind = TimePowers.useRewind;
            TimePowers.useRewind = function () {
                const hadCharges = this.rewindCharges > 0;
                const result = originalUseRewind.call(this);

                // Show screen crack when losing an anchor
                if (hadCharges && result) {
                    ScreenCrackSystem.showCrack();
                }

                return result;
            };
        }







        // =============================================
        // ATTACH TOGGLE BUTTON EVENT LISTENERS
        // =============================================
        document.addEventListener('DOMContentLoaded', function () {
            console.log('🔧 Attaching toggle button event listeners...');

            const themeBtn = document.getElementById('theme-toggle-btn');

            if (themeBtn) {
                themeBtn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    console.log('🔄 Theme button clicked via event listener!');
                    toggleTheme();
                });
                console.log('✅ Theme button listener attached');
            } else {
                console.error('❌ Theme button not found!');
            }
            // Initialize +1 pop-up container (already in HTML)
            // Initialize leaderboard modal handling
            const leaderboardModal = document.getElementById('leaderboard-modal');
            const closeLeaderboardBtn = document.getElementById('close-leaderboard');
            if (closeLeaderboardBtn) {
                closeLeaderboardBtn.addEventListener('click', () => {
                    leaderboardModal.classList.add('hidden');
                });
            }
            // Function to show leaderboard (populate list from localStorage)
            function showLeaderboard() {
                const scores = JSON.parse(localStorage.getItem('neuro_fried_scores') || '[]');
                const list = document.getElementById('leaderboard-list');
                if (list) {
                    list.innerHTML = '';
                    scores.slice(0, 3).forEach((s, i) => {
                        const li = document.createElement('li');
                        li.textContent = `${i + 1}. ${s}`;
                        list.appendChild(li);
                    });
                }
                leaderboardModal.classList.remove('hidden');
            }
            // Save score function (to be called on game over)

            // Dark mode toggle implementation
            function toggleTheme() {
                const html = document.documentElement;
                const current = html.getAttribute('data-theme') || 'dark';
                const next = current === 'dark' ? 'light' : 'dark';
                html.setAttribute('data-theme', next);
            }
            // Blood drop generator (simple interval creating small divs)
            function spawnBloodDrop() {
                const container = document.getElementById('blood-drop-container');
                if (!container) return;
                const drop = document.createElement('div');
                drop.style.position = 'absolute';
                drop.style.width = '4px';
                drop.style.height = '10px';
                drop.style.background = 'rgba(139,0,0,0.7)';
                drop.style.left = Math.random() * window.innerWidth + 'px';
                drop.style.top = '-20px';
                drop.style.opacity = '0.8';
                drop.style.transform = 'rotate(' + Math.random() * 360 + 'deg)';
                container.appendChild(drop);
                // animate falling
                const duration = 2000 + Math.random() * 1000;
                drop.animate([
                    { transform: `translateY(${window.innerHeight + 20}px)` },
                    { opacity: 0 }
                ], { duration, easing: 'ease-out' });
                setTimeout(() => drop.remove(), duration);
            }
            // Start blood drops interval during gameplay
            let bloodInterval = null;
            function startBloodDrops() {
                if (bloodInterval) return;
                bloodInterval = setInterval(spawnBloodDrop, 300);
            }
            function stopBloodDrops() {
                clearInterval(bloodInterval);
                bloodInterval = null;
            }
            // BGM speed modulation
            function rampBGM() {
                if (typeof MusicSystem === 'undefined' || !MusicSystem.currentTrack) return;
                const track = MusicSystem.currentTrack;
                track.playbackRate = 0.7;
                const targetRate = 1.0;
                const step = 0.01;
                const interval = setInterval(() => {
                    if (track.playbackRate >= targetRate) {
                        clearInterval(interval);
                    } else {
                        track.playbackRate = Math.min(targetRate, track.playbackRate + step);
                    }
                }, 500);
            }
            // Hook into game start to ramp BGM
            if (typeof MusicSystem !== 'undefined') {
                MusicSystem.play = (function (orig) {
                    return function (name) {
                        orig.call(this, name);
                        if (name === 'start') rampBGM();
                    };
                })(MusicSystem.play);
            }
        });

        // =============================================
        // STORY SYSTEM - All Screen Narratives
        // =============================================
        const StorySystem = {
            stories: {
                title: [
                    { text: '"You wake up. Your head is pounding."', style: 'color:#ff4444; font-style:italic;' },
                    { text: '◉ The clock reads 60 SECONDS. It\'s counting down.', style: 'color:#ffffff;' },
                    { text: '◉ Your memories... they\'re bleeding away.', style: 'color:#ffffff; opacity:0.9;' },
                    { text: '◉ The only way out? REMEMBER. Answer correctly.', style: 'color:#ffffff; opacity:0.85;' },
                    { text: '◉ Each correct answer buys you time. Each mistake costs you.', style: 'color:#ffffff; opacity:0.8;' },
                    { text: '"Time is the only currency. And yours is running out."', style: 'color:#ff6666; font-weight:bold;' }
                ],
                fate: [
                    { text: '"The timeline fractures into three paths..."', style: 'color:#ff4444; font-style:italic;' },
                    { text: '◉ Your fate is not yours to choose.', style: 'color:#ffffff;' },
                    { text: '◉ The machine will decide.', style: 'color:#ffffff; opacity:0.9;' },
                    { text: '◉ OWN LUCK... TIME LOOP... or PARADOX?', style: 'color:#ffffff; opacity:0.85;' },
                    { text: '"Spin the wheel. Accept your destiny."', style: 'color:#ff6666; font-weight:bold;' }
                ],
                timeline: [
                    { text: '"Two paths through time. Neither is safe."', style: 'color:#ff4444; font-style:italic;' },
                    { text: '◉ Forward through history as it happened...', style: 'color:#ffffff;' },
                    { text: '◉ Or backwards, unraveling memory itself?', style: 'color:#ffffff; opacity:0.9;' },
                    { text: '"Choose wisely. Time waits for no one."', style: 'color:#ff6666; font-weight:bold;' }
                ],
                roulette: [
                    { text: '"Searching the corrupted archives..."', style: 'color:#ff4444; font-style:italic;' },
                    { text: '◉ Fragments of knowledge swirl before you.', style: 'color:#ffffff;' },
                    { text: '"Accept your topic. Or risk a reroll."', style: 'color:#ff6666; font-weight:bold;' }
                ]
            },

            playedScreens: new Set(),

            async fadeFromDarkness() {
                const overlay = document.getElementById('darkness-overlay');
                if (overlay) {
                    overlay.style.opacity = '1';
                    await new Promise(r => setTimeout(r, 100));
                    overlay.classList.add('fade-out');
                    await new Promise(r => setTimeout(r, 1000));
                }
            },

            async playStory(screenId, storyKey, controlsId) {
                if (this.playedScreens.has(screenId)) return;
                this.playedScreens.add(screenId);

                const containerId = screenId + '-story-container';
                const story = this.stories[storyKey];
                if (!story) return;

                await TypeWriter.typeLines(containerId, story);

                // --- MODIFICATION: Vanish text and wait for Title Screen ---
                if (screenId === 'title') {
                    const container = document.getElementById(containerId);
                    if (container) {
                        // Wait a moment so they realize it's done
                        await new Promise(r => setTimeout(r, 1000));

                        // Vanish
                        container.style.transition = 'opacity 1s ease';
                        container.style.opacity = '0';

                        // Wait 2-3 seconds (reduced to 1.5s for snappiness)
                        // SKIP CHECK: If skipped, minimize delay
                        const delay = TypeWriter.skipped ? 100 : 1500;
                        await new Promise(r => setTimeout(r, delay));
                    }
                }

                // Reveal controls after typing (and delay)
                if (controlsId) {
                    const controls = document.getElementById(controlsId);
                    if (controls) {
                        await new Promise(r => setTimeout(r, 400));
                        controls.style.transition = 'opacity 0.5s ease';
                        controls.style.opacity = '1';
                        controls.style.pointerEvents = 'auto';
                    }
                }

                // --- SPECIAL: VANISH FATE RULES (User Request) ---
                if (screenId === 'fate') {
                    const container = document.getElementById(containerId);
                    if (container) {
                        await new Promise(r => setTimeout(r, 1500)); // Let them read
                        container.style.transition = 'all 1s ease';
                        container.style.opacity = '0';
                        container.style.transform = 'translateY(-20px)';

                        await new Promise(r => setTimeout(r, 1000));
                        // Collapse to pull roulette up
                        container.style.display = 'none';
                    }
                }
            },

            reset() {
                this.playedScreens.clear();
            }
        };

        // CLICK TO START HANDLER
        document.getElementById('click-to-start').addEventListener('click', async function () {
            // Unlocks Audio Context immediately
            if (typeof AudioSystem !== 'undefined') {
                if (!AudioSystem.ctx) AudioSystem.init();
                AudioSystem.resume();
            }

            const startScreen = document.getElementById('click-to-start');
            if (startScreen) startScreen.classList.add('hidden'); // Immediate hide

            // --- CINEMATIC BOOT SEQUENCE ---
            const boot = document.getElementById('boot-sequence');
            const term = document.getElementById('boot-terminal');
            const logo = document.getElementById('boot-logo');

            // NOTE: Flash removed for smoothness per user request
            // const flash = document.querySelector('.boot-flash');

            if (!boot || !term || !logo) {
                console.warn("Boot elements missing, skipping sequence.");
                if (typeof StorySystem !== 'undefined') await StorySystem.playStory('title', 'title', 'init-btn');
                return;
            }

            boot.classList.remove('hidden');

            // ENGAGE WARP DRIVE
            if (typeof Canvas !== 'undefined') Canvas.warpMode = true;

            const termLines = [
                "ESTABLISHING SECURE CONNECTION...",
                "BYPASSING NEURAL FIREWALLS...",
                "SYNCHRONIZING CORTEX...",
                "ACCESS GRANTED"
            ];

            // 1. Terminal Typing (Matrix Decode)
            // 1. Terminal Typing (Fast Simple Text - No Matrix Decode)
            // User requested: "instead of that put multi colored particles"
            // The particles are the background. We just show text simply.
            for (let i = 0; i < termLines.length; i++) {
                if (typeof AudioSystem !== 'undefined' && AudioSystem.playTick) AudioSystem.playTick();
                // Simple type text
                const p = document.createElement('div');
                p.textContent = termLines[i];
                p.style.color = '#fff';
                p.style.textShadow = '0 0 5px var(--primary)';
                term.appendChild(p);
                // await matrixDecode(term, termLines[i]); // REMOVED
                await new Promise(r => setTimeout(r, 200)); // Very Short pause
            }
            // term.textContent = ""; // Keep text visible briefly? or clear?
            // User said "remove matrix effect... put particles" - we have particles.
            await new Promise(r => setTimeout(r, 500));
            term.textContent = "";

            // 2. Logo SLAM (Massive & Smooth)

            if (typeof MusicSystem !== 'undefined') MusicSystem.play('start');
            logo.classList.remove('hidden');
            logo.classList.add('slam');

            // 3. Smooth Transition (No Flash)
            await new Promise(r => setTimeout(r, 2000)); // Hold logo for 2s

            if (typeof AudioSystem !== 'undefined') AudioSystem.playCorrect();

            // Fade out boot visually
            boot.style.transition = 'opacity 1s ease';
            boot.style.opacity = '0';

            await new Promise(r => setTimeout(r, 1000));
            boot.classList.add('hidden');
            boot.style.opacity = '1'; // Reset for next time
            logo.classList.remove('slam'); // Reset animation
            logo.classList.add('hidden');

            // Turn off warp
            if (typeof Canvas !== 'undefined') Canvas.warpMode = false;

            // 4. Reveal Title
            if (typeof StorySystem !== 'undefined') await StorySystem.playStory('title', 'title', 'init-btn');
        });



        // Hook into screen transitions
        const originalShowScreen = window.showScreen || function () { };
        window.showScreen = function (screenId) {
            originalShowScreen(screenId);

            // Trigger story for specific screens
            setTimeout(async () => {
                if (screenId === 's-luck') {
                    await StorySystem.playStory('fate', 'fate', 'luck-box-container');
                } else if (screenId === 's-timeline') {
                    await StorySystem.playStory('timeline', 'timeline', 'timeline-controls');
                } else if (screenId === 's-roulette') {
                    await StorySystem.playStory('roulette', 'roulette', 'roulette-actions');
                }
            }, 300);
        };
    </script>
    <style>
        /* +1 POP-UP */
        #score-pop-container {
            position: absolute;
            pointer-events: none;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .score-pop {
            position: absolute;
            font-size: 2rem;
            color: var(--green);
            animation: popFade 1s ease-out forwards;
        }

        @keyframes popFade {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }

            100% {
                opacity: 0;
                transform: translateY(-50px) scale(1.5);
            }
        }

        /* LEADERBOARD MODAL */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .modal.hidden {
            display: none;
        }

        .modal-content {
            background: var(--glass-bg);
            padding: 20px;
            border: var(--glass-border);
            border-radius: 8px;
            color: var(--text-main);
            min-width: 200px;
        }

        #leaderboard-list {
            list-style: decimal;
            margin-left: 20px;
        }

        /* DARK MODE TOGGLE */
        .theme-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            background: var(--glass-bg);
            color: var(--text-main);
            border: var(--glass-border);
            padding: 5px 10px;
            cursor: pointer;
            z-index: 10001;
        }

        /* BLOOD DROP CONTAINER */
        #blood-drop-container {
            position: fixed;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 9994;
        }

        /* COIN LOGO ANIMATION */
        #coin-logo {
            width: 50px;
            animation: coinSpin 3s linear infinite;
        }

        @keyframes coinSpin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* REGISTER SCREEN STYLES */
        .register-box {
            background: rgba(10, 10, 15, 0.95);
            border: 2px solid var(--primary);
            box-shadow: 0 0 30px var(--primary), inset 0 0 50px rgba(0, 0, 0, 0.8);
            padding: 40px;
            width: 500px;
            max-width: 90vw;
            text-align: center;
            position: relative;
            clip-path: polygon(0 0, 100% 0, 100% 90%, 90% 100%, 0 100%);
        }

        .avatar-upload {
            width: 150px;
            height: 150px;
            border: 2px dashed var(--secondary);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            overflow: hidden;
            position: relative;
            transition: all 0.3s;
        }

        .avatar-upload:hover {
            border-color: var(--primary);
            box-shadow: 0 0 20px var(--primary);
        }

        .avatar-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        .cyber-input {
            width: 100%;
            background: transparent;
            border: none;
            border-bottom: 2px solid var(--secondary);
            color: var(--primary);
            font-family: var(--f-mono);
            font-size: 1.5rem;
            padding: 10px;
            text-align: center;
            margin-bottom: 30px;
            outline: none;
            transition: all 0.3s;
        }

        .cyber-input:focus {
            border-color: var(--primary);
            box-shadow: 0 10px 20px -10px var(--primary);
        }

        .leaderboard-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid var(--primary);
            margin-right: 10px;
            object-fit: cover;
            vertical-align: middle;
        }

        .black-glow {
            text-shadow: 0 0 10px #000, 0 0 20px #000, 0 0 30px #000, 0 0 10px #000;
        }
    </style>
    <style>
        /* NEW LEADERBOARD STYLES */
        .cyber-terminal {
            background: rgba(10, 10, 15, 0.95);
            border: 2px solid var(--primary);
            box-shadow: 0 0 30px var(--primary), inset 0 0 20px rgba(0, 0, 0, 0.8);
            color: var(--primary);
            font-family: var(--f-mono);
            width: 400px;
            max-width: 90vw;
            padding: 0;
            /* Clear padding for custom layout */
            text-align: center;
            position: relative;
            overflow: hidden;
            clip-path: polygon(0 0, 100% 0, 100% 95%, 95% 100%, 0 100%);
        }

        .cyber-terminal::before {
            /* Scanline effect */
            content: "";
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 0, 0, 0.5) 4px);
            pointer-events: none;
            z-index: 1;
        }

        .terminal-header {
            background: var(--primary);
            color: #000;
            padding: 10px;
            font-family: var(--f-title);
            font-size: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .leaderboard-container {
            padding: 20px;
        }

        #leaderboard-list {
            list-style: none;
            margin: 0;
            padding: 0;
            font-family: var(--f-mono);
            text-align: left;
        }

        #leaderboard-list li {
            font-size: 1.2rem;
            padding: 15px 10px;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #leaderboard-list li::before {
            content: ">";
            margin-right: 10px;
            color: var(--danger);
        }

        .mega-btn {
            width: 100%;
            padding: 20px;
            font-size: 1.5rem;
            font-family: var(--f-title);
            background: var(--danger);
            color: #fff;
            border: none;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.2s;
            position: relative;
            z-index: 2;
            /* Clickable above scanlines */
        }

        .mega-btn:hover {
            background: #fff;
            color: #000;
            box-shadow: 0 0 30px var(--danger);
        }
    </style>
    <script>
        // Feature functions for Neuro-Fried enhancements
        function showLeaderboard() {
            const scores = JSON.parse(localStorage.getItem('neuro_fried_scores') || '[]');
            const list = document.getElementById('leaderboard-list');
            if (list) {
                list.innerHTML = '';
                scores.slice(0, 3).forEach((s, i) => { const li = document.createElement('li'); li.textContent = `${i + 1}. ${s}`; list.appendChild(li); });
            }
            if (typeof achievementStats !== 'undefined' && typeof unlockAchievement !== 'undefined') {
                achievementStats.leaderboardOpenCount = (achievementStats.leaderboardOpenCount || 0) + 1;
                if (achievementStats.leaderboardOpenCount >= 3) unlockAchievement('social_butterfly'); // EXPANSION HOOK
            }
            document.getElementById('leaderboard-modal').classList.remove('hidden');
        }
        function saveScore(score) {
            const scores = JSON.parse(localStorage.getItem('neuro_fried_scores') || '[]');
            scores.push(score);
            scores.sort((a, b) => b - a);
            localStorage.setItem('neuro_fried_scores', JSON.stringify(scores));
        }
        function toggleTheme() {
            const html = document.documentElement;
            const cur = html.getAttribute('data-theme') || 'dark';
            html.setAttribute('data-theme', cur === 'dark' ? 'light' : 'dark');

            if (typeof achievementStats !== 'undefined' && typeof unlockAchievement !== 'undefined') {
                achievementStats.themeToggleCount = (achievementStats.themeToggleCount || 0) + 1;
                if (achievementStats.themeToggleCount >= 5) unlockAchievement('void_gazer'); // EXPANSION HOOK
            }
        }
        function spawnBloodDrop() {
            const container = document.getElementById('blood-drop-container');
            if (!container) return;
            const drop = document.createElement('div');
            drop.style.position = 'fixed';
            drop.style.width = '4px';
            drop.style.height = '10px';
            drop.style.background = 'rgba(139,0,0,0.7)';
            drop.style.left = Math.random() * window.innerWidth + 'px';
            drop.style.top = '-20px';
            drop.style.transform = 'rotate(' + Math.random() * 360 + 'deg)';
            container.appendChild(drop);
            const dur = 2000 + Math.random() * 1000;
            drop.animate([{ transform: `translateY(${window.innerHeight + 20}px)` }, { opacity: 0 }], { duration: dur, easing: 'ease-out' });
            setTimeout(() => drop.remove(), dur);
        }
        let bloodInterval = null;
        function startBloodDrops() { if (bloodInterval) return; bloodInterval = setInterval(spawnBloodDrop, 300); }
        function stopBloodDrops() { clearInterval(bloodInterval); bloodInterval = null; }
        function rampBGM() {
            if (!MusicSystem || !MusicSystem.currentTrack) return;
            const track = MusicSystem.currentTrack;
            track.playbackRate = 0.7;
            const target = 1.0; const step = 0.01;
            const int = setInterval(() => { if (track.playbackRate >= target) { clearInterval(int); } else { track.playbackRate = Math.min(target, track.playbackRate + step); } }, 500);
        }
        if (typeof MusicSystem !== 'undefined') {
            const origPlay = MusicSystem.play;
            MusicSystem.play = function (name) { origPlay.call(this, name); if (name === 'start') rampBGM(); };
        }
        // Attach theme toggle button
        const themeBtn = document.getElementById('theme-toggle-btn');
        if (themeBtn) {
            themeBtn.addEventListener('click', toggleTheme);
        }

        // Start blood drops when game starts (if Game.start exists)
        if (typeof Game !== 'undefined' && Game.start) {
            const originalStart = Game.start;
            Game.start = function () {
                originalStart.call(this);
                startBloodDrops();
            };
        }

        // Function to show +1 pop-up at given coordinates
        function showScorePop(x, y) {
            const container = document.getElementById('score-pop-container');
            if (!container) return;
            const pop = document.createElement('div');
            pop.className = 'score-pop';
            pop.textContent = '+1';
            pop.style.left = x + 'px';
            pop.style.top = y + 'px';
            container.appendChild(pop);
            setTimeout(() => pop.remove(), 1000);
        }
    </script>
    <!-- +1 pop-up container -->
    <div id="score-pop-container"></div>

    <!-- TUTORIAL TOGGLE BUTTON (Hidden initially) -->
    <button id="tutorial-toggle-btn" class="hidden" onclick="toggleTutorialPanel()">INFO</button>

    <script>
        // --- PLAYER PROFILE SYSTEM ---
        const UserProfile = {
            name: "UNKNOWN",
            photo: null,
            registered: false
        };

        function registerAndStart() {
            const nameInput = document.getElementById('reg-name');
            const name = nameInput.value.toUpperCase().trim() || "AGENT";

            UserProfile.name = name;
            UserProfile.registered = true;

            if (typeof unlockAchievement !== 'undefined') unlockAchievement('identity_verified'); // EXPANSION HOOK

            // Photo is already set by previewAvatar helper

            // Save to LocalStorage for persistence
            localStorage.setItem('neuro_fried_last_user', JSON.stringify({ name: UserProfile.name, photo: UserProfile.photo }));

            // Update UI elements immediately
            updateIdentityDisplays();

            // Hide Register Screen -> Show Luck Screen (Game Start)
            // Hide Register Screen -> Show Luck Screen (Game Start)
            const regScreen = document.getElementById('s-register');
            regScreen.classList.add('hidden');
            regScreen.classList.remove('active');

            const luckScreen = document.getElementById('s-luck');
            luckScreen.classList.remove('hidden');
            luckScreen.classList.add('active');

            // Continue start sequence
            if (typeof StorySystem !== 'undefined') StorySystem.playStory('fate', 'fate', 'luck-box-container');
        }

        function previewAvatar(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const preview = document.getElementById('reg-preview');
                    const text = document.getElementById('reg-upload-text');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    text.style.display = 'none';
                    UserProfile.photo = e.target.result; // Store base64
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function updateIdentityDisplays() {
            // Update "Agent Card" on Game Over screen
            const finalName = document.getElementById('final-name');
            const cardImg = document.getElementById('card-img');

            if (finalName) finalName.textContent = UserProfile.name;
            if (cardImg && UserProfile.photo) {
                cardImg.src = UserProfile.photo;
                cardImg.style.filter = "none"; // Remove grayscale
                cardImg.style.opacity = "1";
            }
        }

        // Intercept Game Start
        // We look for the "INITIALIZE SYSTEM" button click or similar start trigger
        // Actually, Game.startSequence is called. Let's override it or the transition to it.
        // It seems Game.startSequence switches to 's-luck'. We will intercept that.



        // Show Leaderboard with Photo
        function showLeaderboard() {
            const scores = JSON.parse(localStorage.getItem('neuro_fried_scores_v2') || '[]');
            const list = document.getElementById('leaderboard-list');
            if (list) {
                list.innerHTML = '';
                scores.slice(0, 5).forEach((item, i) => { // Top 5
                    const li = document.createElement('li');

                    let photoHtml = '';
                    if (item.photo) {
                        photoHtml = `<img src="${item.photo}" class="leaderboard-avatar">`;
                    } else {
                        photoHtml = `<div class="leaderboard-avatar" style="background:#333; display:inline-block;"></div>`;
                    }

                    li.innerHTML = `
                        <div style="display:flex; align-items:center;">
                            ${photoHtml}
                            <span>${item.name || 'UNKNOWN'}</span>
                        </div>
                        <span>${item.score}</span>
                    `;
                    list.appendChild(li);
                });
            }
            document.getElementById('leaderboard-modal').classList.remove('hidden');
        };

        // Save Score with Profile
        // Save Score with Profile
        function saveScore(score) {
            try {
                const scores = JSON.parse(localStorage.getItem('neuro_fried_scores_v2') || '[]');
                scores.push({
                    score: parseInt(score),
                    name: UserProfile.name,
                    photo: UserProfile.photo
                });
                scores.sort((a, b) => b.score - a.score);

                // Limit to top 50 to prevent overflow
                if (scores.length > 50) scores.length = 50;

                localStorage.setItem('neuro_fried_scores_v2', JSON.stringify(scores));
            } catch (e) {
                console.warn("Storage full, attempting cleanup or ignoring save", e);
                // Last ditch effort: Try to clear old V1 scores if they exist
                try {
                    localStorage.removeItem('neuro_fried_scores');
                    localStorage.setItem('neuro_fried_scores_v2', JSON.stringify([{
                        score: parseInt(score),
                        name: UserProfile.name,
                        photo: UserProfile.photo
                    }])); /* Try saving just this one */
                } catch (e2) {
                    console.error("Critical Storage Error", e2);
                }
            }
        };

        // Ensure UI is updated on load if persisted
        document.addEventListener('DOMContentLoaded', () => {
            try {
                const saved = JSON.parse(localStorage.getItem('neuro_fried_last_user'));
                if (saved) {
                    UserProfile.name = saved.name;
                    UserProfile.photo = saved.photo;
                    updateIdentityDisplays();
                }
            } catch (e) { }

            // Initialize Achievements
            loadAchievements();
        });

        /* =============================================
           ACHIEVEMENT SYSTEM - No Backend Required
           ============================================= */

        const ACHIEVEMENTS = {
            // LEVEL 1: COMMON (Bronze)
            first_blood: { id: 'first_blood', icon: '🩸', name: 'FIRST BLOOD', desc: 'Get your first correct answer', unlocked: false, tier: 'common' },
            time_lord: { id: 'time_lord', icon: '❄️', name: 'TIME LORD', desc: 'Use the Freeze ability', unlocked: false, tier: 'common' },
            temporal_paradox: { id: 'temporal_paradox', icon: '⏪', name: 'TEMPORAL PARADOX', desc: 'Use the Rewind ability', unlocked: false, tier: 'common' },
            identity_verified: { id: 'identity_verified', icon: '🆔', name: 'IDENTITY VERIFIED', desc: 'Register a Full Profile', unlocked: false, tier: 'common' },
            social_butterfly: { id: 'social_butterfly', icon: '🦋', name: 'SOCIAL BUTTERFLY', desc: 'Open the Leaderboard 3 times', unlocked: false, tier: 'common' },

            // LEVEL 2: RARE (Silver)
            hot_streak: { id: 'hot_streak', icon: '🔥', name: 'HOT STREAK', desc: 'Get 5 correct answers in a row', unlocked: false, tier: 'rare' },
            survivor: { id: 'survivor', icon: '🚑', name: 'SURVIVOR', desc: 'Win with less than 5 seconds left', unlocked: false, tier: 'rare' },
            risk_taker: { id: 'risk_taker', icon: '🎲', name: 'RISK TAKER', desc: 'Win after using Rewind 3+ times', unlocked: false, tier: 'rare' },
            void_gazer: { id: 'void_gazer', icon: '⚫', name: 'VOID GAZER', desc: 'Stare into the abyss (Toggle Theme 5x)', unlocked: false, tier: 'rare' },
            nocturnal: { id: 'nocturnal', icon: '🌑', name: 'NOCTURNAL', desc: 'Survive the Night Phase', unlocked: false, tier: 'rare' },

            // LEVEL 3: EPIC (Red/Dark)
            unstoppable: { id: 'unstoppable', icon: '🚀', name: 'UNSTOPPABLE', desc: 'Get 10 correct answers in a row', unlocked: false, tier: 'epic' },
            comeback_king: { id: 'comeback_king', icon: '👑', name: 'COMEBACK KING', desc: 'Win after time dropped below 10s', unlocked: false, tier: 'epic' },
            chrono_master: { id: 'chrono_master', icon: '⏳', name: 'CHRONO MASTER', desc: 'Use both Freeze and Rewind in one game', unlocked: false, tier: 'epic' },
            speed_demon: { id: 'speed_demon', icon: '⚡', name: 'SPEED DEMON', desc: 'Win with more than 30 seconds left', unlocked: false, tier: 'epic' },
            system_overload: { id: 'system_overload', icon: '👾', name: 'SYSTEM OVERLOAD', desc: 'You shouldn\'t be here', unlocked: false, tier: 'epic' },

            // LEGENDARY (Shining)
            neural_sync: { id: 'neural_sync', icon: '🧠', name: 'NEURAL SYNC', desc: 'Complete all questions and win', unlocked: false, tier: 'legendary' },
            perfect_mind: { id: 'perfect_mind', icon: '💎', name: 'PERFECT MIND', desc: 'Win with 0 wrong answers', unlocked: false, tier: 'legendary' },
            timeline_purist: { id: 'timeline_purist', icon: '⚔️', name: 'TIMELINE PURIST', desc: 'Win without using ANY Powers', unlocked: false, tier: 'legendary' },

            // NEW EXPANSION V2
            warp_speed: { id: 'warp_speed', icon: '⏩', name: 'WARP SPEED', desc: 'Reach 2x Score Multiplier', unlocked: false, tier: 'common' },
            ice_breaker: { id: 'ice_breaker', icon: '🌡️', name: 'THERMAL DYNAMICS', desc: 'Win without ever freezing time', unlocked: false, tier: 'rare' },
            no_looking_back: { id: 'no_looking_back', icon: '🚫', name: 'FORWARD MARCH', desc: 'Win without ever rewinding', unlocked: false, tier: 'rare' },
            mode_traveler: { id: 'mode_traveler', icon: '🗺️', name: 'DIMENSION HOPPER', desc: 'Play all 3 gamemodes in one session', unlocked: false, tier: 'rare' },
            veteran: { id: 'veteran', icon: '🎖️', name: 'VET', desc: 'Play 5 games in one session', unlocked: false, tier: 'epic' }
        };

        // Track game stats for achievements
        let achievementStats = {
            correctAnswers: 0,
            wrongAnswers: 0,
            currentStreak: 0,
            maxStreak: 0,
            freezeUsed: false,
            rewindUsed: false,
            rewindCount: 0,
            droppedBelow10: false,
            lowestTime: 60,
            // New stats
            themeToggleCount: 0,
            modesPlayed: new Set(),
            gamesPlayed: 0,
            leaderboardOpenCount: 0,
            titleClickCount: 0
        };

        function loadAchievements() {
            const saved = localStorage.getItem('neurofried_achievements');
            if (saved) {
                const parsed = JSON.parse(saved);
                Object.keys(parsed).forEach(key => {
                    if (ACHIEVEMENTS[key]) ACHIEVEMENTS[key].unlocked = parsed[key];
                });
            }
            updateAchievementCount();
        }

        function saveAchievements() {
            const toSave = {};
            Object.keys(ACHIEVEMENTS).forEach(key => {
                toSave[key] = ACHIEVEMENTS[key].unlocked;
            });
            localStorage.setItem('neurofried_achievements', JSON.stringify(toSave));
        }

        function unlockAchievement(id) {
            if (!ACHIEVEMENTS[id] || ACHIEVEMENTS[id].unlocked) return;

            ACHIEVEMENTS[id].unlocked = true;
            saveAchievements();
            showAchievementPopup(ACHIEVEMENTS[id]);
            updateAchievementCount();
            if (typeof AudioSystem !== 'undefined') AudioSystem.playBtnHover(); // Reuse hover sound as placeholder
            console.log("UNLOCKED: " + id);
        }

        function showAchievementPopup(achievement) {
            const popup = document.getElementById('achievement-popup');
            document.getElementById('ach-popup-icon').textContent = achievement.icon;
            document.getElementById('ach-popup-name').textContent = achievement.name;
            document.getElementById('ach-popup-desc').textContent = achievement.desc;

            popup.classList.add('show');
            document.body.classList.add('glitch-active');
            setTimeout(() => document.body.classList.remove('glitch-active'), 300);

            // Allow multiple popups by resetting timer if needed (simple implementation)
            setTimeout(() => popup.classList.remove('show'), 4000);
        }

        function updateAchievementCount() {
            const total = Object.keys(ACHIEVEMENTS).length;
            const unlocked = Object.values(ACHIEVEMENTS).filter(a => a.unlocked).length;

            const countEl = document.getElementById('ach-count');
            const progressEl = document.getElementById('ach-progress');

            if (countEl) countEl.textContent = `${unlocked}/${total}`;
            if (progressEl) progressEl.textContent = `${unlocked} of ${total} achievements unlocked`;
        }

        // ... helper to get tier name for display
        function getTierLabel(tier) {
            switch (tier) {
                case 'common': return 'LVL 1 - COMMON';
                case 'rare': return 'LVL 2 - RARE';
                case 'epic': return 'LVL 3 - EPIC';
                case 'legendary': return 'LEGENDARY';
                default: return '';
            }
        }

        window.openAchievements = function () { // Expose globally
            const modal = document.getElementById('ach-modal');
            const grid = document.getElementById('ach-grid');

            if (!modal || !grid) return;

            // Define Tier Order & Headers
            const tiers = ['common', 'rare', 'epic', 'legendary'];
            const tierNames = {
                'common': 'LEVEL 1 - COMMON',
                'rare': 'LEVEL 2 - RARE',
                'epic': 'LEVEL 3 - EPIC',
                'legendary': 'LEGENDARY'
            };

            let html = '';

            tiers.forEach(tier => {
                // Filter achievements for this tier
                const tierAchs = Object.values(ACHIEVEMENTS).filter(a => (a.tier || 'common') === tier);

                if (tierAchs.length > 0) {
                    // Add Section Header
                    html += `<h3 class="tier-header tier-${tier}">${tierNames[tier]}</h3>`;

                    // Add Grid for this section works better if we don't nest grids, 
                    // or we wrap them. Let's just output cards and rely on CSS or add a wrapper.
                    // The current CSS might expect a grid container. 
                    // Let's create a sub-grid or just let them flow if the main grid is flex/grid.
                    // If #ach-grid is display:grid, headers effectively break the row flow if not handled.
                    // Better approach: Use a wrapper div for the grid of cards for THIS tier.

                    html += `<div class="ach-tier-group">`;

                    tierAchs.forEach(ach => {
                        const tierLabel = getTierLabel(ach.tier || 'common');
                        html += `
                            <div class="ach-card ${ach.unlocked ? 'unlocked' : 'locked'} tier-${tier}">
                                <span class="ach-card-icon">${ach.unlocked ? ach.icon : '🔒'}</span>
                                <div class="ach-card-info">
                                    <div style="font-size:0.7rem; color:var(--text-dim); margin-bottom:2px; letter-spacing:1px;">${ach.unlocked ? tierLabel : 'LOCKED'}</div>
                                    <div class="ach-card-name">${ach.unlocked ? ach.name : '??? '}</div>
                                    <div class="ach-card-desc">${ach.unlocked ? ach.desc : 'Keep playing to unlock'}</div>
                                </div>
                            </div>
                        `;
                    });
                    html += `</div>`; // End group
                }
            });

            grid.innerHTML = html;
            modal.classList.add('show');
        };

        window.closeAchievements = function () {
            document.getElementById('ach-modal').classList.remove('show');
        };

        function resetAchievementStats() {
            // Preserve session-based stats
            const sessionModes = achievementStats.modesPlayed || new Set();
            const sessionGames = achievementStats.gamesPlayed || 0;
            const sessionThemes = achievementStats.themeToggleCount || 0;
            const sessionClicks = achievementStats.titleClickCount || 0;
            const sessionLeaderboard = achievementStats.leaderboardOpenCount || 0;

            achievementStats = {
                correctAnswers: 0,
                wrongAnswers: 0,
                currentStreak: 0,
                maxStreak: 0,
                freezeUsed: false,
                rewindUsed: false,
                rewindCount: 0,
                droppedBelow10: false,
                lowestTime: 60,
                // Restore session stats
                modesPlayed: sessionModes,
                gamesPlayed: sessionGames,
                themeToggleCount: sessionThemes,
                titleClickCount: sessionClicks,
                leaderboardOpenCount: sessionLeaderboard
            };
        }

        // =============================================
        // TIMELINE CORRUPTION SYSTEM (Game Jam Enhancement)
        // =============================================
        const TimelineIntegrity = {
            corruption: 0,
            maxCorruption: 100,
            seenQuestions: new Set(),
            loopCount: 0,

            init() {
                this.updateUI();
            },

            onRewind() {
                this.corruption += 15; // Rewind costs MORE
                this.updateUI();
                this.checkCritical();

                // Achievement hook
                if (typeof onRewindUsed !== 'undefined') onRewindUsed();
            },

            onFreeze() {
                this.corruption += 5; // Freeze costs less
                this.updateUI();
                this.checkCritical();

                // Achievement hook
                if (typeof onFreezeUsed !== 'undefined') onFreezeUsed();
            },

            checkDejaVu(questionText) {
                // Check if we've seen this question before (time loop!)
                if (this.seenQuestions.has(questionText)) {
                    this.loopCount++;
                    this.triggerDejaVu();
                    return true;
                }
                this.seenQuestions.add(questionText);
                return false;
            },

            triggerDejaVu() {
                console.log('🔁 DEJA VU DETECTED!');

                // Visual effect
                const alert = document.createElement('div');
                alert.className = 'anomaly-alert';
                alert.innerHTML = `🔁 DEJA VU<br><span style="font-size:0.8em;">Haven't I answered this before...?</span>`;
                alert.style.background = 'linear-gradient(135deg, #8b00ff, #ff00ff)';
                document.body.appendChild(alert);

                // Sound
                if (typeof AudioSystem !== 'undefined') AudioSystem.playRewind();

                // Screen flicker
                document.body.style.animation = 'glitch 0.3s';
                setTimeout(() => document.body.style.animation = '', 300);

                // Bonus time for "remembering"
                TimerSystem.addTime(10);
                Game.showTimeFeedback(10);

                // But corruption increases
                this.corruption += 10;
                this.updateUI();

                setTimeout(() => alert.remove(), 3000);
            },

            updateUI() {
                const fill = document.getElementById('corruption-fill');
                const text = document.getElementById('corruption-text');
                const warning = document.getElementById('corruption-warning');

                if (!fill || !text) return;

                // Update bar
                fill.style.width = `${this.corruption}%`;
                text.textContent = `${Math.floor(this.corruption)}% CORRUPTED`;

                // Color shift based on severity
                if (this.corruption < 30) {
                    fill.style.boxShadow = '0 0 10px rgba(139, 0, 255, 0.8)';
                } else if (this.corruption < 60) {
                    fill.style.boxShadow = '0 0 15px rgba(255, 0, 255, 0.9)';
                } else {
                    fill.style.boxShadow = '0 0 20px rgba(255, 0, 0, 1)';
                }

                // Warning at high corruption
                if (this.corruption >= 75 && warning) {
                    warning.style.opacity = '1';
                    warning.style.animation = 'blink 0.5s infinite';
                }
            },

            checkCritical() {
                if (this.corruption >= 100) {
                    // TIMELINE COLLAPSE - Bad Ending
                    this.triggerTimelineCollapse();
                } else if (this.corruption >= 75) {
                    // Reality fracturing effects
                    this.triggerRealityFracture();
                }
            },

            triggerRealityFracture() {
                console.log('⚠️ REALITY FRACTURING');

                // Screen border cracks
                const crackEl = document.getElementById('screen-crack-overlay');
                if (crackEl) {
                    crackEl.classList.add('cracked');
                }

                // Questions start glitching
                const qText = document.getElementById('q-text');
                if (qText && Math.random() > 0.5) {
                    qText.style.animation = 'glitchText 0.3s infinite';
                    setTimeout(() => qText.style.animation = '', 1000);
                }
            },

            triggerTimelineCollapse() {
                console.log('💥 TIMELINE COLLAPSED');
                Game.active = false;
                TimerSystem.stop();

                // Update final score before showing ending
                if (typeof Game !== 'undefined') {
                    document.getElementById('final-aura-score').textContent = Game.score;
                }

                // Hide game screens
                document.getElementById('hud').classList.add('hidden');
                document.getElementById('s-game').classList.add('hidden');
                document.getElementById('s-game-paradox').classList.add('hidden');

                // Show collapse ending, which will then show game over
                setTimeout(() => {
                    this.showEnding('collapse');
                }, 500);
            },

            showEnding(type) {
                // Determine ending based on corruption level and usage
                let endingData = {};

                if (type === 'collapse' || this.corruption >= 100) {
                    endingData = {
                        title: 'TIMELINE COLLAPSED',
                        message: 'Reality shattered beyond repair.<br>You are trapped in an endless loop.',
                        color: '#ff0000',
                        class: 'collapse'
                    };
                } else if (!achievementStats.freezeUsed && !achievementStats.rewindUsed) {
                    endingData = {
                        title: 'PURE SYNC ACHIEVED',
                        message: 'You saved history without bending time.<br>The timeline thanks you.',
                        color: '#00ff00',
                        class: 'pure'
                    };
                } else if (this.corruption < 50) {
                    endingData = {
                        title: 'NEURAL SYNC COMPLETE',
                        message: 'You bent time but didn\'t break it.<br>Reality stabilized.',
                        color: '#0ff',
                        class: 'balanced'
                    };
                } else {
                    endingData = {
                        title: 'FRACTURED REALITY',
                        message: 'Timeline scarred but holding.<br>You survived... for now.',
                        color: '#ff00ff',
                        class: 'fractured'
                    };
                }

                // UPDATE GAME OVER SCREEN STATS (populate immediately)
                const corruptionEl = document.getElementById('final-corruption');
                const loopsEl = document.getElementById('final-loops');
                const powersEl = document.getElementById('final-powers');
                const endingBadge = document.getElementById('final-ending-badge');

                if (corruptionEl) corruptionEl.textContent = `${Math.floor(this.corruption)}%`;
                if (loopsEl) loopsEl.textContent = this.loopCount;
                if (powersEl) powersEl.textContent = achievementStats.rewindCount + (achievementStats.freezeUsed ? 1 : 0);
                if (endingBadge) {
                    endingBadge.textContent = `ENDING: ${endingData.title}`;
                    endingBadge.style.color = endingData.color;
                }

                // Create temporary ending overlay (will auto-remove)
                const overlay = document.createElement('div');
                overlay.id = 'timeline-ending-overlay';
                overlay.style.cssText = `
                    position: fixed;
                    inset: 0;
                    background: rgba(0,0,0,0.95);
                    z-index: 99999;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    opacity: 0;
                    transition: opacity 0.8s;
                `;

                overlay.innerHTML = `
                    <div style="font-family: var(--f-title); font-size: 3rem; color: ${endingData.color};
                                text-shadow: 0 0 30px ${endingData.color}; margin-bottom: 30px;
                                animation: pulsate 2s infinite;">
                        ${endingData.title}
                    </div>
                    <div style="font-family: var(--f-mono); font-size: 1.2rem; color: white;
                                text-align: center; max-width: 600px; line-height: 1.8;">
                        ${endingData.message}
                    </div>
                    <div style="margin-top: 40px; font-family: var(--f-mono); font-size: 0.9rem; color: #888;">
                        Timeline Corruption: ${Math.floor(this.corruption)}%<br>
                        Loops Detected: ${this.loopCount}<br>
                        Time Powers Used: ${achievementStats.rewindCount + (achievementStats.freezeUsed ? 1 : 0)}
                    </div>
                `;

                document.body.appendChild(overlay);
                setTimeout(() => overlay.style.opacity = '1', 100);

                // Auto-remove overlay after 3 seconds and show game over screen
                setTimeout(() => {
                    overlay.style.opacity = '0';
                    setTimeout(() => {
                        overlay.remove();
                        // Trigger the game over screen
                        if (typeof Game !== 'undefined' && typeof Game.runOutroSequence === 'function') {
                            Game.runOutroSequence();
                        }
                    }, 800);
                }, 3000);
            },

            reset() {
                this.corruption = 0;
                this.seenQuestions.clear();
                this.loopCount = 0;
                this.updateUI();
            }
        };

        // Initialize on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => TimelineIntegrity.init());
        } else {
            TimelineIntegrity.init();
        }

        // HOOKS
        function onCorrectAnswer() {
            achievementStats.correctAnswers++;
            achievementStats.currentStreak++;
            achievementStats.maxStreak = Math.max(achievementStats.maxStreak, achievementStats.currentStreak);

            if (achievementStats.correctAnswers === 1) unlockAchievement('first_blood');
            if (achievementStats.currentStreak >= 5) unlockAchievement('hot_streak');
            if (achievementStats.currentStreak >= 10) unlockAchievement('unstoppable');

            // WARP SPEED check
            if (Game.multiplier >= 2) unlockAchievement('warp_speed');
        }

        function onWrongAnswer() {
            achievementStats.wrongAnswers++;
            achievementStats.currentStreak = 0;
        }

        function onFreezeUsed() {
            achievementStats.freezeUsed = true;
            unlockAchievement('time_lord');
            if (achievementStats.freezeUsed && achievementStats.rewindUsed) unlockAchievement('chrono_master');
        }

        function onRewindUsed() {
            achievementStats.rewindUsed = true;
            achievementStats.rewindCount++;
            unlockAchievement('temporal_paradox');
            if (achievementStats.freezeUsed && achievementStats.rewindUsed) unlockAchievement('chrono_master');
        }

        function onTimerUpdateAC(currentTime) {
            achievementStats.lowestTime = Math.min(achievementStats.lowestTime, currentTime);
            if (currentTime < 10) achievementStats.droppedBelow10 = true;
        }

        function onGameWinAC(finalTime) {
            unlockAchievement('neural_sync');
            if (finalTime <= 5) unlockAchievement('survivor');
            if (finalTime >= 30) unlockAchievement('speed_demon');
            if (achievementStats.wrongAnswers === 0) unlockAchievement('perfect_mind');
            if (achievementStats.rewindCount >= 3) unlockAchievement('risk_taker');
            if (achievementStats.droppedBelow10) unlockAchievement('comeback_king');

            // EXPANSION HOOKS
            if (!achievementStats.freezeUsed && !achievementStats.rewindUsed) unlockAchievement('timeline_purist');

            // NEW EXPANSION V2 HOOKS
            if (!achievementStats.freezeUsed) unlockAchievement('ice_breaker');
            if (!achievementStats.rewindUsed) unlockAchievement('no_looking_back');

            // Check Nocturnal (Check DuelMode or Game state)
            const nightTriggered = (typeof DuelMode !== 'undefined' && DuelMode.nightTriggered) || (typeof Game !== 'undefined' && Game.nightTriggered);
            if (nightTriggered) unlockAchievement('nocturnal');
        }

        // System Overload Click Handler
        function handleTitleClick() {
            achievementStats.titleClickCount = (achievementStats.titleClickCount || 0) + 1;
            if (achievementStats.titleClickCount >= 10) unlockAchievement('system_overload');
        }

    </script>

    <!-- Leaderboard modal -->
    <div id="leaderboard-modal" class="modal hidden">
        <div class="modal-content cyber-terminal">
            <div class="terminal-header">
                <span>/// SYSTEM_ARCHIVE</span>
                <span class="blink">LIVE</span>
            </div>
            <div class="leaderboard-container">
                <ol id="leaderboard-list"></ol>
            </div>
            <button id="close-leaderboard" class="mega-btn">CLOSE DATABASE</button>
        </div>
    </div>



    <!-- Blood drops container -->
    <div id="blood-drop-container"></div>

    <!-- Coin logo in header -->
    <header id="game-header">
        <div style="display: flex; align-items: center; gap: 15px;">
            <img src="coin.png" alt="Coin Logo" id="coin-logo" class="coin-spin">
            <div style="display: flex; flex-direction: column;">
                <h1 class="black-glow" onclick="if(typeof handleTitleClick === 'function') handleTitleClick()"
                    style="font-family: var(--f-title); font-size: 2rem; color: var(--primary); margin: 0; line-height: 1; cursor: pointer;">
                    NEURO FRIED</h1>
                <span style="font-family: var(--f-mono); font-size: 0.8rem; color: #888;">DEV: Kaustav
                    Chowdhury</span>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
            <button id="theme-toggle-btn" class="tech-btn" style="padding: 5px 15px; font-size: 1.2rem;">🎨</button>
            <!-- Buttons moved to footer -->
        </div>
    </header>
    <!-- ACHIEVEMENT SYSTEM -->
    <style>
        /* =============================================
           ACHIEVEMENT SYSTEM - Horror Themed
           ============================================= */

        /* Achievement Notification Popup */
        .achievement-popup {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 100001;
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 0 30px var(--primary), inset 0 0 20px rgba(255, 0, 0, 0.1);
        }

        .achievement-popup.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* VIOLET OVERLAYS (User Request) */
        :root {
            --violet: #bc13fe;
            --violet-glow: #bd00ff;
            --violet-dim: #e0b0ff;
        }

        /* Rules Overlay */
        .rules-card {
            border-color: var(--violet) !important;
            box-shadow: 0 0 50px rgba(188, 19, 254, 0.4) !important;
        }

        .rules-title {
            color: var(--violet) !important;
            text-shadow: 0 0 20px var(--violet) !important;
            border-bottom-color: var(--violet) !important;
        }

        /* History / Inception Protocol / Story */
        .story-line {
            color: var(--violet-dim) !important;
            text-shadow: 0 0 10px var(--violet) !important;
        }

        .protocol-container .protocol-trigger {
            color: var(--violet) !important;
            text-shadow: 0 0 10px var(--violet) !important;
            border-color: var(--violet) !important;
        }

        /* Start Screen / Tutorial */
        .click-to-start .start-text {
            color: var(--violet) !important;
            text-shadow: 0 0 30px var(--violet) !important;
        }

        .click-to-start .start-subtext {
            color: var(--violet-dim) !important;
        }


        .achievement-popup.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .achievement-popup .ach-icon {
            font-size: 2.5rem;
            animation: achievePulse 0.5s ease-out;
        }

        .achievement-popup .ach-info {
            display: flex;
            flex-direction: column;
        }

        .achievement-popup .ach-title {
            font-family: var(--f-title);
            font-size: 0.75rem;
            color: var(--primary);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .achievement-popup .ach-name {
            font-family: var(--f-title);
            font-size: 1.1rem;
            color: #fff;
            margin-top: 2px;
        }

        .achievement-popup .ach-desc {
            font-family: var(--f-mono);
            font-size: 0.85rem;
            color: var(--text-dim);
            margin-top: 4px;
        }

        @keyframes achievePulse {
            0% {
                transform: scale(0) rotate(-180deg);
            }

            50% {
                transform: scale(1.3) rotate(10deg);
            }

            100% {
                transform: scale(1) rotate(0deg);
            }
        }

        /* Achievement Gallery Button */
        .ach-gallery-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 320px;
            /* Fixed width for uniformity */
            height: 60px;
            /* Fixed height */
            padding: 0;
            box-sizing: border-box;
            /* Include padding/border in width */
            border-radius: 50px;
            /* Pill shape */
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid var(--primary);
            color: var(--primary);
            font-size: 1.2rem;
            font-family: var(--f-title);
            /* Use title font */
            letter-spacing: 2px;
            cursor: pointer;
            z-index: 9999;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Center content */
            gap: 15px;
            /* Consistent gap */
            text-transform: uppercase;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
            /* Initial glow */
        }

        .ach-gallery-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px var(--primary);
            background: var(--primary);
            color: #000;
        }

        /* Leaderboard Button - At the Header (Top Right) */
        .leaderboard-btn {
            position: fixed;
            top: 30px;
            /* Moved to Header */
            right: 30px;
            width: 320px;
            /* Fixed width for uniformity */
            height: 60px;
            /* Fixed height */
            padding: 0;
            box-sizing: border-box;
            /* Include padding/border in width */
            border-radius: 50px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid var(--primary);
            /* Ditto Color (Cyan) */
            color: var(--primary);
            font-size: 1.2rem;
            font-family: var(--f-title);
            letter-spacing: 2px;
            cursor: pointer;
            z-index: 9999;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Center content */
            gap: 15px;
            /* Consistent gap */
            text-transform: uppercase;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
            /* Ditto Glow */
        }

        .leaderboard-btn:hover {
            transform: scale(1.05);
            /* Gentle zoom */
            box-shadow: 0 0 20px var(--primary);
            background: var(--primary);
            color: #000;
        }

        /* Mobile Responsive Buttons */
        @media (max-width: 768px) {

            .ach-gallery-btn,
            .leaderboard-btn {
                width: 60px !important;
                /* Shrink to circle */
                padding: 0 !important;
                border-radius: 50% !important;
                font-size: 0 !important;
                /* Hide text */
                gap: 0 !important;
            }

            /* Show Icon */
            .ach-gallery-btn span:first-child,
            .leaderboard-btn span:first-child {
                font-size: 1.5rem !important;
                margin: 0 !important;
            }

            /* Hide Count and Text labels */
            .ach-gallery-btn .ach-count {
                position: absolute !important;
                top: -5px !important;
                right: -5px !important;
                font-size: 0.7rem !important;
                background: var(--danger);
                display: block !important;
            }
        }

        .ach-gallery-btn .ach-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: #fff;
            font-size: 0.7rem;
            font-family: var(--f-title);
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        /* Achievement Gallery Modal */
        .ach-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 100002;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .ach-modal.show {
            display: flex;
        }

        .ach-modal-content {
            background: var(--glass-bg);
            border: var(--glass-border);
            border-radius: 16px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(255, 0, 0, 0.3);
        }

        .ach-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 0, 0, 0.3);
        }

        .ach-modal-title {
            font-family: var(--f-title);
            font-size: 1.5rem;
            color: var(--primary);
            letter-spacing: 3px;
        }

        .ach-modal-close {
            background: none;
            border: none;
            color: var(--text-dim);
            font-size: 2rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .ach-modal-close:hover {
            color: var(--danger);
        }

        .ach-progress-text {
            font-family: var(--f-mono);
            color: var(--text-dim);
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        /* REVERTED COIN (CSS ONLY) */
        .retro-coin {
            width: 24px;
            height: 24px;
            background: #ffd700;
            border-radius: 50%;
            box-shadow: 0 0 10px #ffaa00;
            display: inline-block;
            vertical-align: middle;
        }

        /* REVERTED LOGO TITLE (CSS ONLY) */
        .glitch-title {
            font-family: var(--f-title);
            font-size: 6.5rem;
            color: #fff;
            text-shadow: 0 0 20px var(--primary), 0 0 40px var(--primary);
            letter-spacing: 5px;
            text-align: center;
            margin-bottom: 20px;
            animation: logoGlitch 3s infinite;
        }

        /* DEFAULT BACKGROUNDS (CSS ONLY) */
        #click-to-start,
        #s-luck,
        #s-register,
        #s-roulette,
        #s-game,
        #s-game-paradox,
        #s-over,
        #s-outro,
        #victory-screen {
            background: radial-gradient(circle at center, #111 0%, #000 100%) !important;
            background-size: cover;
        }

        #s-game {
            background: radial-gradient(circle at center, #1a0b2e 0%, #000000 100%) !important;
        }

        /* Remove Image Button Styles - Fallback to .tech-btn default */
        .ach-grid {
            /* Changed to flex column for sectioned layout */
            display: flex;
            flex-direction: column;
            gap: 30px;
            padding-bottom: 20px;
        }

        .ach-tier-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .tier-header {
            font-family: var(--f-title);
            font-size: 1.2rem;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Tier Header Colors */
        .tier-header.tier-common {
            color: #cd7f32;
            border-color: #cd7f32;
            text-shadow: 0 0 10px rgba(205, 127, 50, 0.5);
        }

        .tier-header.tier-rare {
            color: #00f3ff;
            border-color: #00f3ff;
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
        }

        .tier-header.tier-epic {
            color: #ff003c;
            border-color: #ff003c;
            text-shadow: 0 0 10px rgba(255, 0, 60, 0.5);
        }

        .tier-header.tier-legendary {
            color: #ffd700;
            border-color: #ffd700;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
        }

        /* Mobile adjust */
        @media (max-width: 600px) {
            .ach-tier-group {
                grid-template-columns: 1fr;
            }
        }


        .ach-card {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(100, 100, 100, 0.3);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            opacity: 0.4;
            filter: grayscale(100%);
        }

        .ach-card.unlocked {
            opacity: 1;
            filter: grayscale(0%);
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.2);
        }

        .ach-card .ach-card-icon {
            font-size: 2rem;
            min-width: 50px;
            text-align: center;
        }

        .ach-card .ach-card-info {
            flex: 1;
        }

        .ach-card .ach-card-name {
            font-family: var(--f-title);
            font-size: 0.9rem;
            color: #fff;
            margin-bottom: 4px;
        }

        .ach-card .ach-card-desc {
            font-family: var(--f-mono);
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        .ach-card.locked .ach-card-icon {
            filter: blur(2px);
        }

        /* Mobile Responsive */
        @media (max-width: 600px) {
            .ach-modal-content {
                padding: 20px;
            }

            .ach-grid {
                grid-template-columns: 1fr;
            }

            .achievement-popup {
                width: 90%;
                padding: 12px 15px;
            }

            .achievement-popup .ach-icon {
                font-size: 2rem;
            }
        }

        /* Freeze and Rewind Button Positioning */
        .big-freeze-btn {
            position: fixed;
            right: 40px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 60;
        }

        .btn-hud-rewind {
            position: fixed;
            left: 40px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 60;
        }

        /* VIDEO EXPANSION STYLES */
        /* VIDEO EXPANSION STYLES REMOVED FOR HUD */
        .big-freeze-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            min-width: 140px;
            overflow: hidden;
            /* Positioning is handled by previous rules */
        }

        .big-freeze-btn:hover {
            /* Stable Hover */
            transform: translateY(-50%);
            /* Start stable, no scale */
            /* background: transparent; Keep transparent or original */
            border-color: var(--primary);
            box-shadow: 0 0 15px var(--primary);
            /* z-index: 10001; No need to bring to front if not expanding */
        }

        .video-preview {
            width: 100%;
            height: 0;
            opacity: 0;
            transition: all 0.4s ease;
            overflow: hidden;
            border-radius: 4px;
            margin-bottom: 0;
            background: #000;
        }

        .big-freeze-btn:hover .video-preview {
            height: 140px;
            opacity: 1;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .video-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .btn-label-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        /* Game Over Screen Elements Default Positioning */
        .share-card-wrapper {
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
        }

        .controls-panel {
            position: fixed;
            right: 50px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 100;
        }

        .share-message-box {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
        }

        .game-over-controls {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
        }
    </style>

    <!-- Achievement Notification Popup -->
    <div class="achievement-popup" id="achievement-popup">
        <span class="ach-icon" id="ach-popup-icon">🏆</span>
        <div class="ach-info">
            <span class="ach-title">ACHIEVEMENT UNLOCKED</span>
            <span class="ach-name" id="ach-popup-name">First Blood</span>
            <span class="ach-desc" id="ach-popup-desc">Answer your first question correctly</span>
        </div>
    </div>

    <!-- Leaderboard Button -->
    <button class="leaderboard-btn" onclick="showLeaderboard()">
        <span style="font-size: 1.5rem;">🌍</span>
        LEADERBOARD
    </button>

    <!-- Achievement Gallery Button -->
    <button class="ach-gallery-btn" id="open-ach-btn" onclick="openAchievements()">
        <span style="font-size: 1.5rem;">🏆</span>
        NEURAL ARCHIVE
        <span class="ach-count" id="ach-count"
            style="position: static; background: var(--danger); font-size: 0.8rem; padding: 2px 8px; border-radius: 4px; min-width: auto;">0/23</span>
    </button>

    <!-- Achievement Gallery Modal -->
    <div class="ach-modal" id="ach-modal">
        <div class="ach-modal-content">
            <div class="ach-modal-header">
                <h2 class="ach-modal-title">⚡ NEURAL ACHIEVEMENTS ⚡</h2>
                <button class="ach-modal-close" onclick="closeAchievements()">×</button>
            </div>
            <p class="ach-progress-text" id="ach-progress">0 of 17 achievements unlocked</p>
            <div class="ach-grid" id="ach-grid">
                <!-- Achievements populated by JS -->
            </div>
        </div>
    </div>

    <!-- CAPTURE MODAL -->
    <div id="capture-modal" class="modal-overlay hidden"
        style="z-index: 20000; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center;">
        <div class="modal-box"
            style="width: 500px; max-width: 90vw; background: #111; border: 2px solid var(--primary); padding: 20px; text-align: center; position: relative; box-shadow: 0 0 50px var(--primary);">
            <h2 style="font-family: var(--f-title); color: var(--primary); margin-top: 0;">MEMORY CAPTURED</h2>
            <div id="capture-preview-cont"
                style="margin: 20px 0; border: 1px solid #333; min-height: 200px; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                <!-- Image goes here -->
            </div>
            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button class="tech-btn" onclick="shareCaptureImage()"
                    style="border-color: var(--green); color: var(--green);">📤 SHARE</button>
                <button class="tech-btn" onclick="downloadCaptureImage()"
                    style="border-color: var(--secondary); color: var(--secondary);">💾 DOWNLOAD</button>
                <button class="tech-btn" onclick="closeCaptureModal()" style="border-color: #666; color: #aaa;">✖
                    CLOSE</button>
            </div>
        </div>
    </div>

    <script>
        /* AUTO FULLSCREEN ON FIRST INTERACTION */
        document.addEventListener('click', function () {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log(`Error attempting to enable full-screen: ${err.message}`);
                });
            }
        }, { once: true });
    </script>
    <script>
        // Neural Interface Tilt System
        const TiltSystem = {
            target: { x: 0, y: 0 },
            current: { x: 0, y: 0 },
            smoothing: 0.4, // Increased from 0.08 for snappier, mouse-matched feel
            baseScale: 1,

            init() {
                this.tiltLayer = document.getElementById('game-tilt-layer');
                this.hud = document.getElementById('neural-hud-overlay');

                if (!this.tiltLayer) return;

                document.addEventListener('mousemove', (e) => this.handleMove(e));
                window.addEventListener('resize', () => this.handleResize());

                // Initial size check
                this.handleResize();
                this.loop();
            },

            handleResize() {
                // Target "Safe Resolution" is roughly 1200x800 for desktops.
                // We scale down if the window is smaller to ensure everything fits.
                const safeW = 1200;
                const safeH = 800;
                const winW = window.innerWidth;
                const winH = window.innerHeight;

                const scaleW = winW / safeW;
                const scaleH = winH / safeH;

                // Use the smaller scale factor to ensure it fits both dimensions
                // Cap at 1.0 to avoid upscaling blur, but allow shrinking.
                // Actually, let's allow slight upscaling (1.2) for large 4k screens
                this.baseScale = Math.min(Math.min(scaleW, scaleH), 1.2);
            },

            handleMove(e) {
                // Normalize coordinates (-1 to 1)
                this.target.x = (e.clientX / window.innerWidth) * 2 - 1;
                this.target.y = (e.clientY / window.innerHeight) * 2 - 1;
            },

            lerp(start, end, factor) {
                return start + (end - start) * factor;
            },

            loop() {
                this.current.x = this.lerp(this.current.x, this.target.x, this.smoothing);
                this.current.y = this.lerp(this.current.y, this.target.y, this.smoothing);

                const rotX = -this.current.y * 8;
                const rotY = this.current.x * 8;

                // Combine Base Fit Scale with Tilt Scale (1.05)
                const finalScale = this.baseScale * 1.05;

                this.tiltLayer.style.transform = `rotateX(${rotX.toFixed(2)}deg) rotateY(${rotY.toFixed(2)}deg) scale(${finalScale.toFixed(3)})`;

                if (this.hud) {
                    const hudX = -this.current.x * 25;
                    const hudY = -this.current.y * 25;
                    this.hud.style.transform = `translate(${hudX.toFixed(2)}px, ${hudY.toFixed(2)}px)`;
                }

                requestAnimationFrame(() => this.loop());
            }
        };

        // Initialize when DOM is ready (script is at end of body so immediate is fine)
        TiltSystem.init();
    </script>
    <script>
        let capturedBlob = null;

        async function initiateCapture() {
            const card = document.querySelector('.share-card');
            if (!card) return;

            const btn = event.target;
            const oldText = btn.innerHTML;
            btn.innerHTML = "PROCESSING...";
            btn.disabled = true;

            try {
                const canvas = await html2canvas(card, {
                    backgroundColor: '#000000',
                    scale: 3,
                    logging: false,
                    useCORS: true,
                    allowTaint: true
                });

                // Show Modal
                const modal = document.getElementById('capture-modal');
                const prev = document.getElementById('capture-preview-cont');

                prev.innerHTML = '';
                const img = new Image();
                img.src = canvas.toDataURL('image/png');
                img.style.maxWidth = '100%';
                img.style.boxShadow = '0 0 20px rgba(0,0,0,0.5)';
                prev.appendChild(img);

                // Store blob for sharing
                canvas.toBlob(blob => {
                    capturedBlob = blob;
                    modal.classList.remove('hidden'); // Assuming style attribute handles flex display
                    modal.style.display = 'flex';

                    btn.innerHTML = oldText;
                    btn.disabled = false;
                });

            } catch (e) {
                console.error(e);
                btn.innerHTML = "❌ ERROR";
                setTimeout(() => { btn.innerHTML = oldText; btn.disabled = false; }, 2000);
            }
        }

        function closeCaptureModal() {
            document.getElementById('capture-modal').style.display = 'none';
        }

        function downloadCaptureImage() {
            if (!capturedBlob) return;
            const link = document.createElement('a');
            link.download = `NEURO_FRIED_MEMORY_${Date.now()}.png`;
            link.href = URL.createObjectURL(capturedBlob);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        async function shareCaptureImage() {
            if (!capturedBlob) return;

            try {
                if (navigator.share && navigator.canShare) {
                    const file = new File([capturedBlob], 'neuro-fried-score.png', { type: 'image/png' });
                    if (navigator.canShare({ files: [file] })) {
                        await navigator.share({
                            files: [file],
                            title: 'NEURO-FRIED SCORE',
                            text: 'I survived the paradox. Beat my score!'
                        });
                        return;
                    }
                }
                // Fallback / Desktop behavior
                alert("Sharing not supported on this device/browser. Image downloaded instead!");
                downloadCaptureImage();
            } catch (err) {
                console.log("Share skipped/failed", err);
            }
        }
        /* Graphics Settings */
        let graphicsQuality = 'high';
        function toggleGraphics() {
            graphicsQuality = graphicsQuality === 'high' ? 'low' : 'high';
            const doc = document.documentElement;
            if (graphicsQuality === 'low') {
                document.body.style.setProperty('--glass-blur', 'blur(0px)');
                document.querySelectorAll('.blood-veins, .blood-drip, .scanlines').forEach(el => el.style.display = 'none');
                document.querySelector('#graphics-toggle').innerText = '⚡';
            } else {
                document.body.style.setProperty('--glass-blur', 'blur(30px)');
                document.querySelectorAll('.blood-veins, .blood-drip, .scanlines').forEach(el => el.style.display = '');
                document.querySelector('#graphics-toggle').innerText = '✨';
            }
        }

        let safeMode = false;
        function toggleSafeMode() {
            safeMode = !safeMode;
            if (safeMode) {
                document.body.style.setProperty('--horror-shake-disabled', '1');
                const style = document.createElement('style');
                style.id = 'safe-mode-override';
                style.textContent = `
                .horror-shake, .glitch-active, body.paradox-hit { animation: none !important; }
                @keyframes horrorShake { 0%, 100% { transform: translate(0); } }
                @keyframes glitchScreen { 0%, 100% { transform: skewX(0); filter: none; } }
            `;
                document.head.appendChild(style);
                document.querySelector('#safe-mode-toggle').innerText = '🛡️';
                alert('✅ SAFE MODE: Reduced motion enabled');
            } else {
                document.getElementById('safe-mode-override')?.remove();
                document.querySelector('#safe-mode-toggle').innerText = '👁️';
            }
        }

        /* First Time Boot Tutorial */
        if (!localStorage.getItem('neuro-fried-played')) {
            setTimeout(() => {
                const tutorial = document.createElement('div');
                tutorial.id = 'boot-tutorial';
                tutorial.style.cssText = `
                position: fixed; inset: 0; z-index: 100000;
                background: rgba(0,0,0,0.95);
                display: flex; flex-direction: column;
                justify-content: center; align-items: center;
                padding: 40px; text-align: center;
                font-family: var(--f-mono);
            `;

                tutorial.innerHTML = `
                <div style="max-width: 600px; border: 1px solid var(--primary); padding: 30px; border-radius: 10px; background: rgba(0,20,0,0.8);">
                    <h1 style="color: var(--primary); font-size: 2.5rem; margin-bottom: 20px;">
                        NEURAL INTERFACE BOOT
                    </h1>
                    <div style="text-align: left; color: #aaa; line-height: 1.8; margin-bottom: 30px;">
                        <p>⏱️ <strong>TIMER</strong>: Answer fast. Time = Life.</p>
                        <p>🎯 <strong>STREAK</strong>: Chain answers for multiplier.</p>
                        <p>⏪ <strong>REWIND</strong>: Press R when time runs out.</p>
                        <p>❄️ <strong>FREEZE</strong>: Press SPACE to pause timer.</p>
                        <p>🔥 <strong>BOSS NODES</strong>: Every 5th question = 2x speed!</p>
                    </div>
                    <button class="tech-btn" onclick="this.parentElement.parentElement.remove(); localStorage.setItem('neuro-fried-played', '1');">
                        BEGIN SYNC
                    </button>
                </div>
            `;
                document.body.appendChild(tutorial);
            }, 2000);
        }
        /* BOSS MODE LOGIC INJECTION */
        (function () {
            if (typeof Game === 'undefined' || typeof TimerSystem === 'undefined') return;

            const originalNextRound = Game.nextRound;
            Game.nextRound = function () {
                if (this.round >= this.qData.length) {
                    originalNextRound.call(this);
                    return;
                }

                const isBossNode = (this.round + 1) % 5 === 0;
                if (isBossNode) {
                    document.body.style.setProperty('--primary', '#00ff00');
                    document.body.style.setProperty('--glass-bg', 'rgba(0, 20, 0, 0.9)');

                    // Check if alert exists
                    if (!document.querySelector('.boss-alert')) {
                        const bossAlert = document.createElement('div');
                        bossAlert.className = 'boss-alert';
                        bossAlert.innerHTML = '🔥 <strong>DATA BREACH</strong> 🔥<br>RAPID RESPONSE REQUIRED';
                        bossAlert.style.cssText = `
                        position: fixed; top: 30%; left: 50%; transform: translate(-50%, -50%);
                        color: #00ff00; border: 2px solid #00ff00; padding: 20px;
                        background: rgba(0,0,0,0.95); z-index: 20000;
                        text-align: center; font-family: var(--f-mono); font-size: 1.5rem;
                        box-shadow: 0 0 50px #00ff00;
                        animation: glitch-anim 0.2s infinite;
                    `;
                        document.body.appendChild(bossAlert);
                        setTimeout(() => bossAlert.remove(), 2500);
                    }

                    TimerSystem.bossMode = true;
                    if (typeof AudioSystem !== 'undefined') AudioSystem.playWrong();
                } else {
                    document.body.style.setProperty('--primary', '#0ff');
                    document.body.style.setProperty('--glass-bg', 'rgba(0, 10, 20, 0.85)');
                    TimerSystem.bossMode = false;
                }
                originalNextRound.call(this);
            };

            const originalUpdate = TimerSystem.update;
            TimerSystem.update = function () {
                // Speed up if Boss Mode
                if (this.running && this.bossMode) {
                    this.timeLeft -= 0.04;
                }
                originalUpdate.call(this);
            };
        })();

        /* DRAGGABLE SYSTEM - Makes UI elements movable */
        const DraggableSystem = {
            draggedElement: null,
            offsetX: 0,
            offsetY: 0,

            init() {
                // Elements to makeDraggable
                const draggableSelectors = [
                    '#timer-panel',
                    '.big-freeze-btn',
                    '.btn-hud-rewind',
                    '.hud-top-right',
                    '.share-card-wrapper',
                    '.controls-panel',
                    '.share-message-box',
                    '.game-over-controls'
                ];

                draggableSelectors.forEach(selector => {
                    const elements = document.querySelectorAll(selector);
                    elements.forEach(element => {
                        if (element && !element.dataset.draggableInit) {
                            this.makeDraggable(element);
                            element.dataset.draggableInit = 'true';
                        }
                    });
                });

                // Setup global listeners
                if (!this.listenersAdded) {
                    document.addEventListener('mousemove', (e) => this.drag(e));
                    document.addEventListener('mouseup', () => this.endDrag());
                    this.listenersAdded = true;
                }
            },

            makeDraggable(element) {
                // Prevent transition jumps during positioning change
                const originalTransition = element.style.transition;
                element.style.transition = 'none';

                element.style.cursor = 'grab';

                // Get current visual position before any changes
                const rect = element.getBoundingClientRect();

                // Make sure positioning is fixed
                const computedStyle = window.getComputedStyle(element);
                if (computedStyle.position !== 'fixed' && computedStyle.position !== 'absolute') {
                    element.style.position = 'fixed';
                }

                // Remove transform to avoid conflicts with drag positioning
                element.style.transform = 'none';

                // Set position to current visual location
                element.style.left = rect.left + 'px';
                element.style.top = rect.top + 'px';
                element.style.right = 'auto';
                element.style.bottom = 'auto';

                // Force layout update
                element.offsetHeight; // Trigger reflow

                // Restore/Enable transitions after short delay if needed, or keep disabled for drag
                // Best to keep 'none' for drag performance, but restore if it had hover effects
                requestAnimationFrame(() => {
                    element.style.transition = originalTransition;
                });

                element.addEventListener('mousedown', (e) => this.startDrag(e, element));
            },

            startDrag(e, element) {
                // Don't drag if clicking on a button inside the element
                if (e.target.tagName === 'BUTTON' && e.target !== element) return;
                if (e.target.tagName === 'INPUT') return;
                if (e.target.tagName === 'TEXTAREA') return;

                this.draggedElement = element;
                const rect = element.getBoundingClientRect();
                this.offsetX = e.clientX - rect.left;
                this.offsetY = e.clientY - rect.top;

                element.style.cursor = 'grabbing';
                element.style.transition = 'none';
                e.preventDefault();
            },

            drag(e) {
                if (!this.draggedElement) return;

                const x = e.clientX - this.offsetX;
                const y = e.clientY - this.offsetY;

                // Keep within bounds
                const maxX = window.innerWidth - this.draggedElement.offsetWidth;
                const maxY = window.innerHeight - this.draggedElement.offsetHeight;

                const boundedX = Math.max(0, Math.min(x, maxX));
                const boundedY = Math.max(0, Math.min(y, maxY));

                this.draggedElement.style.left = boundedX + 'px';
                this.draggedElement.style.top = boundedY + 'px';
                this.draggedElement.style.right = 'auto';
                this.draggedElement.style.bottom = 'auto';
            },

            endDrag() {
                if (this.draggedElement) {
                    this.draggedElement.style.cursor = 'grab';
                    this.draggedElement.style.transition = '';
                    this.draggedElement = null;
                }
            }
        };

        // Initialize systems when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                // Initialize draggable after a delay to ensure elements exist
                setTimeout(() => {
                    DraggableSystem.init();
                    // Re-init periodically to catch dynamically added elements
                    setInterval(() => DraggableSystem.init(), 2000);
                }, 500);
            });
        } else {
            setTimeout(() => {
                DraggableSystem.init();
                setInterval(() => DraggableSystem.init(), 2000);
            }, 500);
        }

        // --- PATCH: DraggableSystem Lazy Initialization Fix ---
        // Overrides existing methods to prevent zero-rect positioning on hidden elements
        DraggableSystem.initializePosition = function (element) {
            const rect = element.getBoundingClientRect();
            if (rect.width === 0 && rect.height === 0) return;

            const computedStyle = window.getComputedStyle(element);
            if (computedStyle.position !== 'fixed') {
                element.style.position = 'fixed';
            }

            const originalTransition = element.style.transition;
            element.style.transition = 'none';
            element.style.transform = 'none';

            element.style.left = rect.left + 'px';
            element.style.top = rect.top + 'px';
            element.style.right = 'auto';
            element.style.bottom = 'auto';

            element.dataset.fixedInit = 'true';

            requestAnimationFrame(() => {
                element.style.transition = originalTransition;
            });
        };

        DraggableSystem.makeDraggable = function (element) {
            element.style.cursor = 'grab';
            element.dataset.fixedInit = 'false';
            // Remove old listeners if possible? (Hard to do without reference, 
            // but adding a new one is okay as long as we don't duplicate logic.
            // The original makeDraggable adds a listener too.
            // Wait, if the original makeDraggable ALREADY ran, we have a problem.
            // But this patch runs BEFORE init().
            // So the original makeDraggable shouldn't be called yet.
            // AND we are overwriting the function.
            // So when init() calls makeDraggable, it calls THIS one.
            element.addEventListener('mousedown', (e) => this.startDrag(e, element));
        };

        DraggableSystem.startDrag = function (e, element) {
            if (e.target.tagName === 'BUTTON' && e.target !== element) return;
            if (e.target.tagName === 'INPUT') return;
            if (e.target.tagName === 'TEXTAREA') return;

            if (element.dataset.fixedInit !== 'true') {
                this.initializePosition(element);
            }

            this.draggedElement = element;
            const rect = element.getBoundingClientRect();
            this.offsetX = e.clientX - rect.left;
            this.offsetY = e.clientY - rect.top;

            element.style.cursor = 'grabbing';
            element.style.transition = 'none';
            e.preventDefault();
        };

    </script>

    <!-- Achievement Popup (Restored for Fix) -->
    <div id="achievement-popup" class="achievement-popup">
        <div id="ach-popup-icon" style="font-size: 2rem;">🏆</div>
        <div>
            <div id="ach-popup-name" style="font-family: var(--f-title); color: var(--primary); font-size: 1.2rem;">
                ACHIEVEMENT</div>
            <div id="ach-popup-desc" style="font-family: var(--f-mono); font-size: 0.8rem; color: #ccc;">Keep playing to
                unlock</div>
        </div>
    </div>

    <!-- Gaming Border Overlay -->
    <div class="gaming-border"></div>
    <style>
        .gaming-border {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            border: 2px solid rgba(139, 0, 0, 0.3);
            pointer-events: none;
            z-index: 9000;
            box-sizing: border-box;
            box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.8);
            background:
                linear-gradient(to bottom, rgba(0, 0, 0, 0.8) 0%, transparent 10%, transparent 90%, rgba(0, 0, 0, 0.8) 100%),
                linear-gradient(to right, rgba(0, 0, 0, 0.8) 0%, transparent 10%, transparent 90%, rgba(0, 0, 0, 0.8) 100%);
        }

        .gaming-border::before,
        .gaming-border::after {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            border: 2px solid var(--danger);
            transition: all 0.3s ease;
        }

        .gaming-border::before {
            top: 20px;
            left: 20px;
            border-right: none;
            border-bottom: none;
        }

        .gaming-border::after {
            bottom: 20px;
            right: 20px;
            border-left: none;
            border-top: none;
        }
    </style>

    <!-- GOD-LEVEL LANDING PAGE SCRIPT -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Fill Archive Tags from TOPICS
            const archiveList = document.getElementById('archive-list');
            if (archiveList && typeof TOPICS !== 'undefined') {
                TOPICS.forEach(t => {
                    const el = document.createElement('span');
                    el.className = 'archive-tag';
                    el.innerText = `[${t.name}]`;
                    archiveList.appendChild(el);
                });
            }

            // [NEW] Play Landing BGM (Low Volume fade handled by system)
            if (typeof MusicSystem !== 'undefined') {
                MusicSystem.play('landing');
            }

            // 2. Master Start Button - Game Transition
            const startBtn = document.getElementById('master-start-btn');
            const landing = document.getElementById('landing-page');
            const gameWrapper = document.getElementById('neural-wrapper');

            if (startBtn && landing) {
                startBtn.addEventListener('click', () => {
                    // Play sound if available
                    if (typeof AudioSystem !== 'undefined' && AudioSystem.playClick) {
                        if (AudioSystem.ctx && AudioSystem.ctx.state === 'suspended') {
                            AudioSystem.ctx.resume();
                        }
                        AudioSystem.playClick();
                    }

                    // [NEW] Fade out Landing BGM
                    if (typeof MusicSystem !== 'undefined') {
                        MusicSystem.stop();
                    }

                    // Transition Out: Instead of display:none, just move it away
                    // So we can bring it back as a side panel
                    landing.style.opacity = '0';
                    landing.style.transform = 'translateY(-100px)';
                    landing.style.transition = '1s cubic-bezier(0.7, 0, 0.3, 1)';

                    setTimeout(() => {
                        // DO NOT set display:none here if we want to reuse it easily without reset
                        // But to prevent clicks, we might need to.
                        // Let's us a special class 'game-active' that hides it via CSS if needed, 
                        // or just rely on 'landing-side-panel' class logic later.

                        // For now, let's hide it but keep it ready
                        landing.classList.add('hidden-panel'); // We'll define this to hide it offscreen
                        landing.classList.add('landing-side-panel'); // Prep for side panel mode

                        // Reset styles that were inline
                        landing.style.opacity = '';
                        landing.style.transform = '';

                        // Show the toggle button
                        const tutBtn = document.getElementById('tutorial-toggle-btn');
                        if (tutBtn) tutBtn.classList.remove('hidden');

                        if (gameWrapper) {
                            gameWrapper.style.display = 'block';
                            // Trigger internal click-to-start
                            const internalStart = document.getElementById('click-to-start');
                            if (internalStart) internalStart.click();
                        }
                    }, 800);
                });
            }

            // [NEW] Tutorial Panel Toggle
            window.toggleTutorialPanel = function () {
                const landing = document.getElementById('landing-page');
                const btn = document.getElementById('tutorial-toggle-btn');
                const game = document.getElementById('neural-wrapper');

                if (landing && landing.classList.contains('landing-side-panel')) {
                    if (landing.classList.contains('hidden-panel')) {
                        // OPEN
                        landing.classList.remove('hidden-panel');
                        if (game) game.classList.add('game-split-mode'); // Shrink game
                        if (btn) btn.innerHTML = 'CLOSE'; // Change to close text
                        if (typeof AudioSystem !== 'undefined' && AudioSystem.playRouletteClick) AudioSystem.playRouletteClick();
                    } else {
                        // CLOSE
                        landing.classList.add('hidden-panel');
                        if (game) game.classList.remove('game-split-mode'); // Restore game
                        if (btn) btn.innerHTML = 'INFO'; // Revert to info text
                        if (typeof AudioSystem !== 'undefined' && AudioSystem.playRouletteClick) AudioSystem.playRouletteClick();
                    }
                }
            };

            // 3. Intersection Observer for Fade-In Animations
            const obs = new IntersectionObserver((entries) => {
                entries.forEach(e => {
                    if (e.isIntersecting) {
                        e.target.style.opacity = '1';
                        e.target.style.transform = 'translateY(0)';
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.exec-step, .mode-box, .faq-item').forEach(el => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(20px)';
                el.style.transition = '0.8s ease-out';
                obs.observe(el);
            });
        });


    </script>

    <!-- SKIP TEXT BUTTON (Global - Always Accessible) -->
    <button id="skip-text-btn" class="hidden">SKIP ▶▶</button>

</body>

</html>